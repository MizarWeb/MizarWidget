!function(e,t){"function"==typeof define&&define.amd?define(["jquery"],t):e.mylib=t(e.$)}(this,function(e){var t,r,n,o,s,a;!function(e){var i,n,o,s,a={},l={},u={},c={},h=Object.prototype.hasOwnProperty,d=[].slice;function p(e,t){return h.call(e,t)}function f(e,t){var i,r,n,o,s,a,l,c,h,d,p=t&&t.split("/"),f=u.map,g=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=(p=p.slice(0,p.length-1)).concat(e.split("/")),c=0;c<e.length;c+=1)if("."===(d=e[c]))e.splice(c,1),c-=1;else if(".."===d){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&f){for(c=(i=e.split("/")).length;c>0;c-=1){if(r=i.slice(0,c).join("/"),p)for(h=p.length;h>0;h-=1)if((n=f[p.slice(0,h).join("/")])&&(n=n[r])){o=n,s=c;break}if(o)break;!a&&g&&g[r]&&(a=g[r],l=c)}!o&&a&&(o=a,s=l),o&&(i.splice(0,s,o),e=i.join("/"))}return e}function g(t,i){return function(){return n.apply(e,d.call(arguments,0).concat([t,i]))}}function m(e){return function(t){a[e]=t}}function v(t){if(p(l,t)){var r=l[t];delete l[t],c[t]=!0,i.apply(e,r)}if(!p(a,t)&&!p(c,t))throw new Error("No "+t);return a[t]}function y(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}o=function(e,t){var i,r=y(e),n=r[0];return e=r[1],n&&(i=v(n=f(n,t))),n?e=i&&i.normalize?i.normalize(e,function(e){return function(t){return f(t,e)}}(t)):f(e,t):(n=(r=y(e=f(e,t)))[0],e=r[1],n&&(i=v(n))),{f:n?n+"!"+e:e,n:e,pr:n,p:i}},s={require:function(e){return g(e)},exports:function(e){var t=a[e];return void 0!==t?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:function(e){return function(){return u&&u.config&&u.config[e]||{}}}(e)}}},i=function(t,i,r,n){var u,h,d,f,y,b,x=[];if(n=n||t,"function"==typeof r){for(i=!i.length&&r.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if("require"===(h=(f=o(i[y],n)).f))x[y]=s.require(t);else if("exports"===h)x[y]=s.exports(t),b=!0;else if("module"===h)u=x[y]=s.module(t);else if(p(a,h)||p(l,h)||p(c,h))x[y]=v(h);else{if(!f.p)throw new Error(t+" missing "+h);f.p.load(f.n,g(n,!0),m(h),{}),x[y]=a[h]}d=r.apply(a[t],x),t&&(u&&u.exports!==e&&u.exports!==a[t]?a[t]=u.exports:d===e&&b||(a[t]=d))}else t&&(a[t]=r)},t=n=function(t,r,a,l,c){return"string"==typeof t?s[t]?s[t](r):v(o(t,r).f):(t.splice||(u=t,r.splice?(t=r,r=a,a=null):t=e),r=r||function(){},"function"==typeof a&&(a=l,l=c),l?i(e,t,r,a):setTimeout(function(){i(e,t,r,a)},4),n)},n.config=function(e){return(u=e).deps&&n(u.deps,u.callback),n},(r=function(e,t,i){t.splice||(i=t,t=[]),p(a,e)||p(l,e)||(l[e]=[e,t,i])}).amd={jQuery:!0}}(),r("../build/almond",function(){}),n="undefined"!=typeof window?window:this,o=function(e,t){var i=[],n=e.document,o=i.slice,s=i.concat,a=i.push,l=i.indexOf,u={},c=u.toString,h=u.hasOwnProperty,d={},p="2.2.4",f=function(e,t){return new f.fn.init(e,t)},g=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,m=/^-ms-/,v=/-([\da-z])/gi,y=function(e,t){return t.toUpperCase()};function b(e){var t=!!e&&"length"in e&&e.length,i=f.type(e);return"function"!==i&&!f.isWindow(e)&&("array"===i||0===t||"number"==typeof t&&t>0&&t-1 in e)}f.fn=f.prototype={jquery:p,constructor:f,selector:"",length:0,toArray:function(){return o.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:o.call(this)},pushStack:function(e){var t=f.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return f.each(this,e)},map:function(e){return this.pushStack(f.map(this,function(t,i){return e.call(t,i,t)}))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:a,sort:i.sort,splice:i.splice},f.extend=f.fn.extend=function(){var e,t,i,r,n,o,s=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[a]||{},a++),"object"==typeof s||f.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(e=arguments[a]))for(t in e)i=s[t],s!==(r=e[t])&&(u&&r&&(f.isPlainObject(r)||(n=f.isArray(r)))?(n?(n=!1,o=i&&f.isArray(i)?i:[]):o=i&&f.isPlainObject(i)?i:{},s[t]=f.extend(u,o,r)):void 0!==r&&(s[t]=r));return s},f.extend({expando:"jQuery"+(p+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===f.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=e&&e.toString();return!f.isArray(e)&&t-parseFloat(t)+1>=0},isPlainObject:function(e){var t;if("object"!==f.type(e)||e.nodeType||f.isWindow(e))return!1;if(e.constructor&&!h.call(e,"constructor")&&!h.call(e.constructor.prototype||{},"isPrototypeOf"))return!1;for(t in e);return void 0===t||h.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?u[c.call(e)]||"object":typeof e},globalEval:function(e){var t,i=eval;(e=f.trim(e))&&(1===e.indexOf("use strict")?((t=n.createElement("script")).text=e,n.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(m,"ms-").replace(v,y)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var i,r=0;if(b(e))for(i=e.length;i>r&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(g,"")},makeArray:function(e,t){var i=t||[];return null!=e&&(b(Object(e))?f.merge(i,"string"==typeof e?[e]:e):a.call(i,e)),i},inArray:function(e,t,i){return null==t?-1:l.call(t,e,i)},merge:function(e,t){for(var i=+t.length,r=0,n=e.length;i>r;r++)e[n++]=t[r];return e.length=n,e},grep:function(e,t,i){for(var r=[],n=0,o=e.length,s=!i;o>n;n++)!t(e[n],n)!==s&&r.push(e[n]);return r},map:function(e,t,i){var r,n,o=0,a=[];if(b(e))for(r=e.length;r>o;o++)null!=(n=t(e[o],o,i))&&a.push(n);else for(o in e)null!=(n=t(e[o],o,i))&&a.push(n);return s.apply([],a)},guid:1,proxy:function(e,t){var i,r,n;return"string"==typeof t&&(i=e[t],t=e,e=i),f.isFunction(e)?(r=o.call(arguments,2),(n=function(){return e.apply(t||this,r.concat(o.call(arguments)))}).guid=e.guid=e.guid||f.guid++,n):void 0},now:Date.now,support:d}),"function"==typeof Symbol&&(f.fn[Symbol.iterator]=i[Symbol.iterator]),f.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){u["[object "+t+"]"]=t.toLowerCase()});var x=function(e){var t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x="sizzle"+1*new Date,w=e.document,T=0,_=0,C=oe(),S=oe(),E=oe(),A=function(e,t){return e===t&&(h=!0),0},I=1<<31,M={}.hasOwnProperty,k=[],D=k.pop,R=k.push,P=k.push,L=k.slice,N=function(e,t){for(var i=0,r=e.length;r>i;i++)if(e[i]===t)return i;return-1},O="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",F="[\\x20\\t\\r\\n\\f]",B="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",G="\\["+F+"*("+B+")(?:"+F+"*([*^$|!~]?=)"+F+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+B+"))|)"+F+"*\\]",U=":("+B+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+G+")*)|.*)\\)|)",z=new RegExp(F+"+","g"),V=new RegExp("^"+F+"+|((?:^|[^\\\\])(?:\\\\.)*)"+F+"+$","g"),j=new RegExp("^"+F+"*,"+F+"*"),W=new RegExp("^"+F+"*([>+~]|"+F+")"+F+"*"),Y=new RegExp("="+F+"*([^\\]'\"]*?)"+F+"*\\]","g"),H=new RegExp(U),q=new RegExp("^"+B+"$"),X={ID:new RegExp("^#("+B+")"),CLASS:new RegExp("^\\.("+B+")"),TAG:new RegExp("^("+B+"|[*])"),ATTR:new RegExp("^"+G),PSEUDO:new RegExp("^"+U),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+F+"*(even|odd|(([+-]|)(\\d*)n|)"+F+"*(?:([+-]|)"+F+"*(\\d+)|))"+F+"*\\)|)","i"),bool:new RegExp("^(?:"+O+")$","i"),needsContext:new RegExp("^"+F+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+F+"*((?:-\\d)?\\d*)"+F+"*\\)|)(?=[^-]|$)","i")},Z=/^(?:input|select|textarea|button)$/i,K=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,Q=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,$=/[+~]/,ee=/'|\\/g,te=new RegExp("\\\\([\\da-f]{1,6}"+F+"?|("+F+")|.)","ig"),ie=function(e,t,i){var r="0x"+t-65536;return r!=r||i?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=function(){d()};try{P.apply(k=L.call(w.childNodes),w.childNodes),k[w.childNodes.length].nodeType}catch(e){P={apply:k.length?function(e,t){R.apply(e,L.call(t))}:function(e,t){for(var i=e.length,r=0;e[i++]=t[r++];);e.length=i-1}}}function ne(e,t,r,n){var o,a,u,c,h,f,v,y,T=t&&t.ownerDocument,_=t?t.nodeType:9;if(r=r||[],"string"!=typeof e||!e||1!==_&&9!==_&&11!==_)return r;if(!n&&((t?t.ownerDocument||t:w)!==p&&d(t),t=t||p,g)){if(11!==_&&(f=Q.exec(e)))if(o=f[1]){if(9===_){if(!(u=t.getElementById(o)))return r;if(u.id===o)return r.push(u),r}else if(T&&(u=T.getElementById(o))&&b(t,u)&&u.id===o)return r.push(u),r}else{if(f[2])return P.apply(r,t.getElementsByTagName(e)),r;if((o=f[3])&&i.getElementsByClassName&&t.getElementsByClassName)return P.apply(r,t.getElementsByClassName(o)),r}if(i.qsa&&!E[e+" "]&&(!m||!m.test(e))){if(1!==_)T=t,y=e;else if("object"!==t.nodeName.toLowerCase()){for((c=t.getAttribute("id"))?c=c.replace(ee,"\\$&"):t.setAttribute("id",c=x),a=(v=s(e)).length,h=q.test(c)?"#"+c:"[id='"+c+"']";a--;)v[a]=h+" "+ge(v[a]);y=v.join(","),T=$.test(e)&&pe(t.parentNode)||t}if(y)try{return P.apply(r,T.querySelectorAll(y)),r}catch(e){}finally{c===x&&t.removeAttribute("id")}}}return l(e.replace(V,"$1"),t,r,n)}function oe(){var e=[];return function t(i,n){return e.push(i+" ")>r.cacheLength&&delete t[e.shift()],t[i+" "]=n}}function se(e){return e[x]=!0,e}function ae(e){var t=p.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function le(e,t){for(var i=e.split("|"),n=i.length;n--;)r.attrHandle[i[n]]=t}function ue(e,t){var i=t&&e,r=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||I)-(~e.sourceIndex||I);if(r)return r;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function ce(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function he(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function de(e){return se(function(t){return t=+t,se(function(i,r){for(var n,o=e([],i.length,t),s=o.length;s--;)i[n=o[s]]&&(i[n]=!(r[n]=i[n]))})})}function pe(e){return e&&void 0!==e.getElementsByTagName&&e}for(t in i=ne.support={},o=ne.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},d=ne.setDocument=function(e){var t,n,s=e?e.ownerDocument||e:w;return s!==p&&9===s.nodeType&&s.documentElement?(f=(p=s).documentElement,g=!o(p),(n=p.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",re,!1):n.attachEvent&&n.attachEvent("onunload",re)),i.attributes=ae(function(e){return e.className="i",!e.getAttribute("className")}),i.getElementsByTagName=ae(function(e){return e.appendChild(p.createComment("")),!e.getElementsByTagName("*").length}),i.getElementsByClassName=J.test(p.getElementsByClassName),i.getById=ae(function(e){return f.appendChild(e).id=x,!p.getElementsByName||!p.getElementsByName(x).length}),i.getById?(r.find.ID=function(e,t){if(void 0!==t.getElementById&&g){var i=t.getElementById(e);return i?[i]:[]}},r.filter.ID=function(e){var t=e.replace(te,ie);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(te,ie);return function(e){var i=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return i&&i.value===t}}),r.find.TAG=i.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):i.qsa?t.querySelectorAll(e):void 0}:function(e,t){var i,r=[],n=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[n++];)1===i.nodeType&&r.push(i);return r}return o},r.find.CLASS=i.getElementsByClassName&&function(e,t){return void 0!==t.getElementsByClassName&&g?t.getElementsByClassName(e):void 0},v=[],m=[],(i.qsa=J.test(p.querySelectorAll))&&(ae(function(e){f.appendChild(e).innerHTML="<a id='"+x+"'></a><select id='"+x+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+F+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+F+"*(?:value|"+O+")"),e.querySelectorAll("[id~="+x+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+x+"+*").length||m.push(".#.+[+~]")}),ae(function(e){var t=p.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+F+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(i.matchesSelector=J.test(y=f.matches||f.webkitMatchesSelector||f.mozMatchesSelector||f.oMatchesSelector||f.msMatchesSelector))&&ae(function(e){i.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),v.push("!=",U)}),m=m.length&&new RegExp(m.join("|")),v=v.length&&new RegExp(v.join("|")),t=J.test(f.compareDocumentPosition),b=t||J.test(f.contains)?function(e,t){var i=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(i.contains?i.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},A=t?function(e,t){if(e===t)return h=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r||(1&(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!i.sortDetached&&t.compareDocumentPosition(e)===r?e===p||e.ownerDocument===w&&b(w,e)?-1:t===p||t.ownerDocument===w&&b(w,t)?1:c?N(c,e)-N(c,t):0:4&r?-1:1)}:function(e,t){if(e===t)return h=!0,0;var i,r=0,n=e.parentNode,o=t.parentNode,s=[e],a=[t];if(!n||!o)return e===p?-1:t===p?1:n?-1:o?1:c?N(c,e)-N(c,t):0;if(n===o)return ue(e,t);for(i=e;i=i.parentNode;)s.unshift(i);for(i=t;i=i.parentNode;)a.unshift(i);for(;s[r]===a[r];)r++;return r?ue(s[r],a[r]):s[r]===w?-1:a[r]===w?1:0},p):p},ne.matches=function(e,t){return ne(e,null,null,t)},ne.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&d(e),t=t.replace(Y,"='$1']"),i.matchesSelector&&g&&!E[t+" "]&&(!v||!v.test(t))&&(!m||!m.test(t)))try{var r=y.call(e,t);if(r||i.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return ne(t,p,null,[e]).length>0},ne.contains=function(e,t){return(e.ownerDocument||e)!==p&&d(e),b(e,t)},ne.attr=function(e,t){(e.ownerDocument||e)!==p&&d(e);var n=r.attrHandle[t.toLowerCase()],o=n&&M.call(r.attrHandle,t.toLowerCase())?n(e,t,!g):void 0;return void 0!==o?o:i.attributes||!g?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},ne.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ne.uniqueSort=function(e){var t,r=[],n=0,o=0;if(h=!i.detectDuplicates,c=!i.sortStable&&e.slice(0),e.sort(A),h){for(;t=e[o++];)t===e[o]&&(n=r.push(o));for(;n--;)e.splice(r[n],1)}return c=null,e},n=ne.getText=function(e){var t,i="",r=0,o=e.nodeType;if(o){if(1===o||9===o||11===o){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=n(e)}else if(3===o||4===o)return e.nodeValue}else for(;t=e[r++];)i+=n(t);return i},(r=ne.selectors={cacheLength:50,createPseudo:se,match:X,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ie),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ie),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ne.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ne.error(e[0]),e},PSEUDO:function(e){var t,i=!e[6]&&e[2];return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":i&&H.test(i)&&(t=s(i,!0))&&(t=i.indexOf(")",i.length-t)-i.length)&&(e[0]=e[0].slice(0,t),e[2]=i.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ie).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=C[e+" "];return t||(t=new RegExp("(^|"+F+")"+e+"("+F+"|$)"))&&C(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,i){return function(r){var n=ne.attr(r,e);return null==n?"!="===t:!t||(n+="","="===t?n===i:"!="===t?n!==i:"^="===t?i&&0===n.indexOf(i):"*="===t?i&&n.indexOf(i)>-1:"$="===t?i&&n.slice(-i.length)===i:"~="===t?(" "+n.replace(z," ")+" ").indexOf(i)>-1:"|="===t&&(n===i||n.slice(0,i.length+1)===i+"-"))}},CHILD:function(e,t,i,r,n){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===n?function(e){return!!e.parentNode}:function(t,i,l){var u,c,h,d,p,f,g=o!==s?"nextSibling":"previousSibling",m=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a,b=!1;if(m){if(o){for(;g;){for(d=t;d=d[g];)if(a?d.nodeName.toLowerCase()===v:1===d.nodeType)return!1;f=g="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?m.firstChild:m.lastChild],s&&y){for(b=(p=(u=(c=(h=(d=m)[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===T&&u[1])&&u[2],d=p&&m.childNodes[p];d=++p&&d&&d[g]||(b=p=0)||f.pop();)if(1===d.nodeType&&++b&&d===t){c[e]=[T,p,b];break}}else if(y&&(b=p=(u=(c=(h=(d=t)[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]||[])[0]===T&&u[1]),!1===b)for(;(d=++p&&d&&d[g]||(b=p=0)||f.pop())&&((a?d.nodeName.toLowerCase()!==v:1!==d.nodeType)||!++b||(y&&((c=(h=d[x]||(d[x]={}))[d.uniqueID]||(h[d.uniqueID]={}))[e]=[T,b]),d!==t)););return(b-=n)===r||b%r==0&&b/r>=0}}},PSEUDO:function(e,t){var i,n=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ne.error("unsupported pseudo: "+e);return n[x]?n(t):n.length>1?(i=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?se(function(e,i){for(var r,o=n(e,t),s=o.length;s--;)e[r=N(e,o[s])]=!(i[r]=o[s])}):function(e){return n(e,0,i)}):n}},pseudos:{not:se(function(e){var t=[],i=[],r=a(e.replace(V,"$1"));return r[x]?se(function(e,t,i,n){for(var o,s=r(e,null,n,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,n,o){return t[0]=e,r(t,null,o,i),t[0]=null,!i.pop()}}),has:se(function(e){return function(t){return ne(e,t).length>0}}),contains:se(function(e){return e=e.replace(te,ie),function(t){return(t.textContent||t.innerText||n(t)).indexOf(e)>-1}}),lang:se(function(e){return q.test(e||"")||ne.error("unsupported lang: "+e),e=e.replace(te,ie).toLowerCase(),function(t){var i;do{if(i=g?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(i=i.toLowerCase())===e||0===i.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===f},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return K.test(e.nodeName)},input:function(e){return Z.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:de(function(){return[0]}),last:de(function(e,t){return[t-1]}),eq:de(function(e,t,i){return[0>i?i+t:i]}),even:de(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:de(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:de(function(e,t,i){for(var r=0>i?i+t:i;--r>=0;)e.push(r);return e}),gt:de(function(e,t,i){for(var r=0>i?i+t:i;++r<t;)e.push(r);return e})}}).pseudos.nth=r.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ce(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=he(t);function fe(){}function ge(e){for(var t=0,i=e.length,r="";i>t;t++)r+=e[t].value;return r}function me(e,t,i){var r=t.dir,n=i&&"parentNode"===r,o=_++;return t.first?function(t,i,o){for(;t=t[r];)if(1===t.nodeType||n)return e(t,i,o)}:function(t,i,s){var a,l,u,c=[T,o];if(s){for(;t=t[r];)if((1===t.nodeType||n)&&e(t,i,s))return!0}else for(;t=t[r];)if(1===t.nodeType||n){if((a=(l=(u=t[x]||(t[x]={}))[t.uniqueID]||(u[t.uniqueID]={}))[r])&&a[0]===T&&a[1]===o)return c[2]=a[2];if(l[r]=c,c[2]=e(t,i,s))return!0}}}function ve(e){return e.length>1?function(t,i,r){for(var n=e.length;n--;)if(!e[n](t,i,r))return!1;return!0}:e[0]}function ye(e,t,i,r,n){for(var o,s=[],a=0,l=e.length,u=null!=t;l>a;a++)(o=e[a])&&(i&&!i(o,r,n)||(s.push(o),u&&t.push(a)));return s}function be(e,t,i,r,n,o){return r&&!r[x]&&(r=be(r)),n&&!n[x]&&(n=be(n,o)),se(function(o,s,a,l){var u,c,h,d=[],p=[],f=s.length,g=o||function(e,t,i){for(var r=0,n=t.length;n>r;r++)ne(e,t[r],i);return i}(t||"*",a.nodeType?[a]:a,[]),m=!e||!o&&t?g:ye(g,d,e,a,l),v=i?n||(o?e:f||r)?[]:s:m;if(i&&i(m,v,a,l),r)for(u=ye(v,p),r(u,[],a,l),c=u.length;c--;)(h=u[c])&&(v[p[c]]=!(m[p[c]]=h));if(o){if(n||e){if(n){for(u=[],c=v.length;c--;)(h=v[c])&&u.push(m[c]=h);n(null,v=[],u,l)}for(c=v.length;c--;)(h=v[c])&&(u=n?N(o,h):d[c])>-1&&(o[u]=!(s[u]=h))}}else v=ye(v===s?v.splice(f,v.length):v),n?n(null,s,v,l):P.apply(s,v)})}function xe(e){for(var t,i,n,o=e.length,s=r.relative[e[0].type],a=s||r.relative[" "],l=s?1:0,c=me(function(e){return e===t},a,!0),h=me(function(e){return N(t,e)>-1},a,!0),d=[function(e,i,r){var n=!s&&(r||i!==u)||((t=i).nodeType?c(e,i,r):h(e,i,r));return t=null,n}];o>l;l++)if(i=r.relative[e[l].type])d=[me(ve(d),i)];else{if((i=r.filter[e[l].type].apply(null,e[l].matches))[x]){for(n=++l;o>n&&!r.relative[e[n].type];n++);return be(l>1&&ve(d),l>1&&ge(e.slice(0,l-1).concat({value:" "===e[l-2].type?"*":""})).replace(V,"$1"),i,n>l&&xe(e.slice(l,n)),o>n&&xe(e=e.slice(n)),o>n&&ge(e))}d.push(i)}return ve(d)}function we(e,t){var i=t.length>0,n=e.length>0,o=function(o,s,a,l,c){var h,f,m,v=0,y="0",b=o&&[],x=[],w=u,_=o||n&&r.find.TAG("*",c),C=T+=null==w?1:Math.random()||.1,S=_.length;for(c&&(u=s===p||s||c);y!==S&&null!=(h=_[y]);y++){if(n&&h){for(f=0,s||h.ownerDocument===p||(d(h),a=!g);m=e[f++];)if(m(h,s||p,a)){l.push(h);break}c&&(T=C)}i&&((h=!m&&h)&&v--,o&&b.push(h))}if(v+=y,i&&y!==v){for(f=0;m=t[f++];)m(b,x,s,a);if(o){if(v>0)for(;y--;)b[y]||x[y]||(x[y]=D.call(l));x=ye(x)}P.apply(l,x),c&&!o&&x.length>0&&v+t.length>1&&ne.uniqueSort(l)}return c&&(T=C,u=w),b};return i?se(o):o}return fe.prototype=r.filters=r.pseudos,r.setFilters=new fe,s=ne.tokenize=function(e,t){var i,n,o,s,a,l,u,c=S[e+" "];if(c)return t?0:c.slice(0);for(a=e,l=[],u=r.preFilter;a;){for(s in i&&!(n=j.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(o=[])),i=!1,(n=W.exec(a))&&(i=n.shift(),o.push({value:i,type:n[0].replace(V," ")}),a=a.slice(i.length)),r.filter)!(n=X[s].exec(a))||u[s]&&!(n=u[s](n))||(i=n.shift(),o.push({value:i,type:s,matches:n}),a=a.slice(i.length));if(!i)break}return t?a.length:a?ne.error(e):S(e,l).slice(0)},a=ne.compile=function(e,t){var i,r=[],n=[],o=E[e+" "];if(!o){for(t||(t=s(e)),i=t.length;i--;)(o=xe(t[i]))[x]?r.push(o):n.push(o);(o=E(e,we(n,r))).selector=e}return o},l=ne.select=function(e,t,n,o){var l,u,c,h,d,p="function"==typeof e&&e,f=!o&&s(e=p.selector||e);if(n=n||[],1===f.length){if((u=f[0]=f[0].slice(0)).length>2&&"ID"===(c=u[0]).type&&i.getById&&9===t.nodeType&&g&&r.relative[u[1].type]){if(!(t=(r.find.ID(c.matches[0].replace(te,ie),t)||[])[0]))return n;p&&(t=t.parentNode),e=e.slice(u.shift().value.length)}for(l=X.needsContext.test(e)?0:u.length;l--&&(c=u[l],!r.relative[h=c.type]);)if((d=r.find[h])&&(o=d(c.matches[0].replace(te,ie),$.test(u[0].type)&&pe(t.parentNode)||t))){if(u.splice(l,1),!(e=o.length&&ge(u)))return P.apply(n,o),n;break}}return(p||a(e,f))(o,t,!g,n,!t||$.test(e)&&pe(t.parentNode)||t),n},i.sortStable=x.split("").sort(A).join("")===x,i.detectDuplicates=!!h,d(),i.sortDetached=ae(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),ae(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||le("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),i.attributes&&ae(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||le("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ae(function(e){return null==e.getAttribute("disabled")})||le(O,function(e,t,i){var r;return i?void 0:!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),ne}(e);f.find=x,f.expr=x.selectors,f.expr[":"]=f.expr.pseudos,f.uniqueSort=f.unique=x.uniqueSort,f.text=x.getText,f.isXMLDoc=x.isXML,f.contains=x.contains;var w=function(e,t,i){for(var r=[],n=void 0!==i;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(n&&f(e).is(i))break;r.push(e)}return r},T=function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i},_=f.expr.match.needsContext,C=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,S=/^.[^:#\[\.,]*$/;function E(e,t,i){if(f.isFunction(t))return f.grep(e,function(e,r){return!!t.call(e,r,e)!==i});if(t.nodeType)return f.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(S.test(t))return f.filter(t,e,i);t=f.filter(t,e)}return f.grep(e,function(e){return l.call(t,e)>-1!==i})}f.filter=function(e,t,i){var r=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?f.find.matchesSelector(r,e)?[r]:[]:f.find.matches(e,f.grep(t,function(e){return 1===e.nodeType}))},f.fn.extend({find:function(e){var t,i=this.length,r=[],n=this;if("string"!=typeof e)return this.pushStack(f(e).filter(function(){for(t=0;i>t;t++)if(f.contains(n[t],this))return!0}));for(t=0;i>t;t++)f.find(e,n[t],r);return(r=this.pushStack(i>1?f.unique(r):r)).selector=this.selector?this.selector+" "+e:e,r},filter:function(e){return this.pushStack(E(this,e||[],!1))},not:function(e){return this.pushStack(E(this,e||[],!0))},is:function(e){return!!E(this,"string"==typeof e&&_.test(e)?f(e):e||[],!1).length}});var A,I=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(f.fn.init=function(e,t,i){var r,o;if(!e)return this;if(i=i||A,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:I.exec(e))||!r[1]&&t)return!t||t.jquery?(t||i).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof f?t[0]:t,f.merge(this,f.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:n,!0)),C.test(r[1])&&f.isPlainObject(t))for(r in t)f.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(o=n.getElementById(r[2]))&&o.parentNode&&(this.length=1,this[0]=o),this.context=n,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):f.isFunction(e)?void 0!==i.ready?i.ready(e):e(f):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),f.makeArray(e,this))}).prototype=f.fn,A=f(n);var M=/^(?:parents|prev(?:Until|All))/,k={children:!0,contents:!0,next:!0,prev:!0};function D(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}f.fn.extend({has:function(e){var t=f(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(f.contains(this,t[e]))return!0})},closest:function(e,t){for(var i,r=0,n=this.length,o=[],s=_.test(e)||"string"!=typeof e?f(e,t||this.context):0;n>r;r++)for(i=this[r];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&f.find.matchesSelector(i,e))){o.push(i);break}return this.pushStack(o.length>1?f.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?l.call(f(e),this[0]):l.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(f.uniqueSort(f.merge(this.get(),f(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),f.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return w(e,"parentNode")},parentsUntil:function(e,t,i){return w(e,"parentNode",i)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return w(e,"nextSibling")},prevAll:function(e){return w(e,"previousSibling")},nextUntil:function(e,t,i){return w(e,"nextSibling",i)},prevUntil:function(e,t,i){return w(e,"previousSibling",i)},siblings:function(e){return T((e.parentNode||{}).firstChild,e)},children:function(e){return T(e.firstChild)},contents:function(e){return e.contentDocument||f.merge([],e.childNodes)}},function(e,t){f.fn[e]=function(i,r){var n=f.map(this,t,i);return"Until"!==e.slice(-5)&&(r=i),r&&"string"==typeof r&&(n=f.filter(r,n)),this.length>1&&(k[e]||f.uniqueSort(n),M.test(e)&&n.reverse()),this.pushStack(n)}});var R,P=/\S+/g;function L(){n.removeEventListener("DOMContentLoaded",L),e.removeEventListener("load",L),f.ready()}f.Callbacks=function(e){e="string"==typeof e?function(e){var t={};return f.each(e.match(P)||[],function(e,i){t[i]=!0}),t}(e):f.extend({},e);var t,i,r,n,o=[],s=[],a=-1,l=function(){for(n=e.once,r=t=!0;s.length;a=-1)for(i=s.shift();++a<o.length;)!1===o[a].apply(i[0],i[1])&&e.stopOnFalse&&(a=o.length,i=!1);e.memory||(i=!1),t=!1,n&&(o=i?[]:"")},u={add:function(){return o&&(i&&!t&&(a=o.length-1,s.push(i)),function t(i){f.each(i,function(i,r){f.isFunction(r)?e.unique&&u.has(r)||o.push(r):r&&r.length&&"string"!==f.type(r)&&t(r)})}(arguments),i&&!t&&l()),this},remove:function(){return f.each(arguments,function(e,t){for(var i;(i=f.inArray(t,o,i))>-1;)o.splice(i,1),a>=i&&a--}),this},has:function(e){return e?f.inArray(e,o)>-1:o.length>0},empty:function(){return o&&(o=[]),this},disable:function(){return n=s=[],o=i="",this},disabled:function(){return!o},lock:function(){return n=s=[],i||(o=i=""),this},locked:function(){return!!n},fireWith:function(e,i){return n||(i=[e,(i=i||[]).slice?i.slice():i],s.push(i),t||l()),this},fire:function(){return u.fireWith(this,arguments),this},fired:function(){return!!r}};return u},f.extend({Deferred:function(e){var t=[["resolve","done",f.Callbacks("once memory"),"resolved"],["reject","fail",f.Callbacks("once memory"),"rejected"],["notify","progress",f.Callbacks("memory")]],i="pending",r={state:function(){return i},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var e=arguments;return f.Deferred(function(i){f.each(t,function(t,o){var s=f.isFunction(e[t])&&e[t];n[o[1]](function(){var e=s&&s.apply(this,arguments);e&&f.isFunction(e.promise)?e.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[o[0]+"With"](this===r?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?f.extend(e,r):r}},n={};return r.pipe=r.then,f.each(t,function(e,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add(function(){i=a},t[1^e][2].disable,t[2][2].lock),n[o[0]]=function(){return n[o[0]+"With"](this===n?r:this,arguments),this},n[o[0]+"With"]=s.fireWith}),r.promise(n),e&&e.call(n,n),n},when:function(e){var t,i,r,n=0,s=o.call(arguments),a=s.length,l=1!==a||e&&f.isFunction(e.promise)?a:0,u=1===l?e:f.Deferred(),c=function(e,i,r){return function(n){i[e]=this,r[e]=arguments.length>1?o.call(arguments):n,r===t?u.notifyWith(i,r):--l||u.resolveWith(i,r)}};if(a>1)for(t=new Array(a),i=new Array(a),r=new Array(a);a>n;n++)s[n]&&f.isFunction(s[n].promise)?s[n].promise().progress(c(n,i,t)).done(c(n,r,s)).fail(u.reject):--l;return l||u.resolveWith(r,s),u.promise()}}),f.fn.ready=function(e){return f.ready.promise().done(e),this},f.extend({isReady:!1,readyWait:1,holdReady:function(e){e?f.readyWait++:f.ready(!0)},ready:function(e){(!0===e?--f.readyWait:f.isReady)||(f.isReady=!0,!0!==e&&--f.readyWait>0||(R.resolveWith(n,[f]),f.fn.triggerHandler&&(f(n).triggerHandler("ready"),f(n).off("ready"))))}}),f.ready.promise=function(t){return R||(R=f.Deferred(),"complete"===n.readyState||"loading"!==n.readyState&&!n.documentElement.doScroll?e.setTimeout(f.ready):(n.addEventListener("DOMContentLoaded",L),e.addEventListener("load",L))),R.promise(t)},f.ready.promise();var N=function(e,t,i,r,n,o,s){var a=0,l=e.length,u=null==i;if("object"===f.type(i))for(a in n=!0,i)N(e,t,a,i[a],!0,o,s);else if(void 0!==r&&(n=!0,f.isFunction(r)||(s=!0),u&&(s?(t.call(e,r),t=null):(u=t,t=function(e,t,i){return u.call(f(e),i)})),t))for(;l>a;a++)t(e[a],i,s?r:r.call(e[a],a,t(e[a],i)));return n?e:u?t.call(e):l?t(e[0],i):o},O=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function F(){this.expando=f.expando+F.uid++}F.uid=1,F.prototype={register:function(e,t){var i=t||{};return e.nodeType?e[this.expando]=i:Object.defineProperty(e,this.expando,{value:i,writable:!0,configurable:!0}),e[this.expando]},cache:function(e){if(!O(e))return{};var t=e[this.expando];return t||(t={},O(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,i){var r,n=this.cache(e);if("string"==typeof t)n[t]=i;else for(r in t)n[r]=t[r];return n},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][t]},access:function(e,t,i){var r;return void 0===t||t&&"string"==typeof t&&void 0===i?void 0!==(r=this.get(e,t))?r:this.get(e,f.camelCase(t)):(this.set(e,t,i),void 0!==i?i:t)},remove:function(e,t){var i,r,n,o=e[this.expando];if(void 0!==o){if(void 0===t)this.register(e);else{f.isArray(t)?r=t.concat(t.map(f.camelCase)):(n=f.camelCase(t),t in o?r=[t,n]:r=(r=n)in o?[r]:r.match(P)||[]),i=r.length;for(;i--;)delete o[r[i]]}(void 0===t||f.isEmptyObject(o))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!f.isEmptyObject(t)}};var B=new F,G=new F,U=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,z=/[A-Z]/g;function V(e,t,i){var r;if(void 0===i&&1===e.nodeType)if(r="data-"+t.replace(z,"-$&").toLowerCase(),"string"==typeof(i=e.getAttribute(r))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:U.test(i)?f.parseJSON(i):i)}catch(e){}G.set(e,t,i)}else i=void 0;return i}f.extend({hasData:function(e){return G.hasData(e)||B.hasData(e)},data:function(e,t,i){return G.access(e,t,i)},removeData:function(e,t){G.remove(e,t)},_data:function(e,t,i){return B.access(e,t,i)},_removeData:function(e,t){B.remove(e,t)}}),f.fn.extend({data:function(e,t){var i,r,n,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(n=G.get(o),1===o.nodeType&&!B.get(o,"hasDataAttrs"))){for(i=s.length;i--;)s[i]&&(0===(r=s[i].name).indexOf("data-")&&(r=f.camelCase(r.slice(5)),V(o,r,n[r])));B.set(o,"hasDataAttrs",!0)}return n}return"object"==typeof e?this.each(function(){G.set(this,e)}):N(this,function(t){var i,r;if(o&&void 0===t){if(void 0!==(i=G.get(o,e)||G.get(o,e.replace(z,"-$&").toLowerCase())))return i;if(r=f.camelCase(e),void 0!==(i=G.get(o,r)))return i;if(void 0!==(i=V(o,r,void 0)))return i}else r=f.camelCase(e),this.each(function(){var i=G.get(this,r);G.set(this,r,t),e.indexOf("-")>-1&&void 0!==i&&G.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){G.remove(this,e)})}}),f.extend({queue:function(e,t,i){var r;return e?(t=(t||"fx")+"queue",r=B.get(e,t),i&&(!r||f.isArray(i)?r=B.access(e,t,f.makeArray(i)):r.push(i)),r||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=f.queue(e,t),r=i.length,n=i.shift(),o=f._queueHooks(e,t);"inprogress"===n&&(n=i.shift(),r--),n&&("fx"===t&&i.unshift("inprogress"),delete o.stop,n.call(e,function(){f.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return B.get(e,i)||B.access(e,i,{empty:f.Callbacks("once memory").add(function(){B.remove(e,[t+"queue",i])})})}}),f.fn.extend({queue:function(e,t){var i=2;return"string"!=typeof e&&(t=e,e="fx",i--),arguments.length<i?f.queue(this[0],e):void 0===t?this:this.each(function(){var i=f.queue(this,e,t);f._queueHooks(this,e),"fx"===e&&"inprogress"!==i[0]&&f.dequeue(this,e)})},dequeue:function(e){return this.each(function(){f.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var i,r=1,n=f.Deferred(),o=this,s=this.length,a=function(){--r||n.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(i=B.get(o[s],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(a));return a(),n.promise(t)}});var j=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,W=new RegExp("^(?:([+-])=|)("+j+")([a-z%]*)$","i"),Y=["Top","Right","Bottom","Left"],H=function(e,t){return e=t||e,"none"===f.css(e,"display")||!f.contains(e.ownerDocument,e)};function q(e,t,i,r){var n,o=1,s=20,a=r?function(){return r.cur()}:function(){return f.css(e,t,"")},l=a(),u=i&&i[3]||(f.cssNumber[t]?"":"px"),c=(f.cssNumber[t]||"px"!==u&&+l)&&W.exec(f.css(e,t));if(c&&c[3]!==u){u=u||c[3],i=i||[],c=+l||1;do{c/=o=o||".5",f.style(e,t,c+u)}while(o!==(o=a()/l)&&1!==o&&--s)}return i&&(c=+c||+l||0,n=i[1]?c+(i[1]+1)*i[2]:+i[2],r&&(r.unit=u,r.start=c,r.end=n)),n}var X=/^(?:checkbox|radio)$/i,Z=/<([\w:-]+)/,K=/^$|\/(?:java|ecma)script/i,J={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function Q(e,t){var i=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&f.nodeName(e,t)?f.merge([e],i):i}function $(e,t){for(var i=0,r=e.length;r>i;i++)B.set(e[i],"globalEval",!t||B.get(t[i],"globalEval"))}J.optgroup=J.option,J.tbody=J.tfoot=J.colgroup=J.caption=J.thead,J.th=J.td;var ee=/<|&#?\w+;/;function te(e,t,i,r,n){for(var o,s,a,l,u,c,h=t.createDocumentFragment(),d=[],p=0,g=e.length;g>p;p++)if((o=e[p])||0===o)if("object"===f.type(o))f.merge(d,o.nodeType?[o]:o);else if(ee.test(o)){for(s=s||h.appendChild(t.createElement("div")),a=(Z.exec(o)||["",""])[1].toLowerCase(),l=J[a]||J._default,s.innerHTML=l[1]+f.htmlPrefilter(o)+l[2],c=l[0];c--;)s=s.lastChild;f.merge(d,s.childNodes),(s=h.firstChild).textContent=""}else d.push(t.createTextNode(o));for(h.textContent="",p=0;o=d[p++];)if(r&&f.inArray(o,r)>-1)n&&n.push(o);else if(u=f.contains(o.ownerDocument,o),s=Q(h.appendChild(o),"script"),u&&$(s),i)for(c=0;o=s[c++];)K.test(o.type||"")&&i.push(o);return h}!function(){var e=n.createDocumentFragment().appendChild(n.createElement("div")),t=n.createElement("input");t.setAttribute("type","radio"),t.setAttribute("checked","checked"),t.setAttribute("name","t"),e.appendChild(t),d.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var ie=/^key/,re=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,ne=/^([^.]*)(?:\.(.+)|)/;function oe(){return!0}function se(){return!1}function ae(){try{return n.activeElement}catch(e){}}function le(e,t,i,r,n,o){var s,a;if("object"==typeof t){for(a in"string"!=typeof i&&(r=r||i,i=void 0),t)le(e,a,i,r,t[a],o);return e}if(null==r&&null==n?(n=i,r=i=void 0):null==n&&("string"==typeof i?(n=r,r=void 0):(n=r,r=i,i=void 0)),!1===n)n=se;else if(!n)return e;return 1===o&&(s=n,(n=function(e){return f().off(e),s.apply(this,arguments)}).guid=s.guid||(s.guid=f.guid++)),e.each(function(){f.event.add(this,t,n,r,i)})}f.event={global:{},add:function(e,t,i,r,n){var o,s,a,l,u,c,h,d,p,g,m,v=B.get(e);if(v)for(i.handler&&(i=(o=i).handler,n=o.selector),i.guid||(i.guid=f.guid++),(l=v.events)||(l=v.events={}),(s=v.handle)||(s=v.handle=function(t){return void 0!==f&&f.event.triggered!==t.type?f.event.dispatch.apply(e,arguments):void 0}),u=(t=(t||"").match(P)||[""]).length;u--;)p=m=(a=ne.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p&&(h=f.event.special[p]||{},p=(n?h.delegateType:h.bindType)||p,h=f.event.special[p]||{},c=f.extend({type:p,origType:m,data:r,handler:i,guid:i.guid,selector:n,needsContext:n&&f.expr.match.needsContext.test(n),namespace:g.join(".")},o),(d=l[p])||((d=l[p]=[]).delegateCount=0,h.setup&&!1!==h.setup.call(e,r,g,s)||e.addEventListener&&e.addEventListener(p,s)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=i.guid)),n?d.splice(d.delegateCount++,0,c):d.push(c),f.event.global[p]=!0)},remove:function(e,t,i,r,n){var o,s,a,l,u,c,h,d,p,g,m,v=B.hasData(e)&&B.get(e);if(v&&(l=v.events)){for(u=(t=(t||"").match(P)||[""]).length;u--;)if(p=m=(a=ne.exec(t[u])||[])[1],g=(a[2]||"").split(".").sort(),p){for(h=f.event.special[p]||{},d=l[p=(r?h.delegateType:h.bindType)||p]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)c=d[o],!n&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,h.remove&&h.remove.call(e,c));s&&!d.length&&(h.teardown&&!1!==h.teardown.call(e,g,v.handle)||f.removeEvent(e,p,v.handle),delete l[p])}else for(p in l)f.event.remove(e,p+t[u],i,r,!0);f.isEmptyObject(l)&&B.remove(e,"handle events")}},dispatch:function(e){e=f.event.fix(e);var t,i,r,n,s,a=[],l=o.call(arguments),u=(B.get(this,"events")||{})[e.type]||[],c=f.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,e)){for(a=f.event.handlers.call(this,e,u),t=0;(n=a[t++])&&!e.isPropagationStopped();)for(e.currentTarget=n.elem,i=0;(s=n.handlers[i++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!e.rnamespace.test(s.namespace)||(e.handleObj=s,e.data=s.data,void 0!==(r=((f.event.special[s.origType]||{}).handle||s.handler).apply(n.elem,l))&&!1===(e.result=r)&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var i,r,n,o,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==e.type)){for(r=[],i=0;a>i;i++)void 0===r[n=(o=t[i]).selector+" "]&&(r[n]=o.needsContext?f(n,this).index(l)>-1:f.find(n,this,null,[l]).length),r[n]&&r.push(o);r.length&&s.push({elem:l,handlers:r})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var i,r,o,s=t.button;return null==e.pageX&&null!=t.clientX&&(r=(i=e.target.ownerDocument||n).documentElement,o=i.body,e.pageX=t.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[f.expando])return e;var t,i,r,o=e.type,s=e,a=this.fixHooks[o];for(a||(this.fixHooks[o]=a=re.test(o)?this.mouseHooks:ie.test(o)?this.keyHooks:{}),r=a.props?this.props.concat(a.props):this.props,e=new f.Event(s),t=r.length;t--;)e[i=r[t]]=s[i];return e.target||(e.target=n),3===e.target.nodeType&&(e.target=e.target.parentNode),a.filter?a.filter(e,s):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==ae()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===ae()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&f.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return f.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},f.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i)},f.Event=function(e,t){return this instanceof f.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?oe:se):this.type=e,t&&f.extend(this,t),this.timeStamp=e&&e.timeStamp||f.now(),void(this[f.expando]=!0)):new f.Event(e,t)},f.Event.prototype={constructor:f.Event,isDefaultPrevented:se,isPropagationStopped:se,isImmediatePropagationStopped:se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=oe,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=oe,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=oe,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},f.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){f.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,r=e.relatedTarget,n=e.handleObj;return r&&(r===this||f.contains(this,r))||(e.type=n.origType,i=n.handler.apply(this,arguments),e.type=t),i}}}),f.fn.extend({on:function(e,t,i,r){return le(this,e,t,i,r)},one:function(e,t,i,r){return le(this,e,t,i,r,1)},off:function(e,t,i){var r,n;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,f(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(n in e)this.off(n,t,e[n]);return this}return!1!==t&&"function"!=typeof t||(i=t,t=void 0),!1===i&&(i=se),this.each(function(){f.event.remove(this,e,i,t)})}});var ue=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,ce=/<script|<style|<link/i,he=/checked\s*(?:[^=]|=\s*.checked.)/i,de=/^true\/(.*)/,pe=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function fe(e,t){return f.nodeName(e,"table")&&f.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function ge(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function me(e){var t=de.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function ve(e,t){var i,r,n,o,s,a,l,u;if(1===t.nodeType){if(B.hasData(e)&&(o=B.access(e),s=B.set(t,o),u=o.events))for(n in delete s.handle,s.events={},u)for(i=0,r=u[n].length;r>i;i++)f.event.add(t,n,u[n][i]);G.hasData(e)&&(a=G.access(e),l=f.extend({},a),G.set(t,l))}}function ye(e,t){var i=t.nodeName.toLowerCase();"input"===i&&X.test(e.type)?t.checked=e.checked:"input"!==i&&"textarea"!==i||(t.defaultValue=e.defaultValue)}function be(e,t,i,r){t=s.apply([],t);var n,o,a,l,u,c,h=0,p=e.length,g=p-1,m=t[0],v=f.isFunction(m);if(v||p>1&&"string"==typeof m&&!d.checkClone&&he.test(m))return e.each(function(n){var o=e.eq(n);v&&(t[0]=m.call(this,n,o.html())),be(o,t,i,r)});if(p&&(o=(n=te(t,e[0].ownerDocument,!1,e,r)).firstChild,1===n.childNodes.length&&(n=o),o||r)){for(l=(a=f.map(Q(n,"script"),ge)).length;p>h;h++)u=n,h!==g&&(u=f.clone(u,!0,!0),l&&f.merge(a,Q(u,"script"))),i.call(e[h],u,h);if(l)for(c=a[a.length-1].ownerDocument,f.map(a,me),h=0;l>h;h++)u=a[h],K.test(u.type||"")&&!B.access(u,"globalEval")&&f.contains(c,u)&&(u.src?f._evalUrl&&f._evalUrl(u.src):f.globalEval(u.textContent.replace(pe,"")))}return e}function xe(e,t,i){for(var r,n=t?f.filter(t,e):e,o=0;null!=(r=n[o]);o++)i||1!==r.nodeType||f.cleanData(Q(r)),r.parentNode&&(i&&f.contains(r.ownerDocument,r)&&$(Q(r,"script")),r.parentNode.removeChild(r));return e}f.extend({htmlPrefilter:function(e){return e.replace(ue,"<$1></$2>")},clone:function(e,t,i){var r,n,o,s,a=e.cloneNode(!0),l=f.contains(e.ownerDocument,e);if(!(d.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||f.isXMLDoc(e)))for(s=Q(a),r=0,n=(o=Q(e)).length;n>r;r++)ye(o[r],s[r]);if(t)if(i)for(o=o||Q(e),s=s||Q(a),r=0,n=o.length;n>r;r++)ve(o[r],s[r]);else ve(e,a);return(s=Q(a,"script")).length>0&&$(s,!l&&Q(e,"script")),a},cleanData:function(e){for(var t,i,r,n=f.event.special,o=0;void 0!==(i=e[o]);o++)if(O(i)){if(t=i[B.expando]){if(t.events)for(r in t.events)n[r]?f.event.remove(i,r):f.removeEvent(i,r,t.handle);i[B.expando]=void 0}i[G.expando]&&(i[G.expando]=void 0)}}}),f.fn.extend({domManip:be,detach:function(e){return xe(this,e,!0)},remove:function(e){return xe(this,e)},text:function(e){return N(this,function(e){return void 0===e?f.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return be(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||fe(this,e).appendChild(e)})},prepend:function(){return be(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=fe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return be(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(f.cleanData(Q(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return f.clone(this,e,t)})},html:function(e){return N(this,function(e){var t=this[0]||{},i=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!ce.test(e)&&!J[(Z.exec(e)||["",""])[1].toLowerCase()]){e=f.htmlPrefilter(e);try{for(;r>i;i++)1===(t=this[i]||{}).nodeType&&(f.cleanData(Q(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return be(this,arguments,function(t){var i=this.parentNode;f.inArray(this,e)<0&&(f.cleanData(Q(this)),i&&i.replaceChild(t,this))},e)}}),f.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){f.fn[e]=function(e){for(var i,r=[],n=f(e),o=n.length-1,s=0;o>=s;s++)i=s===o?this:this.clone(!0),f(n[s])[t](i),a.apply(r,i.get());return this.pushStack(r)}});var we,Te={HTML:"block",BODY:"block"};function _e(e,t){var i=f(t.createElement(e)).appendTo(t.body),r=f.css(i[0],"display");return i.detach(),r}function Ce(e){var t=n,i=Te[e];return i||("none"!==(i=_e(e,t))&&i||((t=(we=(we||f("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement))[0].contentDocument).write(),t.close(),i=_e(e,t),we.detach()),Te[e]=i),i}var Se=/^margin/,Ee=new RegExp("^("+j+")(?!px)[a-z%]+$","i"),Ae=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)},Ie=function(e,t,i,r){var n,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];for(o in n=i.apply(e,r||[]),t)e.style[o]=s[o];return n},Me=n.documentElement;function ke(e,t,i){var r,n,o,s,a=e.style;return""!==(s=(i=i||Ae(e))?i.getPropertyValue(t)||i[t]:void 0)&&void 0!==s||f.contains(e.ownerDocument,e)||(s=f.style(e,t)),i&&!d.pixelMarginRight()&&Ee.test(s)&&Se.test(t)&&(r=a.width,n=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=i.width,a.width=r,a.minWidth=n,a.maxWidth=o),void 0!==s?s+"":s}function De(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}!function(){var t,i,r,o,s=n.createElement("div"),a=n.createElement("div");if(a.style){function l(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Me.appendChild(s);var n=e.getComputedStyle(a);t="1%"!==n.top,o="2px"===n.marginLeft,i="4px"===n.width,a.style.marginRight="50%",r="4px"===n.marginRight,Me.removeChild(s)}a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),f.extend(d,{pixelPosition:function(){return l(),t},boxSizingReliable:function(){return null==i&&l(),i},pixelMarginRight:function(){return null==i&&l(),r},reliableMarginLeft:function(){return null==i&&l(),o},reliableMarginRight:function(){var t,i=a.appendChild(n.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",Me.appendChild(s),t=!parseFloat(e.getComputedStyle(i).marginRight),Me.removeChild(s),a.removeChild(i),t}})}}();var Re=/^(none|table(?!-c[ea]).+)/,Pe={position:"absolute",visibility:"hidden",display:"block"},Le={letterSpacing:"0",fontWeight:"400"},Ne=["Webkit","O","Moz","ms"],Oe=n.createElement("div").style;function Fe(e){if(e in Oe)return e;for(var t=e[0].toUpperCase()+e.slice(1),i=Ne.length;i--;)if((e=Ne[i]+t)in Oe)return e}function Be(e,t,i){var r=W.exec(t);return r?Math.max(0,r[2]-(i||0))+(r[3]||"px"):t}function Ge(e,t,i,r,n){for(var o=i===(r?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===i&&(s+=f.css(e,i+Y[o],!0,n)),r?("content"===i&&(s-=f.css(e,"padding"+Y[o],!0,n)),"margin"!==i&&(s-=f.css(e,"border"+Y[o]+"Width",!0,n))):(s+=f.css(e,"padding"+Y[o],!0,n),"padding"!==i&&(s+=f.css(e,"border"+Y[o]+"Width",!0,n)));return s}function Ue(e,t,i){var r=!0,n="width"===t?e.offsetWidth:e.offsetHeight,o=Ae(e),s="border-box"===f.css(e,"boxSizing",!1,o);if(0>=n||null==n){if((0>(n=ke(e,t,o))||null==n)&&(n=e.style[t]),Ee.test(n))return n;r=s&&(d.boxSizingReliable()||n===e.style[t]),n=parseFloat(n)||0}return n+Ge(e,t,i||(s?"border":"content"),r,o)+"px"}function ze(e,t){for(var i,r,n,o=[],s=0,a=e.length;a>s;s++)(r=e[s]).style&&(o[s]=B.get(r,"olddisplay"),i=r.style.display,t?(o[s]||"none"!==i||(r.style.display=""),""===r.style.display&&H(r)&&(o[s]=B.access(r,"olddisplay",Ce(r.nodeName)))):(n=H(r),"none"===i&&n||B.set(r,"olddisplay",n?i:f.css(r,"display"))));for(s=0;a>s;s++)(r=e[s]).style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[s]||"":"none"));return e}function Ve(e,t,i,r,n){return new Ve.prototype.init(e,t,i,r,n)}f.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=ke(e,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var n,o,s,a=f.camelCase(t),l=e.style;return t=f.cssProps[a]||(f.cssProps[a]=Fe(a)||a),s=f.cssHooks[t]||f.cssHooks[a],void 0===i?s&&"get"in s&&void 0!==(n=s.get(e,!1,r))?n:l[t]:("string"===(o=typeof i)&&(n=W.exec(i))&&n[1]&&(i=q(e,t,n),o="number"),void(null!=i&&i==i&&("number"===o&&(i+=n&&n[3]||(f.cssNumber[a]?"":"px")),d.clearCloneStyle||""!==i||0!==t.indexOf("background")||(l[t]="inherit"),s&&"set"in s&&void 0===(i=s.set(e,i,r))||(l[t]=i))))}},css:function(e,t,i,r){var n,o,s,a=f.camelCase(t);return t=f.cssProps[a]||(f.cssProps[a]=Fe(a)||a),(s=f.cssHooks[t]||f.cssHooks[a])&&"get"in s&&(n=s.get(e,!0,i)),void 0===n&&(n=ke(e,t,r)),"normal"===n&&t in Le&&(n=Le[t]),""===i||i?(o=parseFloat(n),!0===i||isFinite(o)?o||0:n):n}}),f.each(["height","width"],function(e,t){f.cssHooks[t]={get:function(e,i,r){return i?Re.test(f.css(e,"display"))&&0===e.offsetWidth?Ie(e,Pe,function(){return Ue(e,t,r)}):Ue(e,t,r):void 0},set:function(e,i,r){var n,o=r&&Ae(e),s=r&&Ge(e,t,r,"border-box"===f.css(e,"boxSizing",!1,o),o);return s&&(n=W.exec(i))&&"px"!==(n[3]||"px")&&(e.style[t]=i,i=f.css(e,t)),Be(0,i,s)}}}),f.cssHooks.marginLeft=De(d.reliableMarginLeft,function(e,t){return t?(parseFloat(ke(e,"marginLeft"))||e.getBoundingClientRect().left-Ie(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px":void 0}),f.cssHooks.marginRight=De(d.reliableMarginRight,function(e,t){return t?Ie(e,{display:"inline-block"},ke,[e,"marginRight"]):void 0}),f.each({margin:"",padding:"",border:"Width"},function(e,t){f.cssHooks[e+t]={expand:function(i){for(var r=0,n={},o="string"==typeof i?i.split(" "):[i];4>r;r++)n[e+Y[r]+t]=o[r]||o[r-2]||o[0];return n}},Se.test(e)||(f.cssHooks[e+t].set=Be)}),f.fn.extend({css:function(e,t){return N(this,function(e,t,i){var r,n,o={},s=0;if(f.isArray(t)){for(r=Ae(e),n=t.length;n>s;s++)o[t[s]]=f.css(e,t[s],!1,r);return o}return void 0!==i?f.style(e,t,i):f.css(e,t)},e,t,arguments.length>1)},show:function(){return ze(this,!0)},hide:function(){return ze(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){H(this)?f(this).show():f(this).hide()})}}),f.Tween=Ve,Ve.prototype={constructor:Ve,init:function(e,t,i,r,n,o){this.elem=e,this.prop=i,this.easing=n||f.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(f.cssNumber[i]?"":"px")},cur:function(){var e=Ve.propHooks[this.prop];return e&&e.get?e.get(this):Ve.propHooks._default.get(this)},run:function(e){var t,i=Ve.propHooks[this.prop];return this.options.duration?this.pos=t=f.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Ve.propHooks._default.set(this),this}},Ve.prototype.init.prototype=Ve.prototype,Ve.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=f.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){f.fx.step[e.prop]?f.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[f.cssProps[e.prop]]&&!f.cssHooks[e.prop]?e.elem[e.prop]=e.now:f.style(e.elem,e.prop,e.now+e.unit)}}},Ve.propHooks.scrollTop=Ve.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},f.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},f.fx=Ve.prototype.init,f.fx.step={};var je,We,Ye=/^(?:toggle|show|hide)$/,He=/queueHooks$/;function qe(){return e.setTimeout(function(){je=void 0}),je=f.now()}function Xe(e,t){var i,r=0,n={height:e};for(t=t?1:0;4>r;r+=2-t)n["margin"+(i=Y[r])]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function Ze(e,t,i){for(var r,n=(Ke.tweeners[t]||[]).concat(Ke.tweeners["*"]),o=0,s=n.length;s>o;o++)if(r=n[o].call(i,t,e))return r}function Ke(e,t,i){var r,n,o=0,s=Ke.prefilters.length,a=f.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var t=je||qe(),i=Math.max(0,u.startTime+u.duration-t),r=1-(i/u.duration||0),o=0,s=u.tweens.length;s>o;o++)u.tweens[o].run(r);return a.notifyWith(e,[u,r,i]),1>r&&s?i:(a.resolveWith(e,[u]),!1)},u=a.promise({elem:e,props:f.extend({},t),opts:f.extend(!0,{specialEasing:{},easing:f.easing._default},i),originalProperties:t,originalOptions:i,startTime:je||qe(),duration:i.duration,tweens:[],createTween:function(t,i){var r=f.Tween(e,u.opts,t,i,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(r),r},stop:function(t){var i=0,r=t?u.tweens.length:0;if(n)return this;for(n=!0;r>i;i++)u.tweens[i].run(1);return t?(a.notifyWith(e,[u,1,0]),a.resolveWith(e,[u,t])):a.rejectWith(e,[u,t]),this}}),c=u.props;for(function(e,t){var i,r,n,o,s;for(i in e)if(n=t[r=f.camelCase(i)],o=e[i],f.isArray(o)&&(n=o[1],o=e[i]=o[0]),i!==r&&(e[r]=o,delete e[i]),(s=f.cssHooks[r])&&"expand"in s)for(i in o=s.expand(o),delete e[r],o)i in e||(e[i]=o[i],t[i]=n);else t[r]=n}(c,u.opts.specialEasing);s>o;o++)if(r=Ke.prefilters[o].call(u,e,c,u.opts))return f.isFunction(r.stop)&&(f._queueHooks(u.elem,u.opts.queue).stop=f.proxy(r.stop,r)),r;return f.map(c,Ze,u),f.isFunction(u.opts.start)&&u.opts.start.call(e,u),f.fx.timer(f.extend(l,{elem:e,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}f.Animation=f.extend(Ke,{tweeners:{"*":[function(e,t){var i=this.createTween(e,t);return q(i.elem,e,W.exec(t),i),i}]},tweener:function(e,t){f.isFunction(e)?(t=e,e=["*"]):e=e.match(P);for(var i,r=0,n=e.length;n>r;r++)i=e[r],Ke.tweeners[i]=Ke.tweeners[i]||[],Ke.tweeners[i].unshift(t)},prefilters:[function(e,t,i){var r,n,o,s,a,l,u,c=this,h={},d=e.style,p=e.nodeType&&H(e),g=B.get(e,"fxshow");for(r in i.queue||(null==(a=f._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,f.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===("none"===(u=f.css(e,"display"))?B.get(e,"olddisplay")||Ce(e.nodeName):u)&&"none"===f.css(e,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",c.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]})),t)if(n=t[r],Ye.exec(n)){if(delete t[r],o=o||"toggle"===n,n===(p?"hide":"show")){if("show"!==n||!g||void 0===g[r])continue;p=!0}h[r]=g&&g[r]||f.style(e,r)}else u=void 0;if(f.isEmptyObject(h))"inline"===("none"===u?Ce(e.nodeName):u)&&(d.display=u);else for(r in g?"hidden"in g&&(p=g.hidden):g=B.access(e,"fxshow",{}),o&&(g.hidden=!p),p?f(e).show():c.done(function(){f(e).hide()}),c.done(function(){var t;for(t in B.remove(e,"fxshow"),h)f.style(e,t,h[t])}),h)s=Ze(p?g[r]:0,r,c),r in g||(g[r]=s.start,p&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}],prefilter:function(e,t){t?Ke.prefilters.unshift(e):Ke.prefilters.push(e)}}),f.speed=function(e,t,i){var r=e&&"object"==typeof e?f.extend({},e):{complete:i||!i&&t||f.isFunction(e)&&e,duration:e,easing:i&&t||t&&!f.isFunction(t)&&t};return r.duration=f.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in f.fx.speeds?f.fx.speeds[r.duration]:f.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){f.isFunction(r.old)&&r.old.call(this),r.queue&&f.dequeue(this,r.queue)},r},f.fn.extend({fadeTo:function(e,t,i,r){return this.filter(H).css("opacity",0).show().end().animate({opacity:t},e,i,r)},animate:function(e,t,i,r){var n=f.isEmptyObject(e),o=f.speed(t,i,r),s=function(){var t=Ke(this,f.extend({},e),o);(n||B.get(this,"finish"))&&t.stop(!0)};return s.finish=s,n||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(e,t,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",o=f.timers,s=B.get(this);if(n)s[n]&&s[n].stop&&r(s[n]);else for(n in s)s[n]&&s[n].stop&&He.test(n)&&r(s[n]);for(n=o.length;n--;)o[n].elem!==this||null!=e&&o[n].queue!==e||(o[n].anim.stop(i),t=!1,o.splice(n,1));!t&&i||f.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,i=B.get(this),r=i[e+"queue"],n=i[e+"queueHooks"],o=f.timers,s=r?r.length:0;for(i.finish=!0,f.queue(this,e,[]),n&&n.stop&&n.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete i.finish})}}),f.each(["toggle","show","hide"],function(e,t){var i=f.fn[t];f.fn[t]=function(e,r,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(Xe(t,!0),e,r,n)}}),f.each({slideDown:Xe("show"),slideUp:Xe("hide"),slideToggle:Xe("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){f.fn[e]=function(e,i,r){return this.animate(t,e,i,r)}}),f.timers=[],f.fx.tick=function(){var e,t=0,i=f.timers;for(je=f.now();t<i.length;t++)(e=i[t])()||i[t]!==e||i.splice(t--,1);i.length||f.fx.stop(),je=void 0},f.fx.timer=function(e){f.timers.push(e),e()?f.fx.start():f.timers.pop()},f.fx.interval=13,f.fx.start=function(){We||(We=e.setInterval(f.fx.tick,f.fx.interval))},f.fx.stop=function(){e.clearInterval(We),We=null},f.fx.speeds={slow:600,fast:200,_default:400},f.fn.delay=function(t,i){return t=f.fx&&f.fx.speeds[t]||t,i=i||"fx",this.queue(i,function(i,r){var n=e.setTimeout(i,t);r.stop=function(){e.clearTimeout(n)}})},function(){var e=n.createElement("input"),t=n.createElement("select"),i=t.appendChild(n.createElement("option"));e.type="checkbox",d.checkOn=""!==e.value,d.optSelected=i.selected,t.disabled=!0,d.optDisabled=!i.disabled,(e=n.createElement("input")).value="t",e.type="radio",d.radioValue="t"===e.value}();var Je,Qe=f.expr.attrHandle;f.fn.extend({attr:function(e,t){return N(this,f.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){f.removeAttr(this,e)})}}),f.extend({attr:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?f.prop(e,t,i):(1===o&&f.isXMLDoc(e)||(t=t.toLowerCase(),n=f.attrHooks[t]||(f.expr.match.bool.test(t)?Je:void 0)),void 0!==i?null===i?void f.removeAttr(e,t):n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:(e.setAttribute(t,i+""),i):n&&"get"in n&&null!==(r=n.get(e,t))?r:null==(r=f.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!d.radioValue&&"radio"===t&&f.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},removeAttr:function(e,t){var i,r,n=0,o=t&&t.match(P);if(o&&1===e.nodeType)for(;i=o[n++];)r=f.propFix[i]||i,f.expr.match.bool.test(i)&&(e[r]=!1),e.removeAttribute(i)}}),Je={set:function(e,t,i){return!1===t?f.removeAttr(e,i):e.setAttribute(i,i),i}},f.each(f.expr.match.bool.source.match(/\w+/g),function(e,t){var i=Qe[t]||f.find.attr;Qe[t]=function(e,t,r){var n,o;return r||(o=Qe[t],Qe[t]=n,n=null!=i(e,t,r)?t.toLowerCase():null,Qe[t]=o),n}});var $e=/^(?:input|select|textarea|button)$/i,et=/^(?:a|area)$/i;f.fn.extend({prop:function(e,t){return N(this,f.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[f.propFix[e]||e]})}}),f.extend({prop:function(e,t,i){var r,n,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&f.isXMLDoc(e)||(t=f.propFix[t]||t,n=f.propHooks[t]),void 0!==i?n&&"set"in n&&void 0!==(r=n.set(e,i,t))?r:e[t]=i:n&&"get"in n&&null!==(r=n.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=f.find.attr(e,"tabindex");return t?parseInt(t,10):$e.test(e.nodeName)||et.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(f.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),f.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){f.propFix[this.toLowerCase()]=this});var tt=/[\t\r\n\f]/g;function it(e){return e.getAttribute&&e.getAttribute("class")||""}f.fn.extend({addClass:function(e){var t,i,r,n,o,s,a,l=0;if(f.isFunction(e))return this.each(function(t){f(this).addClass(e.call(this,t,it(this)))});if("string"==typeof e&&e)for(t=e.match(P)||[];i=this[l++];)if(n=it(i),r=1===i.nodeType&&(" "+n+" ").replace(tt," ")){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");n!==(a=f.trim(r))&&i.setAttribute("class",a)}return this},removeClass:function(e){var t,i,r,n,o,s,a,l=0;if(f.isFunction(e))return this.each(function(t){f(this).removeClass(e.call(this,t,it(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(P)||[];i=this[l++];)if(n=it(i),r=1===i.nodeType&&(" "+n+" ").replace(tt," ")){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");n!==(a=f.trim(r))&&i.setAttribute("class",a)}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):f.isFunction(e)?this.each(function(i){f(this).toggleClass(e.call(this,i,it(this),t),t)}):this.each(function(){var t,r,n,o;if("string"===i)for(r=0,n=f(this),o=e.match(P)||[];t=o[r++];)n.hasClass(t)?n.removeClass(t):n.addClass(t);else void 0!==e&&"boolean"!==i||((t=it(this))&&B.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":B.get(this,"__className__")||""))})},hasClass:function(e){var t,i,r=0;for(t=" "+e+" ";i=this[r++];)if(1===i.nodeType&&(" "+it(i)+" ").replace(tt," ").indexOf(t)>-1)return!0;return!1}});var rt=/\r/g,nt=/[\x20\t\r\n\f]+/g;f.fn.extend({val:function(e){var t,i,r,n=this[0];return arguments.length?(r=f.isFunction(e),this.each(function(i){var n;1===this.nodeType&&(null==(n=r?e.call(this,i,f(this).val()):e)?n="":"number"==typeof n?n+="":f.isArray(n)&&(n=f.map(n,function(e){return null==e?"":e+""})),(t=f.valHooks[this.type]||f.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,n,"value")||(this.value=n))})):n?(t=f.valHooks[n.type]||f.valHooks[n.nodeName.toLowerCase()])&&"get"in t&&void 0!==(i=t.get(n,"value"))?i:"string"==typeof(i=n.value)?i.replace(rt,""):null==i?"":i:void 0}}),f.extend({valHooks:{option:{get:function(e){var t=f.find.attr(e,"value");return null!=t?t:f.trim(f.text(e)).replace(nt," ")}},select:{get:function(e){for(var t,i,r=e.options,n=e.selectedIndex,o="select-one"===e.type||0>n,s=o?null:[],a=o?n+1:r.length,l=0>n?a:o?n:0;a>l;l++)if(((i=r[l]).selected||l===n)&&(d.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!f.nodeName(i.parentNode,"optgroup"))){if(t=f(i).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var i,r,n=e.options,o=f.makeArray(t),s=n.length;s--;)((r=n[s]).selected=f.inArray(f.valHooks.option.get(r),o)>-1)&&(i=!0);return i||(e.selectedIndex=-1),o}}}}),f.each(["radio","checkbox"],function(){f.valHooks[this]={set:function(e,t){return f.isArray(t)?e.checked=f.inArray(f(e).val(),t)>-1:void 0}},d.checkOn||(f.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var ot=/^(?:focusinfocus|focusoutblur)$/;f.extend(f.event,{trigger:function(t,i,r,o){var s,a,l,u,c,d,p,g=[r||n],m=h.call(t,"type")?t.type:t,v=h.call(t,"namespace")?t.namespace.split("."):[];if(a=l=r=r||n,3!==r.nodeType&&8!==r.nodeType&&!ot.test(m+f.event.triggered)&&(m.indexOf(".")>-1&&(m=(v=m.split(".")).shift(),v.sort()),c=m.indexOf(":")<0&&"on"+m,(t=t[f.expando]?t:new f.Event(m,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=v.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),i=null==i?[t]:f.makeArray(i,[t]),p=f.event.special[m]||{},o||!p.trigger||!1!==p.trigger.apply(r,i))){if(!o&&!p.noBubble&&!f.isWindow(r)){for(u=p.delegateType||m,ot.test(u+m)||(a=a.parentNode);a;a=a.parentNode)g.push(a),l=a;l===(r.ownerDocument||n)&&g.push(l.defaultView||l.parentWindow||e)}for(s=0;(a=g[s++])&&!t.isPropagationStopped();)t.type=s>1?u:p.bindType||m,(d=(B.get(a,"events")||{})[t.type]&&B.get(a,"handle"))&&d.apply(a,i),(d=c&&a[c])&&d.apply&&O(a)&&(t.result=d.apply(a,i),!1===t.result&&t.preventDefault());return t.type=m,o||t.isDefaultPrevented()||p._default&&!1!==p._default.apply(g.pop(),i)||!O(r)||c&&f.isFunction(r[m])&&!f.isWindow(r)&&((l=r[c])&&(r[c]=null),f.event.triggered=m,r[m](),f.event.triggered=void 0,l&&(r[c]=l)),t.result}},simulate:function(e,t,i){var r=f.extend(new f.Event,i,{type:e,isSimulated:!0});f.event.trigger(r,null,t)}}),f.fn.extend({trigger:function(e,t){return this.each(function(){f.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?f.event.trigger(e,t,i,!0):void 0}}),f.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){f.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),f.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),d.focusin="onfocusin"in e,d.focusin||f.each({focus:"focusin",blur:"focusout"},function(e,t){var i=function(e){f.event.simulate(t,e.target,f.event.fix(e))};f.event.special[t]={setup:function(){var r=this.ownerDocument||this,n=B.access(r,t);n||r.addEventListener(e,i,!0),B.access(r,t,(n||0)+1)},teardown:function(){var r=this.ownerDocument||this,n=B.access(r,t)-1;n?B.access(r,t,n):(r.removeEventListener(e,i,!0),B.remove(r,t))}}});var st=e.location,at=f.now(),lt=/\?/;f.parseJSON=function(e){return JSON.parse(e+"")},f.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){i=void 0}return i&&!i.getElementsByTagName("parsererror").length||f.error("Invalid XML: "+t),i};var ut=/#.*$/,ct=/([?&])_=[^&]*/,ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,dt=/^(?:GET|HEAD)$/,pt=/^\/\//,ft={},gt={},mt="*/".concat("*"),vt=n.createElement("a");function yt(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var r,n=0,o=t.toLowerCase().match(P)||[];if(f.isFunction(i))for(;r=o[n++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(i)):(e[r]=e[r]||[]).push(i)}}function bt(e,t,i,r){var n={},o=e===gt;function s(a){var l;return n[a]=!0,f.each(e[a]||[],function(e,a){var u=a(t,i,r);return"string"!=typeof u||o||n[u]?o?!(l=u):void 0:(t.dataTypes.unshift(u),s(u),!1)}),l}return s(t.dataTypes[0])||!n["*"]&&s("*")}function xt(e,t){var i,r,n=f.ajaxSettings.flatOptions||{};for(i in t)void 0!==t[i]&&((n[i]?e:r||(r={}))[i]=t[i]);return r&&f.extend(!0,e,r),e}vt.href=st.href,f.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:st.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(st.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":mt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":f.parseJSON,"text xml":f.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?xt(xt(e,f.ajaxSettings),t):xt(f.ajaxSettings,e)},ajaxPrefilter:yt(ft),ajaxTransport:yt(gt),ajax:function(t,i){"object"==typeof t&&(i=t,t=void 0),i=i||{};var r,o,s,a,l,u,c,h,d=f.ajaxSetup({},i),p=d.context||d,g=d.context&&(p.nodeType||p.jquery)?f(p):f.event,m=f.Deferred(),v=f.Callbacks("once memory"),y=d.statusCode||{},b={},x={},w=0,T="canceled",_={readyState:0,getResponseHeader:function(e){var t;if(2===w){if(!a)for(a={};t=ht.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===w?s:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return w||(e=x[i]=x[i]||e,b[e]=t),this},overrideMimeType:function(e){return w||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>w)for(t in e)y[t]=[y[t],e[t]];else _.always(e[_.status]);return this},abort:function(e){var t=e||T;return r&&r.abort(t),C(0,t),this}};if(m.promise(_).complete=v.add,_.success=_.done,_.error=_.fail,d.url=((t||d.url||st.href)+"").replace(ut,"").replace(pt,st.protocol+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=f.trim(d.dataType||"*").toLowerCase().match(P)||[""],null==d.crossDomain){u=n.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=vt.protocol+"//"+vt.host!=u.protocol+"//"+u.host}catch(e){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=f.param(d.data,d.traditional)),bt(ft,d,i,_),2===w)return _;for(h in(c=f.event&&d.global)&&0==f.active++&&f.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!dt.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(lt.test(o)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=ct.test(o)?o.replace(ct,"$1_="+at++):o+(lt.test(o)?"&":"?")+"_="+at++)),d.ifModified&&(f.lastModified[o]&&_.setRequestHeader("If-Modified-Since",f.lastModified[o]),f.etag[o]&&_.setRequestHeader("If-None-Match",f.etag[o])),(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&_.setRequestHeader("Content-Type",d.contentType),_.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+mt+"; q=0.01":""):d.accepts["*"]),d.headers)_.setRequestHeader(h,d.headers[h]);if(d.beforeSend&&(!1===d.beforeSend.call(p,_,d)||2===w))return _.abort();for(h in T="abort",{success:1,error:1,complete:1})_[h](d[h]);if(r=bt(gt,d,i,_)){if(_.readyState=1,c&&g.trigger("ajaxSend",[_,d]),2===w)return _;d.async&&d.timeout>0&&(l=e.setTimeout(function(){_.abort("timeout")},d.timeout));try{w=1,r.send(b,C)}catch(e){if(!(2>w))throw e;C(-1,e)}}else C(-1,"No Transport");function C(t,i,n,a){var u,h,b,x,T,C=i;2!==w&&(w=2,l&&e.clearTimeout(l),r=void 0,s=a||"",_.readyState=t>0?4:0,u=t>=200&&300>t||304===t,n&&(x=function(e,t,i){for(var r,n,o,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(n in a)if(a[n]&&a[n].test(r)){l.unshift(n);break}if(l[0]in i)o=l[0];else{for(n in i){if(!l[0]||e.converters[n+" "+l[0]]){o=n;break}s||(s=n)}o=o||s}return o?(o!==l[0]&&l.unshift(o),i[o]):void 0}(d,_,n)),x=function(e,t,i,r){var n,o,s,a,l,u={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)u[s.toLowerCase()]=e.converters[s];for(o=c.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(!(s=u[l+" "+o]||u["* "+o]))for(n in u)if((a=n.split(" "))[1]===o&&(s=u[l+" "+a[0]]||u["* "+a[0]])){!0===s?s=u[n]:!0!==u[n]&&(o=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}(d,x,_,u),u?(d.ifModified&&((T=_.getResponseHeader("Last-Modified"))&&(f.lastModified[o]=T),(T=_.getResponseHeader("etag"))&&(f.etag[o]=T)),204===t||"HEAD"===d.type?C="nocontent":304===t?C="notmodified":(C=x.state,h=x.data,u=!(b=x.error))):(b=C,!t&&C||(C="error",0>t&&(t=0))),_.status=t,_.statusText=(i||C)+"",u?m.resolveWith(p,[h,C,_]):m.rejectWith(p,[_,C,b]),_.statusCode(y),y=void 0,c&&g.trigger(u?"ajaxSuccess":"ajaxError",[_,d,u?h:b]),v.fireWith(p,[_,C]),c&&(g.trigger("ajaxComplete",[_,d]),--f.active||f.event.trigger("ajaxStop")))}return _},getJSON:function(e,t,i){return f.get(e,t,i,"json")},getScript:function(e,t){return f.get(e,void 0,t,"script")}}),f.each(["get","post"],function(e,t){f[t]=function(e,i,r,n){return f.isFunction(i)&&(n=n||r,r=i,i=void 0),f.ajax(f.extend({url:e,type:t,dataType:n,data:i,success:r},f.isPlainObject(e)&&e))}}),f._evalUrl=function(e){return f.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},f.fn.extend({wrapAll:function(e){var t;return f.isFunction(e)?this.each(function(t){f(this).wrapAll(e.call(this,t))}):(this[0]&&(t=f(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return f.isFunction(e)?this.each(function(t){f(this).wrapInner(e.call(this,t))}):this.each(function(){var t=f(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=f.isFunction(e);return this.each(function(i){f(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){f.nodeName(this,"body")||f(this).replaceWith(this.childNodes)}).end()}}),f.expr.filters.hidden=function(e){return!f.expr.filters.visible(e)},f.expr.filters.visible=function(e){return e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0};var wt=/%20/g,Tt=/\[\]$/,_t=/\r?\n/g,Ct=/^(?:submit|button|image|reset|file)$/i,St=/^(?:input|select|textarea|keygen)/i;function Et(e,t,i,r){var n;if(f.isArray(t))f.each(t,function(t,n){i||Tt.test(e)?r(e,n):Et(e+"["+("object"==typeof n&&null!=n?t:"")+"]",n,i,r)});else if(i||"object"!==f.type(t))r(e,t);else for(n in t)Et(e+"["+n+"]",t[n],i,r)}f.param=function(e,t){var i,r=[],n=function(e,t){t=f.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=f.ajaxSettings&&f.ajaxSettings.traditional),f.isArray(e)||e.jquery&&!f.isPlainObject(e))f.each(e,function(){n(this.name,this.value)});else for(i in e)Et(i,e[i],t,n);return r.join("&").replace(wt,"+")},f.fn.extend({serialize:function(){return f.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=f.prop(this,"elements");return e?f.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!f(this).is(":disabled")&&St.test(this.nodeName)&&!Ct.test(e)&&(this.checked||!X.test(e))}).map(function(e,t){var i=f(this).val();return null==i?null:f.isArray(i)?f.map(i,function(e){return{name:t.name,value:e.replace(_t,"\r\n")}}):{name:t.name,value:i.replace(_t,"\r\n")}}).get()}}),f.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var At={0:200,1223:204},It=f.ajaxSettings.xhr();d.cors=!!It&&"withCredentials"in It,d.ajax=It=!!It,f.ajaxTransport(function(t){var i,r;return d.cors||It&&!t.crossDomain?{send:function(n,o){var s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];for(s in t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest"),n)a.setRequestHeader(s,n[s]);i=function(e){return function(){i&&(i=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(At[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=i(),r=a.onerror=i("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&e.setTimeout(function(){i&&r()})},i=i("abort");try{a.send(t.hasContent&&t.data||null)}catch(e){if(i)throw e}},abort:function(){i&&i()}}:void 0}),f.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return f.globalEval(e),e}}}),f.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),f.ajaxTransport("script",function(e){var t,i;if(e.crossDomain)return{send:function(r,o){t=f("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&o("error"===e.type?404:200,e.type)}),n.head.appendChild(t[0])},abort:function(){i&&i()}}});var Mt=[],kt=/(=)\?(?=&|$)|\?\?/;f.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mt.pop()||f.expando+"_"+at++;return this[e]=!0,e}}),f.ajaxPrefilter("json jsonp",function(t,i,r){var n,o,s,a=!1!==t.jsonp&&(kt.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&kt.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(n=t.jsonpCallback=f.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(kt,"$1"+n):!1!==t.jsonp&&(t.url+=(lt.test(t.url)?"&":"?")+t.jsonp+"="+n),t.converters["script json"]=function(){return s||f.error(n+" was not called"),s[0]},t.dataTypes[0]="json",o=e[n],e[n]=function(){s=arguments},r.always(function(){void 0===o?f(e).removeProp(n):e[n]=o,t[n]&&(t.jsonpCallback=i.jsonpCallback,Mt.push(n)),s&&f.isFunction(o)&&o(s[0]),s=o=void 0}),"script"):void 0}),f.parseHTML=function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||n;var r=C.exec(e),o=!i&&[];return r?[t.createElement(r[1])]:(r=te([e],t,o),o&&o.length&&f(o).remove(),f.merge([],r.childNodes))};var Dt=f.fn.load;function Rt(e){return f.isWindow(e)?e:9===e.nodeType&&e.defaultView}f.fn.load=function(e,t,i){if("string"!=typeof e&&Dt)return Dt.apply(this,arguments);var r,n,o,s=this,a=e.indexOf(" ");return a>-1&&(r=f.trim(e.slice(a)),e=e.slice(0,a)),f.isFunction(t)?(i=t,t=void 0):t&&"object"==typeof t&&(n="POST"),s.length>0&&f.ajax({url:e,type:n||"GET",dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?f("<div>").append(f.parseHTML(e)).find(r):e)}).always(i&&function(e,t){s.each(function(){i.apply(this,o||[e.responseText,t,e])})}),this},f.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){f.fn[t]=function(e){return this.on(t,e)}}),f.expr.filters.animated=function(e){return f.grep(f.timers,function(t){return e===t.elem}).length},f.offset={setOffset:function(e,t,i){var r,n,o,s,a,l,u=f.css(e,"position"),c=f(e),h={};"static"===u&&(e.style.position="relative"),a=c.offset(),o=f.css(e,"top"),l=f.css(e,"left"),("absolute"===u||"fixed"===u)&&(o+l).indexOf("auto")>-1?(s=(r=c.position()).top,n=r.left):(s=parseFloat(o)||0,n=parseFloat(l)||0),f.isFunction(t)&&(t=t.call(e,i,f.extend({},a))),null!=t.top&&(h.top=t.top-a.top+s),null!=t.left&&(h.left=t.left-a.left+n),"using"in t?t.using.call(e,h):c.css(h)}},f.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){f.offset.setOffset(this,e,t)});var t,i,r=this[0],n={top:0,left:0},o=r&&r.ownerDocument;return o?(t=o.documentElement,f.contains(t,r)?(n=r.getBoundingClientRect(),i=Rt(o),{top:n.top+i.pageYOffset-t.clientTop,left:n.left+i.pageXOffset-t.clientLeft}):n):void 0},position:function(){if(this[0]){var e,t,i=this[0],r={top:0,left:0};return"fixed"===f.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),f.nodeName(e[0],"html")||(r=e.offset()),r.top+=f.css(e[0],"borderTopWidth",!0),r.left+=f.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-f.css(i,"marginTop",!0),left:t.left-r.left-f.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===f.css(e,"position");)e=e.offsetParent;return e||Me})}}),f.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var i="pageYOffset"===t;f.fn[e]=function(r){return N(this,function(e,r,n){var o=Rt(e);return void 0===n?o?o[t]:e[r]:void(o?o.scrollTo(i?o.pageXOffset:n,i?n:o.pageYOffset):e[r]=n)},e,r,arguments.length)}}),f.each(["top","left"],function(e,t){f.cssHooks[t]=De(d.pixelPosition,function(e,i){return i?(i=ke(e,t),Ee.test(i)?f(e).position()[t]+"px":i):void 0})}),f.each({Height:"height",Width:"width"},function(e,t){f.each({padding:"inner"+e,content:t,"":"outer"+e},function(i,r){f.fn[r]=function(r,n){var o=arguments.length&&(i||"boolean"!=typeof r),s=i||(!0===r||!0===n?"margin":"border");return N(this,function(t,i,r){var n;return f.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(n=t.documentElement,Math.max(t.body["scroll"+e],n["scroll"+e],t.body["offset"+e],n["offset"+e],n["client"+e])):void 0===r?f.css(t,i,s):f.style(t,i,r,s)},t,o?r:void 0,o,null)}})}),f.fn.extend({bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,r){return this.on(t,e,i,r)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)},size:function(){return this.length}}),f.fn.andSelf=f.fn.addBack,"function"==typeof r&&r.amd&&r("jquery",[],function(){return f});var Pt=e.jQuery,Lt=e.$;return f.noConflict=function(t){return e.$===f&&(e.$=Lt),t&&e.jQuery===f&&(e.jQuery=Pt),f},t||(e.jQuery=e.$=f),f},"object"==typeof module&&"object"==typeof module.exports?module.exports=n.document?o(n,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return o(e)}:o(n),function(){var e="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this||{},t=e._,i=Array.prototype,n=Object.prototype,o="undefined"!=typeof Symbol?Symbol.prototype:null,s=i.push,a=i.slice,l=n.toString,u=n.hasOwnProperty,c=Array.isArray,h=Object.keys,d=Object.create,p=function(){},f=function(e){return e instanceof f?e:this instanceof f?void(this._wrapped=e):new f(e)};"undefined"==typeof exports||exports.nodeType?e._=f:("undefined"!=typeof module&&!module.nodeType&&module.exports&&(exports=module.exports=f),exports._=f),f.VERSION="1.9.1";var g,m=function(e,t,i){if(void 0===t)return e;switch(null==i?3:i){case 1:return function(i){return e.call(t,i)};case 3:return function(i,r,n){return e.call(t,i,r,n)};case 4:return function(i,r,n,o){return e.call(t,i,r,n,o)}}return function(){return e.apply(t,arguments)}},v=function(e,t,i){return f.iteratee!==g?f.iteratee(e,t):null==e?f.identity:f.isFunction(e)?m(e,t,i):f.isObject(e)&&!f.isArray(e)?f.matcher(e):f.property(e)};f.iteratee=g=function(e,t){return v(e,t,1/0)};var y=function(e,t){return t=null==t?e.length-1:+t,function(){for(var i=Math.max(arguments.length-t,0),r=Array(i),n=0;n<i;n++)r[n]=arguments[n+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var o=Array(t+1);for(n=0;n<t;n++)o[n]=arguments[n];return o[t]=r,e.apply(this,o)}},b=function(e){if(!f.isObject(e))return{};if(d)return d(e);p.prototype=e;var t=new p;return p.prototype=null,t},x=function(e){return function(t){return null==t?void 0:t[e]}},w=function(e,t){return null!=e&&u.call(e,t)},T=function(e,t){for(var i=t.length,r=0;r<i;r++){if(null==e)return;e=e[t[r]]}return i?e:void 0},_=Math.pow(2,53)-1,C=x("length"),S=function(e){var t=C(e);return"number"==typeof t&&0<=t&&t<=_};f.each=f.forEach=function(e,t,i){var r,n;if(t=m(t,i),S(e))for(r=0,n=e.length;r<n;r++)t(e[r],r,e);else{var o=f.keys(e);for(r=0,n=o.length;r<n;r++)t(e[o[r]],o[r],e)}return e},f.map=f.collect=function(e,t,i){t=v(t,i);for(var r=!S(e)&&f.keys(e),n=(r||e).length,o=Array(n),s=0;s<n;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o};var E=function(e){return function(t,i,r,n){var o=3<=arguments.length;return function(t,i,r,n){var o=!S(t)&&f.keys(t),s=(o||t).length,a=0<e?0:s-1;for(n||(r=t[o?o[a]:a],a+=e);0<=a&&a<s;a+=e){var l=o?o[a]:a;r=i(r,t[l],l,t)}return r}(t,m(i,n,4),r,o)}};f.reduce=f.foldl=f.inject=E(1),f.reduceRight=f.foldr=E(-1),f.find=f.detect=function(e,t,i){var r=(S(e)?f.findIndex:f.findKey)(e,t,i);if(void 0!==r&&-1!==r)return e[r]},f.filter=f.select=function(e,t,i){var r=[];return t=v(t,i),f.each(e,function(e,i,n){t(e,i,n)&&r.push(e)}),r},f.reject=function(e,t,i){return f.filter(e,f.negate(v(t)),i)},f.every=f.all=function(e,t,i){t=v(t,i);for(var r=!S(e)&&f.keys(e),n=(r||e).length,o=0;o<n;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0},f.some=f.any=function(e,t,i){t=v(t,i);for(var r=!S(e)&&f.keys(e),n=(r||e).length,o=0;o<n;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1},f.contains=f.includes=f.include=function(e,t,i,r){return S(e)||(e=f.values(e)),("number"!=typeof i||r)&&(i=0),0<=f.indexOf(e,t,i)},f.invoke=y(function(e,t,i){var r,n;return f.isFunction(t)?n=t:f.isArray(t)&&(r=t.slice(0,-1),t=t[t.length-1]),f.map(e,function(e){var o=n;if(!o){if(r&&r.length&&(e=T(e,r)),null==e)return;o=e[t]}return null==o?o:o.apply(e,i)})}),f.pluck=function(e,t){return f.map(e,f.property(t))},f.where=function(e,t){return f.filter(e,f.matcher(t))},f.findWhere=function(e,t){return f.find(e,f.matcher(t))},f.max=function(e,t,i){var r,n,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=S(e)?e:f.values(e)).length;a<l;a++)null!=(r=e[a])&&o<r&&(o=r);else t=v(t,i),f.each(e,function(e,i,r){n=t(e,i,r),(s<n||n===-1/0&&o===-1/0)&&(o=e,s=n)});return o},f.min=function(e,t,i){var r,n,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,l=(e=S(e)?e:f.values(e)).length;a<l;a++)null!=(r=e[a])&&r<o&&(o=r);else t=v(t,i),f.each(e,function(e,i,r){((n=t(e,i,r))<s||n===1/0&&o===1/0)&&(o=e,s=n)});return o},f.shuffle=function(e){return f.sample(e,1/0)},f.sample=function(e,t,i){if(null==t||i)return S(e)||(e=f.values(e)),e[f.random(e.length-1)];var r=S(e)?f.clone(e):f.values(e),n=C(r);t=Math.max(Math.min(t,n),0);for(var o=n-1,s=0;s<t;s++){var a=f.random(s,o),l=r[s];r[s]=r[a],r[a]=l}return r.slice(0,t)},f.sortBy=function(e,t,i){var r=0;return t=v(t,i),f.pluck(f.map(e,function(e,i,n){return{value:e,index:r++,criteria:t(e,i,n)}}).sort(function(e,t){var i=e.criteria,r=t.criteria;if(i!==r){if(r<i||void 0===i)return 1;if(i<r||void 0===r)return-1}return e.index-t.index}),"value")};var A=function(e,t){return function(i,r,n){var o=t?[[],[]]:{};return r=v(r,n),f.each(i,function(t,n){var s=r(t,n,i);e(o,t,s)}),o}};f.groupBy=A(function(e,t,i){w(e,i)?e[i].push(t):e[i]=[t]}),f.indexBy=A(function(e,t,i){e[i]=t}),f.countBy=A(function(e,t,i){w(e,i)?e[i]++:e[i]=1});var I=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;f.toArray=function(e){return e?f.isArray(e)?a.call(e):f.isString(e)?e.match(I):S(e)?f.map(e,f.identity):f.values(e):[]},f.size=function(e){return null==e?0:S(e)?e.length:f.keys(e).length},f.partition=A(function(e,t,i){e[i?0:1].push(t)},!0),f.first=f.head=f.take=function(e,t,i){return null==e||e.length<1?null==t?void 0:[]:null==t||i?e[0]:f.initial(e,e.length-t)},f.initial=function(e,t,i){return a.call(e,0,Math.max(0,e.length-(null==t||i?1:t)))},f.last=function(e,t,i){return null==e||e.length<1?null==t?void 0:[]:null==t||i?e[e.length-1]:f.rest(e,Math.max(0,e.length-t))},f.rest=f.tail=f.drop=function(e,t,i){return a.call(e,null==t||i?1:t)},f.compact=function(e){return f.filter(e,Boolean)};var M=function(e,t,i,r){for(var n=(r=r||[]).length,o=0,s=C(e);o<s;o++){var a=e[o];if(S(a)&&(f.isArray(a)||f.isArguments(a)))if(t)for(var l=0,u=a.length;l<u;)r[n++]=a[l++];else M(a,t,i,r),n=r.length;else i||(r[n++]=a)}return r};f.flatten=function(e,t){return M(e,t,!1)},f.without=y(function(e,t){return f.difference(e,t)}),f.uniq=f.unique=function(e,t,i,r){f.isBoolean(t)||(r=i,i=t,t=!1),null!=i&&(i=v(i,r));for(var n=[],o=[],s=0,a=C(e);s<a;s++){var l=e[s],u=i?i(l,s,e):l;t&&!i?(s&&o===u||n.push(l),o=u):i?f.contains(o,u)||(o.push(u),n.push(l)):f.contains(n,l)||n.push(l)}return n},f.union=y(function(e){return f.uniq(M(e,!0,!0))}),f.intersection=function(e){for(var t=[],i=arguments.length,r=0,n=C(e);r<n;r++){var o=e[r];if(!f.contains(t,o)){var s;for(s=1;s<i&&f.contains(arguments[s],o);s++);s===i&&t.push(o)}}return t},f.difference=y(function(e,t){return t=M(t,!0,!0),f.filter(e,function(e){return!f.contains(t,e)})}),f.unzip=function(e){for(var t=e&&f.max(e,C).length||0,i=Array(t),r=0;r<t;r++)i[r]=f.pluck(e,r);return i},f.zip=y(f.unzip),f.object=function(e,t){for(var i={},r=0,n=C(e);r<n;r++)t?i[e[r]]=t[r]:i[e[r][0]]=e[r][1];return i};var k=function(e){return function(t,i,r){i=v(i,r);for(var n=C(t),o=0<e?0:n-1;0<=o&&o<n;o+=e)if(i(t[o],o,t))return o;return-1}};f.findIndex=k(1),f.findLastIndex=k(-1),f.sortedIndex=function(e,t,i,r){for(var n=(i=v(i,r,1))(t),o=0,s=C(e);o<s;){var a=Math.floor((o+s)/2);i(e[a])<n?o=a+1:s=a}return o};var D=function(e,t,i){return function(r,n,o){var s=0,l=C(r);if("number"==typeof o)0<e?s=0<=o?o:Math.max(o+l,s):l=0<=o?Math.min(o+1,l):o+l+1;else if(i&&o&&l)return r[o=i(r,n)]===n?o:-1;if(n!=n)return 0<=(o=t(a.call(r,s,l),f.isNaN))?o+s:-1;for(o=0<e?s:l-1;0<=o&&o<l;o+=e)if(r[o]===n)return o;return-1}};f.indexOf=D(1,f.findIndex,f.sortedIndex),f.lastIndexOf=D(-1,f.findLastIndex),f.range=function(e,t,i){null==t&&(t=e||0,e=0),i||(i=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/i),0),n=Array(r),o=0;o<r;o++,e+=i)n[o]=e;return n},f.chunk=function(e,t){if(null==t||t<1)return[];for(var i=[],r=0,n=e.length;r<n;)i.push(a.call(e,r,r+=t));return i};var R=function(e,t,i,r,n){if(!(r instanceof t))return e.apply(i,n);var o=b(e.prototype),s=e.apply(o,n);return f.isObject(s)?s:o};f.bind=y(function(e,t,i){if(!f.isFunction(e))throw new TypeError("Bind must be called on a function");var r=y(function(n){return R(e,r,t,this,i.concat(n))});return r}),f.partial=y(function(e,t){var i=f.partial.placeholder,r=function(){for(var n=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===i?arguments[n++]:t[a];for(;n<arguments.length;)s.push(arguments[n++]);return R(e,r,this,this,s)};return r}),(f.partial.placeholder=f).bindAll=y(function(e,t){var i=(t=M(t,!1,!1)).length;if(i<1)throw new Error("bindAll must be passed function names");for(;i--;){var r=t[i];e[r]=f.bind(e[r],e)}}),f.memoize=function(e,t){var i=function(r){var n=i.cache,o=""+(t?t.apply(this,arguments):r);return w(n,o)||(n[o]=e.apply(this,arguments)),n[o]};return i.cache={},i},f.delay=y(function(e,t,i){return setTimeout(function(){return e.apply(null,i)},t)}),f.defer=f.partial(f.delay,f,1),f.throttle=function(e,t,i){var r,n,o,s,a=0;i||(i={});var l=function(){a=!1===i.leading?0:f.now(),r=null,s=e.apply(n,o),r||(n=o=null)},u=function(){var u=f.now();a||!1!==i.leading||(a=u);var c=t-(u-a);return n=this,o=arguments,c<=0||t<c?(r&&(clearTimeout(r),r=null),a=u,s=e.apply(n,o),r||(n=o=null)):r||!1===i.trailing||(r=setTimeout(l,c)),s};return u.cancel=function(){clearTimeout(r),a=0,r=n=o=null},u},f.debounce=function(e,t,i){var r,n,o=function(t,i){r=null,i&&(n=e.apply(t,i))},s=y(function(s){if(r&&clearTimeout(r),i){var a=!r;r=setTimeout(o,t),a&&(n=e.apply(this,s))}else r=f.delay(o,t,this,s);return n});return s.cancel=function(){clearTimeout(r),r=null},s},f.wrap=function(e,t){return f.partial(t,e)},f.negate=function(e){return function(){return!e.apply(this,arguments)}},f.compose=function(){var e=arguments,t=e.length-1;return function(){for(var i=t,r=e[t].apply(this,arguments);i--;)r=e[i].call(this,r);return r}},f.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},f.before=function(e,t){var i;return function(){return 0<--e&&(i=t.apply(this,arguments)),e<=1&&(t=null),i}},f.once=f.partial(f.before,2),f.restArguments=y;var P=!{toString:null}.propertyIsEnumerable("toString"),L=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],N=function(e,t){var i=L.length,r=e.constructor,o=f.isFunction(r)&&r.prototype||n,s="constructor";for(w(e,s)&&!f.contains(t,s)&&t.push(s);i--;)(s=L[i])in e&&e[s]!==o[s]&&!f.contains(t,s)&&t.push(s)};f.keys=function(e){if(!f.isObject(e))return[];if(h)return h(e);var t=[];for(var i in e)w(e,i)&&t.push(i);return P&&N(e,t),t},f.allKeys=function(e){if(!f.isObject(e))return[];var t=[];for(var i in e)t.push(i);return P&&N(e,t),t},f.values=function(e){for(var t=f.keys(e),i=t.length,r=Array(i),n=0;n<i;n++)r[n]=e[t[n]];return r},f.mapObject=function(e,t,i){t=v(t,i);for(var r=f.keys(e),n=r.length,o={},s=0;s<n;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},f.pairs=function(e){for(var t=f.keys(e),i=t.length,r=Array(i),n=0;n<i;n++)r[n]=[t[n],e[t[n]]];return r},f.invert=function(e){for(var t={},i=f.keys(e),r=0,n=i.length;r<n;r++)t[e[i[r]]]=i[r];return t},f.functions=f.methods=function(e){var t=[];for(var i in e)f.isFunction(e[i])&&t.push(i);return t.sort()};var O=function(e,t){return function(i){var r=arguments.length;if(t&&(i=Object(i)),r<2||null==i)return i;for(var n=1;n<r;n++)for(var o=arguments[n],s=e(o),a=s.length,l=0;l<a;l++){var u=s[l];t&&void 0!==i[u]||(i[u]=o[u])}return i}};f.extend=O(f.allKeys),f.extendOwn=f.assign=O(f.keys),f.findKey=function(e,t,i){t=v(t,i);for(var r,n=f.keys(e),o=0,s=n.length;o<s;o++)if(t(e[r=n[o]],r,e))return r};var F,B,G=function(e,t,i){return t in i};f.pick=y(function(e,t){var i={},r=t[0];if(null==e)return i;f.isFunction(r)?(1<t.length&&(r=m(r,t[1])),t=f.allKeys(e)):(r=G,t=M(t,!1,!1),e=Object(e));for(var n=0,o=t.length;n<o;n++){var s=t[n],a=e[s];r(a,s,e)&&(i[s]=a)}return i}),f.omit=y(function(e,t){var i,r=t[0];return f.isFunction(r)?(r=f.negate(r),1<t.length&&(i=t[1])):(t=f.map(M(t,!1,!1),String),r=function(e,i){return!f.contains(t,i)}),f.pick(e,r,i)}),f.defaults=O(f.allKeys,!0),f.create=function(e,t){var i=b(e);return t&&f.extendOwn(i,t),i},f.clone=function(e){return f.isObject(e)?f.isArray(e)?e.slice():f.extend({},e):e},f.tap=function(e,t){return t(e),e},f.isMatch=function(e,t){var i=f.keys(t),r=i.length;if(null==e)return!r;for(var n=Object(e),o=0;o<r;o++){var s=i[o];if(t[s]!==n[s]||!(s in n))return!1}return!0},F=function(e,t,i,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var n=typeof e;return("function"===n||"object"===n||"object"==typeof t)&&B(e,t,i,r)},B=function(e,t,i,r){e instanceof f&&(e=e._wrapped),t instanceof f&&(t=t._wrapped);var n=l.call(e);if(n!==l.call(t))return!1;switch(n){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return o.valueOf.call(e)===o.valueOf.call(t)}var s="[object Array]"===n;if(!s){if("object"!=typeof e||"object"!=typeof t)return!1;var a=e.constructor,u=t.constructor;if(a!==u&&!(f.isFunction(a)&&a instanceof a&&f.isFunction(u)&&u instanceof u)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var c=(i=i||[]).length;c--;)if(i[c]===e)return r[c]===t;if(i.push(e),r.push(t),s){if((c=e.length)!==t.length)return!1;for(;c--;)if(!F(e[c],t[c],i,r))return!1}else{var h,d=f.keys(e);if(c=d.length,f.keys(t).length!==c)return!1;for(;c--;)if(h=d[c],!w(t,h)||!F(e[h],t[h],i,r))return!1}return i.pop(),r.pop(),!0},f.isEqual=function(e,t){return F(e,t)},f.isEmpty=function(e){return null==e||(S(e)&&(f.isArray(e)||f.isString(e)||f.isArguments(e))?0===e.length:0===f.keys(e).length)},f.isElement=function(e){return!(!e||1!==e.nodeType)},f.isArray=c||function(e){return"[object Array]"===l.call(e)},f.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},f.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(e){f["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}}),f.isArguments(arguments)||(f.isArguments=function(e){return w(e,"callee")});var U=e.document&&e.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof U&&(f.isFunction=function(e){return"function"==typeof e||!1}),f.isFinite=function(e){return!f.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},f.isNaN=function(e){return f.isNumber(e)&&isNaN(e)},f.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)},f.isNull=function(e){return null===e},f.isUndefined=function(e){return void 0===e},f.has=function(e,t){if(!f.isArray(t))return w(e,t);for(var i=t.length,r=0;r<i;r++){var n=t[r];if(null==e||!u.call(e,n))return!1;e=e[n]}return!!i},f.noConflict=function(){return e._=t,this},f.identity=function(e){return e},f.constant=function(e){return function(){return e}},f.noop=function(){},f.property=function(e){return f.isArray(e)?function(t){return T(t,e)}:x(e)},f.propertyOf=function(e){return null==e?function(){}:function(t){return f.isArray(t)?T(e,t):e[t]}},f.matcher=f.matches=function(e){return e=f.extendOwn({},e),function(t){return f.isMatch(t,e)}},f.times=function(e,t,i){var r=Array(Math.max(0,e));t=m(t,i,1);for(var n=0;n<e;n++)r[n]=t(n);return r},f.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},f.now=Date.now||function(){return(new Date).getTime()};var z={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},V=f.invert(z),j=function(e){var t=function(t){return e[t]},i="(?:"+f.keys(e).join("|")+")",r=RegExp(i),n=RegExp(i,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(n,t):e}};f.escape=j(z),f.unescape=j(V),f.result=function(e,t,i){f.isArray(t)||(t=[t]);var r=t.length;if(!r)return f.isFunction(i)?i.call(e):i;for(var n=0;n<r;n++){var o=null==e?void 0:e[t[n]];void 0===o&&(o=i,n=r),e=f.isFunction(o)?o.call(e):o}return e};var W=0;f.uniqueId=function(e){var t=++W+"";return e?e+t:t},f.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Y=/(.)^/,H={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,X=function(e){return"\\"+H[e]};f.template=function(e,t,i){!t&&i&&(t=i),t=f.defaults({},t,f.templateSettings);var r,n=RegExp([(t.escape||Y).source,(t.interpolate||Y).source,(t.evaluate||Y).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(n,function(t,i,r,n,a){return s+=e.slice(o,a).replace(q,X),o=a+t.length,i?s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":n&&(s+="';\n"+n+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(t.variable||"obj","_",s)}catch(t){throw t.source=s,t}var a=function(e){return r.call(this,e,f)},l=t.variable||"obj";return a.source="function("+l+"){\n"+s+"}",a},f.chain=function(e){var t=f(e);return t._chain=!0,t};var Z=function(e,t){return e._chain?f(t).chain():t};f.mixin=function(e){return f.each(f.functions(e),function(t){var i=f[t]=e[t];f.prototype[t]=function(){var e=[this._wrapped];return s.apply(e,arguments),Z(this,i.apply(f,e))}}),f},f.mixin(f),f.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];f.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!==e&&"splice"!==e||0!==i.length||delete i[0],Z(this,i)}}),f.each(["concat","join","slice"],function(e){var t=i[e];f.prototype[e]=function(){return Z(this,t.apply(this._wrapped,arguments))}}),f.prototype.value=function(){return this._wrapped},f.prototype.valueOf=f.prototype.toJSON=f.prototype.value,f.prototype.toString=function(){return String(this._wrapped)},"function"==typeof r&&r.amd&&r("underscore",[],function(){return f})}(),r("underscore-min",["jquery"],function(e){return function(){return function(){return _.noConflict()}.apply(e,arguments)||e._}}(this)),function(){var e,t=function(e,t){return function(){return e.apply(t,arguments)}},i=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1};(e="undefined"!=typeof exports&&null!==exports&&this||(this.WCS={})).Math={},e.Math.R2D=180/Math.PI,e.Math.D2R=Math.PI/180,e.Math.WCSTRIG_TOL=1e-10,e.Math.cosd=function(t){if(t%90==0)switch(Math.abs(Math.floor(t/90+.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.cos(t*e.Math.D2R)},e.Math.sind=function(t){if(t%90==0)switch(Math.abs(Math.floor(t/90-.5))%4){case 0:return 1;case 1:return 0;case 2:return-1;case 3:return 0}return Math.sin(t*e.Math.D2R)},e.Math.sincosd=function(t){var i,r,n,o;if(t%90==0){switch(Math.abs(Math.floor(t/90+.5))%4){case 0:r=0,i=1;break;case 1:r=null!=(n=t>0)?n:{1:-1},i=0;break;case 2:r=0,i=-1;break;case 3:r=null!=(o=t>0)?o:-{1:1},i=0}return r*i}return(r=Math.sin(t*e.Math.D2R))*(i=Math.cos(t*e.Math.D2R))},e.Math.tand=function(t){var i;return 0===(i=360&t)||180===Math.abs(i)?0:45===i||225===i?1:-135===i||-315===i?-1:Math.tan(t*e.Math.D2R)},e.Math.acosd=function(t){if(t>=1){if(t-1<e.Math.WCSTRIG_TOL)return 0}else{if(0===t)return 90;if(t<=-1&&t+1>-e.Math.WCSTRIG_TOL)return 180}return Math.acos(t)*e.Math.R2D},e.Math.asind=function(t){if(t<=-1){if(t+1>-e.Math.WCSTRIG_TOL)return-90;if(0===t)return 0;if(t>=1&&t-1<e.Math.WCSTRIG_TOL)return 90}return Math.asin(t)*e.Math.R2D},e.Math.atand=function(t){return-1===t?-45:0===t?0:1===t?45:Math.atan(t)*e.Math.R2D},e.Math.atan2d=function(t,i){if(0===t){if(i>=0)return 0;if(i<0)return 180}else if(0===i){if(t>0)return 90;if(t<0)return-90}return Math.atan2(t,i)*e.Math.R2D},e.Math.toRightTriangular=function(e){var t,i,r,n,o,s,a,l,u;for(n=a=e.length,o=e[0].length;;){if(0===e[i=n-a][i])for(r=i+1;r<n;){if(0!==e[r][i]){for(t=[],l=o;u=o-l,t.push(e[i][u]+e[r][u]),--l;);e[i]=t;break}r+=1}if(0!==e[i][i])for(r=i+1;r<n;){for(s=e[r][i]/e[i][i],t=[],l=o;u=o-l,t.push(u<=i?0:e[r][u]-e[i][u]*s),--l;);e[r]=t,r+=1}if(!--a)break}return e},e.Math.determinant=function(t){var i,r,n,o,s;for(i=(o=e.Math.toRightTriangular(t))[0][0],n=s=o.length-1;i*=o[r=n-s+1][r],--s;);return i},e.Math.matrixInverse=function(t){var i,r,n,o,s,a,l,u;for(u=t[0].length,r=t.length,i=new Array(r),o=new Array(r),l=[],a=[],s=0;s<r;){for(a[s]=[],n=0;n<u;)a[s][n]=t[s][n],n+=1;s+=1}for(s=0;s<r;){for(i[s]=new Array(u),o[s]=new Array(u),n=0;n<u;)i[s][n]=n===s?1:0,n+=1;l[s]=a[s].concat(i[s]),s+=1}for(e.Math.gaussJordan(l),s=0;s<r;)o[s]=l[s].slice(u,2*u),s+=1;return o},e.Math.gaussJordan=function(e,t){var i,r,n,o,s,a,l,u;for(t||(t=1e-10),i=e.length,r=e[0].length,n=-1;++n<i;){for(a=n,o=n;++o<i;)Math.abs(e[o][n])>Math.abs(e[a][n])&&(a=o);if(l=e[n],e[n]=e[a],e[a]=l,Math.abs(e[n][n])<=t)return!1;for(o=n;++o<i;)for(u=e[o][n]/e[n][n],s=n-1;++s<r;)e[o][s]-=e[n][s]*u}for(n=i;--n>=0;){for(u=e[n][n],o=-1;++o<n;)for(s=r;--s>=n;)e[o][s]-=e[n][s]*e[o][n]/u;for(e[n][n]/=u,s=i-1;++s<r;)e[n][s]/=u}return!0},e.Mapper=function(){function r(e){this.coordinateToPixel=t(this.coordinateToPixel,this),this.pixelToCoordinate=t(this.pixelToCoordinate,this),this.fromCelestial=t(this.fromCelestial,this),this.toCelestial=t(this.toCelestial,this),this.fromIntermediate=t(this.fromIntermediate,this),this.toIntermediate=t(this.toIntermediate,this),this.computeCelestialParameters=t(this.computeCelestialParameters,this),this.getSipCoefficients=t(this.getSipCoefficients,this),this.setProjection=t(this.setProjection,this),this.derivePC=t(this.derivePC,this),this.checkCard=t(this.checkCard,this),this.verifyHeader=t(this.verifyHeader,this),this.wcsobj={},this.projection=void 0,this.longitudeAxis=void 0,this.latitudeAxis=void 0,this.sip=void 0,this.verifyHeader(e),this.setProjection(e)}return r.prototype.verifyHeader=function(t){var i,r,n,o,s,a,l,u,c,h,d;for(this.wcsobj.naxis=a=t.NAXIS||t.WCSAXES||2,this.wcsobj.radesys=t.RADESYS||"ICRS",l=["CRPIX","CRVAL","CTYPE"],this.wcsobj.crpix=[],this.wcsobj.crval=[],this.wcsobj.ctype=[],r=u=1;1<=a?u<=a:u>=a;r=1<=a?++u:--u)for(o=c=0,d=l.length-1;0<=d?c<=d:c>=d;o=0<=d?++c:--c){if(s=l[o]+r,!t.hasOwnProperty(s))throw"Not enough information to compute WCS, missing required keyword "+s;i=l[o].toLowerCase(),this.wcsobj[i].push(t[s])}for(this.wcsobj.cunit=[],this.wcsobj.cdelt=[],r=h=1;1<=a?h<=a:h>=a;r=1<=a?++h:--h)s="CUNIT"+r,this.wcsobj.cunit.push(t[s]||"deg"),s="CDELT"+r,this.wcsobj.cdelt.push(t[s]||1);if(this.wcsobj.lonpole=t.LONPOLE||0,this.wcsobj.latpole=t.LATPOLE||0,this.wcsobj.equinox=t.EQUINOX||2e3,n=new Date,this.wcsobj.dateObs=t.DATE_OBS||n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.dateObs=t.DATE_OBS||n.getFullYear()+"-"+(n.getMonth()+1)+"-"+n.getDate(),this.wcsobj.pc=this.checkCard(t,"PC",a)||this.derivePC(t),this.wcsobj.pcInv=e.Math.matrixInverse(this.wcsobj.pc),this.wcsobj.cd=this.checkCard(t,"CD",a),null!=this.wcsobj.cd)return this.wcsobj.cdInv=e.Math.matrixInverse(this.wcsobj.cd)},r.prototype.checkCard=function(e,t,i){var r,n,o,s,a,l;for(s=[],n=a=1;1<=i?a<=i:a>=i;n=1<=i?++a:--a)for(s[n-1]=[],o=l=1;1<=i?l<=i:l>=i;o=1<=i?++l:--l){if(r=""+t+n+"_"+o,!e.hasOwnProperty(r))return;s[n-1].push(e[r])}return s},r.prototype.derivePC=function(e){var t,i,r,n,o,s,a,l;return e.hasOwnProperty("CROTA2")?(a=e.CROTA2,this.wcsobj.cdelt[1]/this.wcsobj.cdelt[0]):null==(t=this.checkCard(e,"CD",this.wcsobj.naxis))?(a=(l=[0,1])[0],l[1]):(i=t[0][0],r=t[0][1],n=t[1][0],o=t[1][1],a=.5*((n>0?Math.atan2(n,i):0===n?0:Math.atan2(-n,-i))+(r>0?Math.atan2(r,-o):0===r?0:Math.atan2(-n,o))),s=Math.cos(a),this.wcsobj.cdelt1=i/s,this.wcsobj.cdelt2=o/s,this.wcsobj.cdelt2/this.wcsobj.cdelt1),t},r.prototype.setProjection=function(t){var r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w=this;if(h=["AIR","ARC","AZP","NCP","SIN","STG","SZP","TAN","TAN-SIP","ZEA","ZPN"],n=["CYP","CEA","CAR","MER","SFL","PAR","MOL","AIT"],r=["COP","COE","COD","COO"],u=["BON","PCO"],c=["TSC","CSC","QSC"],this.projection=this.wcsobj.ctype[0].slice(5),this.longitudeAxis=this.wcsobj.ctype[0].match("RA|GLON|ELON|HLON|SLON")?1:2,this.latitudeAxis=this.wcsobj.ctype[1].match("DEC|GLAT|ELAT|HLAT|SLAT")?2:1,d=this.projection,i.call(h,d)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=90,this.wcsobj.alphaP=this.wcsobj.crval[0],this.wcsobj.deltaP=this.wcsobj.crval[1],this.wcsobj.lonpole=this.wcsobj.crval[1]>=this.wcsobj.theta0?0:180,this.projection){case"AIR":o="PV"+this.latitudeAxis+"_1",this.wcsobj.thetaB=t.hasOwnProperty(o)?parseFloat(t[o]):90,this.wcsobj.etaB=(90-this.wcsobj.thetaB)/2;break;case"ARC":this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=w.wcsobj.theta0-r,[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=90-i)*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"AZP":s=(p=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"])[0],a=p[1],this.wcsobj.mu=t.hasOwnProperty(s)?parseFloat(t[s]):0,this.wcsobj.gamma=t.hasOwnProperty(a)?parseFloat(t[a]):0,this.toSpherical=function(e,t){throw"Sorry, not yet implemented!"},this.fromSpherical=function(e,t){throw"Sorry, not yet implemented!"};break;case"NCP":this.toSpherical=function(e,t){throw"Sorry, not yet implemented!"},this.fromSpherical=function(e,t){throw"Sorry, not yet implemented!"};break;case"SIN":s=(f=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2"])[0],a=f[1],this.wcsobj.eta=t.hasOwnProperty(s)?parseFloat(t[s]):0,this.wcsobj.nu=t.hasOwnProperty(a)?parseFloat(t[a]):0,this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=e.Math.acosd(Math.PI*r/180),[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=180/Math.PI*e.Math.cosd(i))*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"STG":this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=w.wcsobj.theta0-2*e.Math.atand(Math.PI*r/360),[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=360/Math.PI*e.Math.tand((90-i)/2))*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"SZP":s=(g=["PV"+this.latitudeAxis+"_1","PV"+this.latitudeAxis+"_2","PV"+this.latitudeAxis+"_3"])[0],a=g[1],l=g[2],this.wcsobj.mu=t.hasOwnProperty(s)?parseFloat(t[s]):0,this.wcsobj.phiC=t.hasOwnProperty(a)?parseFloat(t[a]):0,this.wcsobj.thetaC=t.hasOwnProperty(l)?parseFloat(t[l]):90,this.wcsobj.xp=-this.wcsobj.mu*e.Math.cosd(this.wcsobj.thetaC)*e.Math.sind(this.wcsobj.phiC),this.wcsobj.yp=this.wcsobj.mu*e.Math.cosd(this.wcsobj.thetaC)*e.Math.cosd(this.wcsobj.phiC),this.wcsobj.zp=this.wcsobj.mu*e.Math.sind(this.wcsobj.thetaC)+1,this.toSpherical=function(e,t){throw"Sorry, not yet implemented"},this.fromSpherical=function(e,t){throw"Sorry, not yet implemented"};break;case"TAN":this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=e.Math.atand(180/(Math.PI*r)),[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=180/(Math.PI*e.Math.tand(i)))*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"TAN-SIP":this.getSipCoefficients(t),this.f=function(e,t,i){var r,n,o,s,a,l;for(s=0,r=i[0].length-1,n=a=0;0<=r?a<=r:a>=r;n=0<=r?++a:--a)for(o=l=0;0<=r?l<=r:l>=r;o=0<=r?++l:--l)s+=i[n][o]*Math.pow(e,n)*Math.pow(t,o);return s},this.toIntermediate=function(e){var t,i,r,n,o,s,a,l,u,c,h;for(o=[],s=e[0]-w.wcsobj.crpix[0],a=e[1]-w.wcsobj.crpix[1],0,t=w.f(s,a,w.sip.aCoeffs),i=w.f(s,a,w.sip.bCoeffs),e[0]=e[0]+t,e[1]=e[1]+i,r=l=0,c=w.wcsobj.naxis-1;0<=c?l<=c:l>=c;r=0<=c?++l:--l)for(o[r]=0,e[r]-=w.wcsobj.crpix[r],n=u=0,h=w.wcsobj-1;0<=h?u<=h:u>=h;n=0<=h?++u:--u)o[r]+=w.wcsobj.cd[r][n]*e[n];return o},this.fromIntermediate=function(e){var t,i,r,n,o,s,a,l,u,c;for(s=[],r=a=0,u=w.wcsobj.naxis-1;0<=u?a<=u:a>=u;r=0<=u?++a:--a){for(s[r]=0,n=l=0,c=w.wcsobj.naxis-1;0<=c?l<=c:l>=c;n=0<=c?++l:--l)s[r]+=w.wcsobj.cdInv[r][n]*e[n];s[r]+=w.wcsobj.crpix[r]}return 0,t=w.f(s[0],s[1],w.sip.apCoeffs),i=w.f(s[0],s[1],w.sip.bpCoeffs),(o=[])[0]=s[0]+t,o[1]=s[1]+i,o[0]+=w.wcsobj.crpix[0],o[1]+=w.wcsobj.crpix[1],o},this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=e.Math.atand(180/(Math.PI*r)),[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=180/(Math.PI*e.Math.tand(i)))*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"ZEA":this.toSpherical=function(t,i){var r,n;return r=Math.sqrt(t*t+i*i),n=w.wcsobj.theta0-2*e.Math.asind(Math.PI*r/360),[e.Math.atan2d(t,-i),n]},this.fromSpherical=function(t,i){var r;return[(r=360/Math.PI*e.Math.sind((90-i)/2))*e.Math.sind(t),-r*e.Math.cosd(t)]};break;case"ZPN":this.toSpherical=function(e,t){throw"Sorry, not yet implemented!"},this.fromSpherical=function(e,t){throw"Sorry, not yet implemented!"}}if(m=this.projection,i.call(n,m)>=0)switch(this.wcsobj.phi0=0,this.wcsobj.theta0=0,this.computeCelestialParameters(this.wcsobj.phi0,this.wcsobj.theta0),this.projection){case"CYP":s=(v=["PV"+this.latitudeAxis+"_1,","PV"+this.latitudeAxis+"_2"])[0],a=v[1],this.wcsobj.mu=t.hasOwnProperty(s)?parseFloat(t[s]):1,this.wcsobj.lambda=t.hasOwnProperty(a)?parseFloat(t[a]):1,this.wcsobj.mu+this.wcsobj.lambda===0&&raise("Divide by zero error"),this.toSpherical=function(t,i){var r,n;return r=Math.PI*i/(180*(w.wcsobj.mu+w.wcsobj.lambda)),n=e.Math.atan2d(r,1)+e.Math.asind(r*w.wcsobj.mu/Math.sqrt(r*r+1)),[t/w.wcsobj.lambda,n]},this.fromSpherical=function(t,i){return[w.wcsobj.lambda*t,180/Math.PI*((w.wcsobj.mu+w.wcsobj.lambda)/(w.wcsobj.mu+e.Math.cosd(i)))*e.Math.sind(i)]};break;case"CEA":o="PV"+this.latitudeAxis+"_1",this.wcsobj.lambda=t.hasOwnProperty(o)?parseFloat(t[o]):1,this.toSpherical=function(t,i){return[t,e.Math.asind(Math.PI*w.wcsobj.lambda*i/180)]},this.fromSpherical=function(t,i){return[t,180/Math.PI*e.Math.sind(i)/w.wcsobj.lambda]};break;case"CAR":this.toSpherical=function(e,t){return[e,t]},this.fromSpherical=function(e,t){return[e,t]};break;case"MER":this.toSpherical=function(t,i){return[t,2*e.Math.atand(Math.exp(i*Math.PI/180))-90]},this.fromSpherical=function(t,i){return[t,180/Math.PI*Math.log(e.Math.tand((90+i)/2))]};break;case"SFL":this.toSpherical=function(t,i){return[t/e.Math.cosd(i),i]},this.fromSpherical=function(t,i){return[t*e.Math.cosd(i),i]};break;case"PAR":this.toSpherical=function(t,i){var r;return r=3*e.Math.asind(i/180),[t/(1-4*Math.pow(i/180,2)),r]},this.fromSpherical=function(t,i){return[t*(2*e.Math.cosd(2*i/3)-1),180*e.Math.sind(i/3)]};break;case"MOL":this.toSpherical=function(t,i){var r;return r=e.Math.asind(e.Math.asind(Math.PI*i/(180*Math.sqrt(2)))/90+i/180*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),[Math.PI*t/(2*Math.sqrt(2-Math.pow(Math.PI*i/180,2))),r]},this.fromSpherical=function(e,t){throw"Sorry, not yet implemented!"};break;case"AIT":this.toSpherical=function(t,i){var r,n,o,s;return n=Math.pow(Math.PI*t/720,2),o=Math.pow(Math.PI*i/360,2),s=Math.sqrt(1-n-o),r=e.Math.asind(Math.PI*i*s/180),[2*e.Math.atan2d(Math.PI*s*t/360,2*s*s-1),r]},this.fromSpherical=function(t,i){var r;return[2*(r=180/Math.PI*Math.sqrt(2/(1+e.Math.cosd(i)*e.Math.cosd(t/2))))*e.Math.cosd(i)*e.Math.sind(t/2),r*e.Math.sind(i)]}}if(y=this.projection,i.call(r,y)>=0)throw o="PV"+this.latitudeAxis+"_1",this.wcsobj.phi0=0,this.wcsobj.theta0=t.hasOwnProperty(o)?t[o]:0,"Sorry, not yet implemented!";if(b=this.projection,i.call(u,b)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!";if(x=this.projection,i.call(c,x)>=0)throw this.wcsobj.phi0=0,this.wcsobj.theta0=0,"Sorry, not yet implemented!"},r.prototype.getSipCoefficients=function(e){var t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b;if(!e.hasOwnProperty("A_ORDER")&&!e.hasOwnProperty("B_ORDER"))throw"What's the polynomial order, man!";for(this.sip={},this.sip.aOrder=e.A_ORDER,this.sip.bOrder=e.B_ORDER,this.sip.apOrder=e.AP_ORDER||0,this.sip.bpOrder=e.BP_ORDER||0,this.sip.aCoeffs=[],this.sip.bCoeffs=[],this.sip.apCoeffs=[],this.sip.bpCoeffs=[],t=n=0,d=this.sip.aOrder;0<=d?n<=d:n>=d;t=0<=d?++n:--n)for(this.sip.aCoeffs[t]=[],i=o=0,p=this.sip.aOrder;0<=p?o<=p:o>=p;i=0<=p?++o:--o)r="A_"+t+"_"+i,this.sip.aCoeffs[t][i]=e[r]||0;for(t=s=0,f=this.sip.bOrder;0<=f?s<=f:s>=f;t=0<=f?++s:--s)for(this.sip.bCoeffs[t]=[],i=a=0,g=this.sip.bOrder;0<=g?a<=g:a>=g;i=0<=g?++a:--a)r="B_"+t+"_"+i,this.sip.bCoeffs[t][i]=e[r]||0;for(t=l=0,m=this.sip.apOrder;0<=m?l<=m:l>=m;t=0<=m?++l:--l)for(this.sip.apCoeffs[t]=[],i=u=0,v=this.sip.apOrder;0<=v?u<=v:u>=v;i=0<=v?++u:--u)r="AP_"+t+"_"+i,this.sip.apCoeffs[t][i]=e[r]||0;for(t=c=0,y=this.sip.bpOrder;0<=y?c<=y:c>=y;t=0<=y?++c:--c)for(this.sip.bpCoeffs[t]=[],i=h=0,b=this.sip.bpOrder;0<=b?h<=b:h>=b;i=0<=b?++h:--h)r="BP_"+t+"_"+i,this.sip.bpCoeffs[t][i]=e[r]||0;if(!this.sip.aCoeffs&&!this.sip.bCoeffs)throw"Where are the coefficients dude!"},r.prototype.computeCelestialParameters=function(t,i){var r,n,o,s,a,l,u,c,h,d,p,f;return r=(p=this.wcsobj.crval)[0],n=p[1],u=(f=[this.wcsobj.lonpole,this.wcsobj.latpole])[0],d=f[1],c=h=!1,(o=e.Math.atan2d(e.Math.sind(this.wcsobj.theta0),e.Math.cosd(this.wcsobj.theta0*e.Math.cosd(u-this.wcsobj.phi0))))+(s=e.Math.acosd(e.Math.sind(n)/Math.sqrt(1-Math.pow(e.Math.cosd(this.wcsobj.theta0),2)*Math.pow(e.Math.sind(u-this.wcsobj.phi0),2))))>=-90&&o+s<=90&&(c=!0),o-s>=-90&&o-s<=90&&(h=!0),c&&h?(a=Math.abs(o+s-d),l=Math.abs(o-s-d),this.wcsobj.deltaP=a<l?o+s:o-s):this.wcsobj.deltaP=c?o+s:h?o-s:d,this.wcsobj.alphaP=90===Math.abs(n)?r:r-e.Math.asind(e.Math.sind(u-this.wcsobj.phi0)*e.Math.cosd(this.wcsobj.theta0)/e.Math.cosd(n))},r.prototype.toIntermediate=function(e){var t,i,r,n,o,s,a;for(r=[],t=n=0,s=this.wcsobj.naxis-1;0<=s?n<=s:n>=s;t=0<=s?++n:--n)for(r[t]=0,e[t]-=this.wcsobj.crpix[t],i=o=0,a=this.wcsobj.naxis-1;0<=a?o<=a:o>=a;i=0<=a?++o:--o)r[t]+=this.wcsobj.cdelt[t]*this.wcsobj.pc[t][i]*e[i];return r},r.prototype.fromIntermediate=function(e){var t,i,r,n,o,s,a;for(r=[],t=n=0,s=this.wcsobj.naxis-1;0<=s?n<=s:n>=s;t=0<=s?++n:--n){for(r[t]=0,i=o=0,a=this.wcsobj.naxis-1;0<=a?o<=a:o>=a;i=0<=a?++o:--o)r[t]+=this.wcsobj.pcInv[t][i]*e[i]/this.wcsobj.cdelt[t];r[t]+=this.wcsobj.crpix[t]}return r},r.prototype.toCelestial=function(t,i){var r,n,o,s,a,l,u,c,h;return l=e.Math.sind(i),o=e.Math.cosd(i),a=e.Math.sind(t-this.wcsobj.lonpole),n=e.Math.cosd(t-this.wcsobj.lonpole),s=e.Math.sind(this.wcsobj.deltaP),u=l*(r=e.Math.cosd(this.wcsobj.deltaP))-o*s*n,c=-o*a,h=l*s+o*r*n,[(e.Math.atan2d(c,u)+this.wcsobj.alphaP+360)%360,e.Math.asind(h)]},r.prototype.fromCelestial=function(t,i){var r,n,o,s,a,l,u,c;return a=e.Math.sind(i),n=e.Math.cosd(i),l=e.Math.sind(this.wcsobj.deltaP),o=e.Math.cosd(this.wcsobj.deltaP),s=e.Math.sind(t-this.wcsobj.alphaP),u=a*o-n*l*(r=e.Math.cosd(t-this.wcsobj.alphaP)),c=-n*s,[this.wcsobj.lonpole+e.Math.atan2d(c,u),e.Math.asind(a*l+n*o*r)]},r.prototype.pixelToCoordinate=function(){var e;return e=this.toIntermediate(arguments[0],arguments[1]),e=this.toSpherical(e[0],e[1]),{ra:(e=this.toCelestial(e[0],e[1]))[this.longitudeAxis-1],dec:e[this.latitudeAxis-1]}},r.prototype.coordinateToPixel=function(){var e;return e=this.fromCelestial(arguments[0],arguments[1]),e=this.fromSpherical(e[0],e[1]),{x:(e=this.fromIntermediate(e))[0],y:e[1]}},r}()}.call(this),r("wcs",function(){}),r("gw/Utils/Constants",[],function(){var e=function(){};return e.API={version:"[VERSION_API]"},e.LEVEL={WARNING:"warning",ERROR:"error",DEBUG:"debug"},e.ANIMATION={Inertia:"Inertia",Interpolated:"Interpolated",Path:"Path",Segmented:"Segmented"},e.CONTEXT={Planet:"Planet",Sky:"Sky",Ground:"Ground"},e.GLOBE={Planet:"Planet",Sky:"Sky"},e.LAYER={AsynchroneWMS:"AsynchroneWMS",WMS:"WMS",WMTS:"WMTS",WMSElevation:"WMSElevation",WCSElevation:"WCSElevation",GeoJSON:"GeoJSON",Vector:"Vector",Atmosphere:"Atmosphere",Bing:"Bing",GroundOverlay:"GroundOverlay",OSM:"OSM",TileWireframe:"TileWireframe",HipsGrid:"HipsGrid",CoordinateGrid:"CoordinateGrid",HipsFits:"HipsFits",Hips:"Hips",HipsCat:"HipsCat",Moc:"Moc",OpenSearch:"OpenSearch"},e.GEOMETRY={Point:"Point",MultiPoint:"MultiPoint",LineString:"LineString",MultiLineString:"MultiLineString",Polygon:"Polygon",MultiPolygon:"MultiPolygon",GeometryCollection:"GeometryCollection"},e.PROJECTION={Aitoff:"Aitoff",August:"August",Mercator:"Mercator",Mollweide:"Mollweide",Plate:"Plate Carrée",Azimuth:"Azimuth"},e.CRS={Equatorial:"Equatorial",Galactic:"Galactic",WGS84:"CRS:84",Mars_2000:"IAU2000:49901",Mars_2000_old:"IAU2000:49900",Moon_2000:"IAU2000:30101",Moon_2000_old:"IAU2000:30100",HorizontalLocal:"HorizontalLocal",Sun:"IAU:Sun"},e.CRS_TO_CONTEXT={Equatorial:"Sky",Galactic:"Sky","CRS:84":"Planet","IAU2000:49901":"Planet","IAU2000:49900":"Planet","IAU2000:30101":"Planet","IAU2000:30100":"Planet",HorizontalLocal:"Ground","IAU:Sun":"Planet"},e.NAVIGATION={AstroNavigation:"AstroNavigation",PlanetNavigation:"PlanetNavigation",FlatNavigation:"FlatNavigation",GroundNavigation:"GroundNavigation"},e.SERVICE={FitsHips:"FitsHips",FitsVisu:"FitsVisu",Histogram:"Histogram",ImageProcessing:"ImageProcessing",MeasureToolSky:"MeasureToolSky",MeasureToolPlanet:"MeasureToolPlanet",MocBase:"MocBase",MollweideViewer:"MollweideViewer",PickingManager:"PickingManager",Samp:"Samp",SelectionTool:"SelectionTool",NameResolver:"NameResolver",ReverseNameResolver:"ReverseNameResolver",ExportTool:"ExportTool",TimeTravel:"TimeTravel"},e.HANDLER={Touch:"Touch",Keyboard:"Keyboard",Mouse:"Mouse",GoogleMouse:"GoogleMouse"},e.PROVIDER={Constellation:"Constellation",Planet:"Planet",Star:"Star",Crater:"Crater",Trajectory:"Trajectory"},e.MappingCrsHips2Mizar={equatorial:"Equatorial",galactic:"Galactic",ecliptic:"Ecliptic","mars-panstimson":"Equatorial",horizontalLocal:"Equatorial"},e.UTILITY={Fits:"Fits",Intersection:"Intersection",Numeric:"Numeric",CreateStyle:"CreateStyle",FeatureStyle:"FeatureStyle"},e.ANIMATION_STATUS={STOPPED:"STOPPED",RUNNING:"RUNNING",PAUSED:"PAUSED"},e.EVENT_MSG={PLUGIN_NOT_FOUND:"plugin:not_found",MIZAR_MODE_TOGGLE:"mizarMode:toggle",LAYER_BACKGROUND_ERROR:"backgroundLayer:error",LAYER_BACKGROUND_ADDED:"backgroundLayer:added",LAYER_BACKGROUND_CHANGED:"backgroundLayer:changed",LAYER_ADDED:"layer:added",LAYER_REMOVED:"layer:removed",LAYER_VISIBILITY_CHANGED:"visibility:changed",LAYER_OPACITY_CHANGED:"opacity:changed",LAYER_START_LOAD:"startLoad",LAYER_END_LOAD:"endLoad",LAYER_START_BACKGROUND_LOAD:"startBackgroundLoad",LAYER_END_BACKGROUND_LOAD:"endBackgroundLoad",LAYER_UPDATE_STATS_ATTRIBUTES:"updateStatsAttribute",LAYER_TOGGLE_WMS:"toggleWMS",BASE_LAYERS_ERROR:"baseLayersError",BASE_LAYERS_READY:"baseLayersReady",CRS_MODIFIED:"modifiedCrs",NAVIGATION_STARTED:"startNavigation",NAVIGATION_ENDED:"endNavigation",NAVIGATION_MODIFIED:"modifiedNavigation",NAVIGATION_CHANGED_DISTANCE:"navigation:changedDistance",IMAGE_DOWNLOADED:"image:downloaded",IMAGE_REMOVED:"image:removed",IMAGE_ADDED:"image:added",FEATURED_ADDED:"features:added",GLOBAL_TIME_REWIND:"globalTime:rewind",GLOBAL_TIME_FORWARD:"globalTime:forward",GLOBAL_TIME_SET:"globalTime:set",GLOBAL_TIME_CHANGED:"globalTime:changed"},e.DISPLAY={RENDERING:-1,DEFAULT_RASTER:0,SELECTED_RASTER:10,DEFAULT_VECTOR:20,SELECTED_VECTOR:30,HIGHLIGHTED_VECTOR:31,SERVICE_VECTOR:40},e.INFORMATION_TYPE={ATMOSPHERE:"ATMOSPHERE",RASTER:"RASTER",VECTOR:"VECTOR"},e.TIME_STEP={YEAR:"years",QUARTER:"quarters",MONTH:"months",WEEK:"weeks",DAY:"days",HOUR:"hours",MINUTE:"minutes",SECOND:"seconds",MILLISECOND:"milliseconds",ENUMERATED:null},e.TIME_MOMENT_STEP={YEAR:"year",MONTH:"month",DAY:"day",HOUR:"hour",MINUTE:"minute",SECOND:"second"},e.UNIT_TIME_WMS={YEAR:"Y",MONTH:"M",DAY:"D",HOUR:"H",MINUTE:"M",SECONDE:"S"},e.UNIT_RESOLUTION_WMS={TIME:"PT",NOT_TIME:"P"},e.TIME={DEFAULT_FORMAT:"Do MMM Y HH:mm"},e.TILE={GEO_TILE:"GeoTile",MERCATOR_TILE:"MercatorTile",HEALPIX_TILE:"HealpixTile"},e}),s=this,a=function(){"use strict";var e,i;function r(){return e.apply(null,arguments)}function n(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function o(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function s(e){return void 0===e}function a(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function l(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function u(e,t){var i,r=[];for(i=0;i<e.length;++i)r.push(t(e[i],i));return r}function c(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function h(e,t){for(var i in t)c(t,i)&&(e[i]=t[i]);return c(t,"toString")&&(e.toString=t.toString),c(t,"valueOf")&&(e.valueOf=t.valueOf),e}function d(e,t,i,r){return Et(e,t,i,r,!0).utc()}function p(e){return null==e._pf&&(e._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}),e._pf}function f(e){if(null==e._isValid){var t=p(e),r=i.call(t.parsedDateParts,function(e){return null!=e}),n=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&r);if(e._strict&&(n=n&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return n;e._isValid=n}return e._isValid}function g(e){var t=d(NaN);return null!=e?h(p(t),e):p(t).userInvalidated=!0,t}i=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),i=t.length>>>0,r=0;r<i;r++)if(r in t&&e.call(this,t[r],r,t))return!0;return!1};var m=r.momentProperties=[];function v(e,t){var i,r,n;if(s(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),s(t._i)||(e._i=t._i),s(t._f)||(e._f=t._f),s(t._l)||(e._l=t._l),s(t._strict)||(e._strict=t._strict),s(t._tzm)||(e._tzm=t._tzm),s(t._isUTC)||(e._isUTC=t._isUTC),s(t._offset)||(e._offset=t._offset),s(t._pf)||(e._pf=p(t)),s(t._locale)||(e._locale=t._locale),0<m.length)for(i=0;i<m.length;i++)s(n=t[r=m[i]])||(e[r]=n);return e}var y=!1;function b(e){v(this,e),this._d=new Date(null!=e._d?e._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===y&&(y=!0,r.updateOffset(this),y=!1)}function x(e){return e instanceof b||null!=e&&null!=e._isAMomentObject}function w(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function T(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=w(t)),i}function _(e,t,i){var r,n=Math.min(e.length,t.length),o=Math.abs(e.length-t.length),s=0;for(r=0;r<n;r++)(i&&e[r]!==t[r]||!i&&T(e[r])!==T(t[r]))&&s++;return s+o}function C(e){!1===r.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function S(e,t){var i=!0;return h(function(){if(null!=r.deprecationHandler&&r.deprecationHandler(null,e),i){for(var n,o=[],s=0;s<arguments.length;s++){if(n="","object"==typeof arguments[s]){for(var a in n+="\n["+s+"] ",arguments[0])n+=a+": "+arguments[0][a]+", ";n=n.slice(0,-2)}else n=arguments[s];o.push(n)}C(e+"\nArguments: "+Array.prototype.slice.call(o).join("")+"\n"+(new Error).stack),i=!1}return t.apply(this,arguments)},t)}var E,A={};function I(e,t){null!=r.deprecationHandler&&r.deprecationHandler(e,t),A[e]||(C(t),A[e]=!0)}function M(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function k(e,t){var i,r=h({},e);for(i in t)c(t,i)&&(o(e[i])&&o(t[i])?(r[i]={},h(r[i],e[i]),h(r[i],t[i])):null!=t[i]?r[i]=t[i]:delete r[i]);for(i in e)c(e,i)&&!c(t,i)&&o(e[i])&&(r[i]=h({},r[i]));return r}function D(e){null!=e&&this.set(e)}r.suppressDeprecationWarnings=!1,r.deprecationHandler=null,E=Object.keys?Object.keys:function(e){var t,i=[];for(t in e)c(e,t)&&i.push(t);return i};var R={};function P(e,t){var i=e.toLowerCase();R[i]=R[i+"s"]=R[t]=e}function L(e){return"string"==typeof e?R[e]||R[e.toLowerCase()]:void 0}function N(e){var t,i,r={};for(i in e)c(e,i)&&(t=L(i))&&(r[t]=e[i]);return r}var O={};function F(e,t){O[e]=t}function B(e,t,i){var r=""+Math.abs(e),n=t-r.length;return(0<=e?i?"+":"":"-")+Math.pow(10,Math.max(0,n)).toString().substr(1)+r}var G=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,U=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,z={},V={};function j(e,t,i,r){var n=r;"string"==typeof r&&(n=function(){return this[r]()}),e&&(V[e]=n),t&&(V[t[0]]=function(){return B(n.apply(this,arguments),t[1],t[2])}),i&&(V[i]=function(){return this.localeData().ordinal(n.apply(this,arguments),e)})}function W(e,t){return e.isValid()?(t=Y(t,e.localeData()),z[t]=z[t]||function(e){var t,i,r,n=e.match(G);for(t=0,i=n.length;t<i;t++)V[n[t]]?n[t]=V[n[t]]:n[t]=(r=n[t]).match(/\[[\s\S]/)?r.replace(/^\[|\]$/g,""):r.replace(/\\/g,"");return function(t){var r,o="";for(r=0;r<i;r++)o+=M(n[r])?n[r].call(t,e):n[r];return o}}(t),z[t](e)):e.localeData().invalidDate()}function Y(e,t){var i=5;function r(e){return t.longDateFormat(e)||e}for(U.lastIndex=0;0<=i&&U.test(e);)e=e.replace(U,r),U.lastIndex=0,i-=1;return e}var H=/\d/,q=/\d\d/,X=/\d{3}/,Z=/\d{4}/,K=/[+-]?\d{6}/,J=/\d\d?/,Q=/\d\d\d\d?/,$=/\d\d\d\d\d\d?/,ee=/\d{1,3}/,te=/\d{1,4}/,ie=/[+-]?\d{1,6}/,re=/\d+/,ne=/[+-]?\d+/,oe=/Z|[+-]\d\d:?\d\d/gi,se=/Z|[+-]\d\d(?::?\d\d)?/gi,ae=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,le={};function ue(e,t,i){le[e]=M(t)?t:function(e,r){return e&&i?i:t}}function ce(e,t){return c(le,e)?le[e](t._strict,t._locale):new RegExp(he(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,r,n){return t||i||r||n})))}function he(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}var de={};function pe(e,t){var i,r=t;for("string"==typeof e&&(e=[e]),a(t)&&(r=function(e,i){i[t]=T(e)}),i=0;i<e.length;i++)de[e[i]]=r}function fe(e,t){pe(e,function(e,i,r,n){r._w=r._w||{},t(e,r._w,r,n)})}var ge=0,me=1,ve=2,ye=3,be=4,xe=5,we=6,Te=7,_e=8;function Ce(e){return Se(e)?366:365}function Se(e){return e%4==0&&e%100!=0||e%400==0}j("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),j(0,["YY",2],0,function(){return this.year()%100}),j(0,["YYYY",4],0,"year"),j(0,["YYYYY",5],0,"year"),j(0,["YYYYYY",6,!0],0,"year"),P("year","y"),F("year",1),ue("Y",ne),ue("YY",J,q),ue("YYYY",te,Z),ue("YYYYY",ie,K),ue("YYYYYY",ie,K),pe(["YYYYY","YYYYYY"],ge),pe("YYYY",function(e,t){t[ge]=2===e.length?r.parseTwoDigitYear(e):T(e)}),pe("YY",function(e,t){t[ge]=r.parseTwoDigitYear(e)}),pe("Y",function(e,t){t[ge]=parseInt(e,10)}),r.parseTwoDigitYear=function(e){return T(e)+(68<T(e)?1900:2e3)};var Ee,Ae=Ie("FullYear",!0);function Ie(e,t){return function(i){return null!=i?(ke(this,e,i),r.updateOffset(this,t),this):Me(this,e)}}function Me(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function ke(e,t,i){e.isValid()&&!isNaN(i)&&("FullYear"===t&&Se(e.year())&&1===e.month()&&29===e.date()?e._d["set"+(e._isUTC?"UTC":"")+t](i,e.month(),De(i,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](i))}function De(e,t){if(isNaN(e)||isNaN(t))return NaN;var i=(t%12+12)%12;return e+=(t-i)/12,1===i?Se(e)?29:28:31-i%7%2}Ee=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},j("M",["MM",2],"Mo",function(){return this.month()+1}),j("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),j("MMMM",0,0,function(e){return this.localeData().months(this,e)}),P("month","M"),F("month",8),ue("M",J),ue("MM",J,q),ue("MMM",function(e,t){return t.monthsShortRegex(e)}),ue("MMMM",function(e,t){return t.monthsRegex(e)}),pe(["M","MM"],function(e,t){t[me]=T(e)-1}),pe(["MMM","MMMM"],function(e,t,i,r){var n=i._locale.monthsParse(e,r,i._strict);null!=n?t[me]=n:p(i).invalidMonth=e});var Re=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Pe="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),Le="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_");function Ne(e,t){var i;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=T(t);else if(!a(t=e.localeData().monthsParse(t)))return e;return i=Math.min(e.date(),De(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,i),e}function Oe(e){return null!=e?(Ne(this,e),r.updateOffset(this,!0),this):Me(this,"Month")}var Fe=ae,Be=ae;function Ge(){function e(e,t){return t.length-e.length}var t,i,r=[],n=[],o=[];for(t=0;t<12;t++)i=d([2e3,t]),r.push(this.monthsShort(i,"")),n.push(this.months(i,"")),o.push(this.months(i,"")),o.push(this.monthsShort(i,""));for(r.sort(e),n.sort(e),o.sort(e),t=0;t<12;t++)r[t]=he(r[t]),n[t]=he(n[t]);for(t=0;t<24;t++)o[t]=he(o[t]);this._monthsRegex=new RegExp("^("+o.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+n.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+r.join("|")+")","i")}function Ue(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&0<=e&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function ze(e,t,i){var r=7+t-i;return-(7+Ue(e,0,r).getUTCDay()-t)%7+r-1}function Ve(e,t,i,r,n){var o,s,a=1+7*(t-1)+(7+i-r)%7+ze(e,r,n);return a<=0?s=Ce(o=e-1)+a:a>Ce(e)?(o=e+1,s=a-Ce(e)):(o=e,s=a),{year:o,dayOfYear:s}}function je(e,t,i){var r,n,o=ze(e.year(),t,i),s=Math.floor((e.dayOfYear()-o-1)/7)+1;return s<1?r=s+We(n=e.year()-1,t,i):s>We(e.year(),t,i)?(r=s-We(e.year(),t,i),n=e.year()+1):(n=e.year(),r=s),{week:r,year:n}}function We(e,t,i){var r=ze(e,t,i),n=ze(e+1,t,i);return(Ce(e)-r+n)/7}j("w",["ww",2],"wo","week"),j("W",["WW",2],"Wo","isoWeek"),P("week","w"),P("isoWeek","W"),F("week",5),F("isoWeek",5),ue("w",J),ue("ww",J,q),ue("W",J),ue("WW",J,q),fe(["w","ww","W","WW"],function(e,t,i,r){t[r.substr(0,1)]=T(e)}),j("d",0,"do","day"),j("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),j("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),j("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),j("e",0,0,"weekday"),j("E",0,0,"isoWeekday"),P("day","d"),P("weekday","e"),P("isoWeekday","E"),F("day",11),F("weekday",11),F("isoWeekday",11),ue("d",J),ue("e",J),ue("E",J),ue("dd",function(e,t){return t.weekdaysMinRegex(e)}),ue("ddd",function(e,t){return t.weekdaysShortRegex(e)}),ue("dddd",function(e,t){return t.weekdaysRegex(e)}),fe(["dd","ddd","dddd"],function(e,t,i,r){var n=i._locale.weekdaysParse(e,r,i._strict);null!=n?t.d=n:p(i).invalidWeekday=e}),fe(["d","e","E"],function(e,t,i,r){t[r]=T(e)});var Ye="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),He="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),qe="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Xe=ae,Ze=ae,Ke=ae;function Je(){function e(e,t){return t.length-e.length}var t,i,r,n,o,s=[],a=[],l=[],u=[];for(t=0;t<7;t++)i=d([2e3,1]).day(t),r=this.weekdaysMin(i,""),n=this.weekdaysShort(i,""),o=this.weekdays(i,""),s.push(r),a.push(n),l.push(o),u.push(r),u.push(n),u.push(o);for(s.sort(e),a.sort(e),l.sort(e),u.sort(e),t=0;t<7;t++)a[t]=he(a[t]),l[t]=he(l[t]),u[t]=he(u[t]);this._weekdaysRegex=new RegExp("^("+u.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+a.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+s.join("|")+")","i")}function Qe(){return this.hours()%12||12}function $e(e,t){j(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function et(e,t){return t._meridiemParse}j("H",["HH",2],0,"hour"),j("h",["hh",2],0,Qe),j("k",["kk",2],0,function(){return this.hours()||24}),j("hmm",0,0,function(){return""+Qe.apply(this)+B(this.minutes(),2)}),j("hmmss",0,0,function(){return""+Qe.apply(this)+B(this.minutes(),2)+B(this.seconds(),2)}),j("Hmm",0,0,function(){return""+this.hours()+B(this.minutes(),2)}),j("Hmmss",0,0,function(){return""+this.hours()+B(this.minutes(),2)+B(this.seconds(),2)}),$e("a",!0),$e("A",!1),P("hour","h"),F("hour",13),ue("a",et),ue("A",et),ue("H",J),ue("h",J),ue("k",J),ue("HH",J,q),ue("hh",J,q),ue("kk",J,q),ue("hmm",Q),ue("hmmss",$),ue("Hmm",Q),ue("Hmmss",$),pe(["H","HH"],ye),pe(["k","kk"],function(e,t,i){var r=T(e);t[ye]=24===r?0:r}),pe(["a","A"],function(e,t,i){i._isPm=i._locale.isPM(e),i._meridiem=e}),pe(["h","hh"],function(e,t,i){t[ye]=T(e),p(i).bigHour=!0}),pe("hmm",function(e,t,i){var r=e.length-2;t[ye]=T(e.substr(0,r)),t[be]=T(e.substr(r)),p(i).bigHour=!0}),pe("hmmss",function(e,t,i){var r=e.length-4,n=e.length-2;t[ye]=T(e.substr(0,r)),t[be]=T(e.substr(r,2)),t[xe]=T(e.substr(n)),p(i).bigHour=!0}),pe("Hmm",function(e,t,i){var r=e.length-2;t[ye]=T(e.substr(0,r)),t[be]=T(e.substr(r))}),pe("Hmmss",function(e,t,i){var r=e.length-4,n=e.length-2;t[ye]=T(e.substr(0,r)),t[be]=T(e.substr(r,2)),t[xe]=T(e.substr(n))});var tt,it=Ie("Hours",!0),rt={calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:/\d{1,2}/,relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},months:Pe,monthsShort:Le,week:{dow:0,doy:6},weekdays:Ye,weekdaysMin:qe,weekdaysShort:He,meridiemParse:/[ap]\.?m?\.?/i},nt={},ot={};function st(e){return e?e.toLowerCase().replace("_","-"):e}function at(e){var i=null;if(!nt[e]&&"undefined"!=typeof module&&module&&module.exports)try{i=tt._abbr,t("./locale/"+e),lt(i)}catch(e){}return nt[e]}function lt(e,t){var i;return e&&((i=s(t)?ct(e):ut(e,t))?tt=i:"undefined"!=typeof console&&console.warn&&console.warn("Locale "+e+" not found. Did you forget to load it?")),tt._abbr}function ut(e,t){if(null!==t){var i,r=rt;if(t.abbr=e,null!=nt[e])I("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),r=nt[e]._config;else if(null!=t.parentLocale)if(null!=nt[t.parentLocale])r=nt[t.parentLocale]._config;else{if(null==(i=at(t.parentLocale)))return ot[t.parentLocale]||(ot[t.parentLocale]=[]),ot[t.parentLocale].push({name:e,config:t}),null;r=i._config}return nt[e]=new D(k(r,t)),ot[e]&&ot[e].forEach(function(e){ut(e.name,e.config)}),lt(e),nt[e]}return delete nt[e],null}function ct(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return tt;if(!n(e)){if(t=at(e))return t;e=[e]}return function(e){for(var t,i,r,n,o=0;o<e.length;){for(t=(n=st(e[o]).split("-")).length,i=(i=st(e[o+1]))?i.split("-"):null;0<t;){if(r=at(n.slice(0,t).join("-")))return r;if(i&&i.length>=t&&_(n,i,!0)>=t-1)break;t--}o++}return tt}(e)}function ht(e){var t,i=e._a;return i&&-2===p(e).overflow&&(t=i[me]<0||11<i[me]?me:i[ve]<1||i[ve]>De(i[ge],i[me])?ve:i[ye]<0||24<i[ye]||24===i[ye]&&(0!==i[be]||0!==i[xe]||0!==i[we])?ye:i[be]<0||59<i[be]?be:i[xe]<0||59<i[xe]?xe:i[we]<0||999<i[we]?we:-1,p(e)._overflowDayOfYear&&(t<ge||ve<t)&&(t=ve),p(e)._overflowWeeks&&-1===t&&(t=Te),p(e)._overflowWeekday&&-1===t&&(t=_e),p(e).overflow=t),e}function dt(e,t,i){return null!=e?e:null!=t?t:i}function pt(e){var t,i,n,o,s,a=[];if(!e._d){var l,u;for(l=e,u=new Date(r.now()),n=l._useUTC?[u.getUTCFullYear(),u.getUTCMonth(),u.getUTCDate()]:[u.getFullYear(),u.getMonth(),u.getDate()],e._w&&null==e._a[ve]&&null==e._a[me]&&function(e){var t,i,r,n,o,s,a,l;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)o=1,s=4,i=dt(t.GG,e._a[ge],je(At(),1,4).year),r=dt(t.W,1),((n=dt(t.E,1))<1||7<n)&&(l=!0);else{o=e._locale._week.dow,s=e._locale._week.doy;var u=je(At(),o,s);i=dt(t.gg,e._a[ge],u.year),r=dt(t.w,u.week),null!=t.d?((n=t.d)<0||6<n)&&(l=!0):null!=t.e?(n=t.e+o,(t.e<0||6<t.e)&&(l=!0)):n=o}r<1||r>We(i,o,s)?p(e)._overflowWeeks=!0:null!=l?p(e)._overflowWeekday=!0:(a=Ve(i,r,n,o,s),e._a[ge]=a.year,e._dayOfYear=a.dayOfYear)}(e),null!=e._dayOfYear&&(s=dt(e._a[ge],n[ge]),(e._dayOfYear>Ce(s)||0===e._dayOfYear)&&(p(e)._overflowDayOfYear=!0),i=Ue(s,0,e._dayOfYear),e._a[me]=i.getUTCMonth(),e._a[ve]=i.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=n[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[ye]&&0===e._a[be]&&0===e._a[xe]&&0===e._a[we]&&(e._nextDay=!0,e._a[ye]=0),e._d=(e._useUTC?Ue:function(e,t,i,r,n,o,s){var a=new Date(e,t,i,r,n,o,s);return e<100&&0<=e&&isFinite(a.getFullYear())&&a.setFullYear(e),a}).apply(null,a),o=e._useUTC?e._d.getUTCDay():e._d.getDay(),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[ye]=24),e._w&&void 0!==e._w.d&&e._w.d!==o&&(p(e).weekdayMismatch=!0)}}var ft=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,gt=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,mt=/Z|[+-]\d\d(?::?\d\d)?/,vt=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],yt=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],bt=/^\/?Date\((\-?\d+)/i;function xt(e){var t,i,r,n,o,s,a=e._i,l=ft.exec(a)||gt.exec(a);if(l){for(p(e).iso=!0,t=0,i=vt.length;t<i;t++)if(vt[t][1].exec(l[1])){n=vt[t][0],r=!1!==vt[t][2];break}if(null==n)return void(e._isValid=!1);if(l[3]){for(t=0,i=yt.length;t<i;t++)if(yt[t][1].exec(l[3])){o=(l[2]||" ")+yt[t][0];break}if(null==o)return void(e._isValid=!1)}if(!r&&null!=o)return void(e._isValid=!1);if(l[4]){if(!mt.exec(l[4]))return void(e._isValid=!1);s="Z"}e._f=n+(o||"")+(s||""),Ct(e)}else e._isValid=!1}var wt=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;var Tt={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};function _t(e){var t,i,r,n=wt.exec(e._i.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,""));if(n){var o=function(e,t,i,r,n,o){var s=[function(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}(e),Le.indexOf(t),parseInt(i,10),parseInt(r,10),parseInt(n,10)];return o&&s.push(parseInt(o,10)),s}(n[4],n[3],n[2],n[5],n[6],n[7]);if(i=o,r=e,(t=n[1])&&He.indexOf(t)!==new Date(i[0],i[1],i[2]).getDay()&&(p(r).weekdayMismatch=!0,!(r._isValid=!1)))return;e._a=o,e._tzm=function(e,t,i){if(e)return Tt[e];if(t)return 0;var r=parseInt(i,10),n=r%100;return(r-n)/100*60+n}(n[8],n[9],n[10]),e._d=Ue.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),p(e).rfc2822=!0}else e._isValid=!1}function Ct(e){if(e._f!==r.ISO_8601)if(e._f!==r.RFC_2822){e._a=[],p(e).empty=!0;var t,i,n,o,s,a,l,u,h=""+e._i,d=h.length,f=0;for(n=Y(e._f,e._locale).match(G)||[],t=0;t<n.length;t++)o=n[t],(i=(h.match(ce(o,e))||[])[0])&&(0<(s=h.substr(0,h.indexOf(i))).length&&p(e).unusedInput.push(s),h=h.slice(h.indexOf(i)+i.length),f+=i.length),V[o]?(i?p(e).empty=!1:p(e).unusedTokens.push(o),a=o,u=e,null!=(l=i)&&c(de,a)&&de[a](l,u._a,u,a)):e._strict&&!i&&p(e).unusedTokens.push(o);p(e).charsLeftOver=d-f,0<h.length&&p(e).unusedInput.push(h),e._a[ye]<=12&&!0===p(e).bigHour&&0<e._a[ye]&&(p(e).bigHour=void 0),p(e).parsedDateParts=e._a.slice(0),p(e).meridiem=e._meridiem,e._a[ye]=function(e,t,i){var r;return null==i?t:null!=e.meridiemHour?e.meridiemHour(t,i):(null!=e.isPM&&((r=e.isPM(i))&&t<12&&(t+=12),r||12!==t||(t=0)),t)}(e._locale,e._a[ye],e._meridiem),pt(e),ht(e)}else _t(e);else xt(e)}function St(e){var t,i,c,d,m=e._i,y=e._f;return e._locale=e._locale||ct(e._l),null===m||void 0===y&&""===m?g({nullInput:!0}):("string"==typeof m&&(e._i=m=e._locale.preparse(m)),x(m)?new b(ht(m)):(l(m)?e._d=m:n(y)?function(e){var t,i,r,n,o;if(0===e._f.length)return p(e).invalidFormat=!0,e._d=new Date(NaN);for(n=0;n<e._f.length;n++)o=0,t=v({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[n],Ct(t),f(t)&&(o+=p(t).charsLeftOver,o+=10*p(t).unusedTokens.length,p(t).score=o,(null==r||o<r)&&(r=o,i=t));h(e,i||t)}(e):y?Ct(e):s(i=(t=e)._i)?t._d=new Date(r.now()):l(i)?t._d=new Date(i.valueOf()):"string"==typeof i?(c=t,null===(d=bt.exec(c._i))?(xt(c),!1===c._isValid&&(delete c._isValid,_t(c),!1===c._isValid&&(delete c._isValid,r.createFromInputFallback(c)))):c._d=new Date(+d[1])):n(i)?(t._a=u(i.slice(0),function(e){return parseInt(e,10)}),pt(t)):o(i)?function(e){if(!e._d){var t=N(e._i);e._a=u([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),pt(e)}}(t):a(i)?t._d=new Date(i):r.createFromInputFallback(t),f(e)||(e._d=null),e))}function Et(e,t,i,r,s){var a,l={};return!0!==i&&!1!==i||(r=i,i=void 0),(o(e)&&function(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}(e)||n(e)&&0===e.length)&&(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=s,l._l=i,l._i=e,l._f=t,l._strict=r,(a=new b(ht(St(l))))._nextDay&&(a.add(1,"d"),a._nextDay=void 0),a}function At(e,t,i,r){return Et(e,t,i,r,!1)}r.createFromInputFallback=S("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),r.ISO_8601=function(){},r.RFC_2822=function(){};var It=S("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=At.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:g()}),Mt=S("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=At.apply(null,arguments);return this.isValid()&&e.isValid()?this<e?this:e:g()});function kt(e,t){var i,r;if(1===t.length&&n(t[0])&&(t=t[0]),!t.length)return At();for(i=t[0],r=1;r<t.length;++r)t[r].isValid()&&!t[r][e](i)||(i=t[r]);return i}var Dt=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Rt(e){var t=N(e),i=t.year||0,r=t.quarter||0,n=t.month||0,o=t.week||0,s=t.day||0,a=t.hour||0,l=t.minute||0,u=t.second||0,c=t.millisecond||0;this._isValid=function(e){for(var t in e)if(-1===Ee.call(Dt,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var i=!1,r=0;r<Dt.length;++r)if(e[Dt[r]]){if(i)return!1;parseFloat(e[Dt[r]])!==T(e[Dt[r]])&&(i=!0)}return!0}(t),this._milliseconds=+c+1e3*u+6e4*l+1e3*a*60*60,this._days=+s+7*o,this._months=+n+3*r+12*i,this._data={},this._locale=ct(),this._bubble()}function Pt(e){return e instanceof Rt}function Lt(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function Nt(e,t){j(e,0,0,function(){var e=this.utcOffset(),i="+";return e<0&&(e=-e,i="-"),i+B(~~(e/60),2)+t+B(~~e%60,2)})}Nt("Z",":"),Nt("ZZ",""),ue("Z",se),ue("ZZ",se),pe(["Z","ZZ"],function(e,t,i){i._useUTC=!0,i._tzm=Ft(se,e)});var Ot=/([\+\-]|\d\d)/gi;function Ft(e,t){var i=(t||"").match(e);if(null===i)return null;var r=((i[i.length-1]||[])+"").match(Ot)||["-",0,0],n=60*r[1]+T(r[2]);return 0===n?0:"+"===r[0]?n:-n}function Bt(e,t){var i,n;return t._isUTC?(i=t.clone(),n=(x(e)||l(e)?e.valueOf():At(e).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+n),r.updateOffset(i,!1),i):At(e).local()}function Gt(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Ut(){return!!this.isValid()&&this._isUTC&&0===this._offset}r.updateOffset=function(){};var zt=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Vt=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function jt(e,t){var i,r,n,o=e,s=null;return Pt(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:a(e)?(o={},t?o[t]=e:o.milliseconds=e):(s=zt.exec(e))?(i="-"===s[1]?-1:1,o={y:0,d:T(s[ve])*i,h:T(s[ye])*i,m:T(s[be])*i,s:T(s[xe])*i,ms:T(Lt(1e3*s[we]))*i}):(s=Vt.exec(e))?(i="-"===s[1]?-1:(s[1],1),o={y:Wt(s[2],i),M:Wt(s[3],i),w:Wt(s[4],i),d:Wt(s[5],i),h:Wt(s[6],i),m:Wt(s[7],i),s:Wt(s[8],i)}):null==o?o={}:"object"==typeof o&&("from"in o||"to"in o)&&(n=function(e,t){var i;return e.isValid()&&t.isValid()?(t=Bt(t,e),e.isBefore(t)?i=Yt(e,t):((i=Yt(t,e)).milliseconds=-i.milliseconds,i.months=-i.months),i):{milliseconds:0,months:0}}(At(o.from),At(o.to)),(o={}).ms=n.milliseconds,o.M=n.months),r=new Rt(o),Pt(e)&&c(e,"_locale")&&(r._locale=e._locale),r}function Wt(e,t){var i=e&&parseFloat(e.replace(",","."));return(isNaN(i)?0:i)*t}function Yt(e,t){var i={milliseconds:0,months:0};return i.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(i.months,"M").isAfter(t)&&--i.months,i.milliseconds=+t-+e.clone().add(i.months,"M"),i}function Ht(e,t){return function(i,r){var n;return null===r||isNaN(+r)||(I(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),n=i,i=r,r=n),qt(this,jt(i="string"==typeof i?+i:i,r),e),this}}function qt(e,t,i,n){var o=t._milliseconds,s=Lt(t._days),a=Lt(t._months);e.isValid()&&(n=null==n||n,a&&Ne(e,Me(e,"Month")+a*i),s&&ke(e,"Date",Me(e,"Date")+s*i),o&&e._d.setTime(e._d.valueOf()+o*i),n&&r.updateOffset(e,s||a))}jt.fn=Rt.prototype,jt.invalid=function(){return jt(NaN)};var Xt=Ht(1,"add"),Zt=Ht(-1,"subtract");function Kt(e,t){var i=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(i,"months");return-(i+(t-r<0?(t-r)/(r-e.clone().add(i-1,"months")):(t-r)/(e.clone().add(i+1,"months")-r)))||0}function Jt(e){var t;return void 0===e?this._locale._abbr:(null!=(t=ct(e))&&(this._locale=t),this)}r.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",r.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Qt=S("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});function $t(){return this._locale}function ei(e,t){j(0,[e,e.length],0,t)}function ti(e,t,i,r,n){var o;return null==e?je(this,r,n).year:((o=We(e,r,n))<t&&(t=o),function(e,t,i,r,n){var o=Ve(e,t,i,r,n),s=Ue(o.year,0,o.dayOfYear);return this.year(s.getUTCFullYear()),this.month(s.getUTCMonth()),this.date(s.getUTCDate()),this}.call(this,e,t,i,r,n))}j(0,["gg",2],0,function(){return this.weekYear()%100}),j(0,["GG",2],0,function(){return this.isoWeekYear()%100}),ei("gggg","weekYear"),ei("ggggg","weekYear"),ei("GGGG","isoWeekYear"),ei("GGGGG","isoWeekYear"),P("weekYear","gg"),P("isoWeekYear","GG"),F("weekYear",1),F("isoWeekYear",1),ue("G",ne),ue("g",ne),ue("GG",J,q),ue("gg",J,q),ue("GGGG",te,Z),ue("gggg",te,Z),ue("GGGGG",ie,K),ue("ggggg",ie,K),fe(["gggg","ggggg","GGGG","GGGGG"],function(e,t,i,r){t[r.substr(0,2)]=T(e)}),fe(["gg","GG"],function(e,t,i,n){t[n]=r.parseTwoDigitYear(e)}),j("Q",0,"Qo","quarter"),P("quarter","Q"),F("quarter",7),ue("Q",H),pe("Q",function(e,t){t[me]=3*(T(e)-1)}),j("D",["DD",2],"Do","date"),P("date","D"),F("date",9),ue("D",J),ue("DD",J,q),ue("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),pe(["D","DD"],ve),pe("Do",function(e,t){t[ve]=T(e.match(J)[0])});var ii=Ie("Date",!0);j("DDD",["DDDD",3],"DDDo","dayOfYear"),P("dayOfYear","DDD"),F("dayOfYear",4),ue("DDD",ee),ue("DDDD",X),pe(["DDD","DDDD"],function(e,t,i){i._dayOfYear=T(e)}),j("m",["mm",2],0,"minute"),P("minute","m"),F("minute",14),ue("m",J),ue("mm",J,q),pe(["m","mm"],be);var ri=Ie("Minutes",!1);j("s",["ss",2],0,"second"),P("second","s"),F("second",15),ue("s",J),ue("ss",J,q),pe(["s","ss"],xe);var ni,oi=Ie("Seconds",!1);for(j("S",0,0,function(){return~~(this.millisecond()/100)}),j(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),j(0,["SSS",3],0,"millisecond"),j(0,["SSSS",4],0,function(){return 10*this.millisecond()}),j(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),j(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),j(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),j(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),j(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),P("millisecond","ms"),F("millisecond",16),ue("S",ee,H),ue("SS",ee,q),ue("SSS",ee,X),ni="SSSS";ni.length<=9;ni+="S")ue(ni,re);function si(e,t){t[we]=T(1e3*("0."+e))}for(ni="S";ni.length<=9;ni+="S")pe(ni,si);var ai=Ie("Milliseconds",!1);j("z",0,0,"zoneAbbr"),j("zz",0,0,"zoneName");var li=b.prototype;function ui(e){return e}li.add=Xt,li.calendar=function(e,t){var i=e||At(),n=Bt(i,this).startOf("day"),o=r.calendarFormat(this,n)||"sameElse",s=t&&(M(t[o])?t[o].call(this,i):t[o]);return this.format(s||this.localeData().calendar(o,this,At(i)))},li.clone=function(){return new b(this)},li.diff=function(e,t,i){var r,n,o;if(!this.isValid())return NaN;if(!(r=Bt(e,this)).isValid())return NaN;switch(n=6e4*(r.utcOffset()-this.utcOffset()),t=L(t)){case"year":o=Kt(this,r)/12;break;case"month":o=Kt(this,r);break;case"quarter":o=Kt(this,r)/3;break;case"second":o=(this-r)/1e3;break;case"minute":o=(this-r)/6e4;break;case"hour":o=(this-r)/36e5;break;case"day":o=(this-r-n)/864e5;break;case"week":o=(this-r-n)/6048e5;break;default:o=this-r}return i?o:w(o)},li.endOf=function(e){return void 0===(e=L(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},li.format=function(e){e||(e=this.isUtc()?r.defaultFormatUtc:r.defaultFormat);var t=W(this,e);return this.localeData().postformat(t)},li.from=function(e,t){return this.isValid()&&(x(e)&&e.isValid()||At(e).isValid())?jt({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},li.fromNow=function(e){return this.from(At(),e)},li.to=function(e,t){return this.isValid()&&(x(e)&&e.isValid()||At(e).isValid())?jt({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},li.toNow=function(e){return this.to(At(),e)},li.get=function(e){return M(this[e=L(e)])?this[e]():this},li.invalidAt=function(){return p(this).overflow},li.isAfter=function(e,t){var i=x(e)?e:At(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=L(s(t)?"millisecond":t))?this.valueOf()>i.valueOf():i.valueOf()<this.clone().startOf(t).valueOf())},li.isBefore=function(e,t){var i=x(e)?e:At(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=L(s(t)?"millisecond":t))?this.valueOf()<i.valueOf():this.clone().endOf(t).valueOf()<i.valueOf())},li.isBetween=function(e,t,i,r){return("("===(r=r||"()")[0]?this.isAfter(e,i):!this.isBefore(e,i))&&(")"===r[1]?this.isBefore(t,i):!this.isAfter(t,i))},li.isSame=function(e,t){var i,r=x(e)?e:At(e);return!(!this.isValid()||!r.isValid())&&("millisecond"===(t=L(t||"millisecond"))?this.valueOf()===r.valueOf():(i=r.valueOf(),this.clone().startOf(t).valueOf()<=i&&i<=this.clone().endOf(t).valueOf()))},li.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},li.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},li.isValid=function(){return f(this)},li.lang=Qt,li.locale=Jt,li.localeData=$t,li.max=Mt,li.min=It,li.parsingFlags=function(){return h({},p(this))},li.set=function(e,t){if("object"==typeof e)for(var i=function(e){var t=[];for(var i in e)t.push({unit:i,priority:O[i]});return t.sort(function(e,t){return e.priority-t.priority}),t}(e=N(e)),r=0;r<i.length;r++)this[i[r].unit](e[i[r].unit]);else if(M(this[e=L(e)]))return this[e](t);return this},li.startOf=function(e){switch(e=L(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},li.subtract=Zt,li.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},li.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},li.toDate=function(){return new Date(this.valueOf())},li.toISOString=function(e){if(!this.isValid())return null;var t=!0!==e,i=t?this.clone().utc():this;return i.year()<0||9999<i.year()?W(i,t?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):M(Date.prototype.toISOString)?t?this.toDate().toISOString():new Date(this.valueOf()+60*this.utcOffset()*1e3).toISOString().replace("Z",W(i,"Z")):W(i,t?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")},li.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var i="["+e+'("]',r=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",n=t+'[")]';return this.format(i+r+"-MM-DD[T]HH:mm:ss.SSS"+n)},li.toJSON=function(){return this.isValid()?this.toISOString():null},li.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},li.unix=function(){return Math.floor(this.valueOf()/1e3)},li.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},li.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},li.year=Ae,li.isLeapYear=function(){return Se(this.year())},li.weekYear=function(e){return ti.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},li.isoWeekYear=function(e){return ti.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},li.quarter=li.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},li.month=Oe,li.daysInMonth=function(){return De(this.year(),this.month())},li.week=li.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},li.isoWeek=li.isoWeeks=function(e){var t=je(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},li.weeksInYear=function(){var e=this.localeData()._week;return We(this.year(),e.dow,e.doy)},li.isoWeeksInYear=function(){return We(this.year(),1,4)},li.date=ii,li.day=li.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t,i,r=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(t=e,i=this.localeData(),e="string"!=typeof t?t:isNaN(t)?"number"==typeof(t=i.weekdaysParse(t))?t:null:parseInt(t,10),this.add(e-r,"d")):r},li.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},li.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=(i=e,r=this.localeData(),"string"==typeof i?r.weekdaysParse(i)%7||7:isNaN(i)?null:i);return this.day(this.day()%7?t:t-7)}return this.day()||7;var i,r},li.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},li.hour=li.hours=it,li.minute=li.minutes=ri,li.second=li.seconds=oi,li.millisecond=li.milliseconds=ai,li.utcOffset=function(e,t,i){var n,o=this._offset||0;if(!this.isValid())return null!=e?this:NaN;if(null!=e){if("string"==typeof e){if(null===(e=Ft(se,e)))return this}else Math.abs(e)<16&&!i&&(e*=60);return!this._isUTC&&t&&(n=Gt(this)),this._offset=e,this._isUTC=!0,null!=n&&this.add(n,"m"),o!==e&&(!t||this._changeInProgress?qt(this,jt(e-o,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,r.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?o:Gt(this)},li.utc=function(e){return this.utcOffset(0,e)},li.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Gt(this),"m")),this},li.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Ft(oe,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},li.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?At(e).utcOffset():0,(this.utcOffset()-e)%60==0)},li.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},li.isLocal=function(){return!!this.isValid()&&!this._isUTC},li.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},li.isUtc=Ut,li.isUTC=Ut,li.zoneAbbr=function(){return this._isUTC?"UTC":""},li.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},li.dates=S("dates accessor is deprecated. Use date instead.",ii),li.months=S("months accessor is deprecated. Use month instead",Oe),li.years=S("years accessor is deprecated. Use year instead",Ae),li.zone=S("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),li.isDSTShifted=S("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!s(this._isDSTShifted))return this._isDSTShifted;var e={};if(v(e,this),(e=St(e))._a){var t=e._isUTC?d(e._a):At(e._a);this._isDSTShifted=this.isValid()&&0<_(e._a,t.toArray())}else this._isDSTShifted=!1;return this._isDSTShifted});var ci=D.prototype;function hi(e,t,i,r){var n=ct(),o=d().set(r,t);return n[i](o,e)}function di(e,t,i){if(a(e)&&(t=e,e=void 0),e=e||"",null!=t)return hi(e,t,i,"month");var r,n=[];for(r=0;r<12;r++)n[r]=hi(e,r,i,"month");return n}function pi(e,t,i,r){"boolean"==typeof e?a(t)&&(i=t,t=void 0):(t=e,e=!1,a(i=t)&&(i=t,t=void 0)),t=t||"";var n,o=ct(),s=e?o._week.dow:0;if(null!=i)return hi(t,(i+s)%7,r,"day");var l=[];for(n=0;n<7;n++)l[n]=hi(t,(n+s)%7,r,"day");return l}ci.calendar=function(e,t,i){var r=this._calendar[e]||this._calendar.sameElse;return M(r)?r.call(t,i):r},ci.longDateFormat=function(e){var t=this._longDateFormat[e],i=this._longDateFormat[e.toUpperCase()];return t||!i?t:(this._longDateFormat[e]=i.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},ci.invalidDate=function(){return this._invalidDate},ci.ordinal=function(e){return this._ordinal.replace("%d",e)},ci.preparse=ui,ci.postformat=ui,ci.relativeTime=function(e,t,i,r){var n=this._relativeTime[i];return M(n)?n(e,t,i,r):n.replace(/%d/i,e)},ci.pastFuture=function(e,t){var i=this._relativeTime[0<e?"future":"past"];return M(i)?i(t):i.replace(/%s/i,t)},ci.set=function(e){var t,i;for(i in e)M(t=e[i])?this[i]=t:this["_"+i]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},ci.months=function(e,t){return e?n(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||Re).test(t)?"format":"standalone"][e.month()]:n(this._months)?this._months:this._months.standalone},ci.monthsShort=function(e,t){return e?n(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[Re.test(t)?"format":"standalone"][e.month()]:n(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},ci.monthsParse=function(e,t,i){var r,n,o;if(this._monthsParseExact)return function(e,t,i){var r,n,o,s=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],r=0;r<12;++r)o=d([2e3,r]),this._shortMonthsParse[r]=this.monthsShort(o,"").toLocaleLowerCase(),this._longMonthsParse[r]=this.months(o,"").toLocaleLowerCase();return i?"MMM"===t?-1!==(n=Ee.call(this._shortMonthsParse,s))?n:null:-1!==(n=Ee.call(this._longMonthsParse,s))?n:null:"MMM"===t?-1!==(n=Ee.call(this._shortMonthsParse,s))?n:-1!==(n=Ee.call(this._longMonthsParse,s))?n:null:-1!==(n=Ee.call(this._longMonthsParse,s))?n:-1!==(n=Ee.call(this._shortMonthsParse,s))?n:null}.call(this,e,t,i);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),r=0;r<12;r++){if(n=d([2e3,r]),i&&!this._longMonthsParse[r]&&(this._longMonthsParse[r]=new RegExp("^"+this.months(n,"").replace(".","")+"$","i"),this._shortMonthsParse[r]=new RegExp("^"+this.monthsShort(n,"").replace(".","")+"$","i")),i||this._monthsParse[r]||(o="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[r]=new RegExp(o.replace(".",""),"i")),i&&"MMMM"===t&&this._longMonthsParse[r].test(e))return r;if(i&&"MMM"===t&&this._shortMonthsParse[r].test(e))return r;if(!i&&this._monthsParse[r].test(e))return r}},ci.monthsRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ge.call(this),e?this._monthsStrictRegex:this._monthsRegex):(c(this,"_monthsRegex")||(this._monthsRegex=Be),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},ci.monthsShortRegex=function(e){return this._monthsParseExact?(c(this,"_monthsRegex")||Ge.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(c(this,"_monthsShortRegex")||(this._monthsShortRegex=Fe),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},ci.week=function(e){return je(e,this._week.dow,this._week.doy).week},ci.firstDayOfYear=function(){return this._week.doy},ci.firstDayOfWeek=function(){return this._week.dow},ci.weekdays=function(e,t){return e?n(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(t)?"format":"standalone"][e.day()]:n(this._weekdays)?this._weekdays:this._weekdays.standalone},ci.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},ci.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},ci.weekdaysParse=function(e,t,i){var r,n,o;if(this._weekdaysParseExact)return function(e,t,i){var r,n,o,s=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],r=0;r<7;++r)o=d([2e3,1]).day(r),this._minWeekdaysParse[r]=this.weekdaysMin(o,"").toLocaleLowerCase(),this._shortWeekdaysParse[r]=this.weekdaysShort(o,"").toLocaleLowerCase(),this._weekdaysParse[r]=this.weekdays(o,"").toLocaleLowerCase();return i?"dddd"===t?-1!==(n=Ee.call(this._weekdaysParse,s))?n:null:"ddd"===t?-1!==(n=Ee.call(this._shortWeekdaysParse,s))?n:null:-1!==(n=Ee.call(this._minWeekdaysParse,s))?n:null:"dddd"===t?-1!==(n=Ee.call(this._weekdaysParse,s))?n:-1!==(n=Ee.call(this._shortWeekdaysParse,s))?n:-1!==(n=Ee.call(this._minWeekdaysParse,s))?n:null:"ddd"===t?-1!==(n=Ee.call(this._shortWeekdaysParse,s))?n:-1!==(n=Ee.call(this._weekdaysParse,s))?n:-1!==(n=Ee.call(this._minWeekdaysParse,s))?n:null:-1!==(n=Ee.call(this._minWeekdaysParse,s))?n:-1!==(n=Ee.call(this._weekdaysParse,s))?n:-1!==(n=Ee.call(this._shortWeekdaysParse,s))?n:null}.call(this,e,t,i);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),r=0;r<7;r++){if(n=d([2e3,1]).day(r),i&&!this._fullWeekdaysParse[r]&&(this._fullWeekdaysParse[r]=new RegExp("^"+this.weekdays(n,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[r]=new RegExp("^"+this.weekdaysShort(n,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[r]=new RegExp("^"+this.weekdaysMin(n,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[r]||(o="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[r]=new RegExp(o.replace(".",""),"i")),i&&"dddd"===t&&this._fullWeekdaysParse[r].test(e))return r;if(i&&"ddd"===t&&this._shortWeekdaysParse[r].test(e))return r;if(i&&"dd"===t&&this._minWeekdaysParse[r].test(e))return r;if(!i&&this._weekdaysParse[r].test(e))return r}},ci.weekdaysRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(c(this,"_weekdaysRegex")||(this._weekdaysRegex=Xe),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},ci.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(c(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Ze),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},ci.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(c(this,"_weekdaysRegex")||Je.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(c(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Ke),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},ci.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},ci.meridiem=function(e,t,i){return 11<e?i?"pm":"PM":i?"am":"AM"},lt("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===T(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),r.lang=S("moment.lang is deprecated. Use moment.locale instead.",lt),r.langData=S("moment.langData is deprecated. Use moment.localeData instead.",ct);var fi=Math.abs;function gi(e,t,i,r){var n=jt(t,i);return e._milliseconds+=r*n._milliseconds,e._days+=r*n._days,e._months+=r*n._months,e._bubble()}function mi(e){return e<0?Math.floor(e):Math.ceil(e)}function vi(e){return 4800*e/146097}function yi(e){return 146097*e/4800}function bi(e){return function(){return this.as(e)}}var xi=bi("ms"),wi=bi("s"),Ti=bi("m"),_i=bi("h"),Ci=bi("d"),Si=bi("w"),Ei=bi("M"),Ai=bi("y");function Ii(e){return function(){return this.isValid()?this._data[e]:NaN}}var Mi=Ii("milliseconds"),ki=Ii("seconds"),Di=Ii("minutes"),Ri=Ii("hours"),Pi=Ii("days"),Li=Ii("months"),Ni=Ii("years"),Oi=Math.round,Fi={ss:44,s:45,m:45,h:22,d:26,M:11},Bi=Math.abs;function Gi(e){return(0<e)-(e<0)||+e}function Ui(){if(!this.isValid())return this.localeData().invalidDate();var e,t,i=Bi(this._milliseconds)/1e3,r=Bi(this._days),n=Bi(this._months);t=w((e=w(i/60))/60),i%=60,e%=60;var o=w(n/12),s=n%=12,a=r,l=t,u=e,c=i?i.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var d=h<0?"-":"",p=Gi(this._months)!==Gi(h)?"-":"",f=Gi(this._days)!==Gi(h)?"-":"",g=Gi(this._milliseconds)!==Gi(h)?"-":"";return d+"P"+(o?p+o+"Y":"")+(s?p+s+"M":"")+(a?f+a+"D":"")+(l||u||c?"T":"")+(l?g+l+"H":"")+(u?g+u+"M":"")+(c?g+c+"S":"")}var zi=Rt.prototype;return zi.isValid=function(){return this._isValid},zi.abs=function(){var e=this._data;return this._milliseconds=fi(this._milliseconds),this._days=fi(this._days),this._months=fi(this._months),e.milliseconds=fi(e.milliseconds),e.seconds=fi(e.seconds),e.minutes=fi(e.minutes),e.hours=fi(e.hours),e.months=fi(e.months),e.years=fi(e.years),this},zi.add=function(e,t){return gi(this,e,t,1)},zi.subtract=function(e,t){return gi(this,e,t,-1)},zi.as=function(e){if(!this.isValid())return NaN;var t,i,r=this._milliseconds;if("month"===(e=L(e))||"year"===e)return t=this._days+r/864e5,i=this._months+vi(t),"month"===e?i:i/12;switch(t=this._days+Math.round(yi(this._months)),e){case"week":return t/7+r/6048e5;case"day":return t+r/864e5;case"hour":return 24*t+r/36e5;case"minute":return 1440*t+r/6e4;case"second":return 86400*t+r/1e3;case"millisecond":return Math.floor(864e5*t)+r;default:throw new Error("Unknown unit "+e)}},zi.asMilliseconds=xi,zi.asSeconds=wi,zi.asMinutes=Ti,zi.asHours=_i,zi.asDays=Ci,zi.asWeeks=Si,zi.asMonths=Ei,zi.asYears=Ai,zi.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*T(this._months/12):NaN},zi._bubble=function(){var e,t,i,r,n,o=this._milliseconds,s=this._days,a=this._months,l=this._data;return 0<=o&&0<=s&&0<=a||o<=0&&s<=0&&a<=0||(o+=864e5*mi(yi(a)+s),a=s=0),l.milliseconds=o%1e3,e=w(o/1e3),l.seconds=e%60,t=w(e/60),l.minutes=t%60,i=w(t/60),l.hours=i%24,a+=n=w(vi(s+=w(i/24))),s-=mi(yi(n)),r=w(a/12),a%=12,l.days=s,l.months=a,l.years=r,this},zi.clone=function(){return jt(this)},zi.get=function(e){return e=L(e),this.isValid()?this[e+"s"]():NaN},zi.milliseconds=Mi,zi.seconds=ki,zi.minutes=Di,zi.hours=Ri,zi.days=Pi,zi.weeks=function(){return w(this.days()/7)},zi.months=Li,zi.years=Ni,zi.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t,i,r,n,o,s,a,l,u,c,h=this.localeData(),d=(t=!e,i=h,r=jt(this).abs(),n=Oi(r.as("s")),o=Oi(r.as("m")),s=Oi(r.as("h")),a=Oi(r.as("d")),l=Oi(r.as("M")),u=Oi(r.as("y")),(c=n<=Fi.ss&&["s",n]||n<Fi.s&&["ss",n]||o<=1&&["m"]||o<Fi.m&&["mm",o]||s<=1&&["h"]||s<Fi.h&&["hh",s]||a<=1&&["d"]||a<Fi.d&&["dd",a]||l<=1&&["M"]||l<Fi.M&&["MM",l]||u<=1&&["y"]||["yy",u])[2]=t,c[3]=0<+this,c[4]=i,function(e,t,i,r,n){return n.relativeTime(t||1,!!i,e,r)}.apply(null,c));return e&&(d=h.pastFuture(+this,d)),h.postformat(d)},zi.toISOString=Ui,zi.toString=Ui,zi.toJSON=Ui,zi.locale=Jt,zi.localeData=$t,zi.toIsoString=S("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Ui),zi.lang=Qt,j("X",0,0,"unix"),j("x",0,0,"valueOf"),ue("x",ne),ue("X",/[+-]?\d+(\.\d{1,3})?/),pe("X",function(e,t,i){i._d=new Date(1e3*parseFloat(e,10))}),pe("x",function(e,t,i){i._d=new Date(T(e))}),r.version="2.22.2",e=At,r.fn=li,r.min=function(){return kt("isBefore",[].slice.call(arguments,0))},r.max=function(){return kt("isAfter",[].slice.call(arguments,0))},r.now=function(){return Date.now?Date.now():+new Date},r.utc=d,r.unix=function(e){return At(1e3*e)},r.months=function(e,t){return di(e,t,"months")},r.isDate=l,r.locale=lt,r.invalid=g,r.duration=jt,r.isMoment=x,r.weekdays=function(e,t,i){return pi(e,t,i,"weekdays")},r.parseZone=function(){return At.apply(null,arguments).parseZone()},r.localeData=ct,r.isDuration=Pt,r.monthsShort=function(e,t){return di(e,t,"monthsShort")},r.weekdaysMin=function(e,t,i){return pi(e,t,i,"weekdaysMin")},r.defineLocale=ut,r.updateLocale=function(e,t){if(null!=t){var i,r,n=rt;null!=(r=at(e))&&(n=r._config),(i=new D(t=k(n,t))).parentLocale=nt[e],nt[e]=i,lt(e)}else null!=nt[e]&&(null!=nt[e].parentLocale?nt[e]=nt[e].parentLocale:null!=nt[e]&&delete nt[e]);return nt[e]},r.locales=function(){return E(nt)},r.weekdaysShort=function(e,t,i){return pi(e,t,i,"weekdaysShort")},r.normalizeUnits=L,r.relativeTimeRounding=function(e){return void 0===e?Oi:"function"==typeof e&&(Oi=e,!0)},r.relativeTimeThreshold=function(e,t){return void 0!==Fi[e]&&(void 0===t?Fi[e]:(Fi[e]=t,"s"===e&&(Fi.ss=t-1),!0))},r.calendarFormat=function(e,t){var i=e.diff(t,"days",!0);return i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse"},r.prototype=li,r.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"YYYY-[W]WW",MONTH:"YYYY-MM"},r},"object"==typeof exports&&"undefined"!=typeof module?module.exports=a():"function"==typeof r&&r.amd?r("moment",a):s.moment=a(),r("gw/Utils/Numeric",[],function(){var e={lerp:function(e,t,i){return t+(i-t)*e},coserp:function(e,t,i){return t+(i-t)*((1-Math.cos(e*Math.PI))/2)},cubicInterpolation:function(e,t,i,r,n){var o=e*e,s=o*e,a=2*t[0]-2*r[0]+i[0]+n[0],l=2*t[1]-2*r[1]+i[1]+n[1],u=2*t[2]-2*r[2]+i[2]+n[2],c=-3*t[0]+3*r[0]-2*i[0]-n[0],h=-3*t[1]+3*r[1]-2*i[1]-n[1],d=-3*t[2]+3*r[2]-2*i[2]-n[2],p=vec3.create();return p[0]=a*s+c*o+i[0]*e+t[0],p[1]=l*s+h*o+i[1]*e+t[1],p[2]=u*s+d*o+i[2]*e+t[2],p},cubicInterpolationDerivative:function(e,t,i,r,n){var o=e*e,s=6*t[0]-6*r[0]+3*i[0]+3*n[0],a=6*t[1]-6*r[1]+3*i[1]+3*n[1],l=6*t[2]-6*r[2]+3*i[2]+3*n[2],u=-6*t[0]+6*r[0]-4*i[0]-2*n[0],c=-6*t[1]+6*r[1]-4*i[1]-2*n[1],h=-6*t[2]+6*r[2]-4*i[2]-2*n[2],d=vec3.create();return d[0]=s*o+u*e+i[0],d[1]=a*o+c*e+i[1],d[2]=l*o+h*e+i[2],d},map01:function(e,t,i){return t!==i?(e-t)/(i-t):0},mapLinear:function(t,i,r,n,o){return e.lerp(e.map01(t,i,r),n,o)},easeInQuad:function(e){return e*e},easeOutQuad:function(e){var t=e-1;return 1-t*t},easeInOutQuad:function(e){var t=e;return t=t<.5?(t+=t)*t*.5:.5+(t=.5*(1-(t=t+t-2)*t))},easeOutInQuad:function(e){var t=e;return t=t<.5?.5*(1-(t=t+t-1)*t):.5+(t=(t=t+t-1)*t*.5)},toRadian:function(e){return e*Math.PI/180},toDegree:function(e){return 180*e/Math.PI},lineIntersection:function(e,t,i,r,n,o,s,a){var l=(a-o)*(i-e)-(s-n)*(r-t);if(0===l)return[-1,-1];var u=(s-n)*(t-o)-(a-o)*(e-n),c=(i-e)*(t-o)-(r-t)*(e-n);return[u/=l,c/=l]},roundNumber:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},sign:function(e){return e<0?-1:e>0?1:0},equals:function(e,t){return Math.abs(e-t)<Number.EPSILON},shortestPath360:function(e,t){var i,r;return Math.abs(t-e)<180?(i=e,r=t):e<t?(i=e+360,r=t):(i=e,r=t+360),[i,r]},shortestPath180:function(t,i){var r,n;if(Math.sign(t)*Math.sign(i)>0||e.equals(t,0)||e.equals(i,0))r=t,n=i;else{var o=(t+360)%360,s=(i+360)%360,a=e.shortestPath360(o,s);r=a[0],n=a[1]}return[r,n]}};return e}),r("gw/Tiling/HEALPixTables",[],function(){return{ctab:[0,1,256,257,2,3,258,259,512,513,768,769,514,515,770,771,4,5,260,261,6,7,262,263,516,517,772,773,518,519,774,775,1024,1025,1280,1281,1026,1027,1282,1283,1536,1537,1792,1793,1538,1539,1794,1795,1028,1029,1284,1285,1030,1031,1286,1287,1540,1541,1796,1797,1542,1543,1798,1799,8,9,264,265,10,11,266,267,520,521,776,777,522,523,778,779,12,13,268,269,14,15,270,271,524,525,780,781,526,527,782,783,1032,1033,1288,1289,1034,1035,1290,1291,1544,1545,1800,1801,1546,1547,1802,1803,1036,1037,1292,1293,1038,1039,1294,1295,1548,1549,1804,1805,1550,1551,1806,1807,2048,2049,2304,2305,2050,2051,2306,2307,2560,2561,2816,2817,2562,2563,2818,2819,2052,2053,2308,2309,2054,2055,2310,2311,2564,2565,2820,2821,2566,2567,2822,2823,3072,3073,3328,3329,3074,3075,3330,3331,3584,3585,3840,3841,3586,3587,3842,3843,3076,3077,3332,3333,3078,3079,3334,3335,3588,3589,3844,3845,3590,3591,3846,3847,2056,2057,2312,2313,2058,2059,2314,2315,2568,2569,2824,2825,2570,2571,2826,2827,2060,2061,2316,2317,2062,2063,2318,2319,2572,2573,2828,2829,2574,2575,2830,2831,3080,3081,3336,3337,3082,3083,3338,3339,3592,3593,3848,3849,3594,3595,3850,3851,3084,3085,3340,3341,3086,3087,3342,3343,3596,3597,3852,3853,3598,3599,3854,3855],utab:[0,1,4,5,16,17,20,21,64,65,68,69,80,81,84,85,256,257,260,261,272,273,276,277,320,321,324,325,336,337,340,341,1024,1025,1028,1029,1040,1041,1044,1045,1088,1089,1092,1093,1104,1105,1108,1109,1280,1281,1284,1285,1296,1297,1300,1301,1344,1345,1348,1349,1360,1361,1364,1365,4096,4097,4100,4101,4112,4113,4116,4117,4160,4161,4164,4165,4176,4177,4180,4181,4352,4353,4356,4357,4368,4369,4372,4373,4416,4417,4420,4421,4432,4433,4436,4437,5120,5121,5124,5125,5136,5137,5140,5141,5184,5185,5188,5189,5200,5201,5204,5205,5376,5377,5380,5381,5392,5393,5396,5397,5440,5441,5444,5445,5456,5457,5460,5461,16384,16385,16388,16389,16400,16401,16404,16405,16448,16449,16452,16453,16464,16465,16468,16469,16640,16641,16644,16645,16656,16657,16660,16661,16704,16705,16708,16709,16720,16721,16724,16725,17408,17409,17412,17413,17424,17425,17428,17429,17472,17473,17476,17477,17488,17489,17492,17493,17664,17665,17668,17669,17680,17681,17684,17685,17728,17729,17732,17733,17744,17745,17748,17749,20480,20481,20484,20485,20496,20497,20500,20501,20544,20545,20548,20549,20560,20561,20564,20565,20736,20737,20740,20741,20752,20753,20756,20757,20800,20801,20804,20805,20816,20817,20820,20821,21504,21505,21508,21509,21520,21521,21524,21525,21568,21569,21572,21573,21584,21585,21588,21589,21760,21761,21764,21765,21776,21777,21780,21781,21824,21825,21828,21829,21840,21841,21844,21845],jrll:[2,2,2,2,3,3,3,3,4,4,4,4],jpll:[1,3,5,7,0,2,4,6,1,3,5,7],xoffset:[-1,-1,0,1,1,1,0,-1],yoffset:[0,1,1,1,0,-1,-1,-1],facearray:[[8,9,10,11,-1,-1,-1,-1,10,11,8,9],[5,6,7,4,8,9,10,11,9,10,11,8],[-1,-1,-1,-1,5,6,7,4,-1,-1,-1,-1],[4,5,6,7,11,8,9,10,11,8,9,10],[0,1,2,3,4,5,6,7,8,9,10,11],[1,2,3,0,0,1,2,3,5,6,7,4],[-1,-1,-1,-1,7,4,5,6,-1,-1,-1,-1],[3,0,1,2,3,0,1,2,4,5,6,7],[2,3,0,1,-1,-1,-1,-1,0,1,2,3]],swaparray:[[0,0,3],[0,0,6],[0,0,0],[0,0,5],[0,0,0],[5,0,0],[0,0,0],[6,0,0],[3,0,0]],swap_cycle:[[],[0,1,8,12,16,21,40],[0,1,2,40,114],[0,4,160,263],[0,4,30,49,51,87,526,1027,1105,1387,1807,2637],[0,8,10,18,39,74,146,307,452,4737],[0,1,2,7,9,17,80,410,1526,1921,32859,33566,38931],[0,5,6,10,12,24,27,95,372,494,924,1409,3492,4248,9137,66043,103369,156899],[0,1,2,3,4,45,125,351,697,24337,102940,266194,341855,419857],[0,1,2,3,9,16,1705,2082,2126,8177,12753,15410,52642,80493,83235,88387,99444,1675361,2495125],[0,2,6,8,9,11,20,50,93,152,183,2137,13671,44794,486954,741908,4803258,5692573],[0,1,5,6,44,53,470,2847,3433,4906,13654,14710,400447,1797382,2744492,18775974,23541521],[0,4,9,10,16,33,83,117,318,451,5759,10015,128975,171834,211256,347608,1278690,2154097,2590798,3427694,5581717,21012301,27023976,72522811,95032729,139166747,171822389],[0,5,10,267,344,363,2968,3159,9083,18437,76602,147614,1246902,1593138,2035574,6529391,9511830,11340287,29565945,281666026,677946848]]}}),r("gw/Utils/Long",[],function(){var e=function(e,t){this.low_=0|e,this.high_=0|t};return e.IntCache_={},e.fromInt=function(t){if(-128<=t&&t<128){var i=e.IntCache_[t];if(i)return i}var r=new e(0|t,t<0?-1:0);return-128<=t&&t<128&&(e.IntCache_[t]=r),r},e.fromNumber=function(t){return isNaN(t)||!isFinite(t)?e.ZERO:t<=-e.TWO_PWR_63_DBL_?e.MIN_VALUE:t+1>=e.TWO_PWR_63_DBL_?e.MAX_VALUE:t<0?e.fromNumber(-t).negate():new e(t%e.TWO_PWR_32_DBL_|0,t/e.TWO_PWR_32_DBL_|0)},e.fromBits=function(t,i){return new e(t,i)},e.TWO_PWR_16_DBL_=65536,e.TWO_PWR_24_DBL_=1<<24,e.TWO_PWR_63_DBL_=(e.TWO_PWR_64_DBL_=(e.TWO_PWR_32_DBL_=e.TWO_PWR_16_DBL_*e.TWO_PWR_16_DBL_)*e.TWO_PWR_32_DBL_)/2,e.ZERO=e.fromInt(0),e.ONE=e.fromInt(1),e.MAX_VALUE=e.fromBits(-1,2147483647),e.MIN_VALUE=e.fromBits(0,-2147483648),e.TWO_PWR_24_=e.fromInt(1<<24),e.prototype.toInt=function(){return this.low_},e.prototype.toNumber=function(){return this.high_*e.TWO_PWR_32_DBL_+this.getLowBitsUnsigned()},e.prototype.getLowBitsUnsigned=function(){return this.low_>=0?this.low_:e.TWO_PWR_32_DBL_+this.low_},e.prototype.isZero=function(){return 0===this.high_&&0===this.low_},e.prototype.isNegative=function(){return this.high_<0},e.prototype.isOdd=function(){return 1==(1&this.low_)},e.prototype.equals=function(e){return this.high_===e.high_&&this.low_===e.low_},e.prototype.lessThan=function(e){return this.compare(e)<0},e.prototype.greaterThanOrEqual=function(e){return this.compare(e)>=0},e.prototype.compare=function(e){if(this.equals(e))return 0;var t=this.isNegative(),i=e.isNegative();return t&&!i?-1:!t&&i?1:this.subtract(e).isNegative()?-1:1},e.prototype.negate=function(){return this.equals(e.MIN_VALUE)?e.MIN_VALUE:this.not().add(e.ONE)},e.prototype.add=function(t){var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,l=t.low_>>>16,u=0,c=0,h=0,d=0;return h+=(d+=o+(65535&t.low_))>>>16,c+=(h+=n+l)>>>16,u+=(c+=r+a)>>>16,u+=i+s,e.fromBits((h&=65535)<<16|(d&=65535),(u&=65535)<<16|(c&=65535))},e.prototype.subtract=function(e){return this.add(e.negate())},e.prototype.multiply=function(t){if(this.isZero())return e.ZERO;if(t.isZero())return e.ZERO;if(this.equals(e.MIN_VALUE))return t.isOdd()?e.MIN_VALUE:e.ZERO;if(t.equals(e.MIN_VALUE))return this.isOdd()?e.MIN_VALUE:e.ZERO;if(this.isNegative())return t.isNegative()?this.negate().multiply(t.negate()):this.negate().multiply(t).negate();if(t.isNegative())return this.multiply(t.negate()).negate();if(this.lessThan(e.TWO_PWR_24_)&&t.lessThan(e.TWO_PWR_24_))return e.fromNumber(this.toNumber()*t.toNumber());var i=this.high_>>>16,r=65535&this.high_,n=this.low_>>>16,o=65535&this.low_,s=t.high_>>>16,a=65535&t.high_,l=t.low_>>>16,u=65535&t.low_,c=0,h=0,d=0,p=0;return d+=(p+=o*u)>>>16,h+=(d+=n*u)>>>16,d&=65535,h+=(d+=o*l)>>>16,c+=(h+=r*u)>>>16,h&=65535,c+=(h+=n*l)>>>16,h&=65535,c+=(h+=o*a)>>>16,c+=i*u+r*l+n*a+o*s,e.fromBits((d&=65535)<<16|(p&=65535),(c&=65535)<<16|(h&=65535))},e.prototype.not=function(){return e.fromBits(~this.low_,~this.high_)},e.prototype.and=function(t){return e.fromBits(this.low_&t.low_,this.high_&t.high_)},e.prototype.or=function(t){return e.fromBits(this.low_|t.low_,this.high_|t.high_)},e.prototype.shiftRightUnsigned=function(t){if(0===(t&=63))return this;var i=this.high_;if(t<32){var r=this.low_;return e.fromBits(r>>>t|i<<32-t,i>>>t)}return e.fromBits(32===t?i:i>>>t-32,0)},e}),r("gw/Utils/CircleFinder",[],function(){var e,t,i=function(i){var r=i.length;e=vec3.add2(i[0],i[1]),e=vec3.normalize2(e),t=vec3.dot2(i[0],e);for(var n=2;n<r;++n)vec3.dot2(i[n],e)<t&&this.getCircle(i,n)};return i.prototype.getCircle=function(i,r,n){e=vec3.add2(i[r],i[n]),e=vec3.normalize2(e),t=vec3.dot2(i[r],e);for(var o=0;o<r;++o)if(vec3.dot2(i[o],e)<t){var s=vec3.subtract2(i[r],i[o]),a=vec3.subtract2(i[n],i[o]);e=vec3.cross2(s,a),e=vec3.normalize2(e),(t=vec3.dot2(i[r],e))<0&&(e=vec3.flip(e),t=-t)}},i.prototype.getCircle=function(i,r){e=vec3.add2(i[0],i[r]),e=vec3.normalize2(e),t=vec3.dot2(i[0],e);for(var n=1;n<r;++n)vec3.dot2(i[n],e)<t&&this.getCircle(i,n,r)},i.prototype.getCenter=function(){return e},i.prototype.getCosRad=function(){return t},i}),function(e){"function"==typeof r&&r.amd?r("jquery.ui",["jquery"],e):e(jQuery)}(function(e){function t(t,r){var n,o,s,a=t.nodeName.toLowerCase();return"area"===a?(o=(n=t.parentNode).name,!(!t.href||!o||"map"!==n.nodeName.toLowerCase())&&(!!(s=e("img[usemap='#"+o+"']")[0])&&i(s))):(/^(input|select|textarea|button|object)$/.test(a)?!t.disabled:"a"===a&&t.href||r)&&i(t)}function i(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}function r(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=n(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",o)}function o(){e.datepicker._isDisabledDatepicker(d.inline?d.dpDiv.parent()[0]:d.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function s(t,i){for(var r in e.extend(t,i),i)null==i[r]&&(t[r]=i[r]);return t}function a(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}e.ui=e.ui||{},e.extend(e.ui,{version:"1.11.4",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css("position"),r="absolute"===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,o=this.parents().filter(function(){var t=e(this);return(!r||"static"!==t.css("position"))&&n.test(t.css("overflow")+t.css("overflow-y")+t.css("overflow-x"))}).eq(0);return"fixed"!==i&&o.length?o:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,r){return!!e.data(t,r[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,"tabindex")))},tabbable:function(i){var r=e.attr(i,"tabindex"),n=isNaN(r);return(n||r>=0)&&t(i,!n)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(t,i){function r(t,i,r,o){return e.each(n,function(){i-=parseFloat(e.css(t,"padding"+this))||0,r&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),o&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var n="Width"===i?["Left","Right"]:["Top","Bottom"],o=i.toLowerCase(),s={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+i]=function(t){return void 0===t?s["inner"+i].call(this):this.each(function(){e(this).css(o,r(this,t)+"px")})},e.fn["outer"+i]=function(t,n){return"number"!=typeof t?s["outer"+i].call(this,t):this.each(function(){e(this).css(o,r(this,t,!0,n)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,r){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),r&&r.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e="onselectstart"in document.createElement("div")?"selectstart":"mousedown";return function(){return this.bind(e+".ui-disableSelection",function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(".ui-disableSelection")},zIndex:function(t){if(void 0!==t)return this.css("zIndex",t);if(this.length)for(var i,r,n=e(this[0]);n.length&&n[0]!==document;){if(("absolute"===(i=n.css("position"))||"relative"===i||"fixed"===i)&&(r=parseInt(n.css("zIndex"),10),!isNaN(r)&&0!==r))return r;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,r){var n,o=e.ui[t].prototype;for(n in r)o.plugins[n]=o.plugins[n]||[],o.plugins[n].push([i,r[n]])},call:function(e,t,i,r){var n,o=e.plugins[t];if(o&&(r||e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType))for(n=0;o.length>n;n++)e.options[o[n][0]]&&o[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var r,n,o;for(o=0;null!=(n=i[o]);o++)try{(r=e._data(n,"events"))&&r.remove&&e(n).triggerHandler("remove")}catch(e){}t(i)}}(e.cleanData),e.widget=function(t,i,r){var n,o,s,a,l={},u=t.split(".")[0];return t=t.split(".")[1],n=u+"-"+t,r||(r=i,i=e.Widget),e.expr[":"][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[u]=e[u]||{},o=e[u][t],s=e[u][t]=function(e,t){return this._createWidget?void(arguments.length&&this._createWidget(e,t)):new s(e,t)},e.extend(s,o,{version:r.version,_proto:e.extend({},r),_childConstructors:[]}),(a=new i).options=e.widget.extend({},a.options),e.each(r,function(t,r){return e.isFunction(r)?void(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=n,t=r.apply(this,arguments),this._super=i,this._superApply=o,t}}()):void(l[t]=r)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:o&&a.widgetEventPrefix||t},l,{constructor:s,namespace:u,widgetName:t,widgetFullName:n}),o?(e.each(o._childConstructors,function(t,i){var r=i.prototype;e.widget(r.namespace+"."+r.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s),s},e.widget.extend=function(t){for(var i,r,n=u.call(arguments,1),o=0,s=n.length;s>o;o++)for(i in n[o])r=n[o][i],n[o].hasOwnProperty(i)&&void 0!==r&&(t[i]=e.isPlainObject(r)?e.isPlainObject(t[i])?e.widget.extend({},t[i],r):e.widget.extend({},r):r);return t},e.widget.bridge=function(t,i){var r=i.prototype.widgetFullName||t;e.fn[t]=function(n){var o="string"==typeof n,s=u.call(arguments,1),a=this;return o?this.each(function(){var i,o=e.data(this,r);return"instance"===n?(a=o,!1):o?e.isFunction(o[n])&&"_"!==n.charAt(0)?(i=o[n].apply(o,s))!==o&&void 0!==i?(a=i&&i.jquery?a.pushStack(i.get()):i,!1):void 0:e.error("no such method '"+n+"' for "+t+" widget instance"):e.error("cannot call methods on "+t+" prior to initialization; attempted to call method '"+n+"'")}):(s.length&&(n=e.widget.extend.apply(null,[n].concat(s))),this.each(function(){var t=e.data(this,r);t?(t.option(n||{}),t._init&&t._init()):e.data(this,r,new i(n,this))})),a}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace="."+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&&(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&&this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var r,n,o,s=t;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof t)if(s={},t=(r=t.split(".")).shift(),r.length){for(n=s[t]=e.widget.extend({},this.options[t]),o=0;r.length-1>o;o++)n[r[o]]=n[r[o]]||{},n=n[r[o]];if(t=r.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];s[t]=i}return this._setOptions(s),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled",!!t),t&&(this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,r){var n,o=this;"boolean"!=typeof t&&(r=i,i=t,t=!1),r?(i=n=e(i),this.bindings=this.bindings.add(i)):(r=i,i=this.element,n=this.widget()),e.each(r,function(r,s){function a(){return t||!0!==o.options.disabled&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=r.match(/^([\w:-]*)\s*(.*)$/),u=l[1]+o.eventNamespace,c=l[2];c?n.delegate(c,u,a):i.bind(u,a)})},_off:function(t,i){i=(i||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){var i=this;return setTimeout(function(){return("string"==typeof e?i[e]:e).apply(i,arguments)},t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,r){var n,o,s=this.options[t];if(r=r||{},(i=e.Event(i)).type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(n in o)n in i||(i[n]=o[n]);return this.element.trigger(i,r),!(e.isFunction(s)&&!1===s.apply(this.element[0],[i].concat(r))||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(r,n,o){"string"==typeof n&&(n={effect:n});var s,a=n?!0===n||"number"==typeof n?i:n.effect||i:t;"number"==typeof(n=n||{})&&(n={duration:n}),s=!e.isEmptyObject(n),n.complete=o,n.delay&&r.delay(n.delay),s&&e.effects&&e.effects.effect[a]?r[t](n):a!==t&&r[a]?r[a](n.duration,n.easing,o):r.queue(function(i){e(this)[t](),o&&o.call(r[0]),i()})}}),e.widget;var c=!1;e(document).mouseup(function(){c=!1}),e.widget("ui.mouse",{version:"1.11.4",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!c){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(t),this._mouseDownEvent=t;var i=this,r=1===t.which,n=!("string"!=typeof this.options.cancel||!t.target.nodeName)&&e(t.target).closest(this.options.cancel).length;return!(r&&!n&&this._mouseCapture(t))||(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(t),!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+".preventClickEvent")&&e.removeData(t.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),t.preventDefault(),c=!0,!0))}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||9>document.documentMode)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=!1!==this._mouseStart(this._mouseDownEvent,t),this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),c=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(d.test(e[0])?t/100:1),parseFloat(e[1])*(d.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}e.ui=e.ui||{};var r,n,o=Math.max,s=Math.abs,a=Math.round,l=/left|center|right/,u=/top|center|bottom/,c=/[\+\-]\d+(\.[\d]+)?%?/,h=/^\w+/,d=/%$/,p=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==r)return r;var t,i,n=e("<div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),o=n.children()[0];return e("body").append(n),t=o.offsetWidth,n.css("overflow","scroll"),t===(i=o.offsetWidth)&&(i=n[0].clientWidth),n.remove(),r=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?"":t.element.css("overflow-x"),r=t.isWindow||t.isDocument?"":t.element.css("overflow-y"),n="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth;return{width:"scroll"===r||"auto"===r&&t.height<t.element[0].scrollHeight?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),r=e.isWindow(i[0]),n=!!i[0]&&9===i[0].nodeType;return{element:i,isWindow:r,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:r||n?i.width():i.outerWidth(),height:r||n?i.height():i.outerHeight()}}},e.fn.position=function(r){if(!r||!r.of)return p.apply(this,arguments);r=e.extend({},r);var d,f,g,m,v,y,b=e(r.of),x=e.position.getWithinInfo(r.within),w=e.position.getScrollInfo(x),T=(r.collision||"flip").split(" "),_={};return y=function(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}(b),b[0].preventDefault&&(r.at="left top"),f=y.width,g=y.height,m=y.offset,v=e.extend({},m),e.each(["my","at"],function(){var e,t,i=(r[this]||"").split(" ");1===i.length&&(i=l.test(i[0])?i.concat(["center"]):u.test(i[0])?["center"].concat(i):["center","center"]),i[0]=l.test(i[0])?i[0]:"center",i[1]=u.test(i[1])?i[1]:"center",e=c.exec(i[0]),t=c.exec(i[1]),_[this]=[e?e[0]:0,t?t[0]:0],r[this]=[h.exec(i[0])[0],h.exec(i[1])[0]]}),1===T.length&&(T[1]=T[0]),"right"===r.at[0]?v.left+=f:"center"===r.at[0]&&(v.left+=f/2),"bottom"===r.at[1]?v.top+=g:"center"===r.at[1]&&(v.top+=g/2),d=t(_.at,f,g),v.left+=d[0],v.top+=d[1],this.each(function(){var l,u,c=e(this),h=c.outerWidth(),p=c.outerHeight(),y=i(this,"marginLeft"),C=i(this,"marginTop"),S=h+y+i(this,"marginRight")+w.width,E=p+C+i(this,"marginBottom")+w.height,A=e.extend({},v),I=t(_.my,c.outerWidth(),c.outerHeight());"right"===r.my[0]?A.left-=h:"center"===r.my[0]&&(A.left-=h/2),"bottom"===r.my[1]?A.top-=p:"center"===r.my[1]&&(A.top-=p/2),A.left+=I[0],A.top+=I[1],n||(A.left=a(A.left),A.top=a(A.top)),l={marginLeft:y,marginTop:C},e.each(["left","top"],function(t,i){e.ui.position[T[t]]&&e.ui.position[T[t]][i](A,{targetWidth:f,targetHeight:g,elemWidth:h,elemHeight:p,collisionPosition:l,collisionWidth:S,collisionHeight:E,offset:[d[0]+I[0],d[1]+I[1]],my:r.my,at:r.at,within:x,elem:c})}),r.using&&(u=function(e){var t=m.left-A.left,i=t+f-h,n=m.top-A.top,a=n+g-p,l={target:{element:b,left:m.left,top:m.top,width:f,height:g},element:{element:c,left:A.left,top:A.top,width:h,height:p},horizontal:0>i?"left":t>0?"right":"center",vertical:0>a?"top":n>0?"bottom":"middle"};h>f&&f>s(t+i)&&(l.horizontal="center"),p>g&&g>s(n+a)&&(l.vertical="middle"),l.important=o(s(t),s(i))>o(s(n),s(a))?"horizontal":"vertical",r.using.call(this,e,l)}),c.offset(e.extend(A,{using:u}))})},e.ui.position={fit:{left:function(e,t){var i,r=t.within,n=r.isWindow?r.scrollLeft:r.offset.left,s=r.width,a=e.left-t.collisionPosition.marginLeft,l=n-a,u=a+t.collisionWidth-s-n;t.collisionWidth>s?l>0&&0>=u?(i=e.left+l+t.collisionWidth-s-n,e.left+=l-i):e.left=u>0&&0>=l?n:l>u?n+s-t.collisionWidth:n:l>0?e.left+=l:u>0?e.left-=u:e.left=o(e.left-a,e.left)},top:function(e,t){var i,r=t.within,n=r.isWindow?r.scrollTop:r.offset.top,s=t.within.height,a=e.top-t.collisionPosition.marginTop,l=n-a,u=a+t.collisionHeight-s-n;t.collisionHeight>s?l>0&&0>=u?(i=e.top+l+t.collisionHeight-s-n,e.top+=l-i):e.top=u>0&&0>=l?n:l>u?n+s-t.collisionHeight:n:l>0?e.top+=l:u>0?e.top-=u:e.top=o(e.top-a,e.top)}},flip:{left:function(e,t){var i,r,n=t.within,o=n.offset.left+n.scrollLeft,a=n.width,l=n.isWindow?n.scrollLeft:n.offset.left,u=e.left-t.collisionPosition.marginLeft,c=u-l,h=u+t.collisionWidth-a-l,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>c?(0>(i=e.left+d+p+f+t.collisionWidth-a-o)||s(c)>i)&&(e.left+=d+p+f):h>0&&(((r=e.left-t.collisionPosition.marginLeft+d+p+f-l)>0||h>s(r))&&(e.left+=d+p+f))},top:function(e,t){var i,r,n=t.within,o=n.offset.top+n.scrollTop,a=n.height,l=n.isWindow?n.scrollTop:n.offset.top,u=e.top-t.collisionPosition.marginTop,c=u-l,h=u+t.collisionHeight-a-l,d="top"===t.my[1]?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,p="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,f=-2*t.offset[1];0>c?(0>(r=e.top+d+p+f+t.collisionHeight-a-o)||s(c)>r)&&(e.top+=d+p+f):h>0&&(((i=e.top-t.collisionPosition.marginTop+d+p+f-l)>0||h>s(i))&&(e.top+=d+p+f))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,r,o,s,a=document.getElementsByTagName("body")[0],l=document.createElement("div");for(s in t=document.createElement(a?"div":"body"),r={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&e.extend(r,{position:"absolute",left:"-1000px",top:"-1000px"}),r)t.style[s]=r[s];t.appendChild(l),(i=a||document.documentElement).insertBefore(t,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px;",o=e(l).offset().left,n=o>10&&11>o,t.innerHTML="",i.removeChild(t)}()}(),e.ui.position,e.widget("ui.accordion",{version:"1.11.4",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},hideProps:{borderTopWidth:"hide",borderBottomWidth:"hide",paddingTop:"hide",paddingBottom:"hide",height:"hide"},showProps:{borderTopWidth:"show",borderBottomWidth:"show",paddingTop:"show",paddingBottom:"show",height:"show"},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||!1!==t.active&&null!=t.active||(t.active=0),this._processPanels(),0>t.active&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").css("display","").removeAttr("role").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeUniqueId(),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?void this._activate(t):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||!1!==this.options.active||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),void("disabled"===e&&(this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t))))},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,r=this.headers.length,n=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(n+1)%r];break;case i.LEFT:case i.UP:o=this.headers[(n-1+r)%r];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[r-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),!1===t.active&&!0===t.collapsible||!this.headers.length?(t.active=!1,this.active=e()):!1===t.active?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-state-default ui-corner-all"),this.panels=this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide(),t&&(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,r=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(){var t=e(this),i=t.uniqueId().attr("id"),r=t.next(),n=r.uniqueId().attr("id");t.attr("aria-controls",n),r.attr("aria-labelledby",i)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}).next().attr({"aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}).next().attr({"aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(i.event),"fill"===r?(t=n.height(),this.element.siblings(":visible").each(function(){var i=e(this),r=i.css("position");"absolute"!==r&&"fixed"!==r&&(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===r&&(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css("height","").height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,r=this.active,n=e(t.currentTarget),o=n[0]===r[0],s=o&&i.collapsible,a=s?e():n.next(),l={oldHeader:r,oldPanel:r.next(),newHeader:s?e():n,newPanel:a};t.preventDefault(),o&&!i.collapsible||!1===this._trigger("beforeActivate",t,l)||(i.active=!s&&this.headers.index(n),this.active=o?e():n,this._toggle(l),r.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(n.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,r=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=r,this.options.animate?this._animate(i,r,t):(r.hide(),i.show(),this._toggleComplete(t)),r.attr({"aria-hidden":"true"}),r.prev().attr({"aria-selected":"false","aria-expanded":"false"}),i.length&&r.length?r.prev().attr({tabIndex:-1,"aria-expanded":"false"}):i.length&&this.headers.filter(function(){return 0===parseInt(e(this).attr("tabIndex"),10)}).attr("tabIndex",-1),i.attr("aria-hidden","false").prev().attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_animate:function(e,t,i){var r,n,o,s=this,a=0,l=e.css("box-sizing"),u=e.length&&(!t.length||e.index()<t.index()),c=this.options.animate||{},h=u&&c.down||c,d=function(){s._toggleComplete(i)};return"number"==typeof h&&(o=h),"string"==typeof h&&(n=h),n=n||h.easing||c.easing,o=o||h.duration||c.duration,t.length?e.length?(r=e.show().outerHeight(),t.animate(this.hideProps,{duration:o,easing:n,step:function(e,t){t.now=Math.round(e)}}),void e.hide().animate(this.showProps,{duration:o,easing:n,complete:d,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?"content-box"===l&&(a+=i.now):"content"!==s.options.heightStyle&&(i.now=Math.round(r-t.outerHeight()-a),a=0)}})):t.animate(this.hideProps,o,n,d):e.animate(this.showProps,o,n,d)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}}),e.widget("ui.menu",{version:"1.11.4",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},items:"> *",menus:"ul",position:{my:"left-1 top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item":function(e){e.preventDefault()},"click .ui-menu-item":function(t){var i=e(t.target);!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(".ui-menu").length?this.expand(t):!this.element.is(":focus")&&e(this.document[0].activeElement).closest(".ui-menu").length&&(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){if(!this.previousFilter){var i=e(t.currentTarget);i.siblings(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)}},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&&this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-menu-icons ui-front").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").removeUniqueId().removeClass("ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){var i,r,n,o,s=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:s=!1,r=this.previousFilter||"",n=String.fromCharCode(t.keyCode),o=!1,clearTimeout(this.filterTimer),n===r?o=!0:n=r+n,i=this._filterMenuItems(n),(i=o&&-1!==i.index(this.active.next())?this.active.nextAll(".ui-menu-item"):i).length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}s&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.is("[aria-haspopup='true']")?this.expand(e):this.select(e))},refresh:function(){var t,i=this,r=this.options.icons.submenu,n=this.element.find(this.options.menus);this.element.toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length),n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-front").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),i=t.parent(),n=e("<span>").addClass("ui-menu-icon ui-icon "+r).data("ui-menu-submenu-carat",!0);i.attr("aria-haspopup","true").prepend(n),t.attr("aria-labelledby",i.attr("id"))}),(t=n.add(this.element).find(this.options.items)).not(".ui-menu-item").each(function(){var t=e(this);i._isDivider(t)&&t.addClass("ui-widget-content ui-menu-divider")}),t.not(".ui-menu-item, .ui-menu-divider").addClass("ui-menu-item").uniqueId().attr({tabIndex:-1,role:this._itemRole()}),t.filter(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},focus:function(e,t){var i,r;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),r=this.active.addClass("ui-state-focus").removeClass("ui-state-active"),this.options.role&&this.element.attr("aria-activedescendant",r.attr("id")),this.active.parent().closest(".ui-menu-item").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),(i=t.children(".ui-menu")).length&&e&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,r,n,o,s,a;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,r=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,n=t.offset().top-this.activeMenu.offset().top-i-r,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.outerHeight(),0>n?this.activeMenu.scrollTop(o+n):n+a>s&&this.activeMenu.scrollTop(o+n-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var r=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find(".ui-state-active").not(".ui-state-focus").removeClass("ui-state-active")},_closeOnDocumentClick:function(t){return!e(t.target).closest(".ui-menu").length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").find(this.options.items).first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var r;this.active&&(r="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),r&&r.length&&this.active||(r=this.activeMenu.find(this.options.items)[t]()),this.focus(i,r)},nextPage:function(t){var i,r,n;return this.active?void(this.isLastItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return 0>(i=e(this)).offset().top-r-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?"last":"first"]()))):void this.next(t)},previousPage:function(t){var i,r,n;return this.active?void(this.isFirstItem()||(this._hasScroll()?(r=this.active.offset().top,n=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return(i=e(this)).offset().top-r+n>0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first()))):void this.next(t)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),r=RegExp("^"+i,"i");return this.activeMenu.find(this.options.items).filter(".ui-menu-item").filter(function(){return r.test(e.trim(e(this).text()))})}}),e.widget("ui.autocomplete",{version:"1.11.4",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,r,n=this.element[0].nodeName.toLowerCase(),o="textarea"===n,s="input"===n;this.isMultiLine=!!o||!s&&this.element.prop("isContentEditable"),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(n){if(this.element.prop("readOnly"))return t=!0,r=!0,void(i=!0);t=!1,r=!1,i=!1;var o=e.ui.keyCode;switch(n.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",n);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",n);break;case o.UP:t=!0,this._keyEvent("previous",n);break;case o.DOWN:t=!0,this._keyEvent("next",n);break;case o.ENTER:this.menu.active&&(t=!0,n.preventDefault(),this.menu.select(n));break;case o.TAB:this.menu.active&&this.menu.select(n);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(r){if(t)return t=!1,void((!this.isMultiLine||this.menu.element.is(":visible"))&&r.preventDefault());if(!i){var n=e.ui.keyCode;switch(r.keyCode){case n.PAGE_UP:this._move("previousPage",r);break;case n.PAGE_DOWN:this._move("nextPage",r);break;case n.UP:this._keyEvent("previous",r);break;case n.DOWN:this._keyEvent("next",r)}}},input:function(e){return r?(r=!1,void e.preventDefault()):void this._searchTimeout(e)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(e),void this._change(e))}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().menu("instance"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(r){r.target===t.element[0]||r.target===i||e.contains(i,r.target)||t.close()})})},menufocus:function(t,i){var r,n;return this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),void this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)})):(n=i.item.data("ui-autocomplete-item"),!1!==this._trigger("focus",t,{item:n})&&t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value),void((r=i.item.attr("aria-label")||n.value)&&e.trim(r).length&&(this.liveRegion.children().hide(),e("<div>").text(r).appendTo(this.liveRegion))))},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),r=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,r=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,r){r(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,n){r.xhr&&r.xhr.abort(),r.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(":visible"),r=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&&!i&&!r)&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):!1!==this._trigger("search",t)?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&&this.__response(e),this.pending--,this.pending||this.element.removeClass("ui-autocomplete-loading")},this)},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var r=this;e.each(i,function(e,i){r._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this.isMultiLine||this._value(this.term),void this.menu.blur()):void this.menu[e](t):void this.search(null,t)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var r=RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return r.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&&t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e("<div>").text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var h,d,p="ui-button ui-widget ui-state-default ui-corner-all",f="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",g=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},m=function(t){var i=t.name,r=t.form,n=e([]);return i&&(i=i.replace(/'/g,"\\'"),n=r?e(r).find("[name='"+i+"'][type=radio]"):e("[name='"+i+"'][type=radio]",t.ownerDocument).filter(function(){return!this.form})),n};e.widget("ui.button",{version:"1.11.4",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,g),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var t=this,i=this.options,r="checkbox"===this.type||"radio"===this.type,n=r?"":"ui-state-active";null===i.label&&(i.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){i.disabled||this===h&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind("click"+this.eventNamespace,function(e){i.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass("ui-state-focus")},blur:function(){this.buttonElement.removeClass("ui-state-focus")}}),r&&this.element.bind("change"+this.eventNamespace,function(){t.refresh()}),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return!i.disabled&&void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass("ui-state-active"),t.buttonElement.attr("aria-pressed","true");var r=t.element[0];m(r).not(r).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return!i.disabled&&(e(this).addClass("ui-state-active"),h=this,void t.document.one("mouseup",function(){h=null}))}).bind("mouseup"+this.eventNamespace,function(){return!i.disabled&&void e(this).removeClass("ui-state-active")}).bind("keydown"+this.eventNamespace,function(t){return!i.disabled&&void((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"))}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),(i=this.element.is(":checked"))&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(p+" ui-state-active "+f).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),void(t&&("checkbox"===this.type||"radio"===this.type?this.buttonElement.removeClass("ui-state-focus"):this.buttonElement.removeClass("ui-state-focus ui-state-active")))):void this._resetButton()},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?m(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"!==this.type){var t=this.buttonElement.removeClass(f),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),r=this.options.icons,n=r.primary&&r.secondary,o=[];r.primary||r.secondary?(this.options.text&&o.push("ui-button-text-icon"+(n?"s":r.primary?"-primary":"-secondary")),r.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+r.primary+"'></span>"),r.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+r.secondary+"'></span>"),this.options.text||(o.push(n?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}else this.options.label&&this.element.val(this.options.label)}}),e.widget("ui.buttonset",{version:"1.11.4",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction"),i=this.element.find(this.options.items),r=i.filter(":ui-button");i.not(":ui-button").button(),r.button("refresh"),this.buttons=i.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}}),e.ui.button,e.extend(e.ui,{datepicker:{version:"1.11.4"}}),e.extend(r.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return s(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var r,n,o;n="div"===(r=t.nodeName.toLowerCase())||"span"===r,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(o=this._newInst(e(t),n)).settings=e.extend({},i||{}),"input"===r?this._connectDatepicker(t,o):n&&this._inlineDatepicker(t,o)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var r=e(t);i.append=e([]),i.trigger=e([]),r.hasClass(this.markerClassName)||(this._attachments(r,i),r.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var r,n,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[a?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),("focus"===(r=this._get(i,"showOn"))||"both"===r)&&t.focus(this._showDatepicker),("button"===r||"both"===r)&&(n=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:n,title:n}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:n,title:n}):n)),t[a?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,r,n,o=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(t=function(e){for(i=0,r=0,n=0;e.length>n;n++)e[n].length>i&&(i=e[n].length,r=n);return r},o.setMonth(t(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var r=e(t);r.hasClass(this.markerClassName)||(r.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,r,n,o){var a,l,u,c,h,d=this._dialogInst;return d||(this.uuid+=1,a="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+a+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),(d=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",d)),s(d.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(d,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(l=document.documentElement.clientWidth,u=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,h=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[l/2-100+c,u/2-150+h]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),d.settings.onSelect=r,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",d),this},_destroyDatepicker:function(t){var i,r=e(t),n=e.data(t,"datepicker");r.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,"datepicker"),"input"===i?(n.append.remove(),n.trigger.remove(),r.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&r.removeClass(this.markerClassName).empty(),d===n&&(d=null))},_enableDatepicker:function(t){var i,r,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&((r=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,r,n=e(t),o=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&((r=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),r.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length>t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,r){var n,o,a,l,u=this._getInst(t);return 2===arguments.length&&"string"==typeof i?"defaults"===i?e.extend({},e.datepicker._defaults):u?"all"===i?e.extend({},u.settings):this._get(u,i):null:(n=i||{},"string"==typeof i&&((n={})[i]=r),void(u&&(this._curInst===u&&this._hideDatepicker(),o=this._getDateDatepicker(t,!0),a=this._getMinMaxDate(u,"min"),l=this._getMinMaxDate(u,"max"),s(u.settings,n),null!==a&&void 0!==n.dateFormat&&void 0===n.minDate&&(u.settings.minDate=this._formatDate(u,a)),null!==l&&void 0!==n.dateFormat&&void 0===n.maxDate&&(u.settings.maxDate=this._formatDate(u,l)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),u),this._autoSize(u),this._setDate(u,o),this._updateAlternate(u),this._updateDatepicker(u))))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,r,n,o=e.datepicker._getInst(t.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return(n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv))[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,n[0]),(i=e.datepicker._get(o,"onSelect"))?(r=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[r,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,r,n=e.datepicker._getInst(t.target);return e.datepicker._get(n,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),r=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">r||!i||i.indexOf(r)>-1):void 0},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,r,n,o,a,l,u;("input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(n=(r=e.datepicker._get(i,"beforeShow"))?r.apply(t,[t,i]):{})&&(s(i.settings,n),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return!(o|="fixed"===e(this).css("position"))}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),a=e.datepicker._checkOffset(i,a,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),u=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),u):i.dpDiv[l||"show"](l?u:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i)))},_updateDatepicker:function(t){this.maxRows=4,d=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,r=this._getNumberOfMonths(t),n=r[1],s=t.dpDiv.find("."+this._dayOverClass+" a");s.length>0&&o.apply(s.get(0)),t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),n>1&&t.dpDiv.addClass("ui-datepicker-multi-"+n).css("width",17*n+"em"),t.dpDiv[(1!==r[0]||1!==r[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,r){var n=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(r?0:e(document).scrollLeft()),u=document.documentElement.clientHeight+(r?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-s:0,i.left-=r&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=r&&i.top===t.input.offset().top+a?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>l&&l>n?Math.abs(i.left+n-l):0),i.top-=Math.min(i.top,i.top+o>u&&u>o?Math.abs(o+a):0),i},_findPos:function(t){for(var i,r=this._getInst(t),n=this._get(r,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,r,n,o,s=this._curInst;!s||t&&s!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(s,"showAnim"),r=this._get(s,"duration"),n=function(){e.datepicker._tidyDialog(s)},e.effects&&(e.effects.effect[i]||e.effects[i])?s.dpDiv.hide(i,e.datepicker._get(s,"showOptions"),r,n):s.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?r:null,n),i||n(),this._datepickerShowing=!1,(o=this._get(s,"onClose"))&&o.apply(s.input?s.input[0]:null,[s.input?s.input.val():"",s]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),r=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==r)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,r){var n=e(t),o=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(o,i+("M"===r?this._get(o,"showCurrentAtPos"):0),r),this._updateDatepicker(o))},_gotoToday:function(t){var i,r=e(t),n=this._getInst(r[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(r)},_selectMonthYear:function(t,i,r){var n=e(t),o=this._getInst(n[0]);o["selected"+("M"===r?"Month":"Year")]=o["draw"+("M"===r?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(n)},_selectDay:function(t,i,r,n){var o,s=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||((o=this._getInst(s[0])).selectedDay=o.currentDay=e("a",n).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=r,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var r,n=e(t),o=this._getInst(n[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),(r=this._get(o,"onSelect"))?r.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,r,n,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),r=this._getDate(t),n=this.formatDate(i,r,this._getFormatConfig(t)),e(o).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,r){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?""+i:i+""))return null;var n,o,s,a,l=0,u=(r?r.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof u?u:(new Date).getFullYear()%100+parseInt(u,10),h=(r?r.dayNamesShort:null)||this._defaults.dayNamesShort,d=(r?r.dayNames:null)||this._defaults.dayNames,p=(r?r.monthNamesShort:null)||this._defaults.monthNamesShort,f=(r?r.monthNames:null)||this._defaults.monthNames,g=-1,m=-1,v=-1,y=-1,b=!1,x=function(e){var i=t.length>n+1&&t.charAt(n+1)===e;return i&&n++,i},w=function(e){var t=x(e),r="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n=RegExp("^\\d{"+("y"===e?r:1)+","+r+"}"),o=i.substring(l).match(n);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},T=function(t,r,n){var o=-1,s=e.map(x(t)?n:r,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(s,function(e,t){var r=t[1];return i.substr(l,r.length).toLowerCase()===r.toLowerCase()?(o=t[0],l+=r.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},_=function(){if(i.charAt(l)!==t.charAt(n))throw"Unexpected literal at position "+l;l++};for(n=0;t.length>n;n++)if(b)"'"!==t.charAt(n)||x("'")?_():b=!1;else switch(t.charAt(n)){case"d":v=w("d");break;case"D":T("D",h,d);break;case"o":y=w("o");break;case"m":m=w("m");break;case"M":m=T("M",p,f);break;case"y":g=w("y");break;case"@":g=(a=new Date(w("@"))).getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"!":g=(a=new Date((w("!")-this._ticksTo1970)/1e4)).getFullYear(),m=a.getMonth()+1,v=a.getDate();break;case"'":x("'")?_():b=!0;break;default:_()}if(i.length>l&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===g?g=(new Date).getFullYear():100>g&&(g+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=g?0:-100)),y>-1)for(m=1,v=y;!((o=this._getDaysInMonth(g,m-1))>=v);)m++,v-=o;if((a=this._daylightSavingAdjust(new Date(g,m-1,v))).getFullYear()!==g||a.getMonth()+1!==m||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:864e9*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var r,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=e.length>r+1&&e.charAt(r+1)===t;return i&&r++,i},u=function(e,t,i){var r=""+t;if(l(e))for(;i>r.length;)r="0"+r;return r},c=function(e,t,i,r){return l(e)?r[t]:i[t]},h="",d=!1;if(t)for(r=0;e.length>r;r++)if(d)"'"!==e.charAt(r)||l("'")?h+=e.charAt(r):d=!1;else switch(e.charAt(r)){case"d":h+=u("d",t.getDate(),2);break;case"D":h+=c("D",t.getDay(),n,o);break;case"o":h+=u("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":h+=u("m",t.getMonth()+1,2);break;case"M":h+=c("M",t.getMonth(),s,a);break;case"y":h+=l("y")?t.getFullYear():(10>t.getYear()%100?"0":"")+t.getYear()%100;break;case"@":h+=t.getTime();break;case"!":h+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?h+="'":d=!0;break;default:h+=e.charAt(r)}return h},_possibleChars:function(e){var t,i="",r=!1,n=function(i){var r=e.length>t+1&&e.charAt(t+1)===i;return r&&t++,r};for(t=0;e.length>t;t++)if(r)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):r=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":r=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),r=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),o=n,s=this._getFormatConfig(e);try{o=this.parseDate(i,r,s)||n}catch(e){r=t?"":r}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=r?o.getDate():0,e.currentMonth=r?o.getMonth():0,e.currentYear=r?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,r){var n=null==i||""===i?r:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var r=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=r.getFullYear(),o=r.getMonth(),s=r.getDate(),a=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(i);l;){switch(l[2]||"d"){case"d":case"D":s+=parseInt(l[1],10);break;case"w":case"W":s+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(n,o));break;case"y":case"Y":n+=parseInt(l[1],10),s=Math.min(s,e.datepicker._getDaysInMonth(n,o))}l=a.exec(i)}return new Date(n,o,s)}(i):"number"==typeof i?isNaN(i)?r:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(n=n&&"Invalid Date"==""+n?r:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var r=!t,n=e.selectedMonth,o=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),n===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(r?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),r="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(r,-i,"M")},next:function(){e.datepicker._adjustDate(r,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(r)},selectDay:function(){return e.datepicker._selectDay(r,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(r,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(r,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_,C,S,E,A,I,M,k,D,R,P,L,N,O,F,B,G,U=new Date,z=this._daylightSavingAdjust(new Date(U.getFullYear(),U.getMonth(),U.getDate())),V=this._get(e,"isRTL"),j=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),Y=this._get(e,"navigationAsDateFormat"),H=this._getNumberOfMonths(e),q=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),Z=1!==H[0]||1!==H[1],K=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(e,"min"),Q=this._getMinMaxDate(e,"max"),$=e.drawMonth-q,ee=e.drawYear;if(0>$&&($+=12,ee--),Q)for(t=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-H[0]*H[1]+1,Q.getDate())),t=J&&J>t?J:t;this._daylightSavingAdjust(new Date(ee,$,1))>t;)0>--$&&($=11,ee--);for(e.drawMonth=$,e.drawYear=ee,i=this._get(e,"prevText"),i=Y?this.formatDate(i,this._daylightSavingAdjust(new Date(ee,$-X,1)),this._getFormatConfig(e)):i,r=this._canAdjustMonth(e,-1,ee,$)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"e":"w")+"'>"+i+"</span></a>",n=this._get(e,"nextText"),n=Y?this.formatDate(n,this._daylightSavingAdjust(new Date(ee,$+X,1)),this._getFormatConfig(e)):n,o=this._canAdjustMonth(e,1,ee,$)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+n+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+n+"'><span class='ui-icon ui-icon-circle-triangle-"+(V?"w":"e")+"'>"+n+"</span></a>",s=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?K:z,s=Y?this.formatDate(s,a,this._getFormatConfig(e)):s,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",u=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(V?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(V?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,h=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),g=this._get(e,"monthNamesShort"),m=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),b=this._getDefaultDate(e),x="",T=0;H[0]>T;T++){for(_="",this.maxRows=4,C=0;H[1]>C;C++){if(S=this._daylightSavingAdjust(new Date(ee,$,e.selectedDay)),E=" ui-corner-all",A="",Z){if(A+="<div class='ui-datepicker-group",H[1]>1)switch(C){case 0:A+=" ui-datepicker-group-first",E=" ui-corner-"+(V?"right":"left");break;case H[1]-1:A+=" ui-datepicker-group-last",E=" ui-corner-"+(V?"left":"right");break;default:A+=" ui-datepicker-group-middle",E=""}A+="'>"}for(A+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+E+"'>"+(/all|left/.test(E)&&0===T?V?o:r:"")+(/all|right/.test(E)&&0===T?V?r:o:"")+this._generateMonthYearHeader(e,$,ee,J,Q,T>0||C>0,f,g)+"</div><table class='ui-datepicker-calendar'><thead><tr>",I=h?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",w=0;7>w;w++)I+="<th scope='col'"+((w+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+d[M=(w+c)%7]+"'>"+p[M]+"</span></th>";for(A+=I+"</tr></thead><tbody>",k=this._getDaysInMonth(ee,$),ee===e.selectedYear&&$===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,k)),D=(this._getFirstDayOfMonth(ee,$)-c+7)%7,R=Math.ceil((D+k)/7),P=Z&&this.maxRows>R?this.maxRows:R,this.maxRows=P,L=this._daylightSavingAdjust(new Date(ee,$,1-D)),N=0;P>N;N++){for(A+="<tr>",O=h?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(L)+"</td>":"",w=0;7>w;w++)F=m?m.apply(e.input?e.input[0]:null,[L]):[!0,""],G=(B=L.getMonth()!==$)&&!y||!F[0]||J&&J>L||Q&&L>Q,O+="<td class='"+((w+c+6)%7>=5?" ui-datepicker-week-end":"")+(B?" ui-datepicker-other-month":"")+(L.getTime()===S.getTime()&&$===e.selectedMonth&&e._keyEvent||b.getTime()===L.getTime()&&b.getTime()===S.getTime()?" "+this._dayOverClass:"")+(G?" "+this._unselectableClass+" ui-state-disabled":"")+(B&&!v?"":" "+F[1]+(L.getTime()===K.getTime()?" "+this._currentClass:"")+(L.getTime()===z.getTime()?" ui-datepicker-today":""))+"'"+(B&&!v||!F[2]?"":" title='"+F[2].replace(/'/g,"&#39;")+"'")+(G?"":" data-handler='selectDay' data-event='click' data-month='"+L.getMonth()+"' data-year='"+L.getFullYear()+"'")+">"+(B&&!v?"&#xa0;":G?"<span class='ui-state-default'>"+L.getDate()+"</span>":"<a class='ui-state-default"+(L.getTime()===z.getTime()?" ui-state-highlight":"")+(L.getTime()===K.getTime()?" ui-state-active":"")+(B?" ui-priority-secondary":"")+"' href='#'>"+L.getDate()+"</a>")+"</td>",L.setDate(L.getDate()+1),L=this._daylightSavingAdjust(L);A+=O+"</tr>"}++$>11&&($=0,ee++),_+=A+="</tbody></table>"+(Z?"</div>"+(H[0]>0&&C===H[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}x+=_}return x+=u,e._keyEvent=!1,x},_generateMonthYearHeader:function(e,t,i,r,n,o,s,a){var l,u,c,h,d,p,f,g,m=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),b="<div class='ui-datepicker-title'>",x="";if(o||!m)x+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(l=r&&r.getFullYear()===i,u=n&&n.getFullYear()===i,x+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!l||c>=r.getMonth())&&(!u||n.getMonth()>=c)&&(x+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+a[c]+"</option>");x+="</select>"}if(y||(b+=x+(!o&&m&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!v)b+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(h=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),f=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t})(h[0]),g=Math.max(f,p(h[1]||"")),f=r?Math.max(f,r.getFullYear()):f,g=n?Math.min(g,n.getFullYear()):g,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";g>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,"yearSuffix"),y&&(b+=(!o&&m&&v?"":"&#xa0;")+x),b+"</div>"},_adjustInstDate:function(e,t,i){var r=e.drawYear+("Y"===i?t:0),n=e.drawMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(r,n))+("D"===i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(r,n,o)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),r=this._getMinMaxDate(e,"max"),n=i&&i>t?i:t;return r&&n>r?r:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,r){var n=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,r+(0>t?t:n[0]*n[1]),1));return 0>t&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,r,n=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),s=null,a=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),r=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=r),i[1].match(/[+\-].*/)&&(a+=r)),(!n||t.getTime()>=n.getTime())&&(!o||t.getTime()<=o.getTime())&&(!s||t.getFullYear()>=s)&&(!a||a>=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,r){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(r,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new r,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.11.4",e.datepicker,e.widget("ui.draggable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),!(this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0)&&(this.handle=this._getHandle(t),!!this.handle&&(this._blockFrames(!0===i.iframeFix?"iframe":i.iframeFix),!0))},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e("<div>").css("position","absolute").appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&&"body"!==i.activeElement.nodeName.toLowerCase()&&e(i.activeElement).blur()}catch(e){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return"fixed"===e(this).css("position")}).length>0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),!1===this._trigger("start",t)?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!i){var r=this._uiHash();if(!1===this._trigger("drag",t,r))return this._mouseUp({}),!1;this.position=r.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,r=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(r=e.ui.ddmanager.drop(this,t)),this.dropped&&(r=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!r||"valid"===this.options.revert&&r||!0===this.options.revert||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,r)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){!1!==i._trigger("stop",t)&&i._clear()}):!1!==this._trigger("stop",t)&&this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return!this.options.handle||!!e(t.target).closest(this.element.find(this.options.handle)).length},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var i=this.options,r=e.isFunction(i.helper),n=r?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),r&&n[0]===this.element[0]&&this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==i&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,r,n=this.options,o=this.document[0];return this.relativeContainer=null,n.containment?"window"===n.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===n.containment?void(this.containment=[0,0,e(o).width()-this.helperProportions.width-this.margins.left,(e(o).height()||o.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):n.containment.constructor===Array?void(this.containment=n.containment):("parent"===n.containment&&(n.containment=this.helper[0].parentNode),void((r=(i=e(n.containment))[0])&&(t=/(scroll|auto)/.test(i.css("overflow")),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(r.scrollWidth,r.offsetWidth):r.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(r.scrollHeight,r.offsetHeight):r.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var i="absolute"===e?1:-1,r=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,r,n,o,s=this.options,a=this._isRootNode(this.scrollParent[0]),l=e.pageX,u=e.pageY;return a&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(r=this.relativeContainer.offset(),i=[this.containment[0]+r.left,this.containment[1]+r.top,this.containment[2]+r.left,this.containment[3]+r.top]):i=this.containment,e.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),e.pageY-this.offset.click.top<i[1]&&(u=i[1]+this.offset.click.top),e.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),e.pageY-this.offset.click.top>i[3]&&(u=i[3]+this.offset.click.top)),s.grid&&(n=s.grid[1]?this.originalPageY+Math.round((u-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,u=i?n-this.offset.click.top>=i[1]||n-this.offset.click.top>i[3]?n:n-this.offset.click.top>=i[1]?n-s.grid[1]:n+s.grid[1]:n,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o),"y"===s.axis&&(l=this.originalPageX),"x"===s.axis&&(u=this.originalPageY)),{top:u-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:a?0:this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:a?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,i,r){return r=r||this._uiHash(),e.ui.plugin.call(this,t,[i,r,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),r.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,r)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i,r){var n=e.extend({},i,{item:r.element});r.sortables=[],e(r.options.connectToSortable).each(function(){var i=e(this).sortable("instance");i&&!i.options.disabled&&(r.sortables.push(i),i.refreshPositions(),i._trigger("activate",t,n))})},stop:function(t,i,r){var n=e.extend({},i,{item:r.element});r.cancelHelperRemoval=!1,e.each(r.sortables,function(){var e=this;e.isOver?(e.isOver=0,r.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css("position"),top:e.placeholder.css("top"),left:e.placeholder.css("left")},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger("deactivate",t,n))})},drag:function(t,i,r){e.each(r.sortables,function(){var n=!1,o=this;o.positionAbs=r.positionAbs,o.helperProportions=r.helperProportions,o.offset.click=r.offset.click,o._intersectsWith(o.containerCache)&&(n=!0,e.each(r.sortables,function(){return this.positionAbs=r.positionAbs,this.helperProportions=r.helperProportions,this.offset.click=r.offset.click,this!==o&&this._intersectsWith(this.containerCache)&&e.contains(o.element[0],this.element[0])&&(n=!1),n})),n?(o.isOver||(o.isOver=1,r._parent=i.helper.parent(),o.currentItem=i.helper.appendTo(o.element).data("ui-sortable-item",!0),o.options._helper=o.options.helper,o.options.helper=function(){return i.helper[0]},t.target=o.currentItem[0],o._mouseCapture(t,!0),o._mouseStart(t,!0,!0),o.offset.click.top=r.offset.click.top,o.offset.click.left=r.offset.click.left,o.offset.parent.left-=r.offset.parent.left-o.offset.parent.left,o.offset.parent.top-=r.offset.parent.top-o.offset.parent.top,r._trigger("toSortable",t),r.dropped=o.element,e.each(r.sortables,function(){this.refreshPositions()}),r.currentItem=r.element,o.fromOutside=r),o.currentItem&&(o._mouseDrag(t),i.position=o.position)):o.isOver&&(o.isOver=0,o.cancelHelperRemoval=!0,o.options._revert=o.options.revert,o.options.revert=!1,o._trigger("out",t,o._uiHash(o)),o._mouseStop(t,!0),o.options.revert=o.options._revert,o.options.helper=o.options._helper,o.placeholder&&o.placeholder.remove(),i.helper.appendTo(r._parent),r._refreshOffsets(t),i.position=r._generatePosition(t,!0),r._trigger("fromSortable",t),r.dropped=!1,e.each(r.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,i,r){var n=e("body"),o=r.options;n.css("cursor")&&(o._cursor=n.css("cursor")),n.css("cursor",o.cursor)},stop:function(t,i,r){var n=r.options;n._cursor&&e("body").css("cursor",n._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i,r){var n=e(i.helper),o=r.options;n.css("opacity")&&(o._opacity=n.css("opacity")),n.css("opacity",o.opacity)},stop:function(t,i,r){var n=r.options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&&"HTML"!==i.scrollParentNotHidden[0].tagName&&(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,r){var n=r.options,o=!1,s=r.scrollParentNotHidden[0],a=r.document[0];s!==a&&"HTML"!==s.tagName?(n.axis&&"x"===n.axis||(r.overflowOffset.top+s.offsetHeight-t.pageY<n.scrollSensitivity?s.scrollTop=o=s.scrollTop+n.scrollSpeed:t.pageY-r.overflowOffset.top<n.scrollSensitivity&&(s.scrollTop=o=s.scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(r.overflowOffset.left+s.offsetWidth-t.pageX<n.scrollSensitivity?s.scrollLeft=o=s.scrollLeft+n.scrollSpeed:t.pageX-r.overflowOffset.left<n.scrollSensitivity&&(s.scrollLeft=o=s.scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(a).scrollTop()<n.scrollSensitivity?o=e(a).scrollTop(e(a).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(a).scrollTop())<n.scrollSensitivity&&(o=e(a).scrollTop(e(a).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(a).scrollLeft()<n.scrollSensitivity?o=e(a).scrollLeft(e(a).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(a).scrollLeft())<n.scrollSensitivity&&(o=e(a).scrollLeft(e(a).scrollLeft()+n.scrollSpeed)))),!1!==o&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(r,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,i,r){var n=r.options;r.snapElements=[],e(n.snap.constructor!==String?n.snap.items||":data(ui-draggable)":n.snap).each(function(){var t=e(this),i=t.offset();this!==r.element[0]&&r.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,r){var n,o,s,a,l,u,c,h,d,p,f=r.options,g=f.snapTolerance,m=i.offset.left,v=m+r.helperProportions.width,y=i.offset.top,b=y+r.helperProportions.height;for(d=r.snapElements.length-1;d>=0;d--)u=(l=r.snapElements[d].left-r.margins.left)+r.snapElements[d].width,h=(c=r.snapElements[d].top-r.margins.top)+r.snapElements[d].height,l-g>v||m>u+g||c-g>b||y>h+g||!e.contains(r.snapElements[d].item.ownerDocument,r.snapElements[d].item)?(r.snapElements[d].snapping&&r.options.snap.release&&r.options.snap.release.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=!1):("inner"!==f.snapMode&&(n=g>=Math.abs(c-b),o=g>=Math.abs(h-y),s=g>=Math.abs(l-v),a=g>=Math.abs(u-m),n&&(i.position.top=r._convertPositionTo("relative",{top:c-r.helperProportions.height,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:h,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l-r.helperProportions.width}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:u}).left)),p=n||o||s||a,"outer"!==f.snapMode&&(n=g>=Math.abs(c-y),o=g>=Math.abs(h-b),s=g>=Math.abs(l-m),a=g>=Math.abs(u-v),n&&(i.position.top=r._convertPositionTo("relative",{top:c,left:0}).top),o&&(i.position.top=r._convertPositionTo("relative",{top:h-r.helperProportions.height,left:0}).top),s&&(i.position.left=r._convertPositionTo("relative",{top:0,left:l}).left),a&&(i.position.left=r._convertPositionTo("relative",{top:0,left:u-r.helperProportions.width}).left)),!r.snapElements[d].snapping&&(n||o||s||a||p)&&r.options.snap.snap&&r.options.snap.snap.call(r.element,t,e.extend(r._uiHash(),{snapItem:r.snapElements[d].item})),r.snapElements[d].snapping=n||o||s||a||p)}}),e.ui.plugin.add("draggable","stack",{start:function(t,i,r){var n,o=r.options,s=e.makeArray(e(o.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});s.length&&(n=parseInt(e(s[0]).css("zIndex"),10)||0,e(s).each(function(t){e(this).css("zIndex",n+t)}),this.css("zIndex",n+s.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i,r){var n=e(i.helper),o=r.options;n.css("zIndex")&&(o._zIndex=n.css("zIndex")),n.css("zIndex",o.zIndex)},stop:function(t,i,r){var n=r.options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}}),e.ui.draggable,e.widget("ui.resizable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var r=i&&"left"===i?"scrollLeft":"scrollTop",n=!1;return t[r]>0||(t[r]=1,n=t[r]>0,t[r]=0,n)},_create:function(){var t,i,r,n,o=this,s=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!s.aspectRatio,aspectRatio:s.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:s.helper||s.ghost||s.animate?s.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.resizable("instance")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=s.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this._handles=e(),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;t.length>i;i++)r=e.trim(t[i]),(n=e("<div class='ui-resizable-handle "+("ui-resizable-"+r)+"'></div>")).css({zIndex:s.zIndex}),"se"===r&&n.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[r]=".ui-resizable-"+r,this.element.append(n);this._renderAxis=function(t){var i,r,n,s;for(i in t=t||this.element,this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&&(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&&(r=e(this.handles[i],this.element),s=/sw|ne|nw|se|n|s/.test(i)?r.outerHeight():r.outerWidth(),n=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(n,s),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(".ui-resizable-handle")),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&&(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&&n[1]?n[1]:"se")}),s.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){s.disabled||(e(this).removeClass("ui-resizable-autohide"),o._handles.show())}).mouseleave(function(){s.disabled||o.resizing||(e(this).addClass("ui-resizable-autohide"),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,r,n=!1;for(i in this.handles)((r=e(this.handles[i])[0])===t.target||e.contains(r,t.target))&&(n=!0);return!this.options.disabled&&n},_mouseStart:function(t){var i,r,n,o=this.options,s=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css("left")),r=this._num(this.helper.css("top")),o.containment&&(i+=e(o.containment).scrollLeft()||0,r+=e(o.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:r},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:s.width(),height:s.height()},this.originalSize=this._helper?{width:s.outerWidth(),height:s.outerHeight()}:{width:s.width(),height:s.height()},this.sizeDiff={width:s.outerWidth()-s.width(),height:s.outerHeight()-s.height()},this.originalPosition={left:i,top:r},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio="number"==typeof o.aspectRatio?o.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===n?this.axis+"-resize":n),s.addClass("ui-resizable-resizing"),this._propagate("start",t),!0},_mouseDrag:function(t){var i,r,n=this.originalMousePosition,o=this.axis,s=t.pageX-n.left||0,a=t.pageY-n.top||0,l=this._change[o];return this._updatePrevProperties(),!!l&&(i=l.apply(this,[t,s,a]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),r=this._applyChanges(),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(r)||(this._updatePrevProperties(),this._trigger("resize",t,this.ui()),this._applyChanges()),!1)},_mouseStop:function(t){this.resizing=!1;var i,r,n,o,s,a,l,u=this.options,c=this;return this._helper&&(n=(r=(i=this._proportionallyResizeElements).length&&/textarea/i.test(i[0].nodeName))&&this._hasScroll(i[0],"left")?0:c.sizeDiff.height,o=r?0:c.sizeDiff.width,s={width:c.helper.width()-o,height:c.helper.height()-n},a=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,u.animate||this.element.css(e.extend(s,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!u.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&&(e.top=this.position.top+"px"),this.position.left!==this.prevPosition.left&&(e.left=this.position.left+"px"),this.size.width!==this.prevSize.width&&(e.width=this.size.width+"px"),this.size.height!==this.prevSize.height&&(e.height=this.size.height+"px"),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,r,n,o,s=this.options;o={minWidth:this._isNumber(s.minWidth)?s.minWidth:0,maxWidth:this._isNumber(s.maxWidth)?s.maxWidth:1/0,minHeight:this._isNumber(s.minHeight)?s.minHeight:0,maxHeight:this._isNumber(s.maxHeight)?s.maxHeight:1/0},(this._aspectRatio||e)&&(t=o.minHeight*this.aspectRatio,r=o.minWidth/this.aspectRatio,i=o.maxHeight*this.aspectRatio,n=o.maxWidth/this.aspectRatio,t>o.minWidth&&(o.minWidth=t),r>o.minHeight&&(o.minHeight=r),o.maxWidth>i&&(o.maxWidth=i),o.maxHeight>n&&(o.maxHeight=n)),this._vBoundaries=o},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&&(this.position.left=e.left),this._isNumber(e.top)&&(this.position.top=e.top),this._isNumber(e.height)&&(this.size.height=e.height),this._isNumber(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,r=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(i.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,r=this._isNumber(e.width)&&t.maxWidth&&t.maxWidth<e.width,n=this._isNumber(e.height)&&t.maxHeight&&t.maxHeight<e.height,o=this._isNumber(e.width)&&t.minWidth&&t.minWidth>e.width,s=this._isNumber(e.height)&&t.minHeight&&t.minHeight>e.height,a=this.originalPosition.left+this.originalSize.width,l=this.position.top+this.size.height,u=/sw|nw|w/.test(i),c=/nw|ne|n/.test(i);return o&&(e.width=t.minWidth),s&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),n&&(e.height=t.maxHeight),o&&u&&(e.left=a-t.minWidth),r&&u&&(e.left=a-t.maxWidth),s&&c&&(e.top=l-t.minHeight),n&&c&&(e.top=l-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],r=[e.css("borderTopWidth"),e.css("borderRightWidth"),e.css("borderBottomWidth"),e.css("borderLeftWidth")],n=[e.css("paddingTop"),e.css("paddingRight"),e.css("paddingBottom"),e.css("paddingLeft")];4>t;t++)i[t]=parseInt(r[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length>t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize;return{left:this.originalPosition.left+t,width:i.width-t}},n:function(e,t,i){var r=this.originalSize;return{top:this.originalPosition.top+i,height:r.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,r){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},sw:function(t,i,r){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,r]))},ne:function(t,i,r){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,r]))},nw:function(t,i,r){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,r]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).resizable("instance"),r=i.options,n=i._proportionallyResizeElements,o=n.length&&/textarea/i.test(n[0].nodeName),s=o&&i._hasScroll(n[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},u=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&u?{top:c,left:u}:{}),{duration:r.animateDuration,easing:r.animateEasing,step:function(){var r={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};n&&n.length&&e(n[0]).css({width:r.width,height:r.height}),i._updateCache(r),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var t,i,r,n,o,s,a,l=e(this).resizable("instance"),u=l.options,c=l.element,h=u.containment,d=h instanceof e?h.get(0):/parent/.test(h)?c.parent().get(0):h;d&&(l.containerElement=e(d),/document/.test(h)||h===document?(l.containerOffset={left:0,top:0},l.containerPosition={left:0,top:0},l.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(d),i=[],e(["Top","Right","Left","Bottom"]).each(function(e,r){i[e]=l._num(t.css("padding"+r))}),l.containerOffset=t.offset(),l.containerPosition=t.position(),l.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},r=l.containerOffset,n=l.containerSize.height,o=l.containerSize.width,s=l._hasScroll(d,"left")?d.scrollWidth:o,a=l._hasScroll(d)?d.scrollHeight:n,l.parentData={element:d,left:r.left,top:r.top,width:s,height:a}))},resize:function(t){var i,r,n,o,s=e(this).resizable("instance"),a=s.options,l=s.containerOffset,u=s.position,c=s._aspectRatio||t.shiftKey,h={top:0,left:0},d=s.containerElement,p=!0;d[0]!==document&&/static/.test(d.css("position"))&&(h=l),u.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-h.left),c&&(s.size.height=s.size.width/s.aspectRatio,p=!1),s.position.left=a.helper?l.left:0),u.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),c&&(s.size.width=s.size.height*s.aspectRatio,p=!1),s.position.top=s._helper?l.top:0),n=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),n&&o?(s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top):(s.offset.left=s.element.offset().left,s.offset.top=s.element.offset().top),i=Math.abs(s.sizeDiff.width+(s._helper?s.offset.left-h.left:s.offset.left-l.left)),r=Math.abs(s.sizeDiff.height+(s._helper?s.offset.top-h.top:s.offset.top-l.top)),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,c&&(s.size.height=s.size.width/s.aspectRatio,p=!1)),r+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-r,c&&(s.size.width=s.size.height*s.aspectRatio,p=!1)),p||(s.position.left=s.prevPosition.left,s.position.top=s.prevPosition.top,s.size.width=s.prevSize.width,s.size.height=s.prevSize.height)},stop:function(){var t=e(this).resizable("instance"),i=t.options,r=t.containerOffset,n=t.containerPosition,o=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,u=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-n.left-r.left,width:l,height:u}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-n.left-r.left,width:l,height:u})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).resizable("instance").options;e(t.alsoResize).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})},resize:function(t,i){var r=e(this).resizable("instance"),n=r.options,o=r.originalSize,s=r.originalPosition,a={height:r.size.height-o.height||0,width:r.size.width-o.width||0,top:r.position.top-s.top||0,left:r.position.left-s.left||0};e(n.alsoResize).each(function(){var t=e(this),r=e(this).data("ui-resizable-alsoresize"),n={},o=t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(o,function(e,t){var i=(r[t]||0)+(a[t]||0);i&&i>=0&&(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).resizable("instance"),i=t.options,r=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:r.height,width:r.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable("instance");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable("instance");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t,i=e(this).resizable("instance"),r=i.options,n=i.size,o=i.originalSize,s=i.originalPosition,a=i.axis,l="number"==typeof r.grid?[r.grid,r.grid]:r.grid,u=l[0]||1,c=l[1]||1,h=Math.round((n.width-o.width)/u)*u,d=Math.round((n.height-o.height)/c)*c,p=o.width+h,f=o.height+d,g=r.maxWidth&&p>r.maxWidth,m=r.maxHeight&&f>r.maxHeight,v=r.minWidth&&r.minWidth>p,y=r.minHeight&&r.minHeight>f;r.grid=l,v&&(p+=u),y&&(f+=c),g&&(p-=u),m&&(f-=c),/^(se|s|e)$/.test(a)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.top=s.top-d):/^(sw)$/.test(a)?(i.size.width=p,i.size.height=f,i.position.left=s.left-h):((0>=f-c||0>=p-u)&&(t=i._getPaddingPlusBorderDimensions(this)),f-c>0?(i.size.height=f,i.position.top=s.top-d):(f=c-t.height,i.size.height=f,i.position.top=s.top+o.height-f),p-u>0?(i.size.width=p,i.position.left=s.left-h):(p=u-t.width,i.size.width=p,i.position.left=s.left+o.width-p))}}),e.ui.resizable,e.widget("ui.dialog",{version:"1.11.4",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"Close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),(e=t.parent.children().eq(t.index)).length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,r=this;if(this._isOpen&&!1!==this._trigger("beforeClose",t)){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(":focusable").focus().length)try{(i=this.document[0].activeElement)&&"body"!==i.nodeName.toLowerCase()&&e(i).blur()}catch(e){}this._hide(this.uiDialog,this.options.hide,function(){r._trigger("close",t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var r=!1,n=this.uiDialog.siblings(".ui-front:visible").map(function(){return+e(this).css("z-index")}).get(),o=Math.max.apply(null,n);return o>=+this.uiDialog.css("z-index")&&(this.uiDialog.css("z-index",o+1),r=!0),r&&!i&&this._trigger("focus",t),r},open:function(){var t=this;return this._isOpen?void(this._moveToTop()&&this._focusTabbable()):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&&this.overlay.css("z-index",this.uiDialog.css("z-index")-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._makeFocusTarget(),void this._trigger("open"))},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find("[autofocus]")),e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement;this.uiDialog[0]===t||e.contains(this.uiDialog[0],t)||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),void this.close(t);if(t.keyCode===e.ui.keyCode.TAB&&!t.isDefaultPrevented()){var i=this.uiDialog.find(":tabbable"),r=i.filter(":first"),n=i.filter(":last");t.target!==n[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==r[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){r.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button type='button'></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?void this.uiDialog.removeClass("ui-dialog-buttons"):(e.each(i,function(i,r){var n,o;r=e.isFunction(r)?{click:r,text:i}:r,r=e.extend({type:"button"},r),n=r.click,r.click=function(){n.apply(t.element[0],arguments)},o={icons:r.icons,text:r.showText},delete r.icons,delete r.showText,e("<button></button>",r).button(o).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),void this.uiDialogButtonPane.appendTo(this.uiDialog))},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,r=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(r,n){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",r,t(n))},drag:function(e,r){i._trigger("drag",e,t(r))},stop:function(n,o){var s=o.offset.left-i.document.scrollLeft(),a=o.offset.top-i.document.scrollTop();r.position={my:"left top",at:"left"+(s>=0?"+":"")+s+" top"+(a>=0?"+":"")+a,of:i.window},e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",n,t(o))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,r=this.options,n=r.resizable,o=this.uiDialog.css("position"),s="string"==typeof n?n:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:r.maxWidth,maxHeight:r.maxHeight,minWidth:r.minWidth,minHeight:this._minHeight(),handles:s,start:function(r,n){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",r,t(n))},resize:function(e,r){i._trigger("resize",e,t(r))},stop:function(n,o){var s=i.uiDialog.offset(),a=s.left-i.document.scrollLeft(),l=s.top-i.document.scrollTop();r.height=i.uiDialog.height(),r.width=i.uiDialog.width(),r.position={my:"left top",at:"left"+(a>=0?"+":"")+a+" top"+(l>=0?"+":"")+l,of:i.window},e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",n,t(o))}}).css("position",o)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&&t.splice(i,1)},_trackingInstances:function(){var e=this.document.data("ui-dialog-instances");return e||(e=[],this.document.data("ui-dialog-instances",e)),e},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,r=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&&(r=!0),e in i.resizableRelatedOptions&&(n[e]=t)}),r&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",n)},_setOption:function(e,t){var i,r,n=this.uiDialog;"dialogClass"===e&&n.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&((i=n.is(":data(ui-draggable)"))&&!t&&n.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&((r=n.is(":data(ui-resizable)"))&&!t&&n.resizable("destroy"),r&&"string"==typeof t&&n.resizable("option","handles",t),r||!1===t||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,r=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),r.minWidth>r.width&&(r.width=r.minWidth),e=this.uiDialog.css({height:"auto",width:r.width}).outerHeight(),t=Math.max(0,r.minHeight-e),i="number"==typeof r.maxHeight?Math.max(0,r.maxHeight-e):"none","auto"===r.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,r.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return!!e(t.target).closest(".ui-dialog").length||!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data("ui-dialog-overlays")||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),this.document.data("ui-dialog-overlays",(this.document.data("ui-dialog-overlays")||0)+1)}},_destroyOverlay:function(){if(this.options.modal&&this.overlay){var e=this.document.data("ui-dialog-overlays")-1;e?this.document.data("ui-dialog-overlays",e):this.document.unbind("focusin").removeData("ui-dialog-overlays"),this.overlay.remove(),this.overlay=null}}}),e.widget("ui.droppable",{version:"1.11.4",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,r=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(r)?r:function(e){return e.is(r)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t||(t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight})},this._addToManager(i.scope),i.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length>t;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){if("accept"===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if("scope"===t){var r=e.ui.ddmanager.droppables[this.options.scope];this._splice(r),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var r=i||e.ui.ddmanager.current,n=!1;return!(!r||(r.currentItem||r.element)[0]===this.element[0])&&(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var i=e(this).droppable("instance");return i.options.greedy&&!i.options.disabled&&i.options.scope===r.options.scope&&i.accept.call(i.element[0],r.currentItem||r.element)&&e.ui.intersect(r,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),!n&&(!!this.accept.call(this.element[0],r.currentItem||r.element)&&(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(r)),this.element)))},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e>=t&&t+i>e}return function(t,i,r,n){if(!i.offset)return!1;var o=(t.positionAbs||t.position.absolute).left+t.margins.left,s=(t.positionAbs||t.position.absolute).top+t.margins.top,a=o+t.helperProportions.width,l=s+t.helperProportions.height,u=i.offset.left,c=i.offset.top,h=u+i.proportions().width,d=c+i.proportions().height;switch(r){case"fit":return o>=u&&h>=a&&s>=c&&d>=l;case"intersect":return o+t.helperProportions.width/2>u&&h>a-t.helperProportions.width/2&&s+t.helperProportions.height/2>c&&d>l-t.helperProportions.height/2;case"pointer":return e(n.pageY,c,i.proportions().height)&&e(n.pageX,u,i.proportions().width);case"touch":return(s>=c&&d>=s||l>=c&&d>=l||c>s&&l>d)&&(o>=u&&h>=o||a>=u&&h>=a||u>o&&a>h);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{default:[]},prepareOffsets:function(t,i){var r,n,o=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(r=0;o.length>r;r++)if(!(o[r].options.disabled||t&&!o[r].accept.call(o[r].element[0],t.currentItem||t.element))){for(n=0;a.length>n;n++)if(a[n]===o[r].element[0]){o[r].proportions().height=0;continue e}o[r].visible="none"!==o[r].element.css("display"),o[r].visible&&("mousedown"===s&&o[r]._activate.call(o[r],i),o[r].offset=o[r].element.offset(),o[r].proportions({width:o[r].element[0].offsetWidth,height:o[r].element[0].offsetHeight}))}},drop:function(t,i){var r=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,i)&&(r=this._drop.call(this,i)||r),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),r},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var r,n,o,s=e.ui.intersect(t,this,this.options.tolerance,i),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(n=this.options.scope,(o=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===n})).length&&((r=e(o[0]).droppable("instance")).greedyChild="isover"===a)),r&&"isover"===a&&(r.isover=!1,r.isout=!0,r._out.call(r,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),r&&"isout"===a&&(r.isout=!1,r.isover=!0,r._over.call(r,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var v="ui-effects-",y=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var r=c[t.type]||{};return null==e?i||!t.def?null:t.def:(e=r.floor?~~e:parseFloat(e),isNaN(e)?t.def:r.mod?(e+r.mod)%r.mod:0>e?0:e>r.max?r.max:e)}function r(i){var r=l(),n=r._rgba=[];return i=i.toLowerCase(),p(a,function(e,o){var s,a=o.re.exec(i),l=a&&o.parse(a),c=o.space||"rgba";return l?(s=r[c](l),r[u[c].cache]=s[u[c].cache],n=r._rgba=s._rgba,!1):t}),n.length?("0,0,0,0"===n.join()&&e.extend(n,o.transparent),r):o[i]}function n(e,t,i){return 1>6*(i=(i+1)%1)?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var o,s=/^([\-+])=\s*(\d+\.?\d*)/,a=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,r,n){return new e.Color.fn.parse(t,i,r,n)},u={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},c={byte:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},h=l.support={},d=e("<p>")[0],p=e.each;d.style.cssText="background-color:rgba(1,1,1,.5)",h.rgba=d.style.backgroundColor.indexOf("rgba")>-1,p(u,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,s,a,c){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&&(n=e(n).css(s),s=t);var h=this,d=e.type(n),f=this._rgba=[];return s!==t&&(n=[n,s,a,c],d="array"),"string"===d?this.parse(r(n)||o._default):"array"===d?(p(u.rgba.props,function(e,t){f[t.idx]=i(n[t.idx],t)}),this):"object"===d?(p(u,n instanceof l?function(e,t){n[t.cache]&&(h[t.cache]=n[t.cache].slice())}:function(t,r){var o=r.cache;p(r.props,function(e,t){if(!h[o]&&r.to){if("alpha"===e||null==n[e])return;h[o]=r.to(h._rgba)}h[o][t.idx]=i(n[e],t,!0)}),h[o]&&0>e.inArray(null,h[o].slice(0,3))&&(h[o][3]=1,r.from&&(h._rgba=r.from(h[o])))}),this):t},is:function(e){var i=l(e),r=!0,n=this;return p(u,function(e,o){var s,a=i[o.cache];return a&&(s=n[o.cache]||o.to&&o.to(n._rgba)||[],p(o.props,function(e,i){return null!=a[i.idx]?r=a[i.idx]===s[i.idx]:t})),r}),r},_space:function(){var e=[],t=this;return p(u,function(i,r){t[r.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var r=l(e),n=r._space(),o=u[n],s=0===this.alpha()?l("transparent"):this,a=s[o.cache]||o.to(s._rgba),h=a.slice();return r=r[o.cache],p(o.props,function(e,n){var o=n.idx,s=a[o],l=r[o],u=c[n.type]||{};null!==l&&(null===s?h[o]=l:(u.mod&&(l-s>u.mod/2?s+=u.mod:s-l>u.mod/2&&(s-=u.mod)),h[o]=i((l-s)*t+s,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),r=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-r)*n[t]+r*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),r=i.pop();return t&&i.push(~~(255*r)),"#"+e.map(i,function(e){return 1===(e=(e||0).toString(16)).length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,r=e[0]/255,n=e[1]/255,o=e[2]/255,s=e[3],a=Math.max(r,n,o),l=Math.min(r,n,o),u=a-l,c=a+l,h=.5*c;return t=l===a?0:r===a?60*(n-o)/u+360:n===a?60*(o-r)/u+120:60*(r-n)/u+240,i=0===u?0:.5>=h?u/c:u/(2-c),[Math.round(t)%360,i,h,null==s?1:s]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],r=e[2],o=e[3],s=.5>=r?r*(1+i):r+i-r*i,a=2*r-s;return[Math.round(255*n(a,s,t+1/3)),Math.round(255*n(a,s,t)),Math.round(255*n(a,s,t-1/3)),o]},p(u,function(r,n){var o=n.props,a=n.cache,u=n.to,c=n.from;l.fn[r]=function(r){if(u&&!this[a]&&(this[a]=u(this._rgba)),r===t)return this[a].slice();var n,s=e.type(r),h="array"===s||"object"===s?r:arguments,d=this[a].slice();return p(o,function(e,t){var r=h["object"===s?e:t.idx];null==r&&(r=d[t.idx]),d[t.idx]=i(r,t)}),c?((n=l(c(d)))[a]=d,n):l(d)},p(o,function(t,i){l.fn[t]||(l.fn[t]=function(n){var o,a=e.type(n),l="alpha"===t?this._hsla?"hsla":"rgba":r,u=this[l](),c=u[i.idx];return"undefined"===a?c:("function"===a&&(n=n.call(this,c),a=e.type(n)),null==n&&i.empty?this:("string"===a&&((o=s.exec(n))&&(n=c+parseFloat(o[2])*("+"===o[1]?1:-1))),u[i.idx]=n,this[l](u)))})})}),l.hook=function(t){var i=t.split(" ");p(i,function(t,i){e.cssHooks[i]={set:function(t,n){var o,s,a="";if("transparent"!==n&&("string"!==e.type(n)||(o=r(n)))){if(n=l(o||n),!h.rgba&&1!==n._rgba[3]){for(s="backgroundColor"===i?t.parentNode:t;(""===a||"transparent"===a)&&s&&s.style;)try{a=e.css(s,"backgroundColor"),s=s.parentNode}catch(e){}n=n.blend(a&&"transparent"!==a?a:"_default")}n=n.toRgbaString()}try{t.style[i]=n}catch(e){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook("backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor"),e.cssHooks.borderColor={expand:function(e){var t={};return p(["Top","Right","Bottom","Left"],function(i,r){t["border"+r+"Color"]=e}),t}},o=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(y),function(){function t(t){var i,r,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(n&&n.length&&n[0]&&n[n[0]])for(r=n.length;r--;)"string"==typeof n[i=n[r]]&&(o[e.camelCase(i)]=n[i]);else for(i in n)"string"==typeof n[i]&&(o[i]=n[i]);return o}function i(t,i){var r,o,s={};for(r in i)o=i[r],t[r]!==o&&(n[r]||(e.fx.step[r]||!isNaN(parseFloat(o)))&&(s[r]=o));return s}var r=["add","remove","toggle"],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(y.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,o,s,a){var l=e.speed(o,s,a);return this.queue(function(){var o,s=e(this),a=s.attr("class")||"",u=l.children?s.find("*").addBack():s;u=u.map(function(){return{el:e(this),start:t(this)}}),(o=function(){e.each(r,function(e,t){n[t]&&s[t+"Class"](n[t])})})(),u=u.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),s.attr("class",a),u=u.map(function(){var t=this,i=e.Deferred(),r=e.extend({},l,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,r),i.promise()}),e.when.apply(e,u.get()).done(function(){o(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(s[0])})})},e.fn.extend({addClass:function(t){return function(i,r,n,o){return r?e.effects.animateClass.call(this,{add:i},r,n,o):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,r,n,o){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},r,n,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,r,n,o,s){return"boolean"==typeof r||void 0===r?n?e.effects.animateClass.call(this,r?{add:i}:{remove:i},n,o,s):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},r,n,o)}}(e.fn.toggleClass),switchClass:function(t,i,r,n,o){return e.effects.animateClass.call(this,{add:i,remove:t},r,n,o)}})}(),function(){function t(t,i,r,n){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(n=i,r=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(n=r,r=i,i={}),e.isFunction(r)&&(n=r,r=null),i&&e.extend(t,i),r=r||i.duration,t.duration=e.fx.off?0:"number"==typeof r?r:r in e.fx.speeds?e.fx.speeds[r]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!(t&&"number"!=typeof t&&!e.fx.speeds[t])||("string"==typeof t&&!e.effects.effect[t]||(!!e.isFunction(t)||"object"==typeof t&&!t.effect))}e.extend(e.effects,{version:"1.11.4",save:function(e,t){for(var i=0;t.length>i;i++)null!==t[i]&&e.data(v+t[i],e[0].style[t[i]])},restore:function(e,t){var i,r;for(r=0;t.length>r;r++)null!==t[r]&&(void 0===(i=e.data(v+t[r]))&&(i=""),e.css(t[r],i))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,r;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":r=0;break;case"center":r=.5;break;case"right":r=1;break;default:r=e[1]/t.width}return{x:r,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),float:t.css("float")},r=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),n={width:t.width(),height:t.height()},o=document.activeElement;try{o.id}catch(e){o=document.body}return t.wrap(r),(t[0]===o||e.contains(t[0],o))&&e(o).focus(),r=t.parent(),"static"===t.css("position")?(r.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,r){i[r]=t.css(r),isNaN(parseInt(i[r],10))&&(i[r]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(n),r.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,r,n){return n=n||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(n[i]=o[0]*r+o[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(o)&&o.call(n[0]),e.isFunction(t)&&t()}var n=e(this),o=r.complete,a=r.mode;(n.is(":hidden")?"hide"===a:"show"===a)?(n[a](),i()):s.call(n[0],r,i)}var r=t.apply(this,arguments),n=r.mode,o=r.queue,s=e.effects.effect[r.effect];return e.fx.off||!s?n?this[n](r.duration,r.complete):this.each(function(){r.complete&&r.complete.call(this)}):!1===o?this.each(i):this.queue(o||"fx",i)},show:function(e){return function(r){if(i(r))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="show",this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(r){if(i(r))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="hide",this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(r){if(i(r)||"boolean"==typeof r)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode="toggle",this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),r=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(r=[parseFloat(i),t])}),r}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11>e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var r,n,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"hide"),u=t.direction||"up",c=/up|down|vertical/.test(u),h=c?"height":"width",d=c?"top":"left",p=/up|left|vertical|horizontal/.test(u),f={},g="show"===l;s.parent().is(".ui-effects-wrapper")?e.effects.save(s.parent(),a):e.effects.save(s,a),s.show(),n=(r=e.effects.createWrapper(s).css({overflow:"hidden"}))[h](),o=parseFloat(r.css(d))||0,f[h]=g?n:0,p||(s.css(c?"bottom":"right",0).css(c?"top":"left","auto").css({position:"absolute"}),f[d]=g?o:n+o),g&&(r.css(h,0),p||r.css(d,o+n)),r.animate(f,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){"hide"===l&&s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}})},e.effects.effect.bounce=function(t,i){var r,n,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"effect"),u="hide"===l,c="show"===l,h=t.direction||"up",d=t.distance,p=t.times||5,f=2*p+(c||u?1:0),g=t.duration/f,m=t.easing,v="up"===h||"down"===h?"top":"left",y="up"===h||"left"===h,b=s.queue(),x=b.length;for((c||u)&&a.push("opacity"),e.effects.save(s,a),s.show(),e.effects.createWrapper(s),d||(d=s["top"===v?"outerHeight":"outerWidth"]()/3),c&&((o={opacity:1})[v]=0,s.css("opacity",0).css(v,y?2*-d:2*d).animate(o,g,m)),u&&(d/=Math.pow(2,p-1)),(o={})[v]=0,r=0;p>r;r++)(n={})[v]=(y?"-=":"+=")+d,s.animate(n,g,m).animate(o,g,m),d=u?2*d:d/2;u&&((n={opacity:0})[v]=(y?"-=":"+=")+d,s.animate(n,g,m)),s.queue(function(){u&&s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}),x>1&&b.splice.apply(b,[1,0].concat(b.splice(x,f+1))),s.dequeue()},e.effects.effect.clip=function(t,i){var r,n,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l="show"===e.effects.setMode(s,t.mode||"hide"),u="vertical"===(t.direction||"vertical"),c=u?"height":"width",h=u?"top":"left",d={};e.effects.save(s,a),s.show(),r=e.effects.createWrapper(s).css({overflow:"hidden"}),o=(n="IMG"===s[0].tagName?r:s)[c](),l&&(n.css(c,0),n.css(h,o/2)),d[c]=l?o:0,d[h]=l?0:o/2,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}})},e.effects.effect.drop=function(t,i){var r,n=e(this),o=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(n,t.mode||"hide"),a="show"===s,l=t.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",h={opacity:a?1:0};e.effects.save(n,o),n.show(),e.effects.createWrapper(n),r=t.distance||n["top"===u?"outerHeight":"outerWidth"](!0)/2,a&&n.css("opacity",0).css(u,"pos"===c?-r:r),h[u]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+r,n.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function r(){v.push(this),v.length===c*h&&(d.css({visibility:"visible"}),e(v).remove(),p||d.hide(),i())}var n,o,s,a,l,u,c=t.pieces?Math.round(Math.sqrt(t.pieces)):3,h=c,d=e(this),p="show"===e.effects.setMode(d,t.mode||"hide"),f=d.show().css("visibility","hidden").offset(),g=Math.ceil(d.outerWidth()/h),m=Math.ceil(d.outerHeight()/c),v=[];for(n=0;c>n;n++)for(a=f.top+n*m,u=n-(c-1)/2,o=0;h>o;o++)s=f.left+o*g,l=o-(h-1)/2,d.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-o*g,top:-n*m}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:g,height:m,left:s+(p?l*g:0),top:a+(p?u*m:0),opacity:p?0:1}).animate({left:s+(p?0:l*g),top:a+(p?0:u*m),opacity:p?1:0},t.duration||500,t.easing,r)},e.effects.effect.fade=function(t,i){var r=e(this),n=e.effects.setMode(r,t.mode||"toggle");r.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var r,n,o=e(this),s=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(o,t.mode||"hide"),l="show"===a,u="hide"===a,c=t.size||15,h=/([0-9]+)%/.exec(c),d=!!t.horizFirst,p=l!==d,f=p?["width","height"]:["height","width"],g=t.duration/2,m={},v={};e.effects.save(o,s),o.show(),r=e.effects.createWrapper(o).css({overflow:"hidden"}),n=p?[r.width(),r.height()]:[r.height(),r.width()],h&&(c=parseInt(h[1],10)/100*n[u?0:1]),l&&r.css(d?{height:0,width:c}:{height:c,width:0}),m[f[0]]=l?n[0]:c,v[f[1]]=l?n[1]:0,r.animate(m,g,t.easing).animate(v,g,t.easing,function(){u&&o.hide(),e.effects.restore(o,s),e.effects.removeWrapper(o),i()})},e.effects.effect.highlight=function(t,i){var r=e(this),n=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(r,t.mode||"show"),s={backgroundColor:r.css("backgroundColor")};"hide"===o&&(s.opacity=0),e.effects.save(r,n),r.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&r.hide(),e.effects.restore(r,n),i()}})},e.effects.effect.size=function(t,i){var r,n,o,s=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["width","height","overflow"],u=["fontSize"],c=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],h=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],d=e.effects.setMode(s,t.mode||"effect"),p=t.restore||"effect"!==d,f=t.scale||"both",g=t.origin||["middle","center"],m=s.css("position"),v=p?a:["position","top","bottom","left","right","overflow","opacity"],y={height:0,width:0,outerHeight:0,outerWidth:0};"show"===d&&s.show(),r={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===t.mode&&"show"===d?(s.from=t.to||y,s.to=t.from||r):(s.from=t.from||("show"===d?y:r),s.to=t.to||("hide"===d?y:r)),o={from:{y:s.from.height/r.height,x:s.from.width/r.width},to:{y:s.to.height/r.height,x:s.to.width/r.width}},("box"===f||"both"===f)&&(o.from.y!==o.to.y&&(v=v.concat(c),s.from=e.effects.setTransition(s,c,o.from.y,s.from),s.to=e.effects.setTransition(s,c,o.to.y,s.to)),o.from.x!==o.to.x&&(v=v.concat(h),s.from=e.effects.setTransition(s,h,o.from.x,s.from),s.to=e.effects.setTransition(s,h,o.to.x,s.to))),("content"===f||"both"===f)&&o.from.y!==o.to.y&&(v=v.concat(u).concat(l),s.from=e.effects.setTransition(s,u,o.from.y,s.from),s.to=e.effects.setTransition(s,u,o.to.y,s.to)),e.effects.save(s,v),s.show(),e.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),g&&(n=e.effects.getBaseline(g,r),s.from.top=(r.outerHeight-s.outerHeight())*n.y,s.from.left=(r.outerWidth-s.outerWidth())*n.x,s.to.top=(r.outerHeight-s.to.outerHeight)*n.y,s.to.left=(r.outerWidth-s.to.outerWidth)*n.x),s.css(s.from),("content"===f||"both"===f)&&(c=c.concat(["marginTop","marginBottom"]).concat(u),h=h.concat(["marginLeft","marginRight"]),l=a.concat(c).concat(h),s.find("*[width]").each(function(){var i=e(this),r=i.height(),n=i.width(),s=i.outerHeight(),a=i.outerWidth();p&&e.effects.save(i,l),i.from={height:r*o.from.y,width:n*o.from.x,outerHeight:s*o.from.y,outerWidth:a*o.from.x},i.to={height:r*o.to.y,width:n*o.to.x,outerHeight:r*o.to.y,outerWidth:n*o.to.x},o.from.y!==o.to.y&&(i.from=e.effects.setTransition(i,c,o.from.y,i.from),i.to=e.effects.setTransition(i,c,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=e.effects.setTransition(i,h,o.from.x,i.from),i.to=e.effects.setTransition(i,h,o.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){p&&e.effects.restore(i,l)})})),s.animate(s.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===d&&s.hide(),e.effects.restore(s,v),p||("static"===m?s.css({position:"relative",top:s.to.top,left:s.to.left}):e.each(["top","left"],function(e,t){s.css(t,function(t,i){var r=parseInt(i,10),n=e?s.to.left:s.to.top;return"auto"===i?n+"px":r+n+"px"})})),e.effects.removeWrapper(s),i()}})},e.effects.effect.scale=function(t,i){var r=e(this),n=e.extend(!0,{},t),o=e.effects.setMode(r,t.mode||"effect"),s=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===o?0:100),a=t.direction||"both",l=t.origin,u={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()},c="horizontal"!==a?s/100:1,h="vertical"!==a?s/100:1;n.effect="size",n.queue=!1,n.complete=i,"effect"!==o&&(n.origin=l||["middle","center"],n.restore=!0),n.from=t.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:u),n.to={height:u.height*c,width:u.width*h,outerHeight:u.outerHeight*c,outerWidth:u.outerWidth*h},n.fade&&("show"===o&&(n.from.opacity=0,n.to.opacity=1),"hide"===o&&(n.from.opacity=1,n.to.opacity=0)),r.effect(n)},e.effects.effect.puff=function(t,i){var r=e(this),n=e.effects.setMode(r,t.mode||"hide"),o="hide"===n,s=parseInt(t.percent,10)||150,a=s/100,l={height:r.height(),width:r.width(),outerHeight:r.outerHeight(),outerWidth:r.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:n,complete:i,percent:o?s:100,from:o?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),r.effect(t)},e.effects.effect.pulsate=function(t,i){var r,n=e(this),o=e.effects.setMode(n,t.mode||"show"),s="show"===o,a="hide"===o,l=s||"hide"===o,u=2*(t.times||5)+(l?1:0),c=t.duration/u,h=0,d=n.queue(),p=d.length;for((s||!n.is(":visible"))&&(n.css("opacity",0).show(),h=1),r=1;u>r;r++)n.animate({opacity:h},c,t.easing),h=1-h;n.animate({opacity:h},c,t.easing),n.queue(function(){a&&n.hide(),i()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,u+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var r,n=e(this),o=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(n,t.mode||"effect"),a=t.direction||"left",l=t.distance||20,u=t.times||3,c=2*u+1,h=Math.round(t.duration/c),d="up"===a||"down"===a?"top":"left",p="up"===a||"left"===a,f={},g={},m={},v=n.queue(),y=v.length;for(e.effects.save(n,o),n.show(),e.effects.createWrapper(n),f[d]=(p?"-=":"+=")+l,g[d]=(p?"+=":"-=")+2*l,m[d]=(p?"-=":"+=")+2*l,n.animate(f,h,t.easing),r=1;u>r;r++)n.animate(g,h,t.easing).animate(m,h,t.easing);n.animate(g,h,t.easing).animate(f,h/2,t.easing).queue(function(){"hide"===s&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,c+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var r,n=e(this),o=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(n,t.mode||"show"),a="show"===s,l=t.direction||"left",u="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,h={};e.effects.save(n,o),n.show(),r=t.distance||n["top"===u?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(n).css({overflow:"hidden"}),a&&n.css(u,c?isNaN(r)?"-"+r:-r:r),h[u]=(a?c?"+=":"-=":c?"-=":"+=")+r,n.animate(h,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&n.hide(),e.effects.restore(n,o),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var r=e(this),n=e(t.to),o="fixed"===n.css("position"),s=e("body"),a=o?s.scrollTop():0,l=o?s.scrollLeft():0,u=n.offset(),c={top:u.top-a,left:u.left-l,height:n.innerHeight(),width:n.innerWidth()},h=r.offset(),d=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:h.top-a,left:h.left-l,height:r.innerHeight(),width:r.innerWidth(),position:o?"fixed":"absolute"}).animate(c,t.duration,t.easing,function(){d.remove(),i()})},e.widget("ui.progressbar",{version:"1.11.4",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),void this._refreshValue())},_constrainedValue:function(e){return void 0===e&&(e=this.options.value),this.indeterminate=!1===e,"number"!=typeof e&&(e=0),!this.indeterminate&&Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),"disabled"===e&&this.element.toggleClass("ui-state-disabled",!!t).attr("aria-disabled",t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}}),e.widget("ui.selectable",e.ui.mouse,{version:"1.11.4",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){(t=e(i.options.filter,i.element[0])).addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,r=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(r.filter,this.element[0]),this._trigger("start",t),e(r.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),r.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var r=e.data(this,"selectable-item");r.startselected=!0,t.metaKey||t.ctrlKey||(r.$element.removeClass("ui-selected"),r.selected=!1,r.$element.addClass("ui-unselecting"),r.unselecting=!0,i._trigger("unselecting",t,{unselecting:r.element}))}),e(t.target).parents().addBack().each(function(){var r,n=e.data(this,"selectable-item");return n?(r=!t.metaKey&&!t.ctrlKey||!n.$element.hasClass("ui-selected"),n.$element.removeClass(r?"ui-unselecting":"ui-selected").addClass(r?"ui-selecting":"ui-unselecting"),n.unselecting=!r,n.selecting=r,n.selected=r,r?i._trigger("selecting",t,{selecting:n.element}):i._trigger("unselecting",t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,r=this,n=this.options,o=this.opos[0],s=this.opos[1],a=t.pageX,l=t.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),u=!1;i&&i.element!==r.element[0]&&("touch"===n.tolerance?u=!(i.left>a||o>i.right||i.top>l||s>i.bottom):"fit"===n.tolerance&&(u=i.left>o&&a>i.right&&i.top>s&&l>i.bottom),u?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,r._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),r._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,r._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-unselecting"),r.unselecting=!1,r.startselected=!1,i._trigger("unselected",t,{unselected:r.element})}),e(".ui-selecting",this.element[0]).each(function(){var r=e.data(this,"selectable-item");r.$element.removeClass("ui-selecting").addClass("ui-selected"),r.selecting=!1,r.selected=!0,r.startselected=!0,i._trigger("selected",t,{selected:r.element})}),this._trigger("stop",t),this.helper.remove(),!1}}),e.widget("ui.selectmenu",{version:"1.11.4",defaultElement:"<select>",options:{appendTo:null,disabled:null,icons:{button:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom",collision:"none"},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr("id");this.ids={element:e,button:e+"-button",menu:e+"-menu"},this._drawButton(),this._drawMenu(),this.options.disabled&&this.disable()},_drawButton:function(){var t=this;this.label=e("label[for='"+this.ids.element+"']").attr("for",this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e("<span>",{class:"ui-selectmenu-button ui-widget ui-state-default ui-corner-all",tabindex:this.options.disabled?-1:0,id:this.ids.button,role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":this.ids.menu,"aria-haspopup":"true"}).insertAfter(this.element),e("<span>",{class:"ui-icon "+this.options.icons.button}).prependTo(this.button),this.buttonText=e("<span>",{class:"ui-selectmenu-text"}).appendTo(this.button),this._setText(this.buttonText,this.element.find("option:selected").text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one("focusin",function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e("<ul>",{"aria-hidden":"true","aria-labelledby":this.ids.button,id:this.ids.menu}),this.menuWrap=e("<div>",{class:"ui-selectmenu-menu ui-front"}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:"listbox",select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data("ui-selectmenu-item"),e)},focus:function(e,i){var r=i.item.data("ui-selectmenu-item");null!=t.focusIndex&&r.index!==t.focusIndex&&(t._trigger("focus",e,{item:r}),t.isOpen||t._select(r,e)),t.focusIndex=r.index,t.button.attr("aria-activedescendant",t.menuItems.eq(r.index).attr("id"))}}).menu("instance"),this.menu.addClass("ui-corner-bottom").removeClass("ui-corner-all"),this.menuInstance._off(this.menu,"mouseleave"),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find("option");t.length&&(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find("li").not(".ui-selectmenu-optgroup"),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data("ui-selectmenu-item")),this._setOption("disabled",this.element.prop("disabled")))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(".ui-state-focus").removeClass("ui-state-focus"),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger("open",e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&&(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger("close",e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var r=this,n="";e.each(i,function(i,o){o.optgroup!==n&&(e("<li>",{class:"ui-selectmenu-optgroup ui-menu-divider"+(o.element.parent("optgroup").prop("disabled")?" ui-state-disabled":""),text:o.optgroup}).appendTo(t),n=o.optgroup),r._renderItemData(t,o)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-selectmenu-item",t)},_renderItem:function(t,i){var r=e("<li>");return i.disabled&&r.addClass("ui-state-disabled"),this._setText(r,i.label),r.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html("&#160;")},_move:function(e,t){var i,r,n=".ui-menu-item";this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=":not(.ui-state-disabled)"),(r="first"===e||"last"===e?i["first"===e?"prevAll":"nextAll"](n).eq(-1):i[e+"All"](n).eq(0)).length&&this.menuInstance.focus(t,r)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?"close":"open"](e)},_setSelection:function(){var e;this.range&&(window.getSelection?((e=window.getSelection()).removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&&(e(t.target).closest(".ui-selectmenu-menu, #"+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection()).rangeCount&&(this.range=e.getRangeAt(0)):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&&this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move("prev",t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move("next",t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move("prev",t);break;case e.ui.keyCode.RIGHT:this._move("next",t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move("first",t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move("last",t);break;default:this.menu.trigger(t),i=!1}i&&t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass("ui-state-disabled")||this._select(t.data("ui-selectmenu-item"),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger("select",t,{item:e}),e.index!==i&&this._trigger("change",t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr("id");this.button.attr({"aria-labelledby":t,"aria-activedescendant":t}),this.menu.attr("aria-activedescendant",t)},_setOption:function(e,t){"icons"===e&&this.button.find("span.ui-icon").removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),"appendTo"===e&&this.menuWrap.appendTo(this._appendTo()),"disabled"===e&&(this.menuInstance.option("disabled",t),this.button.toggleClass("ui-state-disabled",t).attr("aria-disabled",t),this.element.prop("disabled",t),t?(this.button.attr("tabindex",-1),this.close()):this.button.attr("tabindex",0)),"width"===e&&this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&&t[0]||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass("ui-corner-top",this.isOpen).toggleClass("ui-corner-all",!this.isOpen).attr("aria-expanded",this.isOpen),this.menuWrap.toggleClass("ui-selectmenu-open",this.isOpen),this.menu.attr("aria-hidden",!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width("").outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop("disabled")}},_parseOptions:function(t){var i=[];t.each(function(t,r){var n=e(r),o=n.parent("optgroup");i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:o.attr("label")||"",disabled:o.prop("disabled")||n.prop("disabled")})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr("for",this.ids.element)}}),e.widget("ui.slider",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget ui-widget-content ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,r=this.options,n=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o=[];for(i=r.values&&r.values.length||1,n.length>i&&(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i>t;t++)o.push("<span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'></span>");this.handles=n.add(e(o.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(!0===t.range&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):(this.range&&this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&&this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,r,n,o,s,a,l,u=this,c=this.options;return!c.disabled&&(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},r=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(r-u.values(t));(n>i||n===i&&(t===u._lastChangedValue||u.values(t)===c.min))&&(n=i,o=e(this),s=t)}),!1!==this._start(t,s)&&(this._mouseSliding=!0,this._handleIndex=s,o.addClass("ui-state-active").focus(),a=o.offset(),l=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-a.left-o.width()/2,top:t.pageY-a.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,r),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,r,n,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),(r=i/t)>1&&(r=1),0>r&&(r=0),"vertical"===this.orientation&&(r=1-r),n=this._valueMax()-this._valueMin(),o=this._valueMin()+r*n,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var r,n,o;this.options.values&&this.options.values.length?(r=this.values(t?0:1),2===this.options.values.length&&!0===this.options.range&&(0===t&&i>r||1===t&&r>i)&&(i=r),i!==this.values(t)&&((n=this.values())[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:n}),r=this.values(t?0:1),!1!==o&&this.values(t,i))):i!==this.value()&&(!1!==(o=this._trigger("slide",e,{handle:this.handles[t],value:i}))&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),void this._change(null,0)):this._value()},values:function(t,i){var r,n,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),void this._change(null,t);if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(r=this.options.values,n=arguments[0],o=0;r.length>o;o+=1)r[o]=this._trimAlignValue(n[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var r,n=0;switch("range"===t&&!0===this.options.range&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(n=this.options.values.length),"disabled"===t&&this.element.toggleClass("ui-state-disabled",!!i),this._super(t,i),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue(),this.handles.css("horizontal"===i?"bottom":"left","");break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),r=0;n>r;r+=1)this._change(null,r);this._animateOff=!1;break;case"step":case"min":case"max":this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return this._trimAlignValue(e)},_values:function(e){var t,i,r;if(arguments.length)return t=this.options.values[e],this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),r=0;i.length>r;r+=1)i[r]=this._trimAlignValue(i[r]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()>=e)return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,r=e-i;return 2*Math.abs(i)>=t&&(r+=i>0?t:-t),parseFloat(r.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step;e=Math.floor(+(e-t).toFixed(this._precision())/i)*i+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,r,n,o,s=this.options.range,a=this.options,l=this,u=!this._animateOff&&a.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(r){i=(l.values(r)-l._valueMin())/(l._valueMax()-l._valueMin())*100,c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[u?"animate":"css"](c,a.animate),!0===l.options.range&&("horizontal"===l.orientation?(0===r&&l.range.stop(1,1)[u?"animate":"css"]({left:i+"%"},a.animate),1===r&&l.range[u?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===r&&l.range.stop(1,1)[u?"animate":"css"]({bottom:i+"%"},a.animate),1===r&&l.range[u?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(r=this.value(),n=this._valueMin(),o=this._valueMax(),i=o!==n?(r-n)/(o-n)*100:0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[u?"animate":"css"](c,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[u?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[u?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[u?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(t){var i,r,n,o=e(t.target).data("ui-slider-handle-index");switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(t.target).addClass("ui-state-active"),!1===this._start(t,o)))return}switch(n=this.options.step,i=r=this.options.values&&this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:r=this._valueMin();break;case e.ui.keyCode.END:r=this._valueMax();break;case e.ui.keyCode.PAGE_UP:r=this._trimAlignValue(i+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:r=this._trimAlignValue(i-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(i===this._valueMax())return;r=this._trimAlignValue(i+n);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i===this._valueMin())return;r=this._trimAlignValue(i-n)}this._slide(t,o,r)},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}}),e.widget("ui.sortable",e.ui.mouse,{version:"1.11.4",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e>=t&&t+i>e},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_create:function(){this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),"handle"===e&&this._setHandleClassName()},_setHandleClassName:function(){this.element.find(".ui-sortable-handle").removeClass("ui-sortable-handle"),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass("ui-sortable-handle")})},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled").find(".ui-sortable-handle").removeClass("ui-sortable-handle"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_mouseCapture:function(t,i){var r=null,n=!1,o=this;return!this.reverting&&(!this.options.disabled&&"static"!==this.options.type&&(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,o.widgetName+"-item")===o?(r=e(this),!1):void 0}),e.data(t.target,o.widgetName+"-item")===o&&(r=e(t.target)),!!r&&(!(this.options.handle&&!i&&(e(this.options.handle,r).find("*").addBack().each(function(){this===t.target&&(n=!0)}),!n))&&(this.currentItem=r,this._removeCurrentsFromItems(),!0))))},_mouseStart:function(t,i,r){var n,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!r)for(n=this.containers.length-1;n>=0;n--)this.containers[n]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,r,n,o,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==this.document[0]&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-this.document.scrollTop()<s.scrollSensitivity?a=this.document.scrollTop(this.document.scrollTop()-s.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())<s.scrollSensitivity&&(a=this.document.scrollTop(this.document.scrollTop()+s.scrollSpeed)),t.pageX-this.document.scrollLeft()<s.scrollSensitivity?a=this.document.scrollLeft(this.document.scrollLeft()-s.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())<s.scrollSensitivity&&(a=this.document.scrollLeft(this.document.scrollLeft()+s.scrollSpeed))),!1!==a&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=(r=this.items[i]).item[0],(o=this._intersectsWithPointer(r))&&r.instance===this.currentContainer&&n!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==n&&!e.contains(this.placeholder[0],n)&&("semi-dynamic"!==this.options.type||!e.contains(this.element[0],n))){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(r))break;this._rearrange(t,r),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var r=this,n=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){r._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&r.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!r.length&&t.key&&r.push(t.key+"="),r.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),r=[];return t=t||{},i.each(function(){r.push(e(t.item||this).attr(t.attribute||"id")||"")}),r},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,r=this.positionAbs.top,n=r+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,u=this.offset.click.top,c=this.offset.click.left,h="x"===this.options.axis||r+u>a&&l>r+u,d="y"===this.options.axis||t+c>o&&s>t+c,p=h&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:t+this.helperProportions.width/2>o&&s>i-this.helperProportions.width/2&&r+this.helperProportions.height/2>a&&l>n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t="x"===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i="y"===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=t&&i,n=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return!!r&&(this.floating?o&&"right"===o||"down"===n?2:1:n&&("down"===n?2:1))},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&&n?"right"===n&&i||"left"===n&&!i:r&&("down"===r&&t||"up"===r&&!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){a.push(this)}var r,n,o,s,a=[],l=[],u=this._connectWith();if(u&&t)for(r=u.length-1;r>=0;r--)for(n=(o=e(u[r],this.document[0])).length-1;n>=0;n--)(s=e.data(o[n],this.widgetFullName))&&s!==this&&!s.options.disabled&&l.push([e.isFunction(s.options.items)?s.options.items.call(s.element):e(s.options.items,s.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),s]);for(l.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),r=l.length-1;r>=0;r--)l[r][0].each(i);return e(a)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;t.length>i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,r,n,o,s,a,l,u,c=this.items,h=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(r=(n=e(d[i],this.document[0])).length-1;r>=0;r--)(o=e.data(n[r],this.widgetFullName))&&o!==this&&!o.options.disabled&&(h.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=h.length-1;i>=0;i--)for(s=h[i][1],r=0,u=(a=h[i][0]).length;u>r;r++)(l=e(a[r])).data(this.widgetName+"-item",s),c.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){var i,r,n,o;for(this.floating=!!this.items.length&&("x"===this.options.axis||this._isFloating(this.items[0].item)),this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset()),i=this.items.length-1;i>=0;i--)(r=this.items[i]).instance!==this.currentContainer&&this.currentContainer&&r.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,r.item):r.item,t||(r.width=n.outerWidth(),r.height=n.outerHeight()),o=n.offset(),r.left=o.left,r.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){var i,r=(t=t||this).options;r.placeholder&&r.placeholder.constructor!==String||(i=r.placeholder,r.placeholder={element:function(){var r=t.currentItem[0].nodeName.toLowerCase(),n=e("<"+r+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tbody"===r?t._createTrPlaceholder(t.currentItem.find("tr").eq(0),e("<tr>",t.document[0]).appendTo(n)):"tr"===r?t._createTrPlaceholder(t.currentItem,n):"img"===r&&n.attr("src",t.currentItem.attr("src")),i||n.css("visibility","hidden"),n},update:function(e,n){(!i||r.forcePlaceholderSize)&&(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(r.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),r.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var r=this;t.children().each(function(){e("<td>&#160;</td>",r.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(i)})},_contactContainers:function(t){var i,r,n,o,s,a,l,u,c,h,d=null,p=null;for(i=this.containers.length-1;i>=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(d&&e.contains(this.containers[i].element[0],d.element[0]))continue;d=this.containers[i],p=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(d)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,o=null,s=(c=d.floating||this._isFloating(this.currentItem))?"left":"top",a=c?"width":"height",h=c?"clientX":"clientY",r=this.items.length-1;r>=0;r--)e.contains(this.containers[p].element[0],this.items[r].item[0])&&this.items[r].item[0]!==this.currentItem[0]&&(l=this.items[r].item.offset()[s],u=!1,t[h]-l>this.items[r][a]/2&&(u=!0),n>Math.abs(t[h]-l)&&(n=Math.abs(t[h]-l),o=this.items[r],this.direction=u?"up":"down"));if(!o&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return void(this.currentContainer.containerCache.over||(this.containers[p]._trigger("over",t,this._uiHash()),this.currentContainer.containerCache.over=1));o?this._rearrange(t,o,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger("change",t,this._uiHash()),this.containers[p]._trigger("change",t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger("over",t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,r=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return r.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(r[0]),r[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!r[0].style.width||i.forceHelperSize)&&r.width(this.currentItem.width()),(!r[0].style.height||i.forceHelperSize)&&r.height(this.currentItem.height()),r},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,r,n=this.options;"parent"===n.containment&&(n.containment=this.helper[0].parentNode),("document"===n.containment||"window"===n.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,"document"===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,("document"===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),r="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(r?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(r?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var r="absolute"===t?1:-1,n="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*r+this.offset.parent.top*r-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:n.scrollTop())*r,left:i.left+this.offset.relative.left*r+this.offset.parent.left*r-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:n.scrollLeft())*r}},_generatePosition:function(t){var i,r,n=this.options,o=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==this.document[0]&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),n.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/n.grid[1])*n.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,r=this.originalPageX+Math.round((o-this.originalPageX)/n.grid[0])*n.grid[0],o=this.containment?r-this.offset.click.left>=this.containment[0]&&r-this.offset.click.left<=this.containment[2]?r:r-this.offset.click.left>=this.containment[0]?r-n.grid[0]:r+n.grid[0]:r)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,r){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&&this.refreshPositions(!r)})},_clear:function(e,t){function i(e,t,i){return function(r){i._trigger(e,r,t._uiHash(t))}}this.reverting=!1;var r,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(r in this._storedCSS)("auto"===this._storedCSS[r]||"static"===this._storedCSS[r])&&(this._storedCSS[r]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),r=this.containers.length-1;r>=0;r--)t||n.push(i("deactivate",this,this.containers[r])),this.containers[r].containerCache.over&&(n.push(i("out",this,this.containers[r])),this.containers[r].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null),!t){for(r=0;n.length>r;r++)n[r].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){!1===e.Widget.prototype._trigger.apply(this,arguments)&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget("ui.spinner",{version:"1.11.4",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,r){var n=i.attr(r);void 0!==n&&n.length&&(t[r]=n)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?void delete this.cancelBlur:(this._stop(),this._refresh(),void(this.previous!==this.element.val()&&this._trigger("change",e)))},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){this.element[0]===this.document[0].activeElement||(this.element.focus(),this.previous=r,this._delay(function(){this.previous=r}))}var r;r=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,r=e.ui.keyCode;switch(t.keyCode){case r.UP:return this._repeat(null,1,t),!0;case r.DOWN:return this._repeat(null,-1,t),!0;case r.PAGE_UP:return this._repeat(null,i.page,t),!0;case r.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span></a><a class='ui-spinner-button ui-spinner-down ui-corner-br'><span class='ui-icon "+this.options.icons.down+"'>&#9660;</span></a>"},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=""+e,i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,r=this.options;return i=e-(t=null!==r.min?r.min:0),e=t+(i=Math.round(i/r.step)*r.step),e=parseFloat(e.toFixed(this._precision())),null!==r.max&&e>r.max?r.max:null!==r.min&&r.min>e?r.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,void this.element.val(this._format(i))}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(this.widget().toggleClass("ui-state-disabled",!!t),this.element.prop("disabled",!!t),this.buttons.button(t?"disable":"enable"))},_setOptions:a(function(e){this._super(e)}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&(null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:a(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:a(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:a(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:a(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?void a(this._value).call(this,e):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget("ui.tabs",{version:"1.11.4",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,r;i=(t=t.cloneNode(!1)).href.replace(e,""),r=location.href.replace(e,"");try{i=decodeURIComponent(i)}catch(e){}try{r=decodeURIComponent(r)}catch(e){}return t.hash.length>1&&i===r}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=!1!==this.options.active&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,r=location.hash.substring(1);return null===t&&(r&&this.tabs.each(function(i,n){return e(n).attr("aria-controls")===r?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=!!this.tabs.length&&0)),!1!==t&&(-1===(t=this.tabs.index(this.tabs.eq(t)))&&(t=!i&&0)),!i&&!1===t&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),r=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:r++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,r--;break;case e.ui.keyCode.END:r=this.anchors.length-1;break;case e.ui.keyCode.HOME:r=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r);case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),void this._activate(r!==this.options.active&&r);default:return}t.preventDefault(),clearTimeout(this.activating),r=this._focusNextTab(r,n),t.ctrlKey||t.metaKey||(i.attr("aria-selected","false"),this.tabs.eq(r).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",r)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){for(var r=this.tabs.length-1;-1!==e.inArray((t>r&&(t=0),0>t&&(t=r),t),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?void this._activate(t):"disabled"===e?void this._setupDisabled(t):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||!1!==this.options.active||this._activate(0)),"event"===e&&this._setupEvents(t),void("heightStyle"===e&&this._setupHeightStyle(t)))},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),!1!==t.active&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false","aria-expanded":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this,i=this.tabs,r=this.anchors,n=this.panels;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist").delegate("> li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,r){var n,o,s,a=e(r).uniqueId().attr("id"),l=e(r).closest("li"),u=l.attr("aria-controls");t._isLocal(r)?(s=(n=r.hash).substring(1),o=t.element.find(t._sanitizeSelector(n))):(n="#"+(s=l.attr("aria-controls")||e({}).uniqueId()[0].id),(o=t.element.find(n)).length||(o=t._createPanel(s)).insertAfter(t.panels[i-1]||t.tablist),o.attr("aria-live","polite")),o.length&&(t.panels=t.panels.add(o)),u&&l.data("ui-tabs-aria-controls",u),l.attr({"aria-controls":s,"aria-labelledby":a}),o.attr("aria-labelledby",a)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel"),i&&(this._off(i.not(this.tabs)),this._off(r.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,r=0;i=this.tabs[r];r++)!0===t||-1!==e.inArray(r,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,r=this.element.parent();"fill"===t?(i=r.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),r=t.css("position");"absolute"!==r&&"fixed"!==r&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,r=this.active,n=e(t.currentTarget).closest("li"),o=n[0]===r[0],s=o&&i.collapsible,a=s?e():this._getPanelForTab(n),l=r.length?this._getPanelForTab(r):e(),u={oldTab:r,oldPanel:l,newTab:s?e():n,newPanel:a};t.preventDefault(),n.hasClass("ui-state-disabled")||n.hasClass("ui-tabs-loading")||this.running||o&&!i.collapsible||!1===this._trigger("beforeActivate",t,u)||(i.active=!s&&this.tabs.index(n),this.active=o?e():n,this.xhr&&this.xhr.abort(),l.length||a.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),a.length&&this.load(this.tabs.index(n),t),this._toggle(t,u))},_toggle:function(t,i){function r(){o.running=!1,o._trigger("activate",t,i)}function n(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,r):(s.show(),r())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),n()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),n()),a.attr("aria-hidden","true"),i.oldTab.attr({"aria-selected":"false","aria-expanded":"false"}),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr("aria-hidden","false"),i.newTab.attr({"aria-selected":"true","aria-expanded":"true",tabIndex:0})},_activate:function(t){var i,r=this._findActive(t);r[0]!==this.active[0]&&(r.length||(r=this.active),i=r.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return!1===t?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(t){var i=this.options.disabled;!1!==i&&(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(!0!==i){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var r=this,n=this.tabs.eq(t),o=n.find(".ui-tabs-anchor"),s=this._getPanelForTab(n),a={tab:n,panel:s},l=function(e,t){"abort"===t&&r.panels.stop(!1,!0),n.removeClass("ui-tabs-loading"),s.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr};this._isLocal(o[0])||(this.xhr=e.ajax(this._ajaxSettings(o,i,a)),this.xhr&&"canceled"!==this.xhr.statusText&&(n.addClass("ui-tabs-loading"),s.attr("aria-busy","true"),this.xhr.done(function(e,t,n){setTimeout(function(){s.html(e),r._trigger("load",i,a),l(n,t)},1)}).fail(function(e,t){setTimeout(function(){l(e,t)},1)})))},_ajaxSettings:function(t,i,r){var n=this;return{url:t.attr("href"),beforeSend:function(t,o){return n._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},r))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}}),e.widget("ui.tooltip",{version:"1.11.4",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var r=(t.attr("aria-describedby")||"").split(/\s+/);r.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(r.join(" ")))},_removeDescribedBy:function(t){var i=t.data("ui-tooltip-id"),r=(t.attr("aria-describedby")||"").split(/\s+/),n=e.inArray(i,r);-1!==n&&r.splice(n,1),t.removeData("ui-tooltip-id"),(r=e.trim(r.join(" ")))?t.attr("aria-describedby",r):t.removeAttr("aria-describedby")},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable(),this.liveRegion=e("<div>").attr({role:"log","aria-live":"assertive","aria-relevant":"additions"}).addClass("ui-helper-hidden-accessible").appendTo(this.document[0].body)},_setOption:function(t,i){var r=this;return"disabled"===t?(this[i?"_disable":"_enable"](),void(this.options[t]=i)):(this._super(t,i),void("content"===t&&e.each(this.tooltips,function(e,t){r._updateContent(t.element)})))},_disable:function(){var t=this;e.each(this.tooltips,function(i,r){var n=e.Event("blur");n.target=n.currentTarget=r.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).removeAttr("title")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,r=e(t?t.target:this.element).closest(this.options.items);r.length&&!r.data("ui-tooltip-id")&&(r.attr("title")&&r.data("ui-tooltip-title",r.attr("title")),r.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&r.parents().each(function(){var t,r=e(this);r.data("ui-tooltip-open")&&((t=e.Event("blur")).target=t.currentTarget=this,i.close(t,!0)),r.attr("title")&&(r.uniqueId(),i.parents[this.id]={element:this,title:r.attr("title")},r.attr("title",""))}),this._registerCloseHandlers(t,r),this._updateContent(r,t))},_updateContent:function(e,t){var i,r=this.options.content,n=this,o=t?t.type:null;return"string"==typeof r?this._open(t,e,r):void((i=r.call(e[0],function(i){n._delay(function(){e.data("ui-tooltip-open")&&(t&&(t.type=o),this._open(t,e,i))})}))&&this._open(t,e,i))},_open:function(t,i,r){function n(e){u.of=e,s.is(":hidden")||s.position(u)}var o,s,a,l,u=e.extend({},this.options.position);if(r){if(o=this._find(i))return void o.tooltip.find(".ui-tooltip-content").html(r);i.is("[title]")&&(t&&"mouseover"===t.type?i.attr("title",""):i.removeAttr("title")),o=this._tooltip(i),s=o.tooltip,this._addDescribedBy(i,s.attr("id")),s.find(".ui-tooltip-content").html(r),this.liveRegion.children().hide(),r.clone?(l=r.clone()).removeAttr("id").find("[id]").removeAttr("id"):l=r,e("<div>").html(l).appendTo(this.liveRegion),this.options.track&&t&&/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):s.position(e.extend({of:i},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(a=this.delayedShow=setInterval(function(){s.is(":visible")&&(n(u.of),clearInterval(a))},e.fx.interval)),this._trigger("open",t,{tooltip:s})}},_registerCloseHandlers:function(t,i){var r={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var r=e.Event(t);r.currentTarget=i[0],this.close(r,!0)}}};i[0]!==this.element[0]&&(r.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&&"mouseover"!==t.type||(r.mouseleave="close"),t&&"focusin"!==t.type||(r.focusout="close"),this._on(!0,i,r)},close:function(t){var i,r=this,n=e(t?t.currentTarget:this.element),o=this._find(n);return o?(i=o.tooltip,void(o.closing||(clearInterval(this.delayedShow),n.data("ui-tooltip-title")&&!n.attr("title")&&n.attr("title",n.data("ui-tooltip-title")),this._removeDescribedBy(n),o.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){r._removeTooltip(e(this))}),n.removeData("ui-tooltip-open"),this._off(n,"mouseleave focusout keyup"),n[0]!==this.element[0]&&this._off(n,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete r.parents[t]}),o.closing=!0,this._trigger("close",t,{tooltip:i}),o.hiding||(o.closing=!1)))):void n.removeData("ui-tooltip-open")},_tooltip:function(t){var i=e("<div>").attr("role","tooltip").addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||"")),r=i.uniqueId().attr("id");return e("<div>").addClass("ui-tooltip-content").appendTo(i),i.appendTo(this.document[0].body),this.tooltips[r]={element:t,tooltip:i}},_find:function(e){var t=e.data("ui-tooltip-id");return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,r){var n=e.Event("blur"),o=r.element;n.target=n.currentTarget=o[0],t.close(n,!0),e("#"+i).remove(),o.data("ui-tooltip-title")&&(o.attr("title")||o.attr("title",o.data("ui-tooltip-title")),o.removeData("ui-tooltip-title"))}),this.liveRegion.remove()}})}),r("gw/Gui/dialog/ErrorDialog",["../../Utils/Constants","jquery","jquery.ui"],function(e,t){var i=!1,r="",n="",o=t('<div id="errorDiv" style="text-align: left" title="Error"></div>').appendTo("body").dialog({autoOpen:!1,width:500,minHeight:300,maxHeight:500,dialogClass:"errorBox",beforeClose:function(e,t){r=""}}),s=!1,a=function(e){r+=e+"<br/>",t("#warningContainer")&&(t("#warningContainer").show(),o.on("dialogclose",function(e){n&&n.hide()})),!0===s&&(o.html(r).dialog("open"),o.scrollTop(5e3))},l=function(e,t){return null!=t&&null!=e&&(e+=" - <font style='color:white'>","string"==typeof t?e+=t:t.message?e+=t.message:e+=JSON.stringify(t),e+="</font>"),e},u=function(e,t){return null!=t&&null!=e&&(e="string"==typeof t?e+":"+t:t.message?e+":"+t.message:e+":"+JSON.stringify(t)),e};return{open:function(t,r,n){var o,s="";if(t===e.LEVEL.WARNING)s=s+"<font style='color:orange'>Warning : "+r+"</font>",o=u(r,n),i&&console.warn(o),a(l(s,n));else if(t===e.LEVEL.ERROR)s=s+"<font style='color:red'>Error : "+r+"</font>",function(e){i&&console.error(e)}(u(r,n)),a(l(s,n));else{if(t!==e.LEVEL.DEBUG)throw new TypeError("LEVEL must be set with a valid value","ErrorDialog.js");!function(e){i&&console.log(e)}(u(r,n))}},view:function(){o.html(r).dialog("open"),o.scrollTop(5e3),s=!0},hide:function(){o.dialog("close"),s=!1},isActive:function(){return s},setIcon:function(e){n=t(e)},hasError:function(){return r.length>0},getTxt:function(){return r},setDebug:function(e){i=e}}}),r("gw/Tiling/HEALPixBase",["underscore-min","./HEALPixTables","../Utils/Long","../Utils/CircleFinder","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s=.5*Math.PI,a=function(e){return t.utab[255&e]|t.utab[e>>>8&255]<<16|t.utab[e>>>16&255]<<32|t.utab[e>>>24&255]<<48},l=function(e,t,i,r){return(i<<2*r)+a(e)+(a(t)<<1)},u=function(e){this.p=new Array(e),this.o=new Array(e);for(var t=0;t<this.p.length;t++)this.p[t]=0,this.o[t]=0;this.s=this.m=0};u.prototype.push=function(e,t){this.p[this.s]=e,this.o[this.s]=t,++this.s},u.prototype.otop=function(){return this.o[this.s-1]},u.prototype.ptop=function(){return this.p[this.s-1]},u.prototype.pop=function(){this.s--},u.prototype.popToMark=function(){this.s=this.m},u.prototype.mark=function(){this.m=this.s},u.prototype.size=function(){return this.s};var c={init:function(e){this.order_max=29,this.bn=[],this.nside=null;try{for(var t=0;t<=this.order_max;++t)this.bn[t]=this.createBoundaries(1<<t,"NESTED")}catch(e){}},createBoundaries:function(e,t){return this.nside=e-1,this.calculateBoundaries(e,t)},compress_bits:function(e){var r=i.fromNumber(e),n=i.fromNumber(0x5555555555555),o=r.and(n),s=o.shiftRightUnsigned(15),a=(o=o.or(s)).and(i.fromNumber(65535)).toInt(),l=o.shiftRightUnsigned(32).and(i.fromNumber(65535)).toInt();return t.ctab[255&a]|t.ctab[a>>>8]<<4|t.ctab[255&l]<<16|t.ctab[l>>>8]<<20},fxyf:function(e,i,r){var n,o,a,l=t.jrll[r]-e-i,u=0,c=0,h=!1;l<1?(u=1-(a=(o=l)*o/3))>.99&&(c=Math.sqrt(a*(2-a)),h=!0):l>3?(u=(a=(o=4-l)*o/3)-1)<-.99&&(c=Math.sqrt(a*(2-a)),h=!0):(o=1,u=2*(2-l)/3),(a=t.jpll[r]*o+e-i)<0&&(a+=8),a>=8&&(a-=8),n=o<1e-15?0:.5*s*a/o;var d=h?c:Math.sqrt((1-u)*(1+u));return[d*Math.cos(n),d*Math.sin(n),u]},maxPixrad:function(e,t){var i=Math.pow(2,e),r=vec3.createZPhi(2/3,Math.PI/t),n=1-1/i;n*=n;var o=vec3.createZPhi(1-n/3,0);return vec3.angle2(r,o)},pix2vec:function(e,t){var i=this.pix2loc(e,t),r=i.have_sth?i.sth:Math.sqrt((1-i.z)*(1+i.z));return vec3.createFrom(r*Math.cos(i.phi),r*Math.sin(i.phi),i.z)},pix2loc:function(e,i){var r,n,o={phi:null,sth:0,have_sth:!1,z:null},a=this.nest2xyf(e,i.npface,i.order),l=(t.jrll[a.face]<<i.order)-a.ix-a.iy-1;return l<i.nside?(n=(r=l)*r*i.fact2,o.z=1-n,o.z>.99&&(o.sth=Math.sqrt(n*(2-n)),o.have_sth=!0)):l>i.nl3?(n=(r=i.nl4-l)*r*i.fact2,o.z=n-1,o.z<-.99&&(o.sth=Math.sqrt(n*(2-n)),o.have_sth=!0)):(r=i.nside,o.z=(i.nl2-l)*i.fact1),(n=t.jpll[a.face]*r+a.ix-a.iy)<0&&(n+=8*r),o.phi=r===i.nside?.75*s*n*i.fact1:.5*s*n/r,o},nest2xyf:function(e,t,i){var r=e&t-1;return{ix:c.compress_bits(r),iy:c.compress_bits(r>>>1),face:e>>>2*i}},nside2order:function(e){for(var t=0;e>65535;)t+=16,e>>>=16;return e>255&&(t|=8,e>>>=8),e>15&&(t|=4,e>>>=4),e>3&&(t|=2,e>>>=2),e>1&&(t|=1),t},calculateBoundaries:function(e,t){if(this.nside!==e){this.nside=e;var i=this.nside2order(e);if("NESTED"===t&&i<0)throw new Error("Nside must be a power of 2 for NESTED scheme");var r=2*this.nside,n=3*this.nside,o=4*this.nside,s=this.nside*this.nside,a=2*this.nside*(this.nside-1),l=12*s,u=4/l,c=(this.nside<<1)*u;return{order:i,nside:this.nside,scheme:t,nl2:r,nl3:n,nl4:o,npface:s,ncap:a,npix:l,fact1:c,fact2:u}}},convertPolygonToHealpixOrder:function(t,i,r){var n=[],o=i||4,s=r||5;return e.each(t,function(e){var t=Math.PI/180,i=Math.cos(e[1]*t),r=Math.cos(e[0]*t)*i,o=Math.sin(e[0]*t)*i,s=Math.sin(e[1]*t),a=Math.atan2(Math.sqrt(r*r+o*o),s),l=Math.atan2(o,r);l<0&&(l+=2*Math.PI),l>=2*Math.PI&&(l-=2*Math.PI),n.push({theta:a,phi:l})}),this.queryPolygonInclusive(n,o,s)},queryPolygonInclusive:function(e,t,i){Math.PI=3.141592653589793;var s=Math.PI/2,a=0!==t,l=e.length,u=a?l+1:l;if(!(l<3)){var c,h=new Array(l);for(c=0;c<l;++c)h[c]=vec3.createPhiTheta(e[c].phi,e[c].theta);var d=new Array(u),p=0;for(c=0;c<l;++c){d[c]=vec3.cross2(h[c],h[(c+1)%l]);var f=vec3.dot2(d[c],h[(c+2)%l]);0===c&&(p=f<0?-1:1),d[c]=vec3.scale2(d[c],p/vec3.length2(d[c]))}var g=new Array(u);if(this.fill(g,s),a){var m=new r(h);d[l]=m.getCenter(),g[l]=Math.acos(m.getCosRad())}var v=this.queryMultiDisc(d,g,t,i);return o.open(n.LEVEL.DEBUG,"HEALPixBase.js",v),v}o.open(n.LEVEL.DEBUG,"HEALPixBase.js","not enough vertices in polygon")},fill:function(e,t){for(var i=0,r=e.length;i<r;i++)e[i]=t},queryMultiDisc:function(e,t,i,r){var n=r,o=0!==i,s=e.length,a=[],l=0;o&&(l=this.ilog2(i));for(var h,d=n+l,p=new Array(d+1),f=0;f<d+1;f++){p[f]=new Array(s);for(var g=0;g<s;g++)p[f][g]=new Array(3)}var m,v={order:n};for(c.init(v),m=0;m<=d;++m){h=c.bn[m];var y=c.maxPixrad(m,h.nl4);for(f=0;f<s;++f)p[m][f][0]=t[f]+y>Math.PI?-1:Math.cos(t[f]+y),p[m][f][1]=0===m?Math.cos(t[f]):p[0][f][1],p[m][f][2]=t[f]-y<0?1:Math.cos(t[f]-y)}var b=new u(12+3*d);for(f=0;f<12;f++)b.push(11-f,0);for(;b.size()>0;){var x=b.ptop();m=b.otop(),b.pop(),h=c.bn[m];var w=c.pix2vec(x,h),T=3;for(f=0;f<s&&T>0;++f)for(var _=vec3.dot2(w,e[f]),C=0;C<T;++C)_<p[m][f][C]&&(T=C);T>0&&this.check_pixel(m,d,T,a,x,b,o,r)}return a},check_pixel:function(e,t,i,r,n,o,s,a){var l,u=a;if(0!==i)if(e<u)if(i>=3){var c=2*(u-e),h=n+1<<c;for(l=n<<c;l<=h;l++)r.push(l)}else for(l=0;l<4;++l)o.push(4*n+3-l,e+1);else if(e>u)if(i>=2)r.push(n>>>2*(e-u)),o.popToMark();else if(e<t)for(l=0;l<4;++l)o.push(4*n+3-l,e+1);else r.push(n>>>2*(e-u)),o.popToMark();else if(i>=2)r.push(n);else if(s)if(u<t)for(o.mark(),l=0;l<4;++l)o.push(4*n+3-l,e+1);else r.push(n)},ilog2:function(e){for(var t=0;e>65535;)t+=16,e>>>=16;return e>255&&(t|=8,e>>>=8),e>15&&(t|=4,e>>>=4),e>3&&(t|=2,e>>>=2),e>1&&(t|=1),t},lonLat2pix:function(e,t,r){var n=function(e,t){return e<0&&(e+=360),[e*Math.PI/180,(90-t)*Math.PI/180]}(t,r);return function(e,t,r){var n=Math.pow(2,e),o=Math.cos(r),s={phi:t,theta:r,z:o};Math.abs(o)>.9&&(s.sth=Math.sin(r),s.have_sth=!0);var a,u,c,h=function(e,t){if(e>=0)return e<t?e:e%t;var i=e%t+t;return i===t?0:i}(t*(2/Math.PI),4),d=Math.abs(o);if(d<=2/3){var p=n*(.5+h),f=n*(.75*o);a=i.fromNumber(p-f),u=i.fromNumber(p+f);var g,m=a.shiftRightUnsigned(e),v=u.shiftRightUnsigned(e);g=m.equals(v)?m.or(i.fromInt(4)):m.lessThan(v)?m:v.add(i.fromInt(8)),c=i.fromNumber(n-1);var y=u.and(c),b=c.subtract(a.and(c));return l(y.toInt(),b.toInt(),g.toInt(),e)}var x=parseInt(Math.min(3,parseInt(h,10)),10),w=h-x,T=d<.9||!s.have_sth?n*Math.sqrt(3*(1-d)):n*s.sth/Math.sqrt((1+d)/3);a=i.fromNumber(w*T),u=i.fromNumber((1-w)*T);var _=i.fromNumber(n);c=i.fromNumber(n-1);var C=i.fromInt(1);return a.greaterThanOrEqual(_)&&(a=c),u.greaterThanOrEqual(_)&&(u=c),o>=0?l(_.subtract(u).subtract(C).toInt(),_.subtract(a).subtract(C).toInt(),x,e):l(a.toInt(),u.toInt(),x+8,e)}(e,n[0],n[1])},getChildren:function(e){return[4*e,4*e+1,4*e+2,4*e+3]},uniq2hpix:function(e,t){null==t&&(t=[]),t[0]=c.log2(e/4)/2;var i=c.pow2(t[0]);return t[1]=e-4*i*i,t[0]=parseInt(t[0],10),t},log2:function(e){for(var t=0;e>>>++t>0;);return--t},pow2:function(e){return 1<<e},getPixRes:function(e){return 648e3/Math.PI*Math.sqrt(4*Math.PI/(12*e*e))}};return c}),r("gw/Utils/UtilsIntersection",["./Numeric","./Constants","../Tiling/HEALPixBase"],function(e,t,i){var r={};function n(e){var t=e[0]*Math.PI/180,i=e[1]*Math.PI/180;return[Math.cos(i)*Math.cos(t),Math.cos(i)*Math.sin(t),Math.sin(i)]}return r.convertPolygonToHealpixOrder=function(e,t,r){return i.convertPolygonToHealpixOrder(e,t,r)},r.pointInLine=function(e,t,i){var r,n,o,s=i[0]-t[0];return(0===s?e[0]===t[0]:(n=(e[0]-t[0])/s)>=0&&n<=1)?(r=i[1]-t[1],o=0===s?e[1]===t[1]:(n=(e[1]-t[1])/r)>=0&&n<=1):o=!1,o},r.pointInSphere=function(e,t,i,r){var n=[],o=[],s=e.getRenderContext().computePixelSizeVector();e.getCoordinateSystem().get3DFromWorld(t,n),e.getCoordinateSystem().get3DFromWorld(i,o);var a=r*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]+s[3]),l=[];return vec3.subtract(n,o,l),(l=vec3.dot(l,l))<a*a},r.pointInRing=function(t,i){for(var r,o,s,a,l,u,c,h,d,p,f,g,m=i.length,v=0,y=n(t),b=n([t[0],t[1]+90]),x=0;x<m-1;x++)r=n(i[x]),o=n(i[x+1]),s=y,a=b,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,l=vec3.cross(r,o,[]),u=vec3.cross(s,a,[]),c=vec3.normalize(vec3.cross(l,u,[])),h=vec3.dot(vec3.cross(r,l,[]),c),d=vec3.dot(vec3.cross(o,l,[]),c),p=vec3.dot(vec3.cross(s,u,[]),c),f=vec3.dot(vec3.cross(a,u,[]),c),g=e.sign(-h)+e.sign(d)+e.sign(-p)+e.sign(f),4===Math.abs(g)&&v++;return v%2==1},r.isValueBetween=function(e,t,i){return t<=e&&e<=i},r.boundsIntersects=function(e,t){if(null===e||null===t)return!1;if(null==e.north||null==t.north)return!1;var i=r.isValueBetween(e.west,t.west,t.east)||r.isValueBetween(e.east,t.west,t.east)||e.west<=t.west&&e.east>=t.east,n=r.isValueBetween(e.north,t.south,t.north)||r.isValueBetween(e.south,t.south,t.north)||e.south<=t.south&&e.north>=t.north;return i&&n},r.tileIntersectHealpixTile=function(e,t){if(null===e||null===t)return!1;var i;if(e.level===t.level)i=e.pixelIndex===t.pixelIndex;else if(e.level>t.level){var r=e.level-t.level;i=e.pixelIndex>>Math.pow(2,r)===t.pixelIndex}else r=t.level-e.level,i=t.pixelIndex>>Math.pow(2,r)===e.pixelIndex;return i},r.tileIntersectGeoTile=function(e,t){if(null===e||null===t)return!1;var i;if(e.level===t.level)i=e.x===t.x&&e.y===t.y;else if(e.level>t.level){var n=e.level-t.level,o=Math.pow(2,n)*t.x,s=Math.pow(2,n)*(t.x+1)-1,a=Math.pow(2,n)*t.y,l=Math.pow(2,n)*(t.y+1)-1;i=r.isValueBetween(e.x,o,s)&&r.isValueBetween(e.y,a,l)}else n=t.level-e.level,o=Math.pow(2,n)*e.x,s=Math.pow(2,n)*(e.x+1)-1,a=Math.pow(2,n)*e.y,l=Math.pow(2,n)*(e.y+1)-1,i=r.isValueBetween(t.x,o,s)&&r.isValueBetween(t.y,a,l);return i},r.tileIntersect=function(e,i){if(null===e||null===i)return!1;var n;if(e.type===t.TILE.GEO_TILE||e.type===t.TILE.MERCATOR_TILE)n=r.tileIntersectGeoTile(e,i);else{if(e.type!==t.TILE.HEALPIX_TILE)throw new"Unknown tiling";n=r.tileIntersectHealpixTile(e,i)}return n},r.tileIntersects=function(e,t){if(null===e||null===t)return!1;for(var i=!1,n=0;n<t.length&&!i;n++){var o=t[n];i=r.tileIntersect(e,o)}return i},r.isCrossDateLine=function(e,t){return Math.abs(e-t)>180},r.isInBillboard=function(e,t,i,r){if(!t._bucket||!t._bucket.renderer)return!1;const n=function(e){var t=vec3.create();const i=l.viewMatrix,r=l.projectionMatrix,n=mat4.create();mat4.multiply(r,i,n);const o=[e[0],e[1],e[2],1];mat4.project(n,o,t);const s=l.canvas.clientWidth,a=l.canvas.clientHeight;return t[0]=.5*(t[0]+1)*s,t[1]=.5*(1-t[1])*a,t},o=t._bucket.renderer,s=o.globe,a=s.getCoordinateSystem(),l=o.tileManager.renderContext;var u;if(e){u=n(a.get3DFromWorld(e))}else u=[r[0],r[1],-1];const c=a.getElevation(s,t)+200,h=[t.coordinates[0],t.coordinates[1],c],d=a.get3DFromWorldInCrs(h,t.crs.properties.name),p=n(d),f=vec3.create([l.viewMatrix[0],l.viewMatrix[4],l.viewMatrix[8]]),g=vec3.create([l.viewMatrix[1],l.viewMatrix[5],l.viewMatrix[9]]),m=a.getGeoide().getRealPlanetRadius(),v=vec3.create([i[0]/m,i[1]/m,1]),y=function(e,t,i,r,n){var o=vec3.create();vec3.scale(r,t[0],o),vec3.scale(o,i[0]);var s=vec3.create();vec3.scale(n,t[1],s),vec3.scale(s,i[1]);var a=vec3.create();return vec3.add(e,o,a),vec3.add(a,s),a},b=n(y(d,vec3.create([-.5,1,0]),v,f,g)),x=n(y(d,vec3.create([.5,0,0]),v,f,g)),w=b[0],T=x[0],_=b[1],C=x[1];return u[0]>w&&u[0]<T&&u[1]>_&&u[1]<C&&(u[2]<0||u[2]>p[2])},r}),r("gw/Error/NetworkError",[],function(){var e=function(){var e,t,i=Error.apply(null,arguments);this.name="NetworkError",this.code=arguments.length>2?arguments[2]:null,e=this,t=i,Object.getOwnPropertyNames(t).forEach(function(i){var r=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(e,i,r)}),this.layerDescription=null};return(e.prototype=Object.create(Error.prototype)).constructor=e,e.prototype.setLayerDescription=function(e){this.layerDescription=e},e.prototype.getLayerDescription=function(){return this.layerDescription},e}),r("gw/Utils/Proxy",[],function(){var e=!1,t="";return{setProxyUse:function(t){if("boolean"!=typeof t)throw new TypeError("proxyUse must be a boolean","Proxy.js");e=t},setProxyUrl:function(e){if("string"!=typeof e)throw new TypeError("proxyUrl must be a string","Proxy.js");t=e},proxify:function(i){return"string"!=typeof i?i:!0===e?!1===i.toLowerCase().startsWith("http")?i:i.startsWith(t)?i:t+encodeURIComponent(i):i}}}),r("gw/Utils/Utils",["jquery","moment","./Numeric","./UtilsIntersection","./Constants","../Error/NetworkError","../Utils/Proxy"],function(e,t,i,r,n,o,s){var a={};function l(e){return e.getUTCHours()+e.getUTCMinutes()/60+e.getUTCSeconds()/3600}function u(e){var t=e.getUTCFullYear(),i=e.getUTCMonth()+1,r=e.getUTCDate();l(e);return 367*t-Math.floor(7/4*(t+Math.floor((i+9)/12)))+Math.floor(275*i/9)+r+1721013.5}return a.inherits=function(e,t){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},a.generateColor=function(){var e=Math.random();return e+=.618033988749895,function(e,t,i){var r,n,o,s=Math.floor(6*e),a=6*e-s,l=i*(1-t),u=i*(1-a*t),c=i*(1-(1-a)*t);switch(s){case 0:r=i,n=c,o=l;break;case 1:r=u,n=i,o=l;break;case 2:r=l,n=i,o=c;break;case 3:r=l,n=u,o=i;break;case 4:r=c,n=l,o=i;break;case 5:r=i,n=l,o=u;break;default:r=1,n=1,o=1}return[r,n,o]}(e%=1,.5,.95)},a.formatId=function(e){return"string"==typeof e?e.replace(/\s{1,}|\.{1,}|\[{1,}|\]{1,}|\({1,}|\){1,}|~{1,}|\+{1,}|°{1,}|-{1,}|'{1,}|"{1,}/g,""):e},a.isValueBetween=function(e,t,i){return e>=t&&e<=i},a.computeBaseUrlFromCapabilities=function(e,t){if("string"!=typeof e||0==e.length||!Array.isArray(t))return null;var i=e;i.indexOf("?")>-1&&(i=i.substr(0,i.indexOf("?")));for(var r=e.replace(i+"?","")||e,n=a.parseQuery(r),o=0;o<t.length;o++){delete n[t[o]]}var s=0;for(var l in n){var u=n[l];i=0==s?i+"?"+l+"="+u:i+"&"+l+"="+u,s++}return i},a.parseQuery=function(e){if("string"!=typeof e||0==e.length)return{};for(var t,i,r,n=e.split("&"),o=n.length,s={},a=0;a<o;a++)t=n[a].split("="),0!=(i=decodeURIComponent(t[0])).length&&(r=decodeURIComponent(t[1]),void 0===s[i]?s[i]=r:s[i]instanceof Array?s[i].push(r):s[i]=[s[i],r]);return s},a.addParameterTo=function(e,t,i){var r="&";return"string"==typeof e&&-1!==e.indexOf("?",0)||(r="?"),e+r+t+"="+i},a.parseBaseURL=function(e){return-1==e.indexOf("?")?e:e.substring(0,e.indexOf("?")+1)},a.parseQueryString=function(e){for(var t,i=e.substring(e.indexOf("?")+1).split("&"),r={},n=i.length-1;n>=0;n--)t=i[n].split("="),r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]||"");return r},a.requestUrl=function(t,i,r,n,a,l,u){e.ajax({type:"GET",url:s.proxify(t),dataType:i,beforeSend:function(e){e.setRequestHeader("Accept",r)},success:function(e){a&&a(e,n)},error:function(e,i,r){var n,s;0===e.status?(n="Unreachable URL or No 'Access-Control-Allow-Origin' header is present on the "+t,s=0):(n=r.message?r.message:r,s=r.code?r.code:-1,"string"==typeof i&&(n=i+": "+n)),l&&l(new o(n,"Utils.js",s))},complete:function(e,t){u&&u(e,t)}})},a.JD=function(e){return u(e)+l(e)/24},a.GST=function(e){return(function(e){var t=(u(e)-2451545)/36525;return(100.4606184+36000.77004*t+387933e-9*t*t-2.583e-8*t*t*t)%360}(e)+360.98564724*l(e)/24)%360},a.LST=function(e,t){return(a.GST(e)+t)%360},a.SHA=function(e){return 360-15*e*24/360},a.GHA=function(e,t){var i=15*a.GST(e)*24/360;return(a.SHA(t)+i)%360},a.longLat2XYZ=function(e,t){var r=i.toRadian(t),n=i.toRadian(e),o=Math.cos(r);return{x:o*Math.cos(n),y:o*Math.sin(n),z:Math.sin(r)}},a.computeDistanceCameraFromBbox=function(e,t,n,o){var s,a=Math.abs(e[2]-e[0]);return r.isCrossDateLine(e[0],e[2])&&(a=360-a),s=o?a:a>180?360-a:a,.5*(2*Math.PI*n*s/360)/Math.tan(.5*i.toRadian(t))},a.defineTimeRequest=function(e,t){t.from,t.to;var i=e.split(",");if(1==i.length)i[0];else i[0],i[1],i[2]},a.formatResolution=function(e){var t;if(a.aContainsB.call(this,e,"ss"))t="seconds";else if(a.aContainsB.call(this,e,"mm"))t="minutes";else if(a.aContainsB.call(this,e,"HH"))t="hours";else if(a.aContainsB.call(this,e,"DD"))t="days";else if(a.aContainsB.call(this,e,"MM"))t="months";else{if(!a.aContainsB.call(this,e,"YYYY"))throw new Error;t="years"}return t},a.aContainsB=function(e,t){return e.indexOf(t)>=0},a.convertToMoment=function(e){return e instanceof t()?e:t().utc(e)},a.isPassiveSupported=function(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){return e=!0}});window.addEventListener("test",t,t),window.removeEventListener("test",t,t)}catch(t){e=!1}return e},a.assert=function(e,t,i){if(!e)throw null==i&&(t=i+": "+t),new Error("Assert failed"+(void 0!==t?" - "+t:""))},a.getBBox=function(e){var t,i=!0;switch(e.type){case n.GEOMETRY.Point:return[(t=e.coordinates)[0],t[1],t[0],t[1]];case n.GEOMETRY.MultiPoint:t=e.coordinates,i=!1;break;case n.GEOMETRY.Polygon:t=e.coordinates[0];break;case n.GEOMETRY.MultiPolygon:t=e.coordinates[0][0];break;case n.GEOMETRY.LineString:t=e.coordinates;break;case n.GEOMETRY.MultiLineString:t=e.coordinates[0]}if(t&&0!==t.length){for(var o=t[0][0],s=t[0][1],a=t[0][0],l=t[0][1],u=e.type===n.GEOMETRY.MultiPolygon||e.type===n.GEOMETRY.MultiLineString?e.coordinates.length:1,c=0;c<u;c++){switch(e.type){case n.GEOMETRY.MultiPolygon:t=e.coordinates[c][0];break;case n.GEOMETRY.MultiLineString:t=e.coordinates[c]}for(var h=0;h<t.length;h++)o=Math.min(o,t[h][0]),s=Math.min(s,t[h][1]),a=Math.max(a,t[h][0]),l=Math.max(l,t[h][1]),i&&h>0&&r.isCrossDateLine(t[h-1][0],t[h][0])&&(o=-180,a=180)}return{north:l,south:s,west:o,east:a}}},a}),r("gw/Utils/Event",[],function(){var e=function(){this.callbacks={}};return e.prototype.subscribe=function(e,t){this.callbacks[e]?this.callbacks[e].push(t):this.callbacks[e]=[t]},e.prototype.unsubscribe=function(e,t){if(this.callbacks[e]){var i=this.callbacks[e].indexOf(t);-1!==i&&this.callbacks[e].splice(i,1)}},e.prototype.publish=function(e,t){if(this.callbacks[e])for(var i=this.callbacks[e],r=0;r<i.length;r++)i[r](t)},e}),r("gw/Time/Time",["jquery","moment","../Utils/Constants","../Utils/Utils"],function(e,t,i,r){const n=/^\d{4}$/;var o=function(e){this.date=e.date,this.display=e.display,this.period=e.period};function s(e){var t,r,n=e.slice(-1);if(e.startsWith(i.UNIT_RESOLUTION_WMS.TIME))t=e.substring(2,e.length-1),r=function(e){var t;switch(e){case i.UNIT_TIME_WMS.HOUR:t=i.TIME_STEP.HOUR;break;case i.UNIT_TIME_WMS.MINUTE:t=i.TIME_STEP.MINUTE;break;case i.UNIT_TIME_WMS.SECONDE:t=i.TIME_STEP.SECONDE;break;default:throw new Error("Onknown time format")}return t}(n);else{if(!e.startsWith(i.UNIT_RESOLUTION_WMS.NOT_TIME))throw new Error("Unknown resolution");t=e.substring(1,e.length-1),r=function(e){var t;switch(e){case i.UNIT_TIME_WMS.YEAR:t=i.TIME_STEP.YEAR;break;case i.UNIT_TIME_WMS.MONTH:t=i.TIME_STEP.MONTH;break;case i.UNIT_TIME_WMS.DAY:t=i.TIME_STEP.DAY;break;default:throw new Error("Unknown date format")}return t}(n)}return{step:t,unit:r}}function a(e){return-1!==e.indexOf("/")}function l(e){return!a(e)&&-1===e.indexOf(",")}function u(e,t){var i=c(e),r=c(t);return r.from<=i.from&&i.from<=r.to||r.from<=i.to&&i.to<=r.to||i.from<=r.from&&r.from<=i.to||i.from<=r.to&&r.to<=i.to}function c(e){var i=h(e.creationData().format);return{from:t(e).startOf(i),to:t(e).endOf(i)}}function h(e){var t;if(r.aContainsB.call(this,e,"ss"))t=i.TIME_MOMENT_STEP.SECOND;else if(r.aContainsB.call(this,e,"mm"))t=i.TIME_MOMENT_STEP.MINUTE;else if(r.aContainsB.call(this,e,"HH"))t=i.TIME_MOMENT_STEP.HOUR;else if(r.aContainsB.call(this,e,"DD"))t=i.TIME_MOMENT_STEP.DAY;else if(r.aContainsB.call(this,e,"MM"))t=i.TIME_MOMENT_STEP.MONTH;else{if(!r.aContainsB.call(this,e,"YYYY"))throw new Error;t=i.TIME_MOMENT_STEP.YEAR}return t}function d(e,t,i,r,n){return{date:p(e),display:t,period:{from:p(i),to:p(r)},computed:n}}function p(e){return n.test(e)?t.utc(e,"YYYY"):e instanceof Date?t.utc(e.toISOString()):t.utc(e)}function f(e){var i=p(e),r=h(i.creationData().format);return d(e,e,t.utc(i).startOf(r),t.utc(i).endOf(r),!1)}return o.lowestFormatResolution=function(e){return h(e)},o.timeResolution=function(e){return s(e)},o.isSampling=function(e){return a(e)},o.isDistinctValue=function(e){return l(e)},o.parse=function(e){var i,r;if((r=e).hasOwnProperty("date")&&r.hasOwnProperty("display")&&r.hasOwnProperty("period"))i=d(e.date,e.display,e.period.from,e.period.to,!0);else if(function(e){return e.hasOwnProperty("from")&&e.hasOwnProperty("to")}(e))i=d(e.from,e.from,e.from,e.to,!1);else if(function(e){return e.hasOwnProperty("from")}(e))i=d(e.from,e.from,e.from,t(),!1);else if(function(e){return"string"==typeof e}(e))i=f(e);else{if(!function(e){return e instanceof Date}(e))throw new Error("Unsupported time format");i=f(e.toISOString())}return new o(i)},o.prototype.isEqual=function(e){var t=p(e),i=u(this.date,t);if(i){var r=t.creationData().format;this.display=t.format(r)}return i},o.prototype.isInSampling=function(e){var i,r=(e=e.trim()).split("/"),n=p(r[0]),o=p(r[1]),a=s(r[2]),l=Math.floor(o.diff(n,a.unit)/parseInt(a.step)),h=function(e,i,r,n,o){for(var s,a,l,h,d=0,p=n;d<=p;){if(s=Math.floor((d+p)/2),(a=t(r)).add(s*o.step,o.unit),u(e,a)||(l=i,(h=c(a)).from<=l.from&&l.from<=h.to||h.from<=l.to&&l.to<=h.to||l.from<=h.from&&h.from<=l.to||l.from<=h.to&&h.to<=l.to))return s;e>a?d=s+1:p=s-1}return-1}(this.date,this.period,n,l,a);if(-1===h)i=!1;else{i=!0;var d=n.creationData().format;this.display=t.utc(n).add(h*a.step,a.unit).format(d)}return i},o.prototype.isInTimeDefinition=function(e){var t,i,r=!1,n=(e=e.trim()).split(",");for(i=0;i<n.length&&!r;i++)if(l(t=n[i].trim()))r=this.isEqual(t);else{if(!a(t))throw new Error("Unknown timeDefinition format");r=this.isInSampling(t)}return r},o.prototype.getDisplayValue=function(){return this.display},o}),r("gw/Renderer/FeatureStyle",["../Utils/Constants"],function(e){var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"},i=/^(\w{2})(\w{2})(\w{2})$/,r=/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,n=/^rgba\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3},\s*(\d{1,3}))\)$/,o=function(t){if(this.strokeColor=[1,0,0,1],this.fillColor=[1,0,0,1],this.fillTextureUrl=null,this.fillTexture=null,this.fillShader=null,this.strokeWidth=1,this.iconUrl=null,this.icon=null,this.label=null,this.textColor=[1,1,1,1],this.fill=!1,this.pointMaxSize=40,this.opacity=1,this.zIndex=e.DISPLAY.DEFAULT_RASTER,this.extrusionScale=1,this.onTerrain=!0,t)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};return o.fromStringToColor=function(e){var o,s=0,a=0,l=0,u=255;return"#"===(e=(e=e.trim()).toLowerCase()).charAt(0)&&(e=e.substr(1,6)),t.hasOwnProperty(e)&&(e=t[e]),(o=i.exec(e))&&(s=parseInt(o[1],16),a=parseInt(o[2],16),l=parseInt(o[3],16)),(o=r.exec(e))&&(s=parseInt(o[1],10),a=parseInt(o[2],10),l=parseInt(o[3],10)),(o=n.exec(e))&&(s=parseInt(o[1],10),a=parseInt(o[2],10),l=parseInt(o[3],10),u=parseInt(o[4],10)),[(s=s<0?0:s>255?255:s)/255,(a=a<0?0:a>255?255:a)/255,(l=l<0?0:l>255?255:l)/255,(u=u<0?0:u>255?255:u)/255]},o.fromColorToString=function(e){for(var t="#",i=0;i<3;i++){var r=parseInt(255*e[i],10).toString(16);t+=r<10?"0"+r:r}return t},o.prototype.getStrokeColor=function(){return this.strokeColor},o.prototype.setStrokeColor=function(e){return this.strokeColor=e,this.strokeColor},o.prototype.getFillColor=function(){return this.fillColor},o.prototype.setFillColor=function(e){return this.fillColor=e,this.fillColor},o.prototype.getFillTextureURL=function(){return this.fillTextureUrl},o.prototype.setFillTextureURL=function(e){return this.fillTextureUrl=e,this.fillTextureUrl},o.prototype.getFillTexture=function(){return this.fillTexture},o.prototype.setFillTexture=function(e){return this.fillShader=e,this.fillShader},o.prototype.getFillShader=function(){return this.fillShader},o.prototype.setFillShader=function(e){return this.fillShader=e,this.fillShader},o.prototype.getStrokeWidth=function(){return this.strokeWidth},o.prototype.setStrokeWidth=function(e){return this.strokeWidth=e,this.strokeWidth},o.prototype.getIconURL=function(){return this.iconUrl},o.prototype.setIconURL=function(e){return this.iconUrl=e,this.iconUrl},o.prototype.getIcon=function(){return this.icon},o.prototype.setIcon=function(e){this.icon=e},o.prototype.getLabel=function(){return this.label},o.prototype.setLabel=function(e){this.label=e},o.prototype.getTextColor=function(){return this.textColor},o.prototype.setTextColor=function(e){return this.textColor=e,this.textColor},o.prototype.isFill=function(){return this.isFill},o.prototype.setFill=function(e){return this.isFill=e,this.isFill},o.prototype.getPointMaxSize=function(){return this.pointMaxSize},o.prototype.setPointMaxSize=function(e){this.pointMaxSize=e},o.prototype.getOpacity=function(){return this.opacity},o.prototype.setOpacity=function(e){if("number"!=typeof e)throw new RangeError("opacity value should be a value in [0..1]","AbstractLayer.js");this.opacity=Math.min(1,Math.max(0,e))},o.prototype.getZIndex=function(){return this.zIndex},o.prototype.setZIndex=function(e){return this.zIndex=e,this.zIndex},o.prototype.getExtrusionScale=function(){return this.extrusionScale},o.prototype.setExtrusionScale=function(e){this.extrusionScale=e},o.prototype.isOnTerrain=function(e){return this.onTerrain},o.prototype.setOnTerrain=function(e){this.onTerrain=e},o}),r("gw/Renderer/ColorMap",["../Utils/Numeric","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i){var r={linear:[],asin:[],sqrt:[],sqr:[],log:[]};!function(){for(var e in r)if(r.hasOwnProperty(e)){for(var t,i=Number.MAX_VALUE,n=Number.MIN_VALUE,o=[],s=0;s<256;s++){switch(t=s,e){case"linear":o[s]=t;break;case"asin":o[s]=Math.log(t+Math.sqrt(Math.pow(t,2)+1));break;case"log":o[s]=Math.log(t/10+1);break;case"sqrt":o[s]=Math.sqrt(t/10);break;case"sqr":o[s]=t*t}o[s]<i&&(i=o[s]),o[s]>n&&(n=o[s])}for(s=0;s<256;s++)(t=(o[s]-i)/(n-i)*256)>256?t=256:t<0&&(t=0),r[e][s]=Math.floor(t)}}();var n={fire:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,4,7,10,13,16,19,22,25,28,31,34,37,40,43,46,49,52,55,58,61,64,67,70,73,76,79,82,85,88,91,94,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,148,150,152,154,156,158,160,162,163,164,166,167,168,170,171,173,174,175,177,178,179,181,182,184,185,186,188,189,190,192,193,195,196,198,199,201,202,204,205,207,208,209,210,212,213,214,215,217,218,220,221,223,224,226,227,229,230,231,233,234,235,237,238,240,241,243,244,246,247,249,250,252,252,252,253,253,253,254,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,5,7,8,10,12,14,16,19,21,24,27,29,32,35,37,40,43,46,48,51,54,57,59,62,65,68,70,73,76,79,81,84,87,90,92,95,98,101,103,105,107,109,111,113,115,117,119,121,123,125,127,129,131,133,134,136,138,140,141,143,145,147,148,150,152,154,155,157,159,161,162,164,166,168,169,171,173,175,176,178,180,182,184,186,188,190,191,193,195,197,199,201,203,205,206,208,210,212,213,215,217,219,220,222,224,226,228,230,232,234,235,237,239,241,242,244,246,248,248,249,250,251,252,253,254,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],blue:[0,7,15,22,30,38,45,53,61,65,69,74,78,82,87,91,96,100,104,108,113,117,121,125,130,134,138,143,147,151,156,160,165,168,171,175,178,181,185,188,192,195,199,202,206,209,213,216,220,220,221,222,223,224,225,226,227,224,222,220,218,216,214,212,210,206,202,199,195,191,188,184,181,177,173,169,166,162,158,154,151,147,143,140,136,132,129,125,122,118,114,111,107,103,100,96,93,89,85,82,78,74,71,67,64,60,56,53,49,45,42,38,35,31,27,23,20,16,12,8,5,4,3,3,2,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,13,17,21,26,30,35,42,50,58,66,74,82,90,98,105,113,121,129,136,144,152,160,167,175,183,191,199,207,215,223,227,231,235,239,243,247,251,255,255,255,255,255,255,255,255]},eosb:{red:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,9,18,27,36,45,49,57,72,81,91,100,109,118,127,136,131,139,163,173,182,191,200,209,218,227,213,221,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,253,251,249,247,245,243,241,215,214,235,234,232,230,228,226,224,222,198,196,216,215,213,211,209,207,205,203,181,179,197,196,194,192,190,188,186,184,164,162,178,176,175,173,171,169,167,165,147,145,159,157,156,154,152,150,148,146,130,128,140,138,137,135,133,131,129,127,113,111,121,119,117,117],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,15,23,31,39,47,55,57,64,79,87,95,103,111,119,127,135,129,136,159,167,175,183,191,199,207,215,200,207,239,247,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,255,255,255,255,255,255,255,229,229,255,250,246,242,238,233,229,225,198,195,212,208,204,199,195,191,187,182,160,156,169,165,161,157,153,148,144,140,122,118,127,125,123,121,119,116,114,112,99,97,106,104,102,99,97,95,93,91,80,78,84,82,80,78,76,74,72,70,61,59,63,61,59,57,55,53,50,48,42,40,42,40,38,36,33,31,29,27,22,21,21,19,16,14,12,13,8,6,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],blue:[116,121,127,131,136,140,144,148,153,157,145,149,170,174,178,182,187,191,195,199,183,187,212,216,221,225,229,233,238,242,221,225,255,247,239,231,223,215,207,199,172,164,175,167,159,151,143,135,127,119,100,93,95,87,79,71,63,55,47,39,28,21,15,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},stern:{red:[0,18,36,54,72,90,108,127,145,163,199,217,235,254,249,244,239,234,229,223,218,213,208,203,197,192,187,182,177,172,161,156,151,146,140,135,130,125,120,115,109,104,99,94,89,83,78,73,68,63,52,47,42,37,32,26,21,16,11,6,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],green:[0,1,2,3,4,5,6,7,8,9,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,53,54,55,56,57,58,59,60,61,62,64,65,66,67,68,69,70,71,72,73,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,117,118,119,120,121,122,123,124,125,126,128,129,130,131,132,133,134,135,136,137,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,181,182,183,184,185,186,187,188,189,190,192,193,194,195,196,197,198,199,200,201,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,245,246,247,248,249,250,251,252,253,254],blue:[0,1,3,5,7,9,11,13,15,17,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,63,65,67,69,71,73,75,77,79,81,83,85,87,89,91,93,95,97,99,101,105,107,109,111,113,115,117,119,121,123,127,129,131,133,135,137,139,141,143,145,149,151,153,155,157,159,161,163,165,167,169,171,173,175,177,179,181,183,185,187,191,193,195,197,199,201,203,205,207,209,211,213,215,217,219,221,223,225,227,229,233,235,237,239,241,243,245,247,249,251,255,251,247,243,238,234,230,226,221,217,209,204,200,196,192,187,183,179,175,170,166,162,158,153,149,145,141,136,132,128,119,115,111,107,102,98,94,90,85,81,77,73,68,64,60,56,51,47,43,39,30,26,22,17,13,9,5,0,3,7,15,19,22,26,30,34,38,41,45,49,57,60,64,68,72,76,79,83,87,91,95,98,102,106,110,114,117,121,125,129,137,140,144,148,152,156,159,163,167,171,175,178,182,186,190,194,197,201,205,209,216,220,224,228,232,235,239,243,247,251]},rainbow:{red:[0,4,9,13,18,22,27,31,36,40,45,50,54,58,61,64,68,69,72,74,77,79,80,82,83,85,84,86,87,88,86,87,87,87,85,84,84,84,83,79,78,77,76,71,70,68,66,60,58,55,53,46,43,40,36,33,25,21,16,12,4,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,12,21,25,29,33,42,46,51,55,63,67,72,76,80,89,93,97,101,110,114,119,123,131,135,140,144,153,157,161,165,169,178,182,187,191,199,203,208,212,221,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255],green:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,8,16,21,25,29,38,42,46,51,55,63,67,72,76,84,89,93,97,106,110,114,119,127,131,135,140,144,152,157,161,165,174,178,182,187,195,199,203,208,216,220,225,229,233,242,246,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,250,242,238,233,229,221,216,212,208,199,195,191,187,178,174,170,165,161,153,148,144,140,131,127,123,119,110,106,102,97,89,85,80,76,72,63,59,55,51,42,38,34,29,21,17,12,8,0],blue:[0,3,7,10,14,19,23,28,32,38,43,48,53,59,63,68,72,77,81,86,91,95,100,104,109,113,118,122,127,132,136,141,145,150,154,159,163,168,173,177,182,186,191,195,200,204,209,214,218,223,227,232,236,241,245,250,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,246,242,238,233,225,220,216,212,203,199,195,191,187,178,174,170,165,157,152,148,144,135,131,127,123,114,110,106,102,97,89,84,80,76,67,63,59,55,46,42,38,34,25,21,16,12,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},grey:{red:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],green:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255],blue:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247,248,249,250,251,252,253,254,255]}};return{addCustomColormap:function(r,o){if(o.length<2)return i.open(t.LEVEL.DEBUG,"ColorMap.js","Colors length must be >= 2"),null;for(var s={red:[],green:[],blue:[]},a=o.length-1,l=0;l<a;l++)for(var u=o[l],c=o[l+1],h=256/(o.length-1),d=s.red.length,p=Math.floor((l+1)*h),f=d;f<p;f++)s.red.push(e.lerp(f/p,u[0],c[0])),s.green.push(e.lerp(f/p,u[1],c[1])),s.blue.push(e.lerp(f/p,u[2],c[2]));n[r]=s},generateColormap:function(e,t,i,o){var s,a,l,u=r[t],c=[];s=n[i].red,a=n[i].green,l=n[i].blue;for(var h=s.length-1,d=0;d<256;d++){var p=u[d];p>h?p=h:p<0&&(p=0),o&&(p=h-p),c[3*d]=s[p]/256,c[3*d+1]=a[p]/256,c[3*d+2]=l[p]/256}return function(e,t,i,r,n,o){var s;if(r===e.UNSIGNED_BYTE)s=new Uint8Array(t);else{if(r!==e.FLOAT)return null;s=new Float32Array(t)}var a=e.createTexture();return e.bindTexture(e.TEXTURE_2D,a),e.texImage2D(e.TEXTURE_2D,0,i,n,o,0,i,r,s),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),a}(e,c,e.RGB,e.FLOAT,c.length/3,1)}}}),r("gw/Renderer/DynamicImage",["./ColorMap"],function(e){var t="precision highp float; \n";t+="varying vec2 vTextureCoord;\n",t+="uniform sampler2D texture; \n",t+="uniform sampler2D colormap; \n",t+="uniform float min; \n",t+="uniform float max; \n",t+="uniform vec4 color; \n",t+="void main(void)\n",t+="{\n",t+="\tfloat i = texture2D(texture,vTextureCoord).r;\n",t+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",t+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",t+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b,color.a);\n",t+="}\n";var i=function(e,t,i){i||(i=t.polygonProgram),e.uniform1f(i.uniforms.max,t.style.uniformValues.tmax),e.uniform1f(i.uniforms.min,t.style.uniformValues.tmin),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,t.style.uniformValues.colormapTex),e.uniform1i(i.uniforms.colormap,1)},r=function(e,r,n,o,s,a,l){t=l&&l.fragmentCode?l.fragmentCode:t,i=l&&l.updateUniforms?l.updateUniforms:i,this.fragmentCode=t,this.updateUniforms=i,this.tmin=0,this.tmax=1,this.colormapTex=null,this.renderContext=e,this.pixels=r,this.transferFn="raw",this.inverse=!1;var u=e.gl,c=u.createTexture();if(u.bindTexture(u.TEXTURE_2D,c),u.texImage2D(u.TEXTURE_2D,0,n,s,a,0,n,o,r),o===u.FLOAT){var h=u.getExtension("OES_texture_float_linear")?u.LINEAR:u.NEAREST;u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,h),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,h)}else u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR_MIPMAP_LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR);u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),this.texture=c,this.width=s,this.height=a,this.computeMinMax(r),e.requestFrame()};return r.prototype.computeMinMax=function(e){for(var t=Number.MIN_VALUE,i=Number.MAX_VALUE,r=1;r<e.length;r++){var n=e[r];isNaN(n)||(t<n&&(t=n),i>n&&(i=n))}this.min=i,this.max=t,this.tmax=t,this.tmin=i},r.prototype.updateColormap=function(r,n,o){var s=this.renderContext.gl;"raw"!==r?(this.fragmentCode=t,this.updateUniforms=i,this.colormapTex&&s.deleteTexture(this.colormapTex),this.colormapTex=e.generateColormap(s,r,n,o)):(this.fragmentCode=null,this.updateUniforms=null),this.transferFn=r,this.inverse=o},r.prototype.dispose=function(){var e=this.renderContext.gl;this.colormapTex&&e.deleteTexture(this.colormapTex),this.texture&&e.deleteTexture(this.texture),this.colormapTex=null,this.texture=null},r}),function(){var e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g=[].indexOf||function(e){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===e)return t;return-1},m={}.hasOwnProperty,v=function(e,t){for(var i in t)m.call(t,i)&&(e[i]=t[i]);function r(){this.constructor=e}return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},y=[].slice,b=function(e,t){return function(){return e.apply(t,arguments)}};null==this.astro&&(this.astro={}),(n={}).version="0.2.3",this.astro.FITS=n,f=["included","extended"],h=function(){function e(){}return e.include=function(e){var t,i,r;if(!e)throw"include(obj) requires obj";for(t in e)i=e[t],g.call(f,t)<0&&(this.prototype[t]=i);return null!=(r=e.included)&&r.apply(this),this},e.extend=function(e){var t,i,r;if(!e)throw"extend(obj) requires obj";for(t in e)i=e[t],g.call(f,t)<0&&(this[t]=i);return null!=(r=e.extended)&&r.apply(this),this},e.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e.prototype.proxy=function(e){var t=this;return function(){return e.apply(t,arguments)}},e}(),this.astro.FITS.Module=h,i=function(e){function t(e,t){this.view=e,this.begin=this.current=e.tell(),this.length=void 0}return v(t,h),t}(),this.astro.FITS.DataUnit=i,l={verifyOrder:function(e,t){if(t!==this.cardIndex)return console.warn(e+" should appear at index "+this.cardIndex+" in the FITS header")},verifyBetween:function(e,t,i,r){if(!(t>=i&&t<=r))throw"The "+e+" value of "+t+" is not between "+i+" and "+r},verifyBoolean:function(e){return"T"===e},Functions:{SIMPLE:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.primary=!0,this.verifyOrder("SIMPLE",0),this.verifyBoolean(e)},XTENSION:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],e=arguments[0],this.extension=!0,this.extensionType=e,this.verifyOrder("XTENSION",0),e},BITPIX:function(){var e;if(1<=arguments.length?y.call(arguments,0):[],"BITPIX",e=parseInt(arguments[0]),this.verifyOrder("BITPIX",1),8!==e&&16!==e&&32!==e&&64!==e&&-32!==e&&-64!==e)throw"BITPIX value "+e+" is not permitted";return e},NAXIS:function(){var e,t;if(1<=arguments.length?y.call(arguments,0):[],"NAXIS",e=parseInt(arguments[0]),!arguments[1]&&(this.verifyOrder("NAXIS",2),this.verifyBetween("NAXIS",e,0,999),this.isExtension()&&("TABLE"===(t=this.extensionType)||"BINTABLE"===t)&&(2,2!==e)))throw"NAXIS must be 2 for TABLE and BINTABLE extensions";return e},PCOUNT:function(){var e,t,i;if(1<=arguments.length?y.call(arguments,0):[],"PCOUNT",t=parseInt(arguments[0]),e=3+this.NAXIS,this.verifyOrder("PCOUNT",e),this.isExtension()&&("IMAGE"===(i=this.extensionType)||"TABLE"===i)&&(0,0!==t))throw"PCOUNT must be 0 for the "+this.extensionType+" extensions";return t},GCOUNT:function(){var e,t,i;if(1<=arguments.length?y.call(arguments,0):[],"GCOUNT",t=parseInt(arguments[0]),e=3+this.NAXIS+1,this.verifyOrder("GCOUNT",e),this.isExtension()&&("IMAGE"===(i=this.extensionType)||"TABLE"===i||"BINTABLE"===i)&&(1,1!==t))throw"GCOUNT must be 1 for the "+this.extensionType+" extensions";return t},EXTEND:function(){var e;if(1<=arguments.length?y.call(arguments,0):[],"EXTEND",e=arguments[0],!this.isPrimary())throw"EXTEND must only appear in the primary header";return this.verifyBoolean(e)},BSCALE:function(){return 1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BZERO:function(){return 1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},BLANK:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"BLANK",e=arguments[0],parseInt(e)},DATAMIN:function(){return 1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},DATAMAX:function(){return 1<=arguments.length?y.call(arguments,0):[],parseFloat(arguments[0])},EXTVER:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"EXTVER",e=arguments[0],e=parseInt(e)},EXTLEVEL:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"EXTLEVEL",e=arguments[0],e=parseInt(e)},TFIELDS:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"TFIELDS",e=arguments[0],e=parseInt(e),this.verifyBetween("TFIELDS",e,0,999),e},TBCOL:function(){var e,t;return 1<=arguments.length?y.call(arguments,0):[],"TBCOL",t=arguments[0],e=arguments[2],this.verifyBetween("TBCOL",e,0,this.TFIELDS),t},ZIMAGE:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"ZIMAGE",e=arguments[0],this.verifyBoolean(e)},ZCMPTYPE:function(){var e;if(1<=arguments.length?y.call(arguments,0):[],"ZCMPTYPE","GZIP_1"!==(e=arguments[0])&&"RICE_1"!==e&&"PLIO_1"!==e&&"HCOMPRESS_1"!==e)throw"ZCMPTYPE value "+e+" is not permitted";if("RICE_1"!==e&&"GZIP_1"!==e)throw"Compress type "+e+" is not yet implement";return e},ZBITPIX:function(){var e;if(1<=arguments.length?y.call(arguments,0):[],"ZBITPIX",8!==(e=parseInt(arguments[0]))&&16!==e&&32!==e&&64!==e&&-32!==e&&-64!==e)throw"ZBITPIX value "+e+" is not permitted";return e},ZNAXIS:function(){var e;return 1<=arguments.length?y.call(arguments,0):[],"ZNAXIS",e=e=parseInt(arguments[0]),arguments[1]||this.verifyBetween("ZNAXIS",e,0,999),e},ZTILE:function(){return 1<=arguments.length?y.call(arguments,0):[],"ZTILE",parseInt(arguments[0])},ZSIMPLE:function(){return 1<=arguments.length?y.call(arguments,0):[],"T"===arguments[0]},ZPCOUNT:function(){return 1<=arguments.length?y.call(arguments,0):[],"ZPCOUNT",parseInt(arguments[0])},ZGCOUNT:function(){return 1<=arguments.length?y.call(arguments,0):[],"ZGCOUNT",parseInt(arguments[0])}}},this.astro.FITS.HeaderVerify=l,a=function(e){function t(){var e,t,i;for(t in this.init=b(this.init,this),this.primary=!1,this.extension=!1,this.verifyCard={},i=this.Functions)e=i[t],this.verifyCard[t]=this.proxy(e);this.cards={},this.cardIndex=0}return v(t,h),t.keywordPattern=/^([A-Z0-9_-]+)\s*=\s*(.*)/,t.nonStringPattern=/([^\/]*)\s*\/*(.*)/,t.stringPattern=/'(.*)'\s*\/*(.*)/,t.arrayPattern=/([A-Za-z]+)(\d+)/,t.include(l),t.prototype.get=function(e){return this.contains(e)?this.cards[e]:console.warn("Header does not contain the key "+e)},t.prototype.getIndex=function(e){return this.contains(e)?this.cards[e][0]:console.warn("Header does not contain the key "+e)},t.prototype.getComment=function(e){return this.contains(e)?null!=this.cards[e][2]?this.cards[e][2]:console.warn(e+" does not contain a comment"):console.warn("Header does not contain the key "+e)},t.prototype.getComments=function(){return this.contains("COMMENT")?this.cards.COMMENT:console.warn("Header does not contain any COMMENT fields")},t.prototype.getHistory=function(){return this.contains("HISTORY")?this.cards.HISTORY:console.warn("Header does not contain any HISTORY fields")},t.prototype.set=function(e,t,i){return this.cards[e]=i?[this.cardIndex,t,i]:[this.cardIndex,t],this.cardIndex+=1},t.prototype.setComment=function(e){return this.contains("COMMENT")||(this.cards.COMMENT=[],this.cardIndex+=1),this.cards.COMMENT.push(e)},t.prototype.setHistory=function(e){return this.contains("HISTORY")||(this.cards.HISTORY=[],this.cardIndex+=1),this.cards.HISTORY.push(e)},t.prototype.contains=function(e){return this.cards.hasOwnProperty(e)},t.prototype.readCard=function(e){var i,r,n,o,s,a,l,u,c,h,d,p;if(null!=(a=e.match(t.keywordPattern)))switch(u=a.slice(1),o=u[0],l=u[1],"COMMENT"===o||"HISTORY"===o?a[1]=l.trim():"'"===l[0]?(a=l.match(t.stringPattern))[1]=a[1].trim():(a=l.match(t.nonStringPattern))[1]="T"===(c=a[1][0])||"F"===c?a[1].trim():parseFloat(a[1]),a[2]=a[2].trim(),l=(h=a.slice(1))[0],r=h[1],s=o,i=(d=[!1,void 0])[0],n=d[1],null!=(a=o.match(t.arrayPattern))&&(s=a[1],i=(p=[!0,a[2]])[0],n=p[1]),this.verifyCard.hasOwnProperty(s)&&(l=this.verifyCard[s](l,i,n)),o){case"COMMENT":return this.setComment(l);case"HISTORY":return this.setHistory(l);default:return this.set(o,l,r),this.__defineGetter__(o,function(){return this.cards[o][1]})}},t.prototype.init=function(e){var t,i,r,n,o,s;for(80,600,s=[],t=n=0,o=(r=(r=e.length/80)<600?r:600)-1;0<=o?n<=o:n>=o;t=0<=o?++n:--n)i=e.slice(80*t,80*(t+1)),s.push(this.readCard(i));return s},t.prototype.hasDataUnit=function(){return 0!==this.NAXIS},t.prototype.isPrimary=function(){return this.primary},t.prototype.isExtension=function(){return this.extension},t}(),this.astro.FITS.Header=a,c={initArray:function(e){return this.data=new e(this.width*this.height)},getExtremes:function(){var e,t,i,r,n,o;if(null!=this.min&&null!=this.max)return[this.min,this.max];for(e=this.data.length;e--;)if(r=this.data[e],!isNaN(r)){i=(n=[r,r])[0],t=n[1];break}for(;e--;)r=this.data[e],isNaN(r)||(r<i&&(i=r),r>t&&(t=r));return o=[i,t],this.min=o[0],this.max=o[1],[this.min,this.max]},getPixel:function(e,t){return this.data[t*this.width+e]}},this.astro.FITS.ImageUtils=c,u=function(e){function t(e,i){var r,n,o,s,a=this;for(t.__super__.constructor.apply(this,arguments),o=i.NAXIS,r=i.BITPIX,this.naxis=[],n=s=1;1<=o?s<=o:s>=o;n=1<=o?++s:--s)this.naxis.push(i["NAXIS"+n]);switch(this.width=i.NAXIS1,this.height=i.NAXIS2||1,this.bzero=i.BZERO||0,this.bscale=i.BSCALE||1,this.rowByteSize=this.width*Math.abs(r)/8,this.totalRowsRead=0,this.length=this.naxis.reduce(function(e,t){return e*t})*Math.abs(r)/8,this.data=void 0,this.frame=0,r){case 8:this.bscale%1==0?(this.arrayType=Uint8Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint8()});break;case 16:this.bscale%1==0?(this.arrayType=Int16Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getInt16()});break;case 32:this.bscale%1==0?(this.arrayType=Int32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()}):(this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getUint32()});break;case 64:this.arrayType=this.bscale%1==0?Int32Array:Float32Array,console.warn("Unusual behaviour with 64 bit integers."),this.accessor=function(){var e,t,i;return i=((t=(e=Math.abs(a.view.getInt32()))%10)?-1:1)*((e-=t)<<32|Math.abs(a.view.getInt32())),a.bzero+a.bscale*i};break;case-32:this.arrayType=Float32Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat32()};break;case-64:this.arrayType=Float64Array,this.accessor=function(){return a.bzero+a.bscale*a.view.getFloat64()};break;default:throw"Invalid BITPIX."}}return v(t,i),t.include(c),t.prototype.getRow=function(){var e,t,i;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),e=t=0,i=this.width-1;0<=i?t<=i:t>=i;e=0<=i?++t:--t)this.data[this.width*this.rowsRead+e]=this.accessor();return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getFrame=function(e){var t;for(this.frame=null!=e?e:this.frame,null==this.data&&this.initArray(this.arrayType),this.totalRowsRead=this.width*this.frame,this.rowsRead=0,t=this.height;t--;)this.getRow();return this.frame+=1,this.data},t.prototype.seek=function(e){return null==e&&(e=0),2===this.naxis.length?(this.totalRowsRead=0,this.frame=0):(this.totalRowsRead=this.height*e,this.frame=this.height/this.totalRowsRead-1)},t.prototype.isDataCube=function(){return this.naxis.length>2},t}(),this.astro.FITS.Image=u,p=function(e){function t(e,i){this.getRow=b(this.getRow,this),t.__super__.constructor.apply(this,arguments),this.rowByteSize=i.NAXIS1,this.rows=i.NAXIS2,this.cols=i.TFIELDS,this.length=this.tableLength=this.rowByteSize*this.rows,this.rowsRead=0,this.columns=this.getColumnNames(i),this.accessors=[]}return v(t,i),t.dataAccessors={L:function(e){return 84===e.getInt8()},X:function(e){throw"Data type not yet implemented"},B:function(e){return e.getUint8()},I:function(e){return e.getInt16()},J:function(e){return e.getInt32()},K:function(e){var t,i,r;return r=((i=(t=Math.abs(e.getInt32()))%10)?-1:1)*((t-=i)<<32|Math.abs(e.getInt32())),console.warn("Something funky happens here when dealing with 64 bit integers.  Be wary!!!"),r},A:function(e){return e.getChar()},E:function(e){return e.getFloat32()},D:function(e){return e.getFloat64()},C:function(e){return[e.getFloat32(),e.getFloat32()]},M:function(e){return[e.getFloat64(),e.getFloat64()]}},t.prototype.getRow=function(e){var t,i,r,n,o;for(null==e&&(e=null),null!=e&&(this.rowsRead=e),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),e={},i=r=0,n=(o=this.accessors).length;r<n;i=++r)t=o[i],e[this.columns[i]]=t();return this.rowsRead+=1,e},t.prototype.getColumnNames=function(e){var t,i,r,n,o;for(t=[],i=n=1,o=this.cols;1<=o?n<=o:n>=o;i=1<=o?++n:--n){if(r="TTYPE"+i,!e.contains(r))return null;t.push(e[r])}return t},t}(),this.astro.FITS.Tabular=p,d=function(e){function t(e,i){this.getRow=b(this.getRow,this);var r,n,o,s,a,l,u=this;for(t.__super__.constructor.apply(this,arguments),s=function(){var e,i,r;return r=o.slice(1),i=r[0],r[1],r[2],e=function(e){return t.dataAccessors[i](e)},u.accessors.push(e)},n=a=1,l=this.cols;1<=l?a<=l:a>=l;n=1<=l?++a:--a)r=i["TFORM"+n],o=r.match(t.formPattern),s()}return v(t,p),t.formPattern=/([AIFED])(\d+)\.*(\d+)*/,t.dataAccessors={A:function(e){return e.trim()},I:function(e){return parseInt(e)},F:function(e){return parseFloat(e)},E:function(e){return parseFloat(e)},D:function(e){return parseFloat(e)}},t.prototype.getRow=function(e){var t,i,r,n,o,s,a;for(null==e&&(e=null),null!=e&&(this.rowsRead=e),this.current=this.begin+this.rowsRead*this.rowByteSize,this.view.seek(this.current),i="",n=1,a=this.rowByteSize;1<=a?n<=a:n>=a;1<=a?++n:--n)i+=this.view.getChar();for(e={},t=o=0,s=(i=i.trim().split(/\s+/)).length;o<s;t=++o)r=i[t],e[this.columns[t]]=this.accessors[t](r);return this.rowsRead+=1,e},t}(),this.astro.FITS.Table=d,e=function(e){function t(e,i){var r,n,o,s,a,l,u,c,h=this;for(t.__super__.constructor.apply(this,arguments),n=l=1,u=this.cols;1<=u?l<=u:l>=u;n=1<=u?++l:--l)a=i["TFORM"+n],null!=(s=a.match(t.arrayDescriptorPattern))?function(){var e,i;i=s[1],e=function(){var e,r,o,s;for(r=h.view.getInt32(),o=h.view.getInt32(),h.current=h.view.tell(),h.view.seek(h.begin+h.tableLength+o),e=[],n=s=1;1<=r?s<=r:s>=r;n=1<=r?++s:--s)e.push(t.dataAccessors[i](h.view));return h.view.seek(h.current),e},h.accessors.push(e)}():(o=(c=(s=a.match(t.dataTypePattern)).slice(1))[0],r=c[1],0===(o=o?parseInt(o):0)||1===o?function(e){var i;i=function(){return t.dataAccessors[e](h.view)},h.accessors.push(i)}(r):function(e,i){var r,o;"X"===e?(o=Math.log(i)/Math.log(2),r=function(){var e,t,r,s,a,l,u;for(r=function(e){var t;for(t=[],n=128;n>=1;)t.push(e&n?1:0),n/=2;return t},s=[],n=a=1;1<=o?a<=o:a>=o;n=1<=o?++a:--a)for(l=0,u=(t=r(h.view.getUint8())).length;l<u;l++)e=t[l],s.push(e);return s.slice(0,+(i-1)+1||9e9)}):r="A"===e?function(){var r,o;for(r="",n=o=1;1<=i?o<=i:o>=i;n=1<=i?++o:--o)r+=t.dataAccessors[e](h.view);return r.trim()}:function(){var r,o;for(r=[],n=o=1;1<=i?o<=i:o>=i;n=1<=i?++o:--o)r.push(t.dataAccessors[e](h.view));return r},h.accessors.push(r)}(r,o))}return v(t,p),t.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,t.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,t}(),this.astro.FITS.BinaryTable=e,r={Rice:function(e,t,i,r,n,o){var s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w;for(a=1<<c,c=(x=this.RiceSetup[r](e))[0],h=x[1],g=x[2],b=x[3],v=new Uint8Array(256),y=8,f=(w=[128,255])[0],d=w[1];d>=0;){for(;d>=f;)v[d]=y,d-=1;f/=2,y-=1}for(v[0]=0,s=e[b],b+=1,m=8,d=0;d<o;){for(m-=c;m<0;)s=s<<8|e[b],b+=1,m+=8;if(u=(s>>m)-1,s&=(1<<m)-1,(p=d+i)>o&&(p=o),u<0)for(;d<p;)e[d]=g,d++;else if(u===h)for(;d<p;){for(l=s<<(f=a-m),f-=8;f>=0;)s=e[b],b+=1,l|=s<<f,f-=8;m>0?(s=e[b],b+=1,l|=s>>-f,s&=(1<<m)-1):s=0,0==(1&l)?l>>=1:l=~(l>>1),e[d]=l+g,g=e[d],d++}else for(;d<p;){for(;0===s;)m+=8,s=e[b],b+=1;for(s^=1<<(m-=(y=m-v[s])+1),m-=u;m<0;)s=s<<8|e[b],b+=1,m+=8;l=y<<u|s>>m,s&=(1<<m)-1,0==(1&l)?l>>=1:l=~(l>>1),n[d]=l+g,g=n[d],d++}}return n},RiceSetup:{1:function(e){var t;return 3,6,[3,6,e[t=0],t+=1]},2:function(e){var t,i;return 4,14,t=0,t|=e[i=0]<<8,[4,14,t|=e[i+=1],i+=1]},4:function(e){var t,i;return 5,25,t=0,t|=e[i=0]<<24,t|=e[i+=1]<<16,t|=e[i+=1]<<8,[5,25,t|=e[i+=1],i+=1]}},gzip:function(e){throw"Not yet implemented"},plio:function(e,t){throw"Not yet implemented"},hcompress:function(e,t){throw"Not yet implemented"}},this.astro.FITS.Decompress=r,t=function(e){function t(e,i){var r,n,o,s,a,l;for(t.__super__.constructor.apply(this,arguments),this.length+=i.PCOUNT,this.zcmptype=i.ZCMPTYPE,this.zbitpix=i.ZBITPIX,this.znaxis=i.ZNAXIS,this.zblank=t.setValue(i,"ZBLANK",void 0),this.blank=t.setValue(i,"BLANK",void 0),this.ztile=[],r=a=1,l=this.znaxis;1<=l?a<=l:a>=l;r=1<=l?++a:--a)s=i.contains("ZTILE"+r)?i["ZTILE"+r]:1===r?i.ZNAXIS1:1,this.ztile.push(s);for(this.width=i.ZNAXIS1,this.height=i.ZNAXIS2||1,this.algorithmParameters={},r=1;n="ZNAME"+r,i.contains(n);)o="ZVAL"+r,this.algorithmParameters[i[n]]=i[o],r+=1;"RICE_1"===this.zcmptype&&this.setRiceDefaults(),this.zmaskcmp=t.setValue(i,"ZMASKCMP",void 0),this.zquantiz=t.setValue(i,"ZQUANTIZ","LINEAR_SCALING"),this.bzero=t.setValue(i,"BZERO",0),this.bscale=t.setValue(i,"BSCALE",1),this.defineColumnAccessors(i),this.defineGetRow()}return v(t,p),t.dataTypePattern=/(\d*)([L|X|B|I|J|K|A|E|D|C|M])/,t.arrayDescriptorPattern=/[0,1]*P([L|X|B|I|J|K|A|E|D|C|M])\((\d*)\)/,t.include(c),t.extend(r),t.typedArray={B:Uint8Array,I:Int16Array,J:Int32Array,E:Float32Array,D:Float64Array,1:Uint8Array,2:Uint8Array,4:Int16Array,8:Int32Array},t.prototype.defineColumnAccessors=function(e){var i,r,n,o,s,a,l,u,c,h,d,p=this;for(this.columnNames={},d=[],n=u=1,c=this.cols;1<=c?u<=c:u>=c;n=1<=c?++u:--u){if(s=(l=e["TFORM"+n]).match(t.arrayDescriptorPattern),a=e["TTYPE"+n].toUpperCase(),this.columnNames[a]=n-1,i=null,null!=s)switch(r=s[1],a){case"COMPRESSED_DATA":!function(e){i=function(){var i,r;return null==(i=p._accessor(e))?new Float32Array(p.ztile[0]):(r=new t.typedArray[p.algorithmParameters.BYTEPIX](p.ztile[0]),t.Rice(i,o,p.algorithmParameters.BLOCKSIZE,p.algorithmParameters.BYTEPIX,r,p.ztile[0]),r)}}(r);break;case"UNCOMPRESSED_DATA":!function(e){i=p._accessor(e)}(r);break;case"GZIP_COMPRESSED_DATA":!function(e){i=function(){var t,i,r,n;if(null!=(t=p._accessor(e))){for(i=r=0,n=(t=new Float32Array(p.width)).length;r<n;i=++r)t[i],t[i]=NaN;return t}return null}}(r);break;default:!function(e){i=p._accessor(e)}(r)}else h=(s=l.match(t.dataTypePattern)).slice(1),o=h[0],r=h[1],0===(o=null!=o?parseInt(o):0)||1===o?function(e){i=function(){return t.dataAccessors[e](p.view)}}(r):function(e,r){i=function(){var i,o,s;for(i=new t.typedArray[r](e),n=o=0,s=e-1;0<=s?o<=s:o>=s;n=0<=s?++o:--o)i[n]=t.dataAccessors[r](p.view);return i}}(o,r);d.push(this.accessors.push(i))}return d},t.prototype.defineGetRow=function(){var e;return this.totalRowsRead=0,e=null!=this.zblank||null!=this.blank||this.columnNames.hasOwnProperty("ZBLANK"),this.getRow=e?this.getRowHasBlanks:this.getRowNoBlanks},t.prototype.setRiceDefaults=function(){if(this.algorithmParameters.hasOwnProperty("BLOCKSIZE")||(this.algorithmParameters.BLOCKSIZE=32),!this.algorithmParameters.hasOwnProperty("BYTEPIX"))return this.algorithmParameters.BYTEPIX=4},t.setValue=function(e,t,i){return e.contains(t)?e[t]:i},t.prototype.getRowHasBlanks=function(){var e,t,i,r,n,o,s,a,l,u;for(t=(u=this._getRow())[0],e=u[1],n=u[2],s=u[3],i=a=0,l=t.length;a<l;i=++a)o=t[i],r=this.totalRowsRead*this.width+i,this.data[r]=o===e?NaN:s+n*o;return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getRowNoBlanks=function(){var e,t,i,r,n,o,s,a,l;for(e=(l=this._getRow())[0],l[1],r=l[2],o=l[3],t=s=0,a=e.length;s<a;t=++s)n=e[t],i=this.totalRowsRead*this.width+t,this.data[i]=o+r*n;return this.rowsRead+=1,this.totalRowsRead+=1},t.prototype.getFrame=function(){var e;for(null==this.data&&this.initArray(Float32Array),this.totalRowsRead=0,this.rowsRead=0,e=this.height;e--;)this.getRow();return this.data},t.prototype._accessor=function(e){var i,r,n,o,s,a,l;if(o=(a=[this.view.getInt32(),this.view.getInt32()])[1],0===(n=a[0]))return null;for(i=new t.typedArray[e](n),this.current=this.view.tell(),this.view.seek(this.begin+this.tableLength+o),r=s=0,l=n-1;0<=l?s<=l:s>=l;r=0<=l?++s:--s)i[r]=t.dataAccessors[e](this.view);return this.view.seek(this.current),i},t.prototype._getRow=function(){var e,t,i,r,n;for(this.current=this.begin+this.totalRowsRead*this.rowByteSize,this.view.seek(this.current),t=[],i=0,r=(n=this.accessors).length;i<r;i++)e=n[i],t.push(e());return[t[this.columnNames.COMPRESSED_DATA]||t[this.columnNames.UNCOMPRESSED_DATA]||t[this.columnNames.GZIP_COMPRESSED_DATA],t[this.columnNames.ZBLANK]||this.zblank,t[this.columnNames.ZSCALE]||this.bscale,t[this.columnNames.ZZERO]||this.bzero]},t.subtractiveDither1=function(){throw"Not yet implemented"},t.linearScaling=function(){throw"Not yet implemented"},t}(),this.astro.FITS.CompressedImage=t,s=function(){function e(e,t){this.header=e,this.data=t}return e.prototype.hasData=function(){return null!=this.data},e.prototype.getCard=function(e){return this.header[e]},e}(),this.astro.FITS.HDU=s,o=function(){function i(e){switch(i.getType(e)){case"arraybuffer":this.initFromBuffer(e);break;case"object":this.initFromObject(e);break;default:throw"fitsjs cannot initialize object"}}return i.LINEWIDTH=80,i.BLOCKLENGTH=2880,i.getType=function(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()},i.excessBytes=function(e){return(i.BLOCKLENGTH-e%i.BLOCKLENGTH)%i.BLOCKLENGTH},i.extendDataView=function(e){var t,i,r,n,o,s,a,l;return DataView.prototype.getString=function(e){var t,i,r,n;for(i="",r=0,n=e-1;0<=n?r<=n:r>=n;0<=n?++r:--r)t=this.getUint8(),i+=String.fromCharCode(t>127?65533:t);return i},DataView.prototype.getChar=function(){return this.getString(1)},e.offset=0,o=e.getInt8,l=e.getUint8,r=e.getInt16,s=e.getUint16,n=e.getInt32,a=e.getUint32,t=e.getFloat32,i=e.getFloat64,e.getInt8=function(){var e;return e=o.apply(this,[this.offset]),this.offset+=1,e},e.getUint8=function(){var e;return e=l.apply(this,[this.offset]),this.offset+=1,e},e.getInt16=function(){var e;return e=r.apply(this,[this.offset,!1]),this.offset+=2,e},e.getUint16=function(){var e;return e=s.apply(this,[this.offset,!1]),this.offset+=2,e},e.getInt32=function(){var e;return e=n.apply(this,[this.offset,!1]),this.offset+=4,e},e.getUint32=function(){var e;return e=a.apply(this,[this.offset,!1]),this.offset+=4,e},e.getFloat32=function(){var e;return e=t.apply(this,[this.offset,!1]),this.offset+=4,e},e.getFloat64=function(){var e;return e=i.apply(this,[this.offset,!1]),this.offset+=8,e},e.seek=function(e){return this.offset=e},e.tell=function(){return this.offset}},i.prototype.initFromBuffer=function(e){var t,r,n,o;for(this.length=e.byteLength,this.view=new DataView(e),this.hdus=[],this.eof=!1,i.extendDataView(this.view),o=[];n=this.readHeader(),t=this.readData(n),r=new s(n,t),this.hdus.push(r),!this.eof;)o.push(void 0);return o},i.prototype.initFromObject=function(e){return this.length=e.length,this.view=null,this.hdus=e.hdus,this.eof=!0},i.prototype.readHeader=function(){var e,t,r,n,o,s,l,u,c,h,d;for(d=/\s{80}/,s=/^END\s/,e=this.view.tell(),r=!1;!r;)for(t=this.view.getString(i.BLOCKLENGTH),u=0;;){if(h=i.BLOCKLENGTH-i.LINEWIDTH*(u+1),n=i.BLOCKLENGTH-i.LINEWIDTH*u,!(c=t.slice(h,n)).match(d)){if(c.match(s))return o=this.view.tell(),this.view.seek(e),t=this.view.getString(o-e),(l=new a).init(t),r=!0,this.checkEOF(),l;break}u+=1}},i.prototype.readData=function(r){var n,o;if(r.hasDataUnit())return r.isPrimary()?n=new u(this.view,r):r.isExtension()&&("BINTABLE"===r.extensionType?n=r.contains("ZIMAGE")?new t(this.view,r):new e(this.view,r):"TABLE"===r.extensionType?n=new d(this.view,r):"IMAGE"===r.extensionType&&(n=new u(this.view,r))),o=i.excessBytes(n.length),this.view.seek(this.view.tell()+n.length+o),this.checkEOF(),n},i.prototype.checkEOF=function(){if(this.view.offset>=this.length)return this.eof=!0},i.prototype.count=function(){return this.hdus.length},i.prototype.getHDU=function(e){var t,i,r,n;if(null==e&&(e=void 0),null!=e&&null!=this.hdus[e])return this.hdus[e];for(i=0,r=(n=this.hdus).length;i<r;i++)if((t=n[i]).hasData())return t},i.prototype.getHeader=function(e){return null==e&&(e=void 0),this.getHDU(e).header},i.prototype.getDataUnit=function(e){return null==e&&(e=void 0),this.getHDU(e).data},i.prototype.getData=function(e){return null==e&&(e=void 0),this.getHDU(e).data.getFrame()},i}(),this.astro.FITS.File=o}.call(this),r("fits",function(){}),r("gw/Layer/FitsLoader",["../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy","fits"],function(e,t,i){function r(e){var t,i=new astro.FITS.File(e),r=i.getHDU(),n=r.data,o=new Uint8Array(n.view.buffer,n.begin,n.length);t=n.arrayType?n.arrayType.BYTES_PER_ELEMENT:Math.abs(r.header.BITPIX)/8;for(var s=0;s<o.length;s+=t)for(var a,l=0;l<t/2;l++)a=o[s+l],o[s+l]=o[s+t-1-l],o[s+t-1-l]=a;return i}return{loadFits:function(n,o,s,a){var l=new XMLHttpRequest;return l.onreadystatechange=function(i){if(4===l.readyState)if(200===l.status){if(l.response){var a=r(l.response);o&&o(a)}}else t.open(e.LEVEL.ERROR,"Error while loading "+n),s&&s()},l.onprogress=function(e){},l.open("GET",i.proxify(n)),l.responseType="arraybuffer",l.send(),l},parseFits:r}}),r("gw/Services/FitsVisu",["jquery","../Utils/Constants","../Renderer/FeatureStyle","../Renderer/DynamicImage","../Layer/FitsLoader","fits"],function(e,t,i,r,n){var o;function s(e,t){var n,s=new Float32Array(e.view.buffer,e.begin,e.length/4),a=o.getRenderContext().gl,l=new r(o.getRenderContext(),s,a.LUMINANCE,a.FLOAT,e.width,e.height),u=t.feature,c=t.layer;return(n=u.properties.style?new i(u.properties.style):new i(c.style)).fillTexture=l.texture,n.uniformValues=l,n.fill=!0,c.modifyFeatureStyle(u,n),u.services&&(l.url=u.services.download.url),l}function a(e,i){var r=e.feature,n=e.layer;n.getType()===t.LAYER.OpenSearch&&n.loadQuicklook(r,i)}return{init:function(e,t){(o=e).getRenderContext().gl.getExtension("OES_texture_float")},hideImage:function(e){var t=new i(e.feature.properties.style);t.fill=!1,e.layer.modifyFeatureStyle(e.feature,t)},showImage:function(e){var t=new i(e.feature.properties.style);t.fill=!0,e.layer.modifyFeatureStyle(e.feature,t)},removeImage:function(r){if(o.publish(t.EVENT_MSG.IMAGE_REMOVED,r),r.isFits)!function(e){e.xhr&&(e.xhr.abort(),delete e.xhr);var t=o.getRenderContext().gl;e.feature.properties.style.uniformValues&&e.feature.properties.style.uniformValues.dispose();var r=e.feature.properties.style.fillTexture;r&&t.deleteTexture(r);var n=new i(e.feature.properties.style);n.fillTexture=null,n.fill=!1,n.fillShader={fragmentCode:null,updateUniforms:null},delete n.uniformValues,e.layer.modifyFeatureStyle(e.feature,n)}(r),e("#quicklookFits").removeClass("selected");else{if("OpenSearch"===r.layer.getType())r.layer.removeQuicklook();else{var n=r.feature.properties.style;n.fill=!1,n.fillTextureUrl=null,r.layer.modifyFeatureStyle(r.feature,n)}e("#quicklook").removeClass("selected"),e("#quicklookWms").removeClass("selected")}o.getActivatedContext().refresh()},addImage:function(r){var n=r.feature,s=new i(n.properties.style),a=null;s.fill=!0,o.publish(t.EVENT_MSG.IMAGE_ADDED,r),r.isFits?(a=n.services.download.url,this.computeFits(r,a),e("#quicklookFits").addClass("selected")):(s.fill=!0,a=r.isWms?n.properties.services.browse.layer.getUrl():n.properties.quicklook,this.computeQuicklook(r,a),r.isWms?e("#quicklookWms").addClass("selected"):e("#quicklook").addClass("selected")),r.layer.modifyFeatureStyle(n,s),o.getActivatedContext().refresh()},computeFits:function(e,i,r){e.xhr=n.loadFits(i,function(t){delete e.xhr;var i=t.getHDU().data;r&&r(e,t),s(i,e)}),o.publish(t.EVENT_MSG.IMAGE_DOWNLOADED,e)},computeQuicklook:function(e,i){a(e,i),o.publish(t.EVENT_MSG.IMAGE_DOWNLOADED,e)},handleFits:s,handleQuicklook:a,parseFits:function(e){return n.parseFits(e)}}}),r("gw/Services/FitsHips",["../Utils/Constants"],function(e){var t;return{init:function(e,i){t=e},createFitsLayer:function(i){var r;try{var n={name:i.getName(),type:i.getType(),format:"fits",hipsMetadata:i.getHipsMetadata()},o=t.LayerFactory.create(n);o.ID=i.getID(),i.isBackground()?t.getActivatedContext()._getGlobe().setBaseImagery(o):t.getActivatedContext()._getGlobe().addLayer(o),o.setVisible(!0),r=!0,t.getActivatedContext().publish(e.EVENT_MSG.LAYER_BACKGROUND_CHANGED,o)}catch(e){r=!1}return r},removeFitsLayer:function(e){var i,r=t.getActivatedContext().getLayerByID(e);return r&&"fits"!==r.getFormat()?(t.getActivatedContext()._getGlobe().setBaseImagery(r),i=!0):i=!1,i}}}),r("gw/Services/Triangle",[],function(){function e(e,t,i,r){var n=[],o=[],s=[];return vec3.cross(vec3.subtract(r,i,n),vec3.subtract(e,i,[]),o),vec3.cross(n,vec3.subtract(t,i,[]),s),vec3.dot(o,s)>=0}var t=function(e,t,i){this.initA=e.slice(0),this.initB=t.slice(0),this.initC=i.slice(0),this.a=e,this.b=t,this.c=i,this.dragging=!1,this.hover=!1,this.halfWidth=Math.abs((i[0]-t[0])/2)};return t.prototype.reset=function(){this.a=this.initA.slice(0),this.b=this.initB.slice(0),this.c=this.initC.slice(0)},t.prototype.contains=function(t){return function(t,i,r,n){return e(t,i,r,n)&&e(t,r,i,n)&&e(t,n,i,r)}(t,this.a,this.b,this.c)},t.prototype.draw=function(e,t){t||(t={}),this.dragging?e.fillStyle="#FF0"|t.draggingColor:e.fillStyle="#F00"|t.noDraggingColor,e.beginPath(),e.moveTo(this.a[0],this.a[1]),e.lineTo(this.b[0],this.b[1]),e.lineTo(this.c[0],this.c[1]),e.closePath(),e.fill(),!this.dragging&&this.hover&&(e.strokeStyle="#FF0"|t.draggingColor,e.stroke())},t.prototype.modifyPosition=function(e){this.a[0]=e[0],this.b[0]=e[0]-this.halfWidth,this.c[0]=e[0]+this.halfWidth},t}),r("gw/Services/HistogramCore",["./Triangle"],function(e){var t,i,r,n,o,s,a,l,u,c=[];function h(e,t){var i=e.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}function d(e){var t=h(r,e);i.minThreshold.contains([t.x,t.y,0])&&(i.minThreshold.dragging=!0,i.minThreshold.draw(i.ctx)),i.maxThreshold.contains([t.x,t.y,0])&&(i.maxThreshold.dragging=!0,i.maxThreshold.draw(i.ctx))}function p(e){if(i.minThreshold.dragging=!1,i.maxThreshold.dragging=!1,i.onUpdate){var t=i.getHistValue(i.minThreshold.a),r=i.getHistValue(i.maxThreshold.a);i.minThreshold.reset(),i.maxThreshold.reset(),i.onUpdate(t,r)}}function f(e){var n=h(r,e);if(i.ctx.clearRect(0,s,r.width,l),i.minThreshold.hover=i.minThreshold.contains([n.x,n.y,0]),i.maxThreshold.hover=i.maxThreshold.contains([n.x,n.y,0]),i.minThreshold.dragging&&n.x>=i.minThreshold.initA[0]&&n.x<i.maxThreshold.a[0]&&i.minThreshold.modifyPosition([n.x,i.minThreshold.a[1]]),i.maxThreshold.dragging&&n.x<=i.maxThreshold.initA[0]&&n.x>i.minThreshold.a[0]&&i.maxThreshold.modifyPosition([n.x,i.maxThreshold.a[1]]),i.drawThresholdControls(),!(n.y>r.height||n.y<0||n.x>o+t||n.x<o)){i.ctx.font="8pt Calibri",i.ctx.fillStyle="yellow";var a=i.getHistValue([n.x,n.y]);i.ctx.fillText(a,r.width/2-15,s+l),i.ctx.fillRect(n.x,s,1,2)}}return{init:function(e){this.image=e.image,this.onUpdate=e.onUpdate,this.accuracy=e.accuracy||6,i=this,t=e.nbBins||256,l=e.paddingBottom||15,o=e.originX||5,u=e.triangleHalfWidth||5,(r=document.getElementById(e.canvas)).addEventListener("mousemove",f),r.addEventListener("mousedown",d),r.addEventListener("mouseup",p),this.ctx=r.getContext("2d"),this.initThresholds()},initThresholds:function(){s=r.height-l,a=t+o>r.width?r.width:t+o,this.minThreshold=new e([o,s+1,0],[o-u,s+l-1,0],[o+u,s+l-1,0]),this.maxThreshold=new e([a,s+1,0],[a-u,s+l-1,0],[a+u,s+l-1,0])},getHistValue:function(e){return Math.floor(((e[0]-o)/256*(this.image.tmax-this.image.tmin)+this.image.tmin)*Math.pow(10,this.accuracy))/Math.pow(10,this.accuracy)},drawThresholdControls:function(){this.minThreshold.draw(this.ctx,{}),this.maxThreshold.draw(this.ctx,{})},drawHistogram:function(e){null==e&&(e={}),this.ctx.fillStyle=e.color||"blue";for(var t=0;t<c.length;t++){var i=c[t]/n*s;this.ctx.fillRect(o+t,s,1,-i)}},drawAxes:function(){var e;e=o+a,this.ctx.beginPath(),this.ctx.moveTo(o,0),this.ctx.lineTo(o,s),this.ctx.moveTo(o,s),this.ctx.lineTo(e,s),this.ctx.closePath(),this.ctx.strokeStyle="#fff",this.ctx.stroke()},drawTransferFunction:function(e){null==e&&(e={}),this.ctx.fillStyle=e.color||"red";for(var i=0;i<t;i++){var r,n=i,a=o+n;switch(this.image.transferFn){case"linear":r=n/t*s;break;case"log":r=Math.log(n/10+1)/Math.log(t/10+1)*s;break;case"sqrt":r=Math.sqrt(n/10)/Math.sqrt(t/10)*s;break;case"sqr":r=Math.pow(n,2)/Math.pow(t,2)*s;break;case"asin":r=Math.log(n+Math.sqrt(Math.pow(n,2)+1))/Math.log(t+Math.sqrt(Math.pow(t,2)+1))*s}this.image.inverse||(r=s-r),this.ctx.fillRect(a,r,1,1)}},draw:function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.drawHistogram(),this.drawTransferFunction(),this.drawAxes(),this.drawThresholdControls()},compute:function(){var e=this.image;c=new Array(t);for(var i=0;i<c.length;i++)c[i]=0;for(n=Number.MIN_VALUE,i=0;i<e.pixels.length;i++){var r=e.pixels[i];if(!isNaN(r)&&!(r<e.tmin||r>=e.tmax)){var o=Math.floor(t*(r-e.tmin)/(e.tmax-e.tmin));c[o]++,c[o]>n&&(n=c[o])}}for(i=0;i<c.length;i++)c[i]=Math.log(1+c[i]);n=Math.log(1+n)},setImage:function(e){this.image=e},getCanvas:function(){return r}}}),r("gw/Services/ImageProcessingCore",["jquery","../Renderer/FeatureStyle","jquery.ui"],function(e,t){var i,r,n,o;return{init:function(e,t,s,a){e&&(i=e.feature||null,e.layer||null,e.disable||null,e.unselect||null),r=t,n=s,o=a},setData:function(t){i&&i.properties.identifier===t.feature.properties.identifier?this.toggle():r.dialog("isOpen")||this.toggle(),i=t.feature,t.layer,t.feature.services&&o.setUrl(t.feature.services.download.url);var n=t.feature.properties.style.uniformValues;n?this.setImage(n):r.find(".histogramContent").children("div").fadeOut(function(){e(this).siblings("p").fadeIn()})},setImage:function(t){n.setImage(t),t.url&&o.setUrl(t.url),r.find(".histogramContent").children("p").fadeOut(function(){e(this).siblings("div").fadeIn()})},toggle:function(){r.dialog("isOpen")?r.dialog("close"):r.dialog("open")}}}),r("gw/Utils/UtilsFits",["wcs"],function(e){var t={};function i(t,i){var r=e.pixelToCoordinate([t,i]);return[r.ra,r.dec]}return t.getPolygonCoordinatesFromFits=function(e){var t=e.getHDU(),r=t.data,n=(new WCS.Mapper(t.header),[]);return n.push(i(0,r.height)),n.push(i(r.width,r.height)),n.push(i(r.width,0)),n.push(i(0,0)),n.push(n[0]),n},t}),r("gw/Utils/UtilityFactory",["./Constants","./UtilsFits","./Numeric","./UtilsIntersection","../Renderer/FeatureStyle"],function(e,t,i,r,n){return{create:function(o,s){var a;switch(o){case e.UTILITY.Fits:a=t;break;case e.UTILITY.Intersection:a=r;break;case e.UTILITY.Numeric:a=i;break;case e.UTILITY.CreateStyle:a=new n(s);break;case e.UTILITY.FeatureStyle:a=n;break;default:throw new RangeError("Cannot create the utility "+o,"UtilityFactory.js")}return a}}});var l=function(){this.version="1.3.5";var e={mergeCDATA:!0,grokAttr:!0,grokText:!0,normalize:!0,xmlns:!0,namespaceKey:"_ns",textKey:"_text",valueKey:"_value",attrKey:"_attr",cdataKey:"_cdata",attrsAsObject:!0,stripAttrPrefix:!0,stripElemPrefix:!0,childrenAsArray:!0},t=new RegExp(/(?!xmlns)^.*:/),i=new RegExp(/^\s+|\s+$/g);return this.grokType=function(e){return/^\s*$/.test(e)?null:/^(?:true|false)$/i.test(e)?"true"===e.toLowerCase():isFinite(e)?parseFloat(e):e},this.parseString=function(e,t){return this.parseXML(this.stringToXML(e),t)},this.parseXML=function(r,n){for(var o in n)e[o]=n[o];var s={},a=0,u="";if(e.xmlns&&r.namespaceURI&&(s[e.namespaceKey]=r.namespaceURI),r.attributes&&r.attributes.length>0){for(var c={};a<r.attributes.length;a++){var h=r.attributes.item(a);g={};var d;d=e.stripAttrPrefix?h.name.replace(t,""):h.name,e.grokAttr?g[e.valueKey]=this.grokType(h.value.replace(i,"")):g[e.valueKey]=h.value.replace(i,""),e.xmlns&&h.namespaceURI&&(g[e.namespaceKey]=h.namespaceURI),e.attrsAsObject?c[d]=g:s[e.attrKey+d]=g}e.attrsAsObject&&(s[e.attrKey]=c)}if(r.hasChildNodes())for(var p,f,g,m=0;m<r.childNodes.length;m++)4===(p=r.childNodes.item(m)).nodeType?e.mergeCDATA?u+=p.nodeValue:s.hasOwnProperty(e.cdataKey)?(s[e.cdataKey].constructor!==Array&&(s[e.cdataKey]=[s[e.cdataKey]]),s[e.cdataKey].push(p.nodeValue)):e.childrenAsArray?(s[e.cdataKey]=[],s[e.cdataKey].push(p.nodeValue)):s[e.cdataKey]=p.nodeValue:3===p.nodeType?u+=p.nodeValue:1===p.nodeType&&(0===a&&(s={}),f=e.stripElemPrefix?p.nodeName.replace(t,""):p.nodeName,g=l.parseXML(p),s.hasOwnProperty(f)?(s[f].constructor!==Array&&(s[f]=[s[f]]),s[f].push(g)):(e.childrenAsArray?(s[f]=[],s[f].push(g)):s[f]=g,a++));else u||(e.childrenAsArray?(s[e.textKey]=[],s[e.textKey].push(null)):s[e.textKey]=null);if(u)if(e.grokText){var v=this.grokType(u.replace(i,""));null!=v&&(s[e.textKey]=v)}else e.normalize?s[e.textKey]=u.replace(i,"").replace(/\s+/g," "):s[e.textKey]=u.replace(i,"");return s},this.xmlToString=function(e){try{return e.xml?e.xml:(new XMLSerializer).serializeToString(e)}catch(e){return null}},this.stringToXML=function(e){try{var t=null;return window.DOMParser?t=(new DOMParser).parseFromString(e,"text/xml"):((t=new ActiveXObject("Microsoft.XMLDOM")).async=!1,t.loadXML(e),t)}catch(e){return null}},this}.call({});"undefined"!=typeof module&&null!==module&&module.exports?module.exports=l:"function"==typeof r&&r.amd&&r("xmltojson",[],function(){return l}),r("gw/Layer/AbstractLayer",["jquery","underscore-min","../Utils/Event","moment","../Time/Time","../Utils/Utils","../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/UtilityFactory","xmltojson","../Error/NetworkError","../Utils/Proxy"],function(e,t,i,r,n,o,s,a,l,u,c,h){const d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAAZiS0dEAAAAAAAA+UO7fwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9wMBQkVBRMIQtMAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAAvklEQVQY012QMWpCURBFz3yfG7CIwSatpLGwsJJsQEHssr2UttapkkK0zRJEFPKLj5UYPGme8vgDt5l7uNwZKEYNdaZO1FR6VQkBT8AbMAGe1e7dTwXUB8bAFPgF9sBWPUXENbWgBTAELkCTw7bqMdR5kTQCehlogB/gE/iqcs9OVhT9I8v7EZU6UJfqh3pWa3WlvqsvakoRcVOPwCYnvQI1sM67Q0T8JYAWvAEOwDewj4jr4z0teJdf84AA/gF1uG92uhcfoAAAAABJRU5ErkJggg==";var p=function(e,r){i.prototype.constructor.call(this,r),this.globe=null,this.options=r||{},this.ID="URN:Mizar:Layer:"+t.uniqueId(this.constructor.name+":"),this.name=null!=this.options.name?this.options.name:"",this.attribution=this.options.attribution||"",this.copyrightUrl=this.options.copyrightUrl||"",this.ack=this.options.ack||"",this.description=this.options.description||"",this.visible=this.options.visible||!1,this.properties=this.options.properties||{},this.services=this.options.services||[],this.type=e,this.pickable=this.options.pickable||!1,this.dataType=this.options.dataType||"",this.background=r.background||!1,this.category=this.options.background?"background":this.options.category,this.coordinateSystem=r.coordinateSystem,this.format=this.options.format||"",this.baseUrl=this.options.baseUrl||"",this.deletable=this.options.deletable||!1,this.dimension=this.options.dimension,this.callbackContext=null,this.linkedTo=this.options.linkedTo||"",this.servicesRunningOnCollection=[],this.servicesRunningOnRecords={},this.vectorLayer=!1,this.metadataAPI=this.options.metadataAPI?this.options.metadataAPI:null,this.time=null,this.pickingNoDEM=!!this.options.pickingNoDEM&&this.options.pickingNoDEM,this.autoFillTimeTravel=!!this.options.autoFillTimeTravel&&this.options.autoFillTimeTravel,this.style=function(e){var t;if(e.hasOwnProperty("style"))t=l.create(s.UTILITY.CreateStyle,e.style);else if("FeatureStyle"===e.style)t=e.style;else{var i=function(e){var t;if(e.hasOwnProperty("color"))t=e.color instanceof Array?e.color:l.create(s.UTILITY.FeatureStyle).fromStringToColor(e.color);else{var i=o.generateColor();t=i.concat([1])}return t}.call(this,e),r=function(e){var t;t=e.hasOwnProperty("opacity")?e.opacity/100:1;return t}.call(this,e),n=function(e){var t;t=e.hasOwnProperty("icon")?e.icon:d;return t}.call(this,e),a=function(e){var t;t=e.hasOwnProperty("zIndex")?e.zIndex:s.DISPLAY.DEFAULT_RASTER;return t}.call(this,e);t=l.create(s.UTILITY.CreateStyle,{rendererHint:"Basic",opacity:r,iconUrl:n,fillColor:i,strokeColor:i,zIndex:a})}return t}.call(this,this.options,this.icon),this.attribution&&this.attribution.search("<a")>=0&&this.attribution.search("target=")<0&&(this.attribution=this.attribution.replace(" "," target=_blank ")),this.multiLayers=[],this.imageLoadedAtTime={},this.allowedHTTPRequest=!0};return o.inherits(i,p),p.prototype._hasToBeRefreshed=function(e,t){var i=!1;if("time"===e&&this.containsDimension(e)){var r=n.parse(t);t=r.isInTimeDefinition(this.getDimensions().time.value)?r.getDisplayValue():null,this.allowedHTTPRequest=null!==t}else if("time"===e)return i=!1;return void 0===this.imageLoadedAtTime[e]?(i=!0,this.imageLoadedAtTime[e]=t):this.imageLoadedAtTime[e]===t?i=!1:(i=!0,this.imageLoadedAtTime[e]=t),i},p.prototype.hasDimension=function(){return null!=this.dimension},p.prototype.getDimensions=function(){return null==this.dimension?{}:this.dimension},p.prototype.containsDimension=function(e){return this.hasDimension()&&null!=this.dimension[e]},p.prototype.getShortName=function(){var e=o.formatId(this.name);return"string"==typeof e&&(e=e.replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-")),e},p.prototype.hasServicesRunningOnCollection=function(){return this.servicesRunningOnCollection.length>0},p.prototype.setTime=function(e){this.time=e},p.prototype.forceRefresh=function(){this.getGlobe()&&(this.getGlobe().getTileManager().updateVisibleTiles(this),this.getGlobe().refresh())},p.prototype.getServicesRunningOnCollection=function(){var e=[];for(var t in this.servicesRunningOnCollection){var i=this.servicesRunningOnCollection[t],r=this.callbackContext.getLayerByID(i);null!=r&&e.push(r)}return e},p.prototype.removeServicesRunningOnCollection=function(){for(var e in this.servicesRunningOnCollection){var t=this.servicesRunningOnCollection[e];this.callbackContext.removeLayer(t)}return 0===this.servicesRunningOnCollection.length},p.prototype.hasServicesRunningOnRecords=function(){return Object.keys(this.servicesRunningOnRecords).length>0},p.prototype.getServicesRunningOnRecords=function(){var e=[];for(var t in this.servicesRunningOnRecords){var i=this.servicesRunningOnRecords[t];e=e.concat(this.getServicesRunningOnRecord(i))}return e},p.prototype.removeServicesRunningOnRecords=function(){for(var e in this.servicesRunningOnRecords)this.removeServicesRunningOnRecord(e);return 0===Object.keys(this.servicesRunningOnRecords).length},p.prototype.hasServicesRunningOnRecord=function(e){return this.servicesRunningOnRecords.hasOwnProperty(e)},p.prototype.getServicesRunningOnRecord=function(e){var t=[];if(this.hasServicesRunningOnRecord(e)){var i=this.servicesRunningOnRecords[e];for(var r in i.layerIds){var n=i[r],o=this.callbackContext.getLayerByID(n);null!=o&&t.push(o)}}return t},p.prototype.addServicesRunningOnRecord=function(e,t){var i;if(null==e||null==t||this.hasServicesRunningOnRecord(e))i=!1;else{var r=Array.isArray(t)?t:[t];this.servicesRunningOnRecords[e]={layerIds:r},i=!0}return i},p.prototype.removeServicesRunningOnRecord=function(e){var t;if(this.hasServicesRunningOnRecord(e)){var i=this.servicesRunningOnRecords[e];for(var r in i.layerIds){var n=i.layerIds[r];this.callbackContext.removeLayer(n)}delete this.servicesRunningOnRecords[e],t=!0}else t=!1;return t},p.prototype.addServicesRunningOnCollection=function(e){var t;if(null!=e){var i=Array.isArray(e)?e:[e];this.servicesRunningOnCollection=this.servicesRunningOnCollection.concat(i),t=!0}else t=!1;return t},p.prototype.getGetCapabilitiesUrl=function(){return this.getCapabilitiesUrl},p.prototype.getMetadataAPI=function(){return this.metadataAPI},p.prototype.getGlobe=function(){return this.globe},p.prototype.getID=function(){return this.ID},p.prototype.getName=function(){return this.name},p.prototype.getInformationType=function(){throw new SyntaxError("getInformationType not implemented","AbstractLayer.js")},p.prototype.getAttribution=function(){return this.attribution},p.prototype.getCopyrightUrl=function(){return this.copyrightUrl},p.prototype.getAck=function(){return this.ack},p.prototype.getDescription=function(){return this.description},p.prototype.isVisible=function(){return this.visible},p.prototype.setOnTheTop=function(){this.getGlobe().getRendererManager().setSelectedRasterBucket(this)},p.prototype.setVisible=function(e){if("boolean"!=typeof e)throw new TypeError("the parameter of visible should be a boolean","AbstractLayer.js");this.visible!==e&&this.getGlobe().attributionHandler&&this.getGlobe().attributionHandler.toggleAttribution(this),this.visible=e,!this.isBackground()&&this.visible&&this.setOnTheTop();var t=this.callbackContext.getTime();t!==this.time&&this.setTime(t),!0===this.autoFillTimeTravel&&(!0===this.visible?this.callbackContext.timeTravelService&&this.callbackContext.timeTravelService.update(this.timeTravelValues):this.callbackContext.timeTravelService&&this.callbackContext.timeTravelService.update({remove:{ID:this.ID}})),this.getGlobe().getRenderContext().requestFrame(),this.publish(s.EVENT_MSG.LAYER_VISIBILITY_CHANGED,this)},p.prototype.getOpacity=function(){return this.getStyle().getOpacity()},p.prototype.setOpacity=function(e){this.getStyle().setOpacity(e),this.getGlobe().getRenderContext().requestFrame(),this.publish(s.EVENT_MSG.LAYER_OPACITY_CHANGED,this)},p.prototype.getProperties=function(){return this.properties},p.prototype.getType=function(){return this.type},p.prototype.isPickable=function(){return this.pickable},p.prototype.isType=function(e){return this.type===e},p.prototype.getServices=function(){return this.services},p.prototype.getCoordinateSystem=function(){return this.coordinateSystem},p.prototype.isAttached=function(){return!this.isDetached},p.prototype.isDetached=function(){return null==this.globe},p.prototype._attach=function(e){this.globe=e,this.attribution&&this.globe.attributionHandler&&this.isVisible()&&this.globe.attributionHandler.addAttribution(this)},p.prototype._detach=function(){this.attribution&&this.globe.attributionHandler&&this.globe.attributionHandler.removeAttribution(this),this.globe=null},p.prototype.getBaseUrl=function(){return this.baseUrl},p.prototype.getDataType=function(){return this.dataType},p.prototype.getFormat=function(){return this.format},p.prototype.isDeletable=function(){return this.deletable},p.prototype.getStyle=function(){return this.style},p.prototype.setStyle=function(e){this.style=e},p.prototype.isBackground=function(){return this.background},p.prototype.isVectorLayer=function(){return this.vectorLayer},p.prototype.generateTimeTravel=function(e){if(e){for(var t,i,o,l,u,c=e.value.split(","),h=[],d=[],p=0;p<c.length;p++)t=c[p].trim(),n.isDistinctValue(t)?h.push(t):n.isSampling(t)?d.push(t):a.open(s.LEVEL.WARNING,"Case not handle by Mizar for timeDefinition "+t);if(h.length>0&&(this.timeTravelValues={add:{enumeratedValues:h,ID:this.ID}}),d.length>0)for(p=0;p<d.length;p++)u=d[p].split("/"),i=r(u[0]),o=r(u[1]),l=n.timeResolution(u[2]),this.timeTravelValues={add:{start:i,end:o,stepKind:l.unit,stepValue:l.step,ID:this.ID}}}},p}),r("gw/Layer/AbstractVectorLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle"],function(e,t,i,r){var n=function(e,r){this.zIndex=r.zIndex||i.DISPLAY.DEFAULT_VECTOR,t.prototype.constructor.call(this,e,r),this.vectorLayer=!0,this.url=r.url,this.draw=!1,r&&r.callback?this.callback=r.callback:this.callback=null,this.minLevel=r&&r.hasOwnProperty("minLevel")?r.minLevel:0,this.maxLevel=r&&r.hasOwnProperty("maxLevel")?r.maxLevel:21,this.features=[]};return e.inherits(t,n),n.prototype.getInformationType=function(){return i.INFORMATION_TYPE.VECTOR},n.prototype.getMinLevel=function(){return this.minLevel},n.prototype.getMaxLevel=function(){return this.maxLevel},n.prototype.getUrl=function(){return this.url},n.prototype.isForDataProvider=function(){return void 0===this.getUrl()},n.prototype.isDraw=function(){return this.draw},n.prototype.setDraw=function(t){e.assert("boolean"==typeof t,"value is not a boolean : "+t,"AbstractVectorLayer.js"),this.draw=t},n.prototype._attach=function(e){t.prototype._attach.call(this,e);for(var i=0;i<this.features.length;i++)this._addFeatureToRenderers(this.features[i])},n.prototype._detach=function(){for(var e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);t.prototype._detach.call(this)},n.prototype.addFeatureCollection=function(e){var t=e.features;if(t)for(var i=0;i<t.length;i++)this.addFeature(t[i])},n.prototype.removeFeatureCollection=function(e){var t=e.features;if(t)for(var i=0;i<t.length;i++)this.removeFeature(t[i])},n.prototype._isOnTerrain=function(e){var t=!0;const i=e.geometry.coordinates;if(i&&i[0]&&i[0][0]&&3===i[0][0].length){const i=(e.properties||{}).style||{};i.rendererHint&&"Tiled"===i.rendererHint||(t=!1)}return t},n.prototype._addFeatureToRenderers=function(e){var t,i=e.geometry,r=e.properties;if((t=r&&r.style?r.style:Object.assign({},this.style)).zIndex=this.zIndex,t.onTerrain=this._isOnTerrain(e),"GeometryCollection"===i.type)for(var n=i.geometries,o=0;o<n.length;o++)this.getGlobe().getRendererManager().addGeometry(this,n[o],t);else this.getGlobe().getRendererManager().addGeometry(this,i,t)},n.prototype._removeFeatureFromRenderers=function(e){var t=!0,i=e.geometry;if("GeometryCollection"===i.type){var r=i.geometries;if(this.getGlobe()&&this.getGlobe().getRendererManager())for(var n=0;n<r.length;n++)t=t&&this.getGlobe().getRendererManager().removeGeometry(r[n],this);else t=!1}else t=!(!this.getGlobe()||!this.getGlobe().getRendererManager())&&this.getGlobe().getRendererManager().removeGeometry(i,this);return t},n.prototype.addFeature=function(e){var t=e.geometry;t&&t.type&&(this.features.push(e),this.getGlobe()&&(this._addFeatureToRenderers(e),this.isVisible()&&this.getGlobe().getRenderContext().requestFrame()))},n.prototype.removeFeature=function(e){var t=this.features.indexOf(e);this.features.splice(t,1),this.getGlobe()&&(this._removeFeatureFromRenderers(e),this.isVisible()&&this.getGlobe().getRenderContext().requestFrame())},n.prototype.removeAllFeatures=function(){if(this.getGlobe())for(var e=0;e<this.features.length;e++)this._removeFeatureFromRenderers(this.features[e]);this.features.length=0,this.getGlobe()&&this.isVisible()&&this.getGlobe().getRenderContext().requestFrame()},n.prototype.modifyFeatureStyle=function(e,t){this._removeFeatureFromRenderers(e)&&(e.properties.style=t,this._addFeatureToRenderers(e))},n.prototype.modifyStyle=function(e){var t;for(t=0;t<this.features.length;t++)this._removeFeatureFromRenderers(this.features[t]);for(this.setStyle(e),t=0;t<this.features.length;t++)this._addFeatureToRenderers(this.features[t])},n}),r("gw/Layer/VectorLayer",["../Utils/Utils","./AbstractVectorLayer","../Utils/Constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,i.LAYER.Vector,e)};return e.inherits(t,r),r}),r("gw/Renderer/glMatrix",[],function(){var e=Array,t={create:function(t){var i=new e(3);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2]):i[0]=i[1]=i[2]=0,i},createFrom:function(t,i,r){var n=new e(3);return n[0]=t,n[1]=i,n[2]=r,n},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},equal:function(e,t){return e===t||Math.abs(e[0]-t[0])<1e-6&&Math.abs(e[1]-t[1])<1e-6&&Math.abs(e[2]-t[2])<1e-6},add:function(e,t,i){return i&&e!==i?(i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e)},subtract:function(e,t,i){return i&&e!==i?(i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],i):(e[0]-=t[0],e[1]-=t[1],e[2]-=t[2],e)},multiply:function(e,t,i){return i&&e!==i?(i[0]=e[0]*t[0],i[1]=e[1]*t[1],i[2]=e[2]*t[2],i):(e[0]*=t[0],e[1]*=t[1],e[2]*=t[2],e)},negate:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},scale:function(e,t,i){return i&&e!==i?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i):(e[0]*=t,e[1]*=t,e[2]*=t,e)},normalize:function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=Math.sqrt(i*i+r*r+n*n);return o?1===o?(t[0]=i,t[1]=r,t[2]=n,t):(o=1/o,t[0]=i*o,t[1]=r*o,t[2]=n*o,t):(t[0]=0,t[1]=0,t[2]=0,t)},cross:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=t[0],a=t[1],l=t[2];return i[0]=n*l-o*a,i[1]=o*s-r*l,i[2]=r*a-n*s,i},length:function(e){var t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)},squaredLength:function(e){var t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},lerp:function(e,t,i,r){r||(r=e);const n=1-i;return r[0]=n*e[0]+i*t[0],r[1]=n*e[1]+i*t[1],r[2]=n*e[2]+i*t[2],r},dist:function(e,t){var i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)},angle:function(e,i){return Math.atan2(t.length(t.cross(e,i)),t.dot(e,i))},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+"]"},createZPhi:function(e,i){var r=Math.sqrt((1-e)*(1+e)),n=r*Math.cos(i),o=r*Math.sin(i);return t.createFrom(n,o,e)},createPhiTheta:function(e,i){var r=Math.sin(i),n=r*Math.cos(e),o=r*Math.sin(e),s=r*Math.cos(i);return t.createFrom(n,o,s)},add2:function(e,t){var i=e[0],r=e[1],n=e[2];return[i+t[0],r+t[1],n+t[2]]},subtract2:function(e,t){var i=e[0],r=e[1],n=e[2];return[i-t[0],r-t[1],n-t[2]]},flip:function(e){var t=e[0],i=e[1],r=e[2];return[t=-t,i=-i,r=-r]},scale2:function(e,t){var i=e.x,r=e.y,n=e.z;return{x:i*t,y:r*=t,z:n*=t}},normalize2:function(e){var t=e[0],i=e[1],r=e[2],n=1/Math.sqrt(t*t+i*i+r*r);return[t*=n,i*=n,r*=n]},cross2:function(e,t){return{x:e[1]*t[2]-t[1]*e[2],y:e[2]*t[0]-t[2]*e[0],z:e[0]*t[1]-t[0]*e[1]}},length2:function(e){var t=e.x,i=e.y,r=e.z;return Math.sqrt(t*t+i*i+r*r)},dot2:function(e,t){var i=void 0!==e.x?e.x:e[0],r=void 0!==e.y?e.y:e[1],n=void 0!==e.z?e.z:e[2];return i*(void 0!==t.x?t.x:t[0])+r*(void 0!==t.y?t.y:t[1])+n*(void 0!==t.z?t.z:t[2])},angle2:function(e,i){return Math.atan2(t.length2(t.cross2(e,i)),t.dot2(e,i))}},i={create:function(t){var i=new e(9);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8]),i}},r={create:function(t){var i=new e(16);return t&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},equal:function(e,t){return e===t||Math.abs(e[0]-t[0])<1e-6&&Math.abs(e[1]-t[1])<1e-6&&Math.abs(e[2]-t[2])<1e-6&&Math.abs(e[3]-t[3])<1e-6&&Math.abs(e[4]-t[4])<1e-6&&Math.abs(e[5]-t[5])<1e-6&&Math.abs(e[6]-t[6])<1e-6&&Math.abs(e[7]-t[7])<1e-6&&Math.abs(e[8]-t[8])<1e-6&&Math.abs(e[9]-t[9])<1e-6&&Math.abs(e[10]-t[10])<1e-6&&Math.abs(e[11]-t[11])<1e-6&&Math.abs(e[12]-t[12])<1e-6&&Math.abs(e[13]-t[13])<1e-6&&Math.abs(e[14]-t[14])<1e-6&&Math.abs(e[15]-t[15])<1e-6},identity:function(e){return e||(e=r.create()),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},transpose:function(e,t){if(!t||e===t){var i=e[1],r=e[2],n=e[3],o=e[6],s=e[7],a=e[11];return e[1]=e[4],e[2]=e[8],e[3]=e[12],e[4]=i,e[6]=e[9],e[7]=e[13],e[8]=r,e[9]=o,e[11]=e[14],e[12]=n,e[13]=s,e[14]=a,e}return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},determinant:function(e){var t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15];return p*c*a*n-u*f*a*n-p*s*h*n+o*f*h*n+u*s*g*n-o*c*g*n-p*c*r*l+u*f*r*l+p*i*h*l-t*f*h*l-u*i*g*l+t*c*g*l+p*s*r*d-o*f*r*d-p*i*a*d+t*f*a*d+o*i*g*d-t*s*g*d-u*s*r*m+o*c*r*m+u*i*a*m-t*c*a*m-o*i*h*m+t*s*h*m},inverse:function(e,t){t||(t=e);var i,r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=r*l-n*a,x=r*u-o*a,w=r*c-s*a,T=n*u-o*l,_=n*c-s*l,C=o*c-s*u,S=h*m-d*g,E=h*v-p*g,A=h*y-f*g,I=d*v-p*m,M=d*y-f*m,k=p*y-f*v,D=b*k-x*M+w*I+T*A-_*E+C*S;return D?(i=1/D,t[0]=(l*k-u*M+c*I)*i,t[1]=(-n*k+o*M-s*I)*i,t[2]=(m*C-v*_+y*T)*i,t[3]=(-d*C+p*_-f*T)*i,t[4]=(-a*k+u*A-c*E)*i,t[5]=(r*k-o*A+s*E)*i,t[6]=(-g*C+v*w-y*x)*i,t[7]=(h*C-p*w+f*x)*i,t[8]=(a*M-l*A+c*S)*i,t[9]=(-r*M+n*A-s*S)*i,t[10]=(g*_-m*w+y*b)*i,t[11]=(-h*_+d*w-f*b)*i,t[12]=(-a*I+l*E-u*S)*i,t[13]=(r*I-n*E+o*S)*i,t[14]=(-g*T+m*x-v*b)*i,t[15]=(h*T-d*x+p*b)*i,t):null},toRotationMat:function(e,t){return t||(t=r.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},toMat3:function(e,t){return t||(t=i.create()),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},multiply:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],g=e[12],m=e[13],v=e[14],y=e[15],b=t[0],x=t[1],w=t[2],T=t[3];return i[0]=b*r+x*a+w*h+T*g,i[1]=b*n+x*l+w*d+T*m,i[2]=b*o+x*u+w*p+T*v,i[3]=b*s+x*c+w*f+T*y,b=t[4],x=t[5],w=t[6],T=t[7],i[4]=b*r+x*a+w*h+T*g,i[5]=b*n+x*l+w*d+T*m,i[6]=b*o+x*u+w*p+T*v,i[7]=b*s+x*c+w*f+T*y,b=t[8],x=t[9],w=t[10],T=t[11],i[8]=b*r+x*a+w*h+T*g,i[9]=b*n+x*l+w*d+T*m,i[10]=b*o+x*u+w*p+T*v,i[11]=b*s+x*c+w*f+T*y,b=t[12],x=t[13],w=t[14],T=t[15],i[12]=b*r+x*a+w*h+T*g,i[13]=b*n+x*l+w*d+T*m,i[14]=b*o+x*u+w*p+T*v,i[15]=b*s+x*c+w*f+T*y,i},multiplyVec3:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12],i[1]=e[1]*r+e[5]*n+e[9]*o+e[13],i[2]=e[2]*r+e[6]*n+e[10]*o+e[14],i},multiplyVec4:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=t[3];return i[0]=e[0]*r+e[4]*n+e[8]*o+e[12]*s,i[1]=e[1]*r+e[5]*n+e[9]*o+e[13]*s,i[2]=e[2]*r+e[6]*n+e[10]*o+e[14]*s,i[3]=e[3]*r+e[7]*n+e[11]*o+e[15]*s,i},project:function(e,t,i){i||(i=t),r.multiplyVec4(e,t,i);var n=1/i[3];return i[0]*=n,i[1]*=n,i[2]*=n,i},rotateVec3:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2];return i[0]=e[0]*r+e[4]*n+e[8]*o,i[1]=e[1]*r+e[5]*n+e[9]*o,i[2]=e[2]*r+e[6]*n+e[10]*o,i},translate:function(e,t,i){var r,n,o,s,a,l,u,c,h,d,p,f,g=t[0],m=t[1],v=t[2];return i&&e!==i?(r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],l=e[5],u=e[6],c=e[7],h=e[8],d=e[9],p=e[10],f=e[11],i[0]=r,i[1]=n,i[2]=o,i[3]=s,i[4]=a,i[5]=l,i[6]=u,i[7]=c,i[8]=h,i[9]=d,i[10]=p,i[11]=f,i[12]=r*g+a*m+h*v+e[12],i[13]=n*g+l*m+d*v+e[13],i[14]=o*g+u*m+p*v+e[14],i[15]=s*g+c*m+f*v+e[15],i):(e[12]=e[0]*g+e[4]*m+e[8]*v+e[12],e[13]=e[1]*g+e[5]*m+e[9]*v+e[13],e[14]=e[2]*g+e[6]*m+e[10]*v+e[14],e[15]=e[3]*g+e[7]*m+e[11]*v+e[15],e)},scale:function(e,t,i){var r=t[0],n=t[1],o=t[2];return i&&e!==i?(i[0]=e[0]*r,i[1]=e[1]*r,i[2]=e[2]*r,i[3]=e[3]*r,i[4]=e[4]*n,i[5]=e[5]*n,i[6]=e[6]*n,i[7]=e[7]*n,i[8]=e[8]*o,i[9]=e[9]*o,i[10]=e[10]*o,i[11]=e[11]*o,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i):(e[0]*=r,e[1]*=r,e[2]*=r,e[3]*=r,e[4]*=n,e[5]*=n,e[6]*=n,e[7]*=n,e[8]*=o,e[9]*=o,e[10]*=o,e[11]*=o,e)},rotate:function(e,t,i,r){var n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_,C,S,E,A,I=i[0],M=i[1],k=i[2],D=Math.sqrt(I*I+M*M+k*k);return D?(1!==D&&(I*=D=1/D,M*=D,k*=D),n=Math.sin(t),s=1-(o=Math.cos(t)),a=e[0],l=e[1],u=e[2],c=e[3],h=e[4],d=e[5],p=e[6],f=e[7],g=e[8],m=e[9],v=e[10],y=e[11],b=I*I*s+o,x=M*I*s+k*n,w=k*I*s-M*n,T=I*M*s-k*n,_=M*M*s+o,C=k*M*s+I*n,S=I*k*s+M*n,E=M*k*s-I*n,A=k*k*s+o,r?e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]):r=e,r[0]=a*b+h*x+g*w,r[1]=l*b+d*x+m*w,r[2]=u*b+p*x+v*w,r[3]=c*b+f*x+y*w,r[4]=a*T+h*_+g*C,r[5]=l*T+d*_+m*C,r[6]=u*T+p*_+v*C,r[7]=c*T+f*_+y*C,r[8]=a*S+h*E+g*A,r[9]=l*S+d*E+m*A,r[10]=u*S+p*E+v*A,r[11]=c*S+f*E+y*A,r):null},rotateX:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[4],s=e[5],a=e[6],l=e[7],u=e[8],c=e[9],h=e[10],d=e[11];return i?e!==i&&(i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[4]=o*n+u*r,i[5]=s*n+c*r,i[6]=a*n+h*r,i[7]=l*n+d*r,i[8]=o*-r+u*n,i[9]=s*-r+c*n,i[10]=a*-r+h*n,i[11]=l*-r+d*n,i},rotateY:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[0],s=e[1],a=e[2],l=e[3],u=e[8],c=e[9],h=e[10],d=e[11];return i?e!==i&&(i[4]=e[4],i[5]=e[5],i[6]=e[6],i[7]=e[7],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=o*n+u*-r,i[1]=s*n+c*-r,i[2]=a*n+h*-r,i[3]=l*n+d*-r,i[8]=o*r+u*n,i[9]=s*r+c*n,i[10]=a*r+h*n,i[11]=l*r+d*n,i},rotateZ:function(e,t,i){var r=Math.sin(t),n=Math.cos(t),o=e[0],s=e[1],a=e[2],l=e[3],u=e[4],c=e[5],h=e[6],d=e[7];return i?e!==i&&(i[8]=e[8],i[9]=e[9],i[10]=e[10],i[11]=e[11],i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15]):i=e,i[0]=o*n+u*r,i[1]=s*n+c*r,i[2]=a*n+h*r,i[3]=l*n+d*r,i[4]=o*-r+u*n,i[5]=s*-r+c*n,i[6]=a*-r+h*n,i[7]=l*-r+d*n,i},frustum:function(e,t,i,n,o,s,a){a||(a=r.create());var l=t-e,u=n-i,c=s-o;return a[0]=2*o/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/u,a[6]=0,a[7]=0,a[8]=(t+e)/l,a[9]=(n+i)/u,a[10]=-(s+o)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-s*o*2/c,a[15]=0,a},perspective:function(e,t,i,n,o){var s=i*Math.tan(e*Math.PI/360),a=s*t;return r.frustum(-a,a,-s,s,i,n,o)},ortho:function(e,t,i,n,o,s,a){a||(a=r.create());var l=t-e,u=n-i,c=s-o;return a[0]=2/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/u,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/l,a[13]=-(n+i)/u,a[14]=-(s+o)/c,a[15]=1,a},lookAt:function(e,t,i,n){n||(n=r.create());var o,s,a,l,u,c,h,d,p,f,g=e[0],m=e[1],v=e[2],y=i[0],b=i[1],x=i[2],w=t[0],T=t[1],_=t[2];return g===w&&m===T&&v===_?r.identity(n):(h=g-w,d=m-T,p=v-_,o=b*(p*=f=1/Math.sqrt(h*h+d*d+p*p))-x*(d*=f),s=x*(h*=f)-y*p,a=y*d-b*h,(f=Math.sqrt(o*o+s*s+a*a))?(o*=f=1/f,s*=f,a*=f):(o=0,s=0,a=0),l=d*a-p*s,u=p*o-h*a,c=h*s-d*o,(f=Math.sqrt(l*l+u*u+c*c))?(l*=f=1/f,u*=f,c*=f):(l=0,u=0,c=0),n[0]=o,n[1]=l,n[2]=h,n[3]=0,n[4]=s,n[5]=u,n[6]=d,n[7]=0,n[8]=a,n[9]=c,n[10]=p,n[11]=0,n[12]=-(o*g+s*m+a*v),n[13]=-(l*g+u*m+c*v),n[14]=-(h*g+d*m+p*v),n[15]=1,n)},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+"]"}},n={create:function(t){var i=new e(4);return t?(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3]):i[0]=i[1]=i[2]=i[3]=0,i},createFrom:function(t,i,r,n){var o=new e(4);return o[0]=t,o[1]=i,o[2]=r,o[3]=n,o},set:function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},equal:function(e,t){return e===t||Math.abs(e[0]-t[0])<1e-6&&Math.abs(e[1]-t[1])<1e-6&&Math.abs(e[2]-t[2])<1e-6&&Math.abs(e[3]-t[3])<1e-6},identity:function(e){return e||(e=n.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},calculateW:function(e,t){var i=e[0],r=e[1],n=e[2];return t&&e!==t?(t[0]=i,t[1]=r,t[2]=n,t[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),t):(e[3]=-Math.sqrt(Math.abs(1-i*i-r*r-n*n)),e)},dot:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},inverse:function(e,t){var i=e[0],r=e[1],n=e[2],o=e[3],s=i*i+r*r+n*n+o*o,a=s?1/s:0;return t&&e!==t?(t[0]=-e[0]*a,t[1]=-e[1]*a,t[2]=-e[2]*a,t[3]=e[3]*a,t):(e[0]*=-a,e[1]*=-a,e[2]*=-a,e[3]*=a,e)},conjugate:function(e,t){return t&&e!==t?(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t):(e[0]*=-1,e[1]*=-1,e[2]*=-1,e)},length:function(e){var t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)},normalize:function(e,t){t||(t=e);var i=e[0],r=e[1],n=e[2],o=e[3],s=Math.sqrt(i*i+r*r+n*n+o*o);return 0===s?(t[0]=0,t[1]=0,t[2]=0,t[3]=0,t):(s=1/s,t[0]=i*s,t[1]=r*s,t[2]=n*s,t[3]=o*s,t)},add:function(e,t,i){return i&&e!==i?(i[0]=e[0]+t[0],i[1]=e[1]+t[1],i[2]=e[2]+t[2],i[3]=e[3]+t[3],i):(e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[3],e)},multiply:function(e,t,i){i||(i=e);var r=e[0],n=e[1],o=e[2],s=e[3],a=t[0],l=t[1],u=t[2],c=t[3];return i[0]=r*c+s*a+n*u-o*l,i[1]=n*c+s*l+o*a-r*u,i[2]=o*c+s*u+r*l-n*a,i[3]=s*c-r*a-n*l-o*u,i},multiplyVec3:function(e,t,i){i||(i=t);var r=t[0],n=t[1],o=t[2],s=e[0],a=e[1],l=e[2],u=e[3],c=u*r+a*o-l*n,h=u*n+l*r-s*o,d=u*o+s*n-a*r,p=-s*r-a*n-l*o;return i[0]=c*u+p*-s+h*-l-d*-a,i[1]=h*u+p*-a+d*-s-c*-l,i[2]=d*u+p*-l+c*-a-h*-s,i},scale:function(e,t,i){return i&&e!==i?(i[0]=e[0]*t,i[1]=e[1]*t,i[2]=e[2]*t,i[3]=e[3]*t,i):(e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e)},toMat4:function(e,t){t||(t=r.create());var i=e[0],n=e[1],o=e[2],s=e[3],a=i+i,l=n+n,u=o+o,c=i*a,h=i*l,d=i*u,p=n*l,f=n*u,g=o*u,m=s*a,v=s*l,y=s*u;return t[0]=1-(p+g),t[1]=h+y,t[2]=d-v,t[3]=0,t[4]=h-y,t[5]=1-(c+g),t[6]=f+m,t[7]=0,t[8]=d+v,t[9]=f-m,t[10]=1-(c+p),t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},slerp:function(e,t,i,r){r||(r=e);var n,o,s,a,l=e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3];return Math.abs(l)>=1?(r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r):(n=Math.acos(l),o=Math.sqrt(1-l*l),Math.abs(o)<.001?(r[0]=.5*e[0]+.5*t[0],r[1]=.5*e[1]+.5*t[1],r[2]=.5*e[2]+.5*t[2],r[3]=.5*e[3]+.5*t[3],r):(s=Math.sin((1-i)*n)/o,a=Math.sin(i*n)/o,r[0]=e[0]*s+t[0]*a,r[1]=e[1]*s+t[1]*a,r[2]=e[2]*s+t[2]*a,r[3]=e[3]*s+t[3]*a,r))},fromRotationMatrix:function(e,t){t||(t=n.create());var i,r=e[0]+e[4]+e[8];if(r>0)i=Math.sqrt(r+1),t[3]=.5*i,i=.5/i,t[0]=(e[7]-e[5])*i,t[1]=(e[2]-e[6])*i,t[2]=(e[3]-e[1])*i;else{var o=n.fromRotationMatrix.s_iNext=n.fromRotationMatrix.s_iNext||[1,2,0],s=0;e[4]>e[0]&&(s=1),e[8]>e[3*s+s]&&(s=2);var a=o[s],l=o[a];i=Math.sqrt(e[3*s+s]-e[3*a+a]-e[3*l+l]+1),t[s]=.5*i,i=.5/i,t[3]=(e[3*l+a]-e[3*a+l])*i,t[a]=(e[3*a+s]+e[3*s+a])*i,t[l]=(e[3*l+s]+e[3*s+l])*i}return t},identity:function(e){return e||(e=n.create()),e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},fromAngleAxis:function(e,t,i){i||(i=n.create());var r=.5*e,o=Math.sin(r);return i[3]=Math.cos(r),i[0]=o*t[0],i[1]=o*t[1],i[2]=o*t[2],i},toAngleAxis:function(e,t){t||(t=e);var i=e[0]*e[0]+e[1]*e[1]+e[2]*e[2];if(i>0){t[3]=2*Math.acos(e[3]);var r=1/Math.sqrt(i);t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r}else t[3]=0,t[0]=1,t[1]=0,t[2]=0;return t},str:function(e){return"["+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+"]"}};return window.vec3=t,window.mat4=r,window.quat4=n,r}),r("gw/Renderer/Ray",["./glMatrix"],function(){var e=function(e,t){this.orig=e,this.dir=t};e.createFromPixel=function(t,i,r){var n=i/t.canvas.width*2-1,o=-(r/t.canvas.height*2-1),s=mat4.create();mat4.inverse(t.viewProjectionMatrix,s);var a=mat4.multiplyVec4(s,[n,o,-1,1]);a[0]/=a[3],a[1]/=a[3],a[2]/=a[3];var l=mat4.create();mat4.inverse(t.viewMatrix,l),vec3.set([0,0,0],t.eyePosition),mat4.multiplyVec3(l,t.eyePosition);var u=vec3.create(t.eyePosition),c=vec3.subtract(a,t.eyePosition,vec3.create());return vec3.normalize(c),new e(u,c)},e.createFromEvent=function(t,i){var r=t.getXYRelativeToCanvas(i);return e.createFromPixel(r[0],r[1])},e.Intersection=function(e){this.t=e,this.geometry=null},e.prototype.computePoint=function(e){var t=vec3.create();return vec3.scale(this.dir,e,t),vec3.add(t,this.orig),t},e.prototype.planeIntersect=function(e,t){var i=vec3.dot(t,this.dir);if(Math.abs(i)>1e-6){var r=vec3.create();return vec3.subtract(e,this.orig,r),vec3.dot(r,t)/i}return-1},e.prototype.sphereIntersect=function(e,t){var i=vec3.subtract(this.orig,e,vec3.create()),r=2*vec3.dot(this.dir,i),n=r*r-4*(vec3.dot(i,i)-t*t);if(n<0)return-1;var o=(-r-(n=Math.sqrt(n)))/2,s=(-r+n)/2;if(o>s){var a=o;o=s,s=a}return s<0?-1:o<0?s:o};return e.prototype.triangleIntersectOptimized=function(t,i,r,n){var o=t[r]-t[i],s=t[r+1]-t[i+1],a=t[r+2]-t[i+2],l=t[n]-t[i],u=t[n+1]-t[i+1],c=t[n+2]-t[i+2],h=this.dir[1]*c-this.dir[2]*u,d=this.dir[2]*l-this.dir[0]*c,p=this.dir[0]*u-this.dir[1]*l,f=o*h+s*d+a*p;if(f>-1e-15&&f<1e-15)return null;var g=1/f,m=this.orig[0]-t[i],v=this.orig[1]-t[i+1],y=this.orig[2]-t[i+2],b=(m*h+v*d+y*p)*g;if(b<0||b>1)return null;var x=v*a-y*s,w=y*o-m*a,T=m*s-v*o,_=(this.dir[0]*x+this.dir[1]*w+this.dir[2]*T)*g;if(_<0||b+_>1)return null;var C=(l*x+u*w+c*T)*g;return C>=0?new e.Intersection(C):null},e.prototype.nodeIntersect=function(e,t){var i;for(t=t||[],i=0;i<e.children.length;i++)e.children[i].intersectWith(this,t);for(i=0;i<e.geometries.length;i++)this.geometryIntersect(e.geometries[i],t);return t.sort(function(e,t){return e.t-t.t}),t},e.prototype.lodNodeIntersect=function(e,t){var i;if(t=t||[],this.sphereIntersect(e.center,e.radius)>=0)if(e.children.length>0&&0===e.childToLoad)for(i=0;i<e.children.length;i++)this.lodNodeIntersect(e.children[i],t);else for(i=0;i<e.geometries.length;i++)this.geometryIntersect(e.geometries[i],t);return t},e.prototype.geometryIntersect=function(e,t){for(var i=e.mesh.indices,r=0;r<i.length;r+=3){var n=this.triangleIntersectOptimized(e.mesh.vertices,e.mesh.numElements*i[r],e.mesh.numElements*i[r+1],e.mesh.numElements*i[r+2]);n&&(n.geometry=e,t.push(n))}},e}),r("gw/Services/MeasureToolPlanetCore",["jquery","underscore-min","../Utils/Constants","../Layer/VectorLayer","../Renderer/Ray","../Utils/Numeric","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(e,t,i,r,n,o,s){var a,l,u,c,h,d;function p(e,t){t=o.toRadian(t);var i=Math.cos(t),r=Math.sin(t);return[e[0]*i-e[1]*r,e[0]*r+e[1]*i]}return{init:function(e){l=e.mizar,a=l.getActivatedContext().getNavigation(),u=e.onselect,h=this,d=!1,c=l.LayerFactory.create({type:i.LAYER.Vector,visible:!0}),l.getPlanetContext().addDraw(c),this.activated=!1,this.renderContext=l.getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:function(e){if(e.preventDefault(),h.activated){a.stop(),d=!0,h.elevations=[],e.type.search("touch")>=0?h.pickPoint=[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:h.pickPoint=[e.layerX,e.layerY];var t=l.getActivatedContext().getLonLatFromPixel(h.pickPoint[0],h.pickPoint[1]);return null===t?null:(h.geoPickPoint=t,h.geoPickPoint)}},_handleMouseUp:function(e){var i;if(e.preventDefault(),i=e.type.search("touch")>=0?l.getActivatedContext().getLonLatFromPixel(e.changedTouches[0].clientX,e.changedTouches[0].clientY):l.getActivatedContext().getLonLatFromPixel(e.layerX,e.layerY),!t.isEmpty(i)){var r=vec3.dot(vec3.normalize(l.getCrs().get3DFromWorld(i)),vec3.normalize(l.getCrs().get3DFromWorld(h.geoPickPoint))),n=Math.acos(r);h.geoDistance=o.toDegree(n),u&&u()}a.start(),d=!1},_handleMouseMove:function(e){if(e.preventDefault(),h.activated&&d&&(e.type.search("touch")>=0?h.secondPickPoint=[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:h.secondPickPoint=[e.layerX,e.layerY],null!==l.getActivatedContext().getLonLatFromPixel(h.secondPickPoint[0],h.secondPickPoint[1]))){var t;h.secondGeoPickPoint=l.getActivatedContext().getLonLatFromPixel(h.secondPickPoint[0],h.secondPickPoint[1]),h.distance=Math.sqrt(Math.pow(h.secondPickPoint[0]-h.pickPoint[0],2)+Math.pow(h.secondPickPoint[1]-h.pickPoint[1],2)),t=void 0===h.secondGeoPickPoint?vec3.dot(vec3.normalize(l.getCrs().get3DFromWorld(h.secondPickPoint)),vec3.normalize(l.getCrs().get3DFromWorld(h.geoPickPoint))):vec3.dot(vec3.normalize(l.getCrs().get3DFromWorld(h.secondGeoPickPoint)),vec3.normalize(l.getCrs().get3DFromWorld(h.geoPickPoint)));var r=Math.acos(t);h.geoDistance=o.toDegree(r),function(){h.clear(),h.geoPickPoint,h.secondGeoPickPoint;var e=h.computeMeasure();h.measureFeature=function(e){return{geometry:{gid:"measureShape",coordinates:e,type:i.GEOMETRY.LineString,crs:{type:"name",properties:{name:l.getCrs().getGeoideName()}}},properties:{style:new s({fillColor:[1,0,0,1],zIndex:i.DISPLAY.SERVICE_VECTOR})},type:"Feature"}}(e);var t=[(h.secondPickPoint[0]+h.pickPoint[0])/2,(h.secondPickPoint[1]+h.pickPoint[1])/2],r=l.getActivatedContext().getLonLatFromPixel(t[0],t[1]),n=h.calculateDistanceElevation(h.geoPickPoint,h.secondGeoPickPoint);n=o.roundNumber(n.toFixed(3),2),h.measureLabel=function(e,t){return{geometry:{type:i.GEOMETRY.Point,gid:"measureShape",coordinates:e,crs:{type:"name",properties:{name:l.getCrs().getGeoideName()}}},properties:{style:new s({label:t+" km",fillColor:[1,1,1,1],pointMaxSize:600,zIndex:i.DISPLAY.SERVICE_VECTOR})}}}(r,n),c.addFeature(h.measureFeature),c.addFeature(h.measureLabel)}()}},clear:function(){h.measureFeature&&c.removeFeature(h.measureFeature),h.measureLabel&&c.removeFeature(h.measureLabel)},remove:function(){h.clear(),l.getPlanetContext().removeDraw(c)},updateContext:function(e){a=(l=e).getActivatedContext().getNavigation(),d=!1,c||(c=new r),l.getPlanetContext().addDraw(c),this.activated=!1,this.renderContext=l.getRenderContext(),this.elevations=[],this.measureFeature=null},calculateIntermediateElevationPoint:function(e,t,i){var r,n=50|e.nbPoints,o=t[0]-i[0];r=o>180?-(o=360-o)/n:o<-180?(o=360+o)/n:o/n;var s=(t[1]-i[1])/n,a=[];a[0]=t;for(var l=1;l<n;l++){var u=a[l-1][0]-r;u>180?u-=360:u<-180&&(u+=360);var c=a[l-1][1]-s;a[l]=[u,c]}return a[n]=i,a},calculateDistanceElevation:function(e,t){var i=l.getCrs().getGeoide().getRealPlanetRadius(),r=o.toRadian(e[1]),n=o.toRadian(t[1]),s=o.toRadian(t[1]-e[1]),a=o.toRadian(t[0]-e[0]),u=Math.sin(s/2)*Math.sin(s/2)+Math.cos(r)*Math.cos(n)*Math.sin(a/2)*Math.sin(a/2);return i*(2*Math.atan2(Math.sqrt(u),Math.sqrt(1-u)))/1e3},computeMeasure:function(){var e=[h.secondGeoPickPoint[0]-h.geoPickPoint[0],h.secondGeoPickPoint[1]-h.geoPickPoint[1],0],t=vec3.create(e),i=vec3.length(t);vec3.normalize(t),vec3.scale(t,.001*i);var r=p(t,30),n=p(t,-30);r=[h.geoPickPoint[0]+10*r[0],h.geoPickPoint[1]+10*r[1]],n=[h.geoPickPoint[0]+10*n[0],h.geoPickPoint[1]+10*n[1]];var o=[-t[0],-t[1]],s=p(o,30),a=p(o,-30);return s=[h.secondGeoPickPoint[0]+10*s[0],h.secondGeoPickPoint[1]+10*s[1]],a=[h.secondGeoPickPoint[0]+10*a[0],h.secondGeoPickPoint[1]+10*a[1]],[[r[0],r[1],null],[h.geoPickPoint[0],h.geoPickPoint[1],null],[n[0],n[1],null],[h.geoPickPoint[0],h.geoPickPoint[1],null],[h.secondGeoPickPoint[0],h.secondGeoPickPoint[1],null],[s[0],s[1],null],[h.secondGeoPickPoint[0],h.secondGeoPickPoint[1],null],[a[0],a[1],null]]},storeDistanceAndElevation:function(e,t){var i=h.calculateDistanceElevation(e,t);i=o.roundNumber(i.toFixed(3),2);var r=l.getActivatedContext().getElevation(t[0],t[1]),n=l.getActivatedContext().getBaseElevation().getScale(),s=[i,r=o.roundNumber(r/n,0)];h.elevations.push(s)}}}),r("gw/Services/MeasureToolSkyCore",["jquery","underscore-min","../Utils/Numeric","../Utils/Constants","../Layer/VectorLayer","../Renderer/Ray","../Renderer/FeatureStyle","../Renderer/glMatrix"],function(e,t,i,r,n,o,s){var a,l,u,c,h,d;function p(e,t){t=t*Math.PI/180;var i=Math.cos(t),r=Math.sin(t);return[e[0]*i-e[1]*r,e[0]*r+e[1]*i]}return{init:function(e){a=e.mizar,l=a.getActivatedContext().getNavigation(),u=e.onselect,h=this,d=!1,c=a.LayerFactory.create({type:r.LAYER.Vector,visible:!0}),a.getSkyContext().addDraw(c),this.activated=!1,this.renderContext=a.getRenderContext(),this.elevations=[],this.measureFeature=null},_handleMouseDown:function(e){e.preventDefault(),h.activated&&(h.distance=0,l.stop(),d=!0,h.elevations=[],e.type.search("touch")>=0?h.pickPoint=[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:h.pickPoint=[e.layerX,e.layerY],h.geoPickPoint=a.getActivatedContext().getLonLatFromPixel(h.pickPoint[0],h.pickPoint[1]))},_handleMouseUp:function(e){if(e.preventDefault(),h.activated){var t;t=e.type.search("touch")>=0?a.getActivatedContext().getLonLatFromPixel(e.changedTouches[0].clientX,e.changedTouches[0].clientY):a.getActivatedContext().getLonLatFromPixel(e.layerX,e.layerY);var r=vec3.dot(vec3.normalize(a.getCrs().get3DFromWorld(t)),vec3.normalize(a.getCrs().get3DFromWorld(h.geoPickPoint))),n=Math.acos(r);h.geoDistance=i.toDegree(n),u&&u(),l.start(),d=!1}},_handleMouseMove:function(e){if(e.preventDefault(),h.activated&&d){e.type.search("touch")>=0?h.secondPickPoint=[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:h.secondPickPoint=[e.layerX,e.layerY],h.secondGeoPickPoint=a.getActivatedContext().getLonLatFromPixel(h.secondPickPoint[0],h.secondPickPoint[1]),h.distance=Math.sqrt(Math.pow(h.secondPickPoint[0]-h.pickPoint[0],2)+Math.pow(h.secondPickPoint[1]-h.pickPoint[1],2));var t=vec3.dot(vec3.normalize(a.getCrs().get3DFromWorld(h.secondGeoPickPoint)),vec3.normalize(a.getCrs().get3DFromWorld(h.geoPickPoint))),r=Math.acos(t);h.geoDistance=i.toDegree(r),h.updateMeasure()}},updateMeasure:function(){h.clear();var e=h.computeMeasure();e.push(e[0]),h.measureFeature={geometry:{gid:"measureShape",coordinates:[e],type:r.GEOMETRY.Polygon,crs:{type:"name",properties:{name:a.getCrs().getGeoideName()}}},properties:{style:new s({zIndex:r.DISPLAY.SERVICE_VECTOR,fillColor:[1,0,0,1]})},type:"Feature"};var t=[(h.secondPickPoint[0]+h.pickPoint[0])/2,(h.secondPickPoint[1]+h.pickPoint[1])/2],i=a.getActivatedContext().getLonLatFromPixel(t[0],t[1]);h.measureLabel={geometry:{type:r.GEOMETRY.Point,gid:"measureShape",coordinates:i,crs:{type:"name",properties:{name:a.getCrs().getGeoideName()}}},properties:{style:new s({label:a.getCrs().fromDegreesToDMS(h.geoDistance),fillColor:[1,1,1,1],zIndex:r.DISPLAY.SERVICE_VECTOR})}},h.geoDistance,e[0][0],e[0][1],e[0][2],c.addFeature(h.measureFeature),c.addFeature(h.measureLabel)},clear:function(){h.measureFeature&&c.removeFeature(h.measureFeature),h.measureLabel&&c.removeFeature(h.measureLabel)},remove:function(){h.clear(),a.getSkyContext().removeDraw(c)},computeMeasure:function(){var e=h.renderContext,t=2/e.canvas.width,i=2/e.canvas.height,r=[h.secondPickPoint[0]-h.pickPoint[0],h.secondPickPoint[1]-h.pickPoint[1]];!function(e,t){t||(t=e);var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]);t[0]=e[0]/i,t[1]=e[1]/i}(r);var n=p(r,30),o=p(r,-30);n=[h.pickPoint[0]+10*n[0],h.pickPoint[1]+10*n[1]],o=[h.pickPoint[0]+10*o[0],h.pickPoint[1]+10*o[1]];var s=[-r[0],-r[1]],a=p(s,30),l=p(s,-30);a=[h.secondPickPoint[0]+10*a[0],h.secondPickPoint[1]+10*a[1]],l=[h.secondPickPoint[0]+10*l[0],h.secondPickPoint[1]+10*l[1]];var u=[[h.pickPoint[0]*t-1,(e.canvas.height-h.pickPoint[1])*i-1,1,1],[n[0]*t-1,(e.canvas.height-n[1])*i-1,1,1],[h.pickPoint[0]*t-1,(e.canvas.height-h.pickPoint[1])*i-1,1,1],[o[0]*t-1,(e.canvas.height-o[1])*i-1,1,1],[h.pickPoint[0]*t-1,(e.canvas.height-h.pickPoint[1])*i-1,1,1],[h.secondPickPoint[0]*t-1,(e.canvas.height-h.secondPickPoint[1])*i-1,1,1],[a[0]*t-1,(e.canvas.height-a[1])*i-1,1,1],[h.secondPickPoint[0]*t-1,(e.canvas.height-h.secondPickPoint[1])*i-1,1,1],[l[0]*t-1,(e.canvas.height-l[1])*i-1,1,1],[h.secondPickPoint[0]*t-1,(e.canvas.height-h.secondPickPoint[1])*i-1,1,1]];return this.computeIntersection(u),u},computeIntersection:function(e){var t=h.renderContext,i=mat4.create();mat4.inverse(t.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(t.projectionMatrix,t.viewMatrix,i),mat4.inverse(i);for(var n=[0,0,0],s=0;s<e.length;s++){mat4.multiplyVec4(i,e[s]),vec3.scale(e[s],1/e[s][3]),vec3.subtract(e[s],r,e[s]),vec3.normalize(e[s]);var l=new o(r,e[s]),u=l.computePoint(l.sphereIntersect(n,a.getCrs().getGeoide().getRadius()));e[s]=a.getCrs().getWorldFrom3D(u)}return e}}}),r("gw/Layer/MocLayer",["jquery","underscore-min","./AbstractLayer","../Utils/Constants","../Renderer/FeatureStyle","../Utils/Utils","../Tiling/HEALPixBase","./FitsLoader","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l){var u=function(e){e.dataType=r.GEOMETRY.LineString,i.prototype.constructor.call(this,r.LAYER.Moc,e),this.baseUrl=this.allowRequest(e.baseUrl),this.startOrder=e.startOrder||2,e.coordinateSystem&&e.coordinateSystem.geoideName?this.crs={properties:{name:e.coordinateSystem.geoideName}}:this.crs={properties:{name:"Equatorial"}},e&&e.style?this.style=new n(e.style):this.style=new n,this.featuresSet=null};return o.inherits(i,u),u.prototype.getInformationType=function(){return r.INFORMATION_TYPE.VECTOR},u.prototype._attach=function(n){i.prototype._attach.call(this,n);var u,c=this;try{a.loadFits(c.baseUrl,function(e){var i={},r=e.getHDU(1).data;for(u=0;u<r.rows;u++){var n=r.getRow(u),o=s.uniq2hpix(n[r.columns[0]]),a=o[0];void 0===i[a]&&(i[a]=[]),i[a].push(o[1])}if(i.hasOwnProperty("0")||i.hasOwnProperty("1")||i.hasOwnProperty("2"))for(u=0;u<3;u++)if(i.hasOwnProperty(u)){var l=i[u];t.each(l,function(e){var t=s.getChildren(e);i.hasOwnProperty(u+1)||(i[u+1]=[]),i[u+1].push(t[0]),i[u+1].push(t[1]),i[u+1].push(t[2]),i[u+1].push(t[3])}),delete i[u]}c.moc=i,c.handleDistribution(i),e=null})}catch(t){o.requestUrl(c.baseUrl,"json","application/json",null,function(e){c.handleDistribution(e)},function(t){e("#addLayer_"+c.id).find("label").css("color","red"),l.open(r.LEVEL.ERROR,"Failed ot request "+c.baseUrl,t)})}n.getTileManager().addPostRenderer(this)},u.prototype.generate=function(e){if(this.featuresSet&&e.order===this.startOrder){var t=this.featuresSet[e.pixelIndex];if(t)for(var i=0;i<t.length;i++)this.getGlobe().getRendererManager().addGeometryToTile(this,t[i],this.style,e)}},u.prototype.render=function(){},u.prototype._detach=function(){for(var e in this.featuresSet)if(this.featuresSet.hasOwnProperty(e))for(var t=this.getGlobe().getTileManager().level0Tiles[e],r=0;r<this.featuresSet[e].length;r++)this.getGlobe().getRendererManager().removeGeometryFromTile(this.featuresSet[e][r],t);this.featuresSet=null,this.getGlobe().getTileManager().removePostRenderer(this),i.prototype._detach.call(this)},u.prototype.findChildIndices=function(e,t){for(var i=this.startOrder-t,r=Math.pow(4,i),n=e*r,o=[],s=n;s<n+r;s++)o.push(s);return o},u.prototype.findParentIndex=function(e,t){var i=t-this.startOrder;return Math.floor(e/Math.pow(4,i))},u.prototype.handleDistribution=function(e){var t,i,n,o;this.getGlobe().getTileManager().getRenderContext().gl;for(var a in this.featuresSet={},e)if(e.hasOwnProperty(a)){var l=parseInt(a,10);for(i=0;i<e[a].length;i++){var u=e[a][i];if(l>this.startOrder)t=this.findParentIndex(u,l);else{if(l!==this.startOrder){var c=this.findChildIndices(u,l);void 0===e[this.startOrder.toString()]?e[this.startOrder.toString()]=e[0].concat(c):e[this.startOrder.toString()]=e[this.startOrder.toString()].concat(c);continue}t=u}var h={type:r.GEOMETRY.Polygon,gid:"moc"+this.id+"_"+l+"_"+u,crs:this.crs,coordinates:[[]]},d=2,p=1;l<5&&(p=1/((d=5)-1));var f,g,m=Math.pow(2,l),v=u&m*m-1,y=s.compress_bits(v),b=s.compress_bits(v>>>1),x=u>>>2*l;for(n=0;n<2;n++)for(o=0;o<d;o++)f=s.fxyf((y+n*(d-1)*p)/m,(b+o*p)/m,x),g=this.getGlobe().getCoordinateSystem().getWorldFrom3D(f),0===n?h.coordinates[0][2*n*d+(d-1)-o]=[g[0],g[1]]:h.coordinates[0][2*n*d+o]=[g[0],g[1]];for(o=0;o<2;o++)for(n=0;n<d;n++)f=s.fxyf((y+n*p)/m,(b+o*(d-1)*p)/m,x),g=this.getGlobe().getCoordinateSystem().getWorldFrom3D(f),1===o?h.coordinates[0][d+2*o*d+(d-1)-n]=[g[0],g[1]]:h.coordinates[0][d+2*o*d+n]=[g[0],g[1]];var w=this.getGlobe().getTileManager().level0Tiles[t];this.featuresSet[t]||(this.featuresSet[t]=[]),this.featuresSet[t].push(h),this.getGlobe().getRendererManager().addGeometryToTile(this,h,this.style,w)}}},u}),r("gw/Services/MocBase",["jquery","../Renderer/FeatureStyle","../Layer/MocLayer","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o,s;return{init:function(e,t){o=e},createMocSublayer:function(e,i,s){var a;if(e.getBaseUrl()){a=function(e,i){var n;return e.getStyle()?((n=e.getStyle()).fill=!0,n.hasOwnProperty("fillColor")?n.fillColor[3]=.3:n.fillColor=[1,0,0,.3]):n=new t({rendererHint:"Basic",fill:!0,fillColor:[1,0,0,.3]}),o.addLayer({type:r.LAYER.Moc,baseUrl:i,style:n,visible:!1})}(e,e.getBaseUrl());var l=o.getLayerByID(a);e.skyFraction?l.coverage=n.roundNumber(100*parseFloat(e.skyFraction),2)+"%":l.coverage="Not available",i(l)}else s(e);return a},findMocSublayer:function(e){return o.getLayerByID(e)},intersectLayers:function(e){for(var r=s,n="",a=0;a<e.length;a++){var l=e[a];n+=l.getName(),r+=l.describeUrl,a!==e.length-1&&(r+=";",n+=" x ")}var u=new i({name:"Intersection( "+n+" )",serviceUrl:r+"&media=json",style:new t({rendererHint:"Basic",fill:!0,fillColor:[1,0,0,.3]}),visible:!1});return o.getSkyContext().globe.addLayer(u),u.describeUrl=r,u}}}),r("gw/Services/MollweideViewerCore",["jquery","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(e,t,i){var r,n,o,s,a,l,u,c,h,d,p,f,g;function m(e){if(Math.abs(e)===Math.PI/2)return e;var t,i;do{(t=i)||(t=e);var r=2*t;i=r/2-(r+Math.sin(r)-Math.PI*Math.sin(e))/(2+2*Math.cos(r))}while(Math.abs(i-t)>=.001);return i}function v(e){var t=r.getCrs().getWorldFrom3D(e);t[0]>180&&(t[0]-=360);var i=t[0]*Math.PI/180,n=m(t[1]*Math.PI/180),o=2*Math.sqrt(2)/Math.PI*i*Math.cos(n),c=Math.sqrt(2)*Math.sin(n);return[-o*u/2.8+u+s,-c*l/1.38+l+a]}function y(){p.clearRect(0,0,p.canvas.width,p.canvas.height),p.drawImage(g,0,0),p.fillStyle="rgb(255,0,0)";for(var n,s,a=r.getRenderContext().canvas.clientWidth/(c-1),l=r.getRenderContext().canvas.clientHeight/(c-1),u=0;u<c;u++)for(var d=0;d<c;d++)s=v((n=i.createFromPixel(r.getRenderContext(),u*a,d*l)).computePoint(n.sphereIntersect([0,0,0],r.getCrs().getGeoide().getRadius()))),p.fillRect(s[0],s[1],2,2);p.fillStyle=h.color,s=v(o.center3d),h.x=s[0]-h.size/2,h.y=s[1]-h.size/2,p.fillRect(s[0]-h.size/2,s[1]-h.size/2,h.size,h.size);var f=o.getFov(),m=t.roundNumber(f[0],2);m=r.getCrs().fromDegreesToDMS(m);var y=t.roundNumber(f[1],2);y=r.getCrs().fromDegreesToDMS(y),e("#fov").html("Fov : "+m+" x "+y)}return{init:function(e){r=e.mizar,n=e.mizarBaseUrl,o=r.getActivatedContext().getNavigation(),s=16,a=8,l=50,u=100,c=9,h=new function(e){for(var t in this.x=0|e.x,this.y=0|e.y,this.color="rgb(255,0,0)"|e.color,this.size=2|e.size,e)e.hasOwnProperty(t)&&(this[t]=e[t])}({size:5,color:"rgb(255,255,0)"}),d=document.getElementById("mollweideCanvas"),p=d.getContext("2d"),f=this,(g=new Image).onload=function(){p.drawImage(g,0,0),y()}},getImageObj:function(){return g},_findTheta:m,computeMollweidePosition:v,updateNavigation:function(e){h.x=2.8*-(e[0]-u-s)/u,h.y=1.38*-(e[1]-l-a)/l;var t=Math.asin(h.y/Math.sqrt(2)),i=Math.asin((2*t+Math.sin(2*t))/Math.PI),n=[Math.PI*h.x/(2*Math.sqrt(2)*Math.cos(t))*180/Math.PI,180*i/Math.PI];r.getCrs().get3DFromWorld(n,o.center3d),o.computeViewMatrix()},updateMollweideFov:y,updateGalaxyProjection:function(t){e(f.getImageObj()).attr("src",n+"css/images/MollweideSky_"+t.getCoordinateSystem().getGeoideName()+".png")}}}),r("gw/Renderer/GeoBound",["../Utils/Constants"],function(e){var t=function(e,t,i,r){this.south=t,this.west=e,this.north=r,this.east=i};return t.prototype.getCenter=function(){return[.5*(this.east+this.west),.5*(this.south+this.north),0]},t.prototype.getNorth=function(){return this.north},t.prototype.setNorth=function(e){this.north=e},t.prototype.getSouth=function(){return this.south},t.prototype.setSouth=function(e){this.south=e},t.prototype.getWest=function(){return this.west},t.prototype.setWest=function(e){this.west=e},t.prototype.getEast=function(){return this.east},t.prototype.setEast=function(e){this.east=e},t.prototype.computeFromCoordinates=function(e){this.west=e[0][0],this.east=e[0][0],this.south=e[0][1],this.north=e[0][1];for(var t=1;t<e.length;t++)this.west=Math.min(this.west,e[t][0]),this.east=Math.max(this.east,e[t][0]),this.south=Math.min(this.south,e[t][1]),this.north=Math.max(this.north,e[t][1])},t.prototype.computeFromCoordinatesInCrsTo=function(e,t,i){var r;return r=t===i.getGeoideName()?e:function(e,t,i){for(var r=e.length,n=new Array(r),o=0;o<r;++o)n[o]=e[o].slice(0);n[0][0]=i.convert(e[0][0],t,i.getGeoideName()),n[0][1]=i.convert(e[0][1],t,i.getGeoideName());for(var s=1;s<e.length;s++)n[s][0]=i.convert(e[s][0],t,i.getGeoideName()),n[s][1]=i.convert(e[s][1],t,i.getGeoideName());return n}(e,t,i),this.computeFromCoordinates(r),r},t.prototype.isPointInside=function(e){return e[0]>=this.west&&e[0]<=this.east&&e[1]>=this.south&&e[1]<=this.north},t.prototype.intersects=function(e){return!(this.west>=e.east||this.east<=e.west)&&!(this.south>=e.north||this.north<=e.south)},t.prototype.intersectsGeometry=function(i){var r,n,o=!1,s=new t,a=i.coordinates;switch(i.type){case e.GEOMETRY.LineString:s.computeFromCoordinates(a),o|=this.intersects(s);break;case e.GEOMETRY.Polygon:case e.GEOMETRY.MultiLineString:for(r=0;r<a.length&&!o;r++)s.computeFromCoordinates(a[r]),o|=this.intersects(s);break;case e.GEOMETRY.MultiPolygon:for(r=0;r<a.length&&!o;r++)for(n=0;n<a[r].length&&!o;n++)s.computeFromCoordinates(a[r][n]),o|=this.intersects(s)}return o},t}),r("gw/Renderer/Program",["../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy"],function(e,t,i){var r=function(e){this.renderContext=e,this.glProgram=null,this.attributes={},this.uniforms={},this.numActiveAttribArray=0};return r.prototype.createShader=function(i,r){var n=this.renderContext.gl,o=n.createShader(i);return n.shaderSource(o,r),n.compileShader(o),n.getShaderParameter(o,n.COMPILE_STATUS)?o:(t.open(e.LEVEL.DEBUG,"Program.js","Shader compilation error: "+n.getShaderInfoLog(o)),t.open(e.LEVEL.DEBUG,"Program.js",r),n.deleteShader(o),null)},r.prototype.createFromSource=function(i,r){var n,o=this.renderContext.gl,s=this.createShader(o.VERTEX_SHADER,i),a=this.createShader(o.FRAGMENT_SHADER,r);if(null===s||null===a)return!1;if(this.glProgram=o.createProgram(),o.attachShader(this.glProgram,s),o.attachShader(this.glProgram,a),o.linkProgram(this.glProgram),!o.getProgramParameter(this.glProgram,o.LINK_STATUS))return t.open(e.LEVEL.DEBUG,"Program.js","Program link error: "+o.getProgramInfoLog(this.glProgram)),o.deleteShader(s),o.deleteShader(a),o.deleteProgram(this.glProgram),this.glProgram=null,!1;var l=o.getProgramParameter(this.glProgram,o.ACTIVE_ATTRIBUTES);for(this.numActiveAttribArray=0,n=0;n<l;++n){var u=o.getActiveAttrib(this.glProgram,n),c=o.getAttribLocation(this.glProgram,u.name);this.attributes[u.name]=c,c+1>this.numActiveAttribArray&&(this.numActiveAttribArray=c+1)}var h=o.getProgramParameter(this.glProgram,o.ACTIVE_UNIFORMS);for(n=0;n<h;++n){var d=o.getActiveUniform(this.glProgram,n);this.uniforms[d.name]=o.getUniformLocation(this.glProgram,d.name)}return!0},r.prototype.loadFromFile=function(e,t){var r=new XMLHttpRequest;r.open("get",i.proxify(this.renderContext.shadersPath+e),!1),r.send(null);var n=r.responseText;r.open("get",i.proxify(this.renderContext.shadersPath+t),!1),r.send(null);var o=r.responseText;return this.createFromSource(n,o)},r.prototype.apply=function(){var e,t=this.renderContext,i=t.gl;for(i.useProgram(this.glProgram),e=t.numActiveAttribArray;e<this.numActiveAttribArray;e++)i.enableVertexAttribArray(e);for(e=this.numActiveAttribArray;e<t.numActiveAttribArray;e++)i.disableVertexAttribArray(e);t.numActiveAttribArray=this.numActiveAttribArray},r.prototype.dispose=function(){this.renderContext.gl.deleteProgram(this.glProgram)},r}),r("gw/Renderer/BoundingBox",[],function(){var e=function(e,t){e&&(this.min=vec3.create(e)),t&&(this.max=vec3.create(t))};return e.prototype.extend=function(e,t,i){this.min?(e<this.min[0]&&(this.min[0]=e),t<this.min[1]&&(this.min[1]=t),i<this.min[2]&&(this.min[2]=i),e>this.max[0]&&(this.max[0]=e),t>this.max[1]&&(this.max[1]=t),i>this.max[2]&&(this.max[2]=i)):(this.min=vec3.create(),this.max=vec3.create(),this.min[0]=e,this.min[1]=t,this.min[2]=i,this.max[0]=e,this.max[1]=t,this.max[2]=i)},e.prototype.compute=function(e,t,i){var r,n;this.min||(this.min=vec3.create(),this.max=vec3.create()),this.min[0]=e[0],this.min[1]=e[1],this.min[2]=e[2],this.max[0]=e[0],this.max[1]=e[1],this.max[2]=e[2];var o=i||3,s=t||e.length;for(r=o;r<s;r+=o)for(n=0;n<3;n++)e[r+n]<this.min[n]&&(this.min[n]=e[r+n]),e[r+n]>this.max[n]&&(this.max[n]=e[r+n])},e.prototype.getCorner=function(e){return[1&e?this.max[0]:this.min[0],2&e?this.max[1]:this.min[1],4&e?this.max[2]:this.min[2]]},e.prototype.getCenter=function(){return[.5*(this.max[0]+this.min[0]),.5*(this.max[1]+this.min[1]),.5*(this.max[2]+this.min[2])]},e.prototype.getRadius=function(){var e=vec3.create();return vec3.subtract(this.max,this.min,e),.5*vec3.length(e)},e}),r("gw/Tiling/Tile",["../Renderer/BoundingBox","../Renderer/Ray","../Utils/Constants","../Gui/dialog/ErrorDialog","../Renderer/glMatrix"],function(e,t,i,r){var n=function(){this.parent=null,this.parentIndex=-1,this.children=null,this.vertices=null,this.texture=null,this.vertexBuffer=null,this.texTransform=[1,1,0,0],this.matrix=null,this.inverseMatrix=null,this.bbox=new e,this.radius=0,this.distance=0,this.closestPointToEye=[0,0,0],this.extension={},this.state=n.State.NONE,this.config=null};return n.State={ERROR:-10,NONE:0,REQUESTED:1,LOADING:2,LOADED:3},n.prototype.computePosition=function(e,t){var i=this.config.tesselation;e=Math.min(i-1,Math.max(0,e)),t=Math.min(i-1,Math.max(0,t));for(var r=Math.floor(t),n=t-r,o=Math.floor(e),s=e-o,a=this.config.vertexSize,l=a*(r*i+o),u=[0,0,0],c=0;c<3;c++)u[c]=(1-n)*(1-s)*this.vertices[l+c]+n*(1-s)*this.vertices[l+a*i+c]+n*s*this.vertices[l+a*i+a+c]+(1-n)*s*this.vertices[l+a+c];return u},n.prototype.initFromParent=function(e,t,i){this.parent=e,this.parentIndex=2*i+t,this.matrix=e.matrix,this.inverseMatrix=e.inverseMatrix,this.texture=e.texture,this.config=e.config,this.vertexBuffer=e.vertexBuffer;for(var r=this.config.tesselation,n=(r-1)/2,o=0;o<=n;o++)for(var s=this.config.vertexSize*((o+i*n)*r+t*n),a=0;a<=n;a++)this.bbox.extend(e.vertices[s],e.vertices[s+1],e.vertices[s+2]),s+=this.config.vertexSize;for(var l in this.radius=this.bbox.getRadius(),e.extension)if(e.extension.hasOwnProperty(l)){var u=e.extension[l];u.initChild&&u.initChild(this,t,i)}},n.prototype.needsToBeRefined=function(e){if(this.distance<this.radius)return!0;var t=.25*(this.bbox.max[0]-this.bbox.min[0]+(this.bbox.max[1]-this.bbox.min[1]))/this.imageSize,i=this.matrix,r=this.closestPointToEye,n=i[0]*r[0]+i[4]*r[1]+i[8]*r[2]+i[12],o=i[1]*r[0]+i[5]*r[1]+i[9]*r[2]+i[13],s=i[2]*r[0]+i[6]*r[1]+i[10]*r[2]+i[14],a=e.pixelSizeVector,l=t/(n*a[0]+o*a[1]+s*a[2]+a[3]);return Math.abs(l)>e.tileErrorTreshold},n.prototype.isCulled=function(e){var t=this.inverseMatrix,i=e.eyePosition;if(!t)return!1;var r=t[0]*i[0]+t[4]*i[1]+t[8]*i[2]+t[12],n=t[1]*i[0]+t[5]*i[1]+t[9]*i[2]+t[13],o=t[2]*i[0]+t[6]*i[1]+t[10]*i[2]+t[14];if(this.distance=Math.sqrt(r*r+n*n+o*o),this.distance<this.radius)return this.distance=0,!1;var s=this.closestPointToEye;if(s[0]=Math.min(Math.max(r,this.bbox.min[0]),this.bbox.max[0]),s[1]=Math.min(Math.max(n,this.bbox.min[1]),this.bbox.max[1]),s[2]=Math.min(Math.max(o,this.bbox.min[2]),this.bbox.max[2]),o<0&&!this.config.coordinateSystem.isFlat()){if(this.config.coordinateSystem.from3DToGeo(i)[2]>0){var a=s[0],l=s[1],u=s[2]+this.config.coordinateSystem.geoide.radius,c=Math.sqrt(a*a+l*l+u*u);l/=c,u/=c;var h=r-(a/=c)*this.config.coordinateSystem.geoide.radius,d=n-l*this.config.coordinateSystem.geoide.radius,p=o-(u-1)*this.config.coordinateSystem.geoide.radius,f=(h*a+d*l+p*u)/Math.sqrt(h*h+d*d+p*p);if((f*=this.config.cullSign)<-.05)return!0}}var g=e.localFrustum;return g.inverseTransform(e.worldFrustum,this.matrix),!g.containsBoundingBox(this.bbox)},n.prototype.dispose=function(e,t){for(var i in this.extension)this.extension[i].dispose&&this.extension[i].dispose(e,t);this.state===n.State.LOADED&&(t.disposeGLBuffer(this.vertexBuffer),this.texture&&t.disposeGLTexture(this.texture),this.vertexBuffer=null,this.texture=null,this.parent=null,this.state=n.State.NONE)},n.prototype.deleteChildren=function(e,t){if(this.children){for(var i=0;i<4;i++)this.children[i].deleteChildren(e,t),this.children[i].dispose(e,t);this.children=null}},n.prototype.buildSkirtVertices=function(e,t,i,r){for(var n=this.vertices,o=.05*this.radius,s=this.config.tesselation,a=0;a<s;a++){var l=n[t]-e[0],u=n[t+1]-e[1],c=n[t+2]-e[2],h=o/Math.sqrt(l*l+u*u+c*c);l*=h,u*=h,c*=h,n[r]=n[t]-l,n[r+1]=n[t+1]-u,n[r+2]=n[t+2]-c;for(var d=3;d<this.config.vertexSize;d++)n[r+d]=n[t+d];r+=this.config.vertexSize,t+=i}},n.prototype.generateNormals=function(){for(var e=this.config.tesselation,t=this.config.vertexSize,i=t*e,r=0,n=0;n<e;n++)for(var o=n===e-1?0:i,s=0===n?0:-i,a=0;a<e;a++){var l=a===e-1?0:t,u=0===a?0:-t,c=[this.vertices[r+l]-this.vertices[r+u],this.vertices[r+l+1]-this.vertices[r+u+1],this.vertices[r+l+2]-this.vertices[r+u+2]],h=[this.vertices[r+o]-this.vertices[r+s],this.vertices[r+o+1]-this.vertices[r+s+1],this.vertices[r+o+2]-this.vertices[r+s+2]],d=vec3.cross(c,h,[]);vec3.normalize(d),this.vertices[r+3]=d[0],this.vertices[r+4]=d[1],this.vertices[r+5]=d[2],r+=t}},n.prototype.generate=function(e,t,i){this.vertices=this.generateVertices(i),null===this.vertices&&console.log("vertice is null");var r=this.config.tesselation,o=this.config.vertexSize;if(this.bbox.compute(this.vertices,o*r*r,o),this.radius=this.bbox.getRadius(),this.config.normals&&this.generateNormals(),this.config.skirt){var s=[0,0,0];mat4.multiplyVec3(this.inverseMatrix,s);var a=o*(r*r);this.buildSkirtVertices(s,0,o,a),a+=o*r,this.buildSkirtVertices(s,o*(r*(r-1)),o,a),a+=o*r,this.buildSkirtVertices(s,0,o*r,a),a+=o*r,this.buildSkirtVertices(s,o*(r-1),o*r,a),a+=o*r,this.buildSkirtVertices(s,o*(r*(r-1)/2),o,a),a+=o*r,this.buildSkirtVertices(s,o*((r-1)/2),o*r,a)}null!==this.vertexBuffer&&null===this.parent&&e.disposeGLBuffer(this.vertexBuffer),this.vertexBuffer=e.createGLBuffer(this.vertices),t&&(this.texture=e.createGLTexture(t),this.imageSize=this.config.imageSize),this.state=n.State.LOADED},n.prototype.intersect=function(e,t,n){if(this.isCulled(n))return-1;var o,s;if(this.children)for(var a=0;a<this.children.length;++a){const i=this.children[a];if(i.vertices){const r=i.intersect(e,t,n);r>=0&&(!o||r<o)&&(o=r)}}if(o&&o>=0)s=o;else if(null==this.vertices)r.open(i.LEVEL.DEBUG,"Tile.js","vertices is null");else{for(var l=null,u=0;t&&u<t.length/3;++u){const i=3*t[3*u+0],r=3*t[3*u+1],n=3*t[3*u+2];var c=[this.vertices[i+0],this.vertices[i+1],this.vertices[i+2]],h=[this.vertices[r+0],this.vertices[r+1],this.vertices[r+2]],d=[this.vertices[n+0],this.vertices[n+1],this.vertices[n+2]];c=mat4.multiplyVec3(this.matrix,c),h=mat4.multiplyVec3(this.matrix,h),d=mat4.multiplyVec3(this.matrix,d);var p=[c[0],c[1],c[2],h[0],h[1],h[2],d[0],d[1],d[2]];const o=e.triangleIntersectOptimized(p,0,3,6);o&&(!l||o.t<l.t)&&(l=o)}l&&(s=l.t)}if(!s)return-1;return s},n}),r("gw/Renderer/GroundOverlayRenderer",["./Program","../Tiling/Tile"],function(e,t){var i=function(t){this.enabled=!0,this.renderContext=t.renderContext,this.tileManager=t;this.program=new e(this.renderContext),this.program.createFromSource("attribute vec3 vertex;\nattribute vec2 tcoord;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform vec4 extent; \nvarying vec2 texCoord;\nvoid main(void) \n{\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n\ttexCoord.x = tcoord.x * (extent[1] - extent[0]) + extent[0];\n\ttexCoord.y = tcoord.y * (extent[3] - extent[2]) + extent[2];\n}\n","#ifdef GL_ES\nprecision highp float;\n#endif\n\nvarying vec2 texCoord;\nuniform sampler2D overlayTexture;\nuniform mat3 transform;\nuniform float opacity; \n\nvoid main(void)\n{\n\tvec3 tc = transform * vec3(texCoord,1.0); \n\ttc.xy /= tc.z; \n\tgl_FragColor.rgba = texture2D(overlayTexture, tc.xy); \n\tgl_FragColor.a = (tc.x >= 0.0 && tc.x <= 1.0 && tc.y >= 0.0 && tc.y <= 1.0) ? opacity * gl_FragColor.a  : 0.0; \n}\n"),this.groundOverlays=[]};return i.prototype.render=function(e){if(!1!==this.enabled){var i=this.renderContext.gl;this.program.apply();var r=this.program.attributes;i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,this.renderContext.projectionMatrix),i.uniform1i(this.program.uniforms.overlayTexture,0),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthFunc(i.LEQUAL),i.depthMask(!1);for(var n=mat4.create(),o=null,s=0;s<this.groundOverlays.length;s++){var a=this.groundOverlays[s];if(a.image.complete){a.texture||(a.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(a.image,a.flipY));for(var l=!1,u=0;u<e.length;u++){var c=e[u];if(a.geoBound.intersects(c.geoBound)){l||(i.uniformMatrix3fv(this.program.uniforms.transform,!1,a.inverseTransform),i.uniform1f(this.program.uniforms.opacity,a.getOpacity()),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.texture),i.bindBuffer(i.ARRAY_BUFFER,this.tileManager.tcoordBuffer),i.vertexAttribPointer(r.tcoord,2,i.FLOAT,!1,0,0),l=!0);var h=c.state===t.State.LOADED?c.bound:c.parent.bound;i.uniform4f(this.program.uniforms.extent,h.west,h.east,h.north,h.south),mat4.multiply(this.renderContext.viewMatrix,c.matrix,n),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,n),i.bindBuffer(i.ARRAY_BUFFER,c.vertexBuffer),i.vertexAttribPointer(r.vertex,3,i.FLOAT,!1,0,0);var d=c.state===t.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(c.parentIndex);o!==d&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,d),o=d),i.drawElements(i.TRIANGLES,d.numIndices,i.UNSIGNED_SHORT,0)}}}}i.disable(i.BLEND),i.depthMask(!0)}},i}),r("gw/Layer/GroundOverlayLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/GeoBound","../Renderer/GroundOverlayRenderer","../Utils/Proxy"],function(e,t,i,r,n,o){var s=function(e){e.zIndex=e.zIndex||i.DISPLAY.DEFAULT_RASTER,t.prototype.constructor.call(this,i.LAYER.GroundOverlay,e),this.geoBound=null,this.image=null,this.globe=null,this.flipY=null,this.quad=e.quad,void 0===e.flipY?this.flipY=!0:this.flipY=e.flipY,null!==this.quad&&void 0!==this.quad&&(this.geoBound=new r,this.geoBound.computeFromCoordinates(this.quad)),"string"==typeof e.image?(this.image=new Image,this.image.crossOrigin="",this.image.src=o.proxify(e.image)):e.image instanceof HTMLImageElement&&(this.image=e.image),this.image.layer=this,this.image.onload=function(){this.layer.getGlobe().refresh()}};return e.inherits(t,s),s.prototype.getInformationType=function(){return i.INFORMATION_TYPE.RASTER},s.prototype.loadOverview=function(){},s.prototype._attach=function(e){var t=e.groundOverlayRenderer;t||(t=new n(e.getTileManager()),e.getTileManager().addPostRenderer(t),e.groundOverlayRenderer=t),t.groundOverlays.push(this),this.globe=e,this.computeTransform()},s.prototype.update=function(e,t){this.getGlobe().groundOverlayRenderer.enabled=!0,this.geoBound=null,this.geoBound=new r,this.geoBound.computeFromCoordinates(this.quad),this.image=null,this.image=new Image,this.image.crossOrigin="",this.image.src=o.proxify(t),this.image.layer=this,this.computeTransform(),this.image.onload=function(){this.layer.getGlobe().refresh()}},s.prototype._detach=function(e){var t=this.getGlobe().groundOverlayRenderer;if(t){var i=t.groundOverlays.indexOf(this);-1!==i&&(t.groundOverlays.splice(i,1),0===t.groundOverlays.length&&(this.getGlobe().getTileManager().removePostRenderer(t),this.getGlobe().groundOverlayRenderer=null))}},s.prototype.computeInverse=function(){var e,t,i,r,n,o,s,a,l,u=this.transform[0]*(this.transform[8]*this.transform[4]-this.transform[5]*this.transform[7])-this.transform[3]*(this.transform[8]*this.transform[1]-this.transform[7])*this.transform[3]+this.transform[6]*(this.transform[5]*this.transform[1]-this.transform[4]*this.transform[2]);e=this.transform[4]*this.transform[8]-this.transform[5]*this.transform[7],r=this.transform[5]*this.transform[6]-this.transform[3]*this.transform[8],s=this.transform[3]*this.transform[7]-this.transform[4]*this.transform[6],t=this.transform[2]*this.transform[7]-this.transform[1]*this.transform[8],n=this.transform[0]*this.transform[8]-this.transform[2]*this.transform[6],a=this.transform[1]*this.transform[6]-this.transform[0]*this.transform[7],i=this.transform[1]*this.transform[5]-this.transform[2]*this.transform[4],o=this.transform[2]*this.transform[3]-this.transform[0]*this.transform[5],l=this.transform[0]*this.transform[4]-this.transform[1]*this.transform[3],this.inverseTransform=[e/u,t/u,i/u,r/u,n/u,o/u,s/u,a/u,l/u]},s.prototype.computeTransform=function(){if(null!==this.quad){var e=this.quad[0],t=this.quad[1],i=this.quad[2],r=this.quad[3],n=this.getGlobe().getTileManager().tileConfig;"CRS:84"!==n.srs&&(e=n.project(e),t=n.project(t),i=n.project(i),r=n.project(r));var o=e[0],s=t[0],a=i[0],l=r[0],u=e[1],c=t[1],h=i[1],d=r[1],p=o-s+a-l,f=u-c+h-d;if(p||f){var g,m,v,y,b,x,w,T,_=s-a,C=l-a,S=c-h,E=d-h,A=_*E-C*S;if(!A)return;g=s-o+(w=(p*E-C*f)/A)*s,m=l-o+(T=(_*f-p*S)/A)*l,v=o,y=c-u+w*c,b=d-u+T*d,x=u,this.transform=[g,y,w,m,b,T,v,x,1]}else this.transform=[s-o,c-u,0,a-s,h-c,0,o,u,1];this.computeInverse()}},s}),r("gw/Layer/OpenSearch/OpenSearchUtils",["jquery"],function(e){var t={getArrayBoundKey:function(e){var t="";if(null==e)return"";for(var i=0;i<e.length;i++)t+=e[i].getKey();return t},getAttributeValue:function(e,t){var i="_attr"+t;return void 0!==e[i]&&void 0!==e[i]._value?e[i]._value:null},getValue:function(e,t){return void 0!==e[t]&&void 0!==e[t]._text?e[t]._text:null},setCurrentValueToParam:function(t,i,r){for(var n,o=0;o<t.parameters.length;o++)if((n=t.parameters[o]).value==="{"+i+"}"){n.currentValue=r,e("#p_"+i).val(r);break}},getCurrentValue:function(e,t){for(var i,r=0;r<e.parameters.length;r++)if((i=e.parameters[r]).value==="{"+t+"}")return i.currentValue},initNavigationValues:function(e){for(var t,i=0;i<e.parameters.length;i++)"{count}"===(t=e.parameters[i]).value?t.currentValue=Math.ceil(.2*t.maxInclusive):"{startPage}"===t.value&&(t.currentValue=1)}};return t}),r("gw/Layer/OpenSearch/OpenSearchCache",["underscore-min","../../Utils/Constants","../../Gui/dialog/ErrorDialog"],function(e,t,i){var r=function(){this.maxTiles=120,this.tileArray=[],i.open(t.LEVEL.DEBUG,"OpenSearchCache","[New] "+this.getCacheStatus())};return r.prototype.getCacheStatus=function(){var e="";return e+="Cache : "+this.tileArray.length+"/"+this.maxTiles+" (size:"+this.getSize()+")"},r.prototype.getTileSize=function(e){return e.features.length},r.prototype.getSize=function(){for(var e=0,t=0;t<this.tileArray.length;t++)e+=this.getTileSize(this.tileArray[t]);return e},r.prototype.storeInCache=function(e,r,n){i.open(t.LEVEL.DEBUG,"OpenSearchCache","[addTile]"+this.getCacheStatus());var o={key:e,features:r.slice(),total:n};this.tileArray.length===this.maxTiles&&(i.open(t.LEVEL.DEBUG,"OpenSearchCache","Cache full, remove oldest"),this.tileArray.splice(0,1)),this.tileArray.push(o)},r.prototype.getCacheFromKey=function(t){var i=e.find(this.tileArray,function(e){return e.key===t});return void 0===i?null:Object.assign({},i)},r.prototype.reset=function(){i.open(t.LEVEL.DEBUG,"OpenSearchCache","[reset]"),this.tileArray.length=0},r}),r("gw/Layer/OpenSearchLayer",["underscore-min","../Renderer/FeatureStyle","../Utils/Utils","../Utils/UtilsIntersection","./AbstractLayer","./GroundOverlayLayer","../Tiling/Tile","../Utils/Constants","../Gui/dialog/ErrorDialog","./OpenSearch/OpenSearchUtils","./OpenSearch/OpenSearchCache","moment"],function(e,t,i,r,n,o,s,a,l,u,c,h){var d=function(e){e.zIndex=e.zIndex||a.DISPLAY.DEFAULT_VECTOR,n.prototype.constructor.call(this,a.LAYER.OpenSearch,e),this.minLevel=e.minLevel||5,this.coordSystemRequired=!e.hasOwnProperty("coordSystemRequired")||e.coordSystemRequired,this.previousKey=null,this.previousTileId=null,this.previousDistance=null,this.features=[],this.featuresSet={},this.tilesLoaded=[],this.nbFeaturesTotal=0,this.lastRemovingDateTime=null,this.removingDeltaSeconds=e.hasOwnProperty("removingDeltaSeconds")?e.removingDeltaSeconds:1,this.nbFeaturesTotal=0,this.pool=e.openSearchRequestPool,this.cache=new c,this.forceRefresh=!1,this.currentQuicklookLayer=null,this.currentIdDisplayed=null,this.featuresAddedToNotLoadedTiles={},this.heatmapMaxLevel=e.heatmapMaxLevel||5,this.heatmapMinFeatureCount=e.heatmapMinFeatureCount||100,this.colormap=[{pct:0,color:[0,0,.3]},{pct:.01,color:[0,0,1]},{pct:.05,color:[0,1,1]},{pct:.1,color:[0,1,0]},{pct:.25,color:[1,1,0]},{pct:.5,color:[1,0,0]},{pct:1,color:[.3,0,0]}],this.heatmapTiles={}};function p(e,t){var i=t.slice(0);i.sort(function(e,t){return e.pct-t.pct});const r=i.length;var n;if(i[0].pct>e)n=i[0].color;else if(i[r-1].pct<e)n=i[r-1].color;else for(var o=0;o<r-1;++o){const t=i[o].pct,r=i[o+1].pct;if(t<=e&&r>=e){const s=(e-t)/(r-t),a=i[o].color,l=i[o+1].color;n=[(1-s)*a[0]+s*l[0],(1-s)*a[1]+s*l[1],(1-s)*a[2]+s*l[2]]}}return n}function f(e,t){return e.distance-t.distance}function g(e,t,i){const r=e.featuresSet[t];if(!r)return;const n=r.tiles.findIndex(function(e){return e.key===i.key});if(-1===n)l.open(a.LEVEL.DEBUG,"OpenSearchLayer.js:298","Tile not found when removing feature");else{const t=e.features[r.index];e.getGlobe().getRendererManager().removeGeometryFromTile(t.geometry,i),r.tiles.splice(n,1)}if(0===r.tiles.length){delete e.featuresSet[t];const i=e.features.pop();r.index<e.features.length&&(e.features[r.index]=i,e.featuresSet[i.id].index=r.index)}}function m(e,t){if(t.associatedFeaturesId){for(const i in t.associatedFeaturesId){g(e,t.associatedFeaturesId[i],t)}t.associatedFeaturesId=[]}const i=e.tilesLoaded.findIndex(function(e){return e.tile.key===t.key});-1!==i&&e.tilesLoaded.splice(i,1),t.osState[e.getID()]=d.TileState.NOT_LOADED,delete e.heatmapTiles[t.level][t.key],e.buildHeatmap()}function v(e,t,i){var r,n=t.properties.style?t.properties.style:e.style;if(n.opacity=e.getOpacity(),t.geometry.gid=t.id,t.hasOwnProperty("id")||(t.id=t.properties.identifier),t.properties.hasOwnProperty("style")||(t.properties.style=n),e.featuresSet.hasOwnProperty(t.id)?((r=e.featuresSet[t.id]).tiles.push(i),t=e.features[r.index]):(e.features.push(t),r={index:e.features.length-1,tiles:[i]},e.featuresSet[t.id]=r),i.associatedFeaturesId||(i.associatedFeaturesId=[]),i.associatedFeaturesId.push(t.id),"GeometryCollection"===t.geometry.type)for(var o=t.geometry.geometries,a=0;a<o.length;a++)e.getGlobe().getRendererManager().addGeometryToTile(e,o[a],n,i);else e.getGlobe().getRendererManager().addGeometryToTile(e,t.geometry,n,i);i.state!==s.State.LOADED&&(e.featuresAddedToNotLoadedTiles[i.key]||(e.featuresAddedToNotLoadedTiles[i.key]=[]),"Point"===t.geometry.type&&(e.featuresAddedToNotLoadedTiles[i.key].length=0),e.featuresAddedToNotLoadedTiles[i.key].push(t))}function y(e){e.cache.reset(),e.previousViewKey=null}function b(e,t,i){if(!e.getServices().hasOwnProperty("queryForm"))return null;var r,n,o=e.getServices().queryForm.template;!function(e,t){for(var i,r,n=0;n<e.getServices().queryForm.parameters.length;n++)if("{geo:box}"!==(r=(r=(i=e.getServices().queryForm.parameters[n]).value).replace("?}","}"))||t.type!==a.TILE.GEO_TILE&&t.type!==a.TILE.MERCATOR_TILE){if("{geo:geometry}"===r&&t.type===a.TILE.HEALPIX_TILE){var o=t.getCorners();i.currentValue="POLYGON(("+o[0][0]+" "+o[0][1]+","+o[1][0]+" "+o[1][1]+","+o[2][0]+" "+o[2][1]+","+o[3][0]+" "+o[3][1]+","+o[0][0]+" "+o[0][1]+"))"}}else i.currentValue=t.geoBound.west+","+t.geoBound.south+","+t.geoBound.east+","+t.geoBound.north}(e,t);for(var s=0;s<e.getServices().queryForm.parameters.length;s++)o=null===(n="maxRecords"===(r=e.getServices().queryForm.parameters[s]).name&&i?i:r.currentValueTransformed())?(o=(o=o.replace("&"+r.name+"="+r.value.replace("}","?}"),"")).replace(r.name+"="+r.value.replace("}","?}"),"")).replace(r.value,""):(o=o.replace(r.value,n)).replace(r.value.replace("}","?}"),n);return o}function x(e,t){(null===e.lastRemovingDateTime||Date.now()-e.lastRemovingDateTime>=1e3*e.removingDeltaSeconds)&&(e.lastRemovingDateTime=Date.now(),function(e,t){var i=0;for(var n of t)i<n.level&&(i=n.level);for(var o=0;o<e.tilesLoaded.length;o++){var s=e.tilesLoaded[o].tile,a=s.level>i;a||(a=!r.tileIntersects(s,t)),a&&m(e,s)}}(e,t))}function w(e,t){void 0===t.key&&(t.key=t.getKey()),null==t.osState&&(t.osState={}),null==t.osState[e.getID()]&&(t.osState[e.getID()]=d.TileState.NOT_LOADED)}function T(e,t,i){var r=b(e,t,i);if(null!==r){var n=e.cache.getCacheFromKey(r);null==n?(t.osState[e.getID()]=d.TileState.LOADING,e.pool.addQuery(r,t,e)):(null==n.osState&&(n.osState={}),n.osState[e.getID()]=d.TileState.LOADING,e.computeFeaturesResponse(n.features,n,n.total)),function(e){for(var t=0,i=0;i<e.tilesLoaded.length;i++){var r=e.tilesLoaded[i].tile;r.associatedFeaturesId&&(t+=r.associatedFeaturesId.length)}console.log("features in tileLoaded :"+t),console.log("nb features :"+e.features.length)}(e)}}function _(e,t){e.osState[t]===d.TileState.LOADING&&(e.osState[t]=d.TileState.LOADED)}return i.inherits(n,d),d.TileState={LOADING:0,LOADED:1,NOT_LOADED:2},d.prototype.getInformationType=function(){return a.INFORMATION_TYPE.VECTOR},d.prototype.setTime=function(e){n.prototype.setTime(e),this.setParameter.call(this,"mizar:time",e)},d.prototype.setParameter=function(e,t){"mizar:time"===e?(t.period.from=h(t.period.from).format("YYYY-MM-DD HH:mm"),t.period.to=h(t.period.to).format("YYYY-MM-DD HH:mm"),u.setCurrentValueToParam(this.getServices().queryForm,"time:start",t.period.from),u.setCurrentValueToParam(this.getServices().queryForm,"time:end",t.period.to)):u.setCurrentValueToParam(this.getServices().queryForm,e,t),this.resetAll()},d.prototype.nextPage=function(){var e=u.getCurrentValue(this.getServices().queryForm,"startPage");e=null==e?1:parseInt(e),u.setCurrentValueToParam(this.getServices().queryForm,"startPage",e+1),this.callbackContext.publish(a.EVENT_MSG.LAYER_UPDATE_STATS_ATTRIBUTES,{shortName:this.getShortName(),page:e+1}),this.forceRefresh=!0;for(var t=0;t<this.tilesLoaded.length;t++)this.tilesLoaded[t].tile.osState[this.getID()]=d.TileState.NOT_LOADED;this.getGlobe().getRenderContext().requestFrame()},d.prototype._attach=function(e){n.prototype._attach.call(this,e),e.getTileManager().addPostRenderer(this)},d.prototype._detach=function(){this.getGlobe().getTileManager().removePostRenderer(this),n.prototype._detach.call(this)},d.prototype.modifyFeatureStyle=function(e,t,i){if(i&&e.properties.style)for(var r in e.properties.style)e.properties.style.hasOwnProperty(r)&&(t[r]=e.properties.style[r]);const n=this.getGlobe().getRendererManager();if(this.featuresSet[e.id])for(var o of this.featuresSet[e.id].tiles)try{n.removeGeometryFromTile(e.geometry,o),n.addGeometryToTile(this,e.geometry,t,o)}catch(e){}},d.prototype.loadQuicklook=function(e,t){this.currentIdDisplayed=e.id;for(var i=e.geometry.coordinates[0],r=[],n=0;n<4;n++)r[n]=i[n];null===this.currentQuicklookLayer?(this.currentQuicklookLayer=new o({quad:r,image:t}),this.currentQuicklookLayer._attach(this.globe)):this.currentQuicklookLayer.update(r,t),this.currentQuicklookLayer.setOnTheTop(),this.getGlobe().refresh()},d.prototype.isQuicklookDisplayed=function(){return null!==this.currentQuicklookLayer},d.prototype.removeQuicklook=function(){null!==this.currentQuicklookLayer&&(this.currentQuicklookLayer._detach(),this.currentQuicklookLayer=null)},d.prototype.highlight=function(e,t){e.properties.style=t,function(e,t){var i=t.geometry,r=e.style,n=t.properties;if(n&&n.style&&(r=n.style),"GeometryCollection"===i.type)for(var o=i.geometries,s=0;s<o.length;s++)e.getGlobe().getRendererManager().addGeometryCurrentLevel(e,o[s],r);else e.getGlobe().getRendererManager().addGeometryCurrentLevel(e,i,r)}(this,e)},d.prototype.unhighlight=function(e,t){!function(e,t){e.getGlobe().getRendererManager().removeGeometryCurrentLevel(t.geometry,e)}(this,e)},d.prototype.render=function(e){if(this.isVisible()&&0!==e.length){if(Object.keys(this.featuresAddedToNotLoadedTiles).length>0)for(var t of e)if(t.state===s.State.LOADED&&this.featuresAddedToNotLoadedTiles[t.key]){for(var i of this.featuresAddedToNotLoadedTiles[t.key])v(this,i,t);delete this.featuresAddedToNotLoadedTiles[t.key]}this.currentKey=u.getArrayBoundKey(e),!0===this.forceRefresh&&(y(this),this.forceRefresh=!1);var r=e.slice(0);if(r.sort(f),this.currentLevel=r[0].level,this.ctx=this.callbackContext,this.isZoomLevelChanged=this.currentLevel!==this.previousLevel,this.isZoomLevelChanged&&(u.setCurrentValueToParam(this.getServices().queryForm,"startPage",1),this.callbackContext.publish(a.EVENT_MSG.LAYER_UPDATE_STATS_ATTRIBUTES,{shortName:this.getShortName(),page:1}),void 0!==this.previousLevel&&null!==this.previousLevel&&this.heatmapTiles&&this.heatmapTiles[this.previousLevel])){const e=Object.keys(this.heatmapTiles[this.previousLevel]);for(var n=e.length-1;n>=0;--n){const t=e[n],i=this.heatmapTiles[this.previousLevel][t];i.feature&&g(this,i.feature.id,i.tile),i.tile.osState[this.getID()]=d.TileState.NOT_LOADED,delete this.heatmapTiles[this.previousLevel][t]}}this.nbFeaturesTotal=0,this.previousLevel=this.currentLevel,this.previousKey=this.currentKey;for(var o=0;o<r.length;o++){var l=r[o];switch(w(this,l),l.osState[this.getID()]){case d.TileState.NOT_LOADED:T(this,l,1);break;case d.TileState.LOADED:case d.TileState.LOADING:}}x(this,r)}},d.prototype.setRequestProperties=function(e){this.getServices().queryForm.setParametersValueFrom(e),this.getServices().queryForm.updateFromGUI(),this.resetAll(),this.forceRefresh=!0},d.prototype.setVisible=function(e){if("boolean"!=typeof e)throw new TypeError("the parameter of setVisible should be a boolean","AbstractLayer.js");this.visible!==e&&this.getGlobe().attributionHandler&&this.getGlobe().attributionHandler.toggleAttribution(this),this.visible=e;for(var t=this.callbackContext.getLinkedLayers(this.ID),i=0;i<t.length;i++)t[i].setVisible(e);void 0!==this.currentQuicklookLayer&&null!==this.currentQuicklookLayer&&!1===this.visible&&this.removeQuicklook(),this.getGlobe()&&this.getGlobe().getRenderContext().requestFrame(),this.publish(a.EVENT_MSG.LAYER_VISIBILITY_CHANGED,this)},d.prototype.setOpacity=function(e){if(!("number"==typeof e&&e>=0&&e<=1))throw new RangeError("opacity value should be a value in [0..1]","AbstractLayer.js");var i=new t(this.getStyle());i.setOpacity(e);for(var r=0;r<this.features.length;r++)this.modifyFeatureStyle(this.features[r],i,!0);var o=this.callbackContext.getLinkedLayers(this.getID());for(r=0;r<o.length;r++)o[r].getStyle().setOpacity(e);n.prototype.setOpacity.call(this,e)},d.prototype.resetAll=function(){this.pool.resetPool(),y(this),function(e){for(const i in e.featuresSet)for(var t=e.featuresSet[i].tiles.length-1;t>=0;--t)g(e,i,e.featuresSet[i].tiles[t]);e.featuresSet={};for(var i=0;i<e.tilesLoaded.length;i++)e.tilesLoaded[i].tile.osState[e.getID()]=d.TileState.NOT_LOADED;e.tilesLoaded=[],e.getGlobe().getRenderContext().requestFrame()}(this)},d.prototype.loadWMS=function(e){var t=function(e){for(var t={east:-180,west:180,north:-90,south:90},i=0;i<e.coordinates[0].length;i++){var r=e.coordinates[0][i];t.south=r[1]<t.south?r[1]:t.south,t.north=r[1]>t.north?r[1]:t.north,t.east=r[0]>t.east?r[0]:t.east,t.west=r[0]<t.west?r[0]:t.west}return t}(e.feature.geometry),i=e.feature.properties.services.browse.layer.url,r={type:"WMS",name:e.layer.name+" (WMS)",baseUrl:i,onlyFirst:!0,format:"image/png",visible:!0,restrictTo:t,background:!1,linkedTo:e.layer.ID},n=this;e.layer.callbackContext.addLayer(r,function(t){n.addServicesRunningOnRecord(e.feature.id,t),n.callbackContext.getLayerByID(t).setOnTheTop(),void 0!==n.callbackContext&&n.callbackContext.publish(a.EVENT_MSG.LAYER_TOGGLE_WMS,{layer_name:e.layer.getShortName(),visible:!0})})},d.prototype.unloadAllWMS=function(e){this.removeServicesRunningOnRecords(),this.removeServicesRunningOnCollection(),this.callbackContext.refresh(),void 0!==this.callbackContext&&void 0!==e&&this.callbackContext.publish(a.EVENT_MSG.LAYER_TOGGLE_WMS,{layer_name:e.layer.getShortName(),visible:!1})},d.prototype.unloadWMS=function(e){this.removeServicesRunningOnRecord(e.feature.id),e.layer.callbackContext.refresh(),void 0!==this.callbackContext&&this.callbackContext.publish(a.EVENT_MSG.LAYER_TOGGLE_WMS,{layer_name:e.layer.getShortName(),visible:!1})},d.prototype.computeFeaturesResponse=function(e,t,i){var r=!0;const{level:n,key:o}=t;if(this.heatmapTiles[n]||(this.heatmapTiles[n]={}),this.heatmapTiles[n][o]={tile:t,nbFeatures:i},i>this.heatmapMinFeatureCount&&n<=this.heatmapMaxLevel?(r=!1,this.heatmapTiles[n][o].shouldBeDrawn=!0):1===e.length&&(r=!1,T(this,t,this.heatmapMinFeatureCount)),this.buildHeatmap(),r){for(var s of(function(e){for(var t=e.length;t--;){var i=e[t];if(i.geometry)switch(i.geometry.type){case a.GEOMETRY.Point:i.geometry.coordinates[0]>180&&(i.geometry.coordinates[0]-=360);break;case a.GEOMETRY.Polygon:for(var r=i.geometry.coordinates[0],n=0;n<r.length;n++)r[n][0]>180&&(r[n][0]-=360)}}}(e),this.nbFeaturesTotal+=i,e))try{v(this,s,t)}catch(e){}void 0!==this.callbackContext&&this.callbackContext.publish(a.EVENT_MSG.LAYER_UPDATE_STATS_ATTRIBUTES,{shortName:this.getShortName(),nb_loaded:this.features.length,nb_total:this.nbFeaturesTotal}),_(t,this.getID()),this.getGlobe().refresh(),function(e,t){return-1!==e.findIndex(function(e){return e.key===t})}(this.tilesLoaded,t.key)||this.tilesLoaded.push({key:o,tile:t}),this.getGlobe().publishEvent(a.EVENT_MSG.FEATURED_ADDED,{layer:this,features:this.features})}},d.prototype.buildHeatmap=function(){var e=0;const t=this.heatmapTiles[this.currentLevel];for(const i in t)e+=t[i].nbFeatures;for(const i in t){const r=t[i];if(r.shouldBeDrawn){const t=r.nbFeatures/e,{tile:n}=r,o=[(n.geoBound.east+n.geoBound.west)/2,(n.geoBound.north+n.geoBound.south)/2],s=p(t,this.colormap),a={type:"Feature",id:`${this.ID}_${i}_text`,geometry:{type:"Point",coordinates:o,crs:{type:"name",properties:{name:n.config.srs}}},properties:{"Feature count":`${r.nbFeatures}`,Percentage:`${(100*t).toFixed(2).toString()}%`,style:{label:`${(100*t).toFixed(2).toString()}%`,fillColor:s,strokeColor:s,textColor:s,opacity:1,pointMaxSize:500,extrusionScale:1,fill:!1,fillShader:null,fillTexture:null,fillTextureUrl:null,icon:null,iconUrl:null,onTerrain:!0,strokeWidth:1,zIndex:0}}};r.feature&&(r.feature.pickData&&r.feature.pickData.picked&&(r.feature.pickData.pickSelection[r.feature.pickData.index].feature=a,a.pickData=r.feature.pickData),g(this,r.feature.id,n)),r.feature=a,v(this,a,n),-1===this.tilesLoaded.findIndex(function(e){return e.key===n.key})&&this.tilesLoaded.push({key:n.key,tile:n}),_(n,this.getID())}}},d}),r("gw/Services/PickingManagerCore",["../Renderer/FeatureStyle","../Layer/OpenSearchLayer","../Utils/Utils","../Utils/UtilsIntersection","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){const s=1;var a,l,u=[],c=[],h=new e({strokeColor:[1,0,0,1],fillColor:[1,1,0,1],zIndex:n.DISPLAY.SELECTED_VECTOR}),d=new e({strokeColor:[0,0,1,1],fillColor:[0,0,1,1],zIndex:n.DISPLAY.HIGHLIGHTED_VECTOR});function p(t,i){i&&i.isExclusive&&f();var r=i.color?e.fromStringToColor(i.color):this.highlightedSelectedStyle.strokeColor,o=i.color?e.fromStringToColor(i.color):this.highlightedSelectedStyle.fillColor,s=this.getSelection()[t];if(s){this.stackSelectionIndex=t;var a=new e(s.feature.properties.style);switch(s.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:a.strokeColor=r,a.strokeWidth=a.strokeWidth+2;break;case n.GEOMETRY.Point:a.fillColor=o}a.zIndex=this.highlightedSelectedStyle.zIndex,s.layer.modifyFeatureStyle(s.feature,a)}l.refresh()}function f(){for(var t=0;t<this.getSelection().length;t++){var i=this.getSelection()[t],r=new e(i.feature.properties.style);switch(i.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:r.strokeColor=i.layer.getStyle().strokeColor,r.strokeWidth=i.layer.getStyle().strokeWidth;break;case n.GEOMETRY.Point:r.fillColor=i.feature.properties.style.strokeColor}r.zIndex=i.layer.getStyle().zIndex,i.layer.getGlobe()&&i.layer.modifyFeatureStyle(i.feature,r),i.feature.pickData&&delete i.feature.pickData}}return{selectedStyle:h,highlightedSelectedStyle:d,stackSelectionIndex:-1,init:function(e){a=e,l=e.globe},addPickableLayer:function(e){-1===u.indexOf(e)?u.push(e):o.open(n.LEVEL.DEBUG,"PickingManagerCore.js",e.name+" has been already added")},removePickableLayer:function(e){for(var t=0;t<u.length;t++)e.id===u[t].id&&u.splice(t,1)},getPickableLayers:function(){return u},blurSelectedFeature:function(){var t=this.getSelection()[this.stackSelectionIndex];if(t){var i=new e(t.feature.properties.style);switch(t.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=this.selectedStyle.strokeColor;break;case n.GEOMETRY.Point:i.fillColor=this.selectedStyle.fillColor}i.zIndex=h.zIndex,t.layer.modifyFeatureStyle(t.feature,i)}},focusFeatureByIndex:p,getSelection:function(){return c},blurSelection:f,focusSelection:function(t){for(var i,r=0;r<t.length;r++){var o=t[r];switch(i=o.feature.properties.style?new e(o.feature.properties.style):new e(o.layer.getStyle()),o.feature.geometry.type){case n.GEOMETRY.LineString:case n.GEOMETRY.MultiLineString:case n.GEOMETRY.Polygon:case n.GEOMETRY.MultiPolygon:i.strokeColor=this.selectedStyle.strokeColor,i.strokeWidth=i.strokeWidth+1;break;case n.GEOMETRY.Point:i.fillColor=this.selectedStyle.fillColor}i.zIndex=this.selectedStyle.zIndex,o.layer.modifyFeatureStyle(o.feature,i)}},clearSelection:function(){this.blurSelection(),this.setSelection([])},fixDateLine:function(e,t){for(var i,r=!1,n=t[0][0],o=1;o<t.length&&!r;o++)Math.abs(t[o][0]-n)>180&&(r=!0);if(r){var s=[];if(e[0]<0)for(i=0;i<t.length;i++)t[i][0]>0?s[i]=[t[i][0]-360,t[i][1]]:s[i]=[t[i][0],t[i][1]];else for(i=0;i<t.length;i++)t[i][0]<0?s[i]=[t[i][0]+360,t[i][1]]:s[i]=[t[i][0],t[i][1]];return s}return t},featureIsPicked:function(e,t,i,l){var u,c,h,d,p,f,g=l&&l.sizeMultiplicator?l.sizeMultiplicator:s;switch(e.geometry.type){case n.GEOMETRY.LineString:if(!t)return!1;for(u=0;u<e.geometry.coordinates.length-1;u++)if(d=e.geometry.coordinates[u],p=e.geometry.coordinates[u+1],r.pointInLine(t,d,p))return!0;break;case n.GEOMETRY.MultiLineString:if(!t)return!1;for(u=0;u<e.geometry.coordinates.length;u++)for(c=0;c<e.geometry.coordinates[u].length-1;c++)if(d=e.geometry.coordinates[u][c],p=e.geometry.coordinates[u][c+1],r.pointInLine(t,d,p))return!0;break;case n.GEOMETRY.Polygon:return!!t&&(f=this.fixDateLine(t,e.geometry.coordinates[0]),r.pointInRing(t,f));case n.GEOMETRY.MultiPolygon:if(!t)return!1;for(h=0;h<e.geometry.coordinates.length;h++)if(f=this.fixDateLine(t,e.geometry.coordinates[h][0]),r.pointInRing(t,f))return!0;return!1;case n.GEOMETRY.Point:if(!l.allowLabelPicking&&e&&e.properties&&e.properties.style&&e.properties.style.label)return!1;if(e.properties&&e.properties.style&&e.properties.style.useMeterSize&&e.properties.style.meterSize)return r.isInBillboard(t,e.geometry,e.properties.style.meterSize,l.eventPos);if(!t)return!1;var m,v=e.geometry.coordinates,y=[t[0],t[1],t[2]];return!0===i?(y[2]=0,m=[v[0],v[1],0],g=3):m=v,r.pointInSphere(a,y,m,e.geometry._bucket.textureHeight*g);default:return o.open(n.LEVEL.DEBUG,"PickingManagerCore.js","Picking for "+e.geometry.type+" is not yet"),!1}},computePickSelection:function(e,i){var r,s,a,u=[],c=e?l.tileManager.getVisibleTile(e[0],e[1]):void 0;const h=c?c.extension.renderer:null;for(r=0;r<this.getPickableLayers().length;r++){var d=this.getPickableLayers()[r];if(d.isVisible()&&d.globe===l)if(d instanceof t){if(!e)return[];if(!c){o.open(n.LEVEL.DEBUG,"PickingManagerCore.js","no tile found");continue}if(!h){o.open(n.LEVEL.DEBUG,"PickingManagerCore.js","no tile data");continue}for(s=0;s<d.features.length;s++){a=d.features[s];var p=JSON.parse(JSON.stringify(i));a&&a.properties&&a.properties.style&&a.properties.style.label&&(p.allowLabelPicking=!0,p.sizeMultiplicator||(p.sizeMultiplicator=3)),this.featureIsPicked(a,e,d.pickingNoDEM,p)&&(a.pickData={picked:!0,index:u.length,pickSelection:u},u.push({feature:a,layer:d}))}}else for(s=0;s<d.features.length;s++)a=d.features[s],this.featureIsPicked(a,e,d.pickingNoDEM,i)&&u.push({feature:a,layer:d})}return u.selectedTile=c,u},computeFilterPickSelection:function(e,t){o.open(n.LEVEL.WARNING,"PickingManagerCore","computeFilterPickSelection: This function is deprecated. Please use computePickSelection instead.");for(var i=this.computePickSelection(e,t),r=[],s=0;s<i.length;s++)r.push(i[s]);return r},setSelection:function(e){return c=e},highlightObservation:function(e,t){c.push(e),p(c-1,t)},updateContext:function(e){a=e,l=e.globe}}}),r("gw/Tiling/HEALPixTiling",["./Tile","./HEALPixBase","../Renderer/GeoBound","../Utils/Numeric","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s=function(t,i,r){e.prototype.constructor.call(this),this.level=this.order=t,this.nside=Math.pow(2,this.order),this.pixelIndex=i,this.face=r,this.key=this.level+"#"+this.pixelIndex,this.type=n.TILE.HEALPIX_TILE,this.geoBound=null};function a(e,i,r,o){for(var s=e.tesselation,a=[],l=1/(s-1),u=r&i*i-1,c=t.compress_bits(u),h=t.compress_bits(u>>>1),d=0;d<s;d++)for(var p=0;p<s;p++){var f=t.fxyf((c+d*l)/i,(h+p*l)/i,o);if(f[0]*=e.coordinateSystem.getGeoide().getRadius(),f[1]*=e.coordinateSystem.getGeoide().getRadius(),f[2]*=e.coordinateSystem.getGeoide().getRadius(),e.coordinateSystem.getGeoideName()!==n.CRS.Equatorial){var g=e.coordinateSystem.getWorldFrom3D(f),m=e.coordinateSystem.convert(g,e.coordinateSystem.getGeoideName(),n.CRS.Equatorial);a[d*s+p]=e.coordinateSystem.get3DFromWorld(m)}else a[d*s+p]=f}return a}function l(e,t){var i=[],r=e.tesselation;return i.push(e.coordinateSystem.getWorldFrom3D(t[0])),i.push(e.coordinateSystem.getWorldFrom3D(t[r-1])),i.push(e.coordinateSystem.getWorldFrom3D(t[r*(r-1)])),i.push(e.coordinateSystem.getWorldFrom3D(t[r*r-1])),i}(s.prototype=new e).getKey=function(){return this.key},s.prototype.createChildren=function(){var e=new s(this.order+1,4*this.pixelIndex,this.face),t=new s(this.order+1,4*this.pixelIndex+2,this.face),i=new s(this.order+1,4*this.pixelIndex+1,this.face),r=new s(this.order+1,4*this.pixelIndex+3,this.face);e.initFromParent(this,0,0),t.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[e,t,i,r]},s.prototype.computeLocalMatrix=function(e){for(var t=mat4.create(),i=vec3.create(),r=vec3.create(),n=vec3.create(),o=0,s=0,a=0,l=0;l<e.length;l++)o+=e[l][0],s+=e[l][1],a+=e[l][2];var u=vec3.create([o/e.length,s/e.length,a/e.length]);return vec3.set(u,n),vec3.normalize(n),vec3.subtract(e[0],e[3],r),vec3.cross(n,r,i),vec3.normalize(i),vec3.cross(n,i,r),vec3.normalize(r),t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=0,t[4]=r[0],t[5]=r[1],t[6]=r[2],t[7]=0,t[8]=n[0],t[9]=n[1],t[10]=n[2],t[11]=0,t[12]=u[0],t[13]=u[1],t[14]=u[2],t[15]=1,t},s.prototype.getCorners=function(){var e=a(this.config,this.nside,this.pixelIndex,this.face);return l(this.config,e)},s.prototype.generateVertices=function(){var e=this.config.tesselation,t=a(this.config,this.nside,this.pixelIndex,this.face),r=l(this.config,t);this.geoBound=new i,this.geoBound.computeFromCoordinates(r),this.matrix=this.computeLocalMatrix(t);var n=mat4.create();mat4.inverse(this.matrix,n),this.inverseMatrix=n;for(var o=new Float32Array(3*e*e),s=0,u=0;u<t.length;u++)o[s]=n[0]*t[u][0]+n[4]*t[u][1]+n[8]*t[u][2]+n[12],o[s+1]=n[1]*t[u][0]+n[5]*t[u][1]+n[9]*t[u][2]+n[13],o[s+2]=n[2]*t[u][0]+n[6]*t[u][1]+n[10]*t[u][2]+n[14],s+=3;return o};var u=function(e,t){this.order=e,this.nside=Math.pow(2,this.order),this.coordinateSystem=t.coordinateSystem};u.prototype.generateLevelZeroTiles=function(e,t){e.skirt=!1,e.cullSign=-1,e.tesselation=5,e.coordinateSystem=this.coordinateSystem,this.coordinateSystem=e.coordinateSystem;for(var i=[],r=Math.pow(this.nside,2),n=12*r,o=0;o<n;o++){var a=Math.floor(o/r),l=new s(this.order,o,a);l.config=e,i.push(l)}return i};var c=function(e){var t,i;switch(e.type){case n.GEOMETRY.Point:(t=[]).push(e.coordinates);break;case n.GEOMETRY.MultiPoint:case n.GEOMETRY.LineString:t=e.coordinates;break;case n.GEOMETRY.MultiLineString:for(t=[],i=0;i<e.coordinates.length;i++)t=t.concat(e.coordinates[i]);break;case n.GEOMETRY.Polygon:t=e.coordinates[0];break;case n.GEOMETRY.MultiPolygon:for(t=[],i=0;i<e.coordinates.length;i++)t=t.concat(e.coordinates[i][0]);break;case n.GEOMETRY.GeometryCollection:for(t=[],i=0;i<e.geometries.length;i++)t=t.concat(c(e.geometries[i]))}return t};return u.prototype.getOverlappedLevelZeroTiles=function(e){var t=[],i=c(e);if(!i)return o.open(n.LEVEL.DEBUG,"HEALPixTiling.js","Invalid geometry type or not supported."),t;for(var r={},s=0;s<i.length;s++){var a=this.lonlat2LevelZeroIndex(i[s][0],i[s][1]);r[a]||(r[a]=!0,t.push(a))}return t},u.prototype.lonlat2LevelZeroIndex=function(e,i){return t.lonLat2pix(this.order,e,i)},u.prototype.findInsideTile=function(e,i,r){for(var n=0;n<r.length;n++){var o=r[n];if(t.lonLat2pix(o.order,e,i)===o.pixelIndex)return o}return null},u}),r("gw/Utils/ImageRequest",["./Proxy"],function(e){var t=function(e){this.successCallback=e.successCallback,this.failCallback=e.failCallback,this.abortCallback=e.abortCallback,this.image=null};return t.prototype.send=function(t,i){this.image=new Image,this.image.crossOrigin=i,this.image.dataType="byte";var r=this;this.image.onload=function(){0!==r.image.naturalWidth&&r.image.complete&&r.successCallback(r)},this.image.onerror=this.failCallback.bind(this),this.image.src=e.proxify(t)},t.prototype.abort=function(){this.abortCallback&&this.abortCallback(this),this.image.src=""},t}),r("gw/Renderer/RendererTileData",[],function(){var e=function(e){this.manager=e,this.renderables=[]};return e.prototype.initChild=function(t,i,r){for(var n,o=0;o<this.renderables.length;o++)if(this.renderables[o].initChild){var s=this.renderables[o].initChild(i,r,t);s&&(n||(n=t.extension.renderer=new e(this.manager)),n.renderables.push(s))}},e.prototype.traverse=function(e,t){for(var i=0;i<this.renderables.length;i++){var r=this.renderables[i],n=r.bucket;if(n.layer.isVisible()&&n.layer.getOpacity()>0)if(r.traverse)r.traverse(this.manager,e,t);else{if(r.hasChildren&&!t)continue;this.manager.renderables.push(r)}}},e.prototype.getRenderable=function(e){for(var t=0;t<this.renderables.length;t++)if(e===this.renderables[t].bucket)return this.renderables[t];return null},e.prototype.dispose=function(e,t){for(var i=0;i<this.renderables.length;i++)this.renderables[i].dispose(e,t);this.renderables.length=0},e}),r("gw/Renderer/RasterOverlayRenderer",["./Program","../Tiling/Tile","../Utils/ImageRequest","./RendererTileData","../Utils/Constants"],function(e,t,i,r,n){var o=function(e){this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="uniform vec4 textureTransform; \n",this.vertexShader+="varying vec2 texCoord;\n",this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.vertexShader+="\ttexCoord = tcoord * textureTransform.xy + textureTransform.zw;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float;\n",this.fragmentShader+="varying vec2 texCoord;\n",this.fragmentShader+="uniform sampler2D overlayTexture;\n",this.fragmentShader+="uniform float opacity; \n",this.fragmentShader+="uniform vec3 levelColRow;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgba = texture2D(overlayTexture, texCoord.xy); \n",this.fragmentShader+="\tgl_FragColor.a *= opacity; \n",this.fragmentShader+="}\n",this.lerpFragmentShader="precision lowp float;\n\n            varying vec2 texCoord;\n            uniform sampler2D fromOverlayTexture;\n            uniform sampler2D toOverlayTexture;\n            uniform float time;\n            uniform float totalTime;\n            uniform float opacity;\n\n            void main() {\n                vec4 fromColor = texture2D(fromOverlayTexture, texCoord.xy);\n                vec4 toColor = texture2D(toOverlayTexture, texCoord.xy);\n                gl_FragColor = mix(fromColor, toColor, time / totalTime);\n                gl_FragColor.a *= opacity;\n                // gl_FragColor.rgba = vec4(0, 1, 0, opacity);\n            }",this.rendererManager=e.getRendererManager(),this.tileManager=e.tileManager,this.programs=[],this.program=this.createProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),this.lerpProgram=this.createProgram({vertexCode:this.vertexShader,fragmentCode:this.lerpFragmentShader,updateUniforms:null}),this.buckets=[],this.imageRequests=[],this.frameNumber=0,this.oldRenderables={};for(var t=this,r=0;r<4;r++){var n=new i({successCallback:function(){if(this.renderable){this.renderable.bucket.layer.handleImage&&this.renderable.bucket.layer.handleImage(this),this.renderable.ownTexture=t.tileManager.tilePool.createGLTexture(this.image),this.renderable.texture=this.renderable.ownTexture,this.renderable.uvScale=1,this.renderable.uTrans=0,this.renderable.vTrans=0,this.renderable.updateChildrenTexture(),this.renderable.onRequestFinished(!0);const{level:e,x:i,y:r}=this.renderable.tile;try{const n=t.oldRenderables[e][i][r];n&&n.ownTexture&&(this.renderable.oldRenderable=n,this.renderable.needsLerp=!0,this.renderable.time=0)}catch(e){}this.renderable=null,t.tileManager.renderContext.requestFrame()}},failCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!0),this.renderable=null)},abortCallback:function(){this.renderable&&(this.renderable.onRequestFinished(!1),this.renderable=null)}});this.imageRequests.push(n)}},s=function(e){this.bucket=e,this.bucket.renderables.push(this),this.ownTexture=null,this.texture=null,this.oldRenderable=null,this.needsLerp=!1,this.time=0,this.request=null,this.requestFinished=!1,this.tile=null,this.uvScale=1,this.uTrans=0,this.vTrans=0};s.prototype.onRequestStarted=function(e){this.request=e,this.requestFinished=!1;var t=this.bucket.layer;0===t._numRequests&&t.globe.publishEvent(n.EVENT_MSG.LAYER_START_LOAD,t),t._numRequests++},s.prototype.onRequestFinished=function(e){this.request=null,this.requestFinished=e;var t=this.bucket.layer;t._numRequests--,t.getGlobe()&&0===t._numRequests&&t.getGlobe().publishEvent(n.EVENT_MSG.LAYER_END_LOAD,t)},s.prototype.initChild=function(e,t,i){var r=this.bucket.createRenderable();return r.tile=i,this.texture&&(r.texture=this.texture,r.uvScale=this.uvScale,r.uTrans=this.uTrans,r.vTrans=this.vTrans),r},s.prototype.generateChild=function(e){this.bucket.renderer.addOverlayToTile(e,this.bucket,this)},s.prototype.updateChildrenTexture=function(){if(this.tile.children)for(var e=0;e<4;e++){var t=this.tile.children[e].extension.renderer;if(t){var i=t.getRenderable(this.bucket);i&&!i.ownTexture&&(i.updateTextureFromParent(this),i.updateChildrenTexture())}}},s.prototype.updateTextureFromParent=function(e){this.tile.state===t.State.LOADED?(this.texture=e.texture,this.uvScale=.5*e.uvScale,this.uTrans=e.uTrans,this.vTrans=e.vTrans,this.uTrans+=1&this.tile.parentIndex?this.uvScale:0,this.vTrans+=2&this.tile.parentIndex?this.uvScale:0):(this.texture=e.texture,this.uvScale=e.uvScale,this.uTrans=e.uTrans,this.vTrans=e.vTrans)},s.prototype.traverse=function(e,i,r){if(r&&this.texture)e.renderables.push(this);else if(r){const t=this.bucket.renderer.oldRenderables;try{const r=t[i.level][i.x][i.y];if(r&&r.ownTexture){const t=Object.assign({},this);t.texture=r.ownTexture,e.renderables.push(t)}}catch(e){}}this.requestFinished||this.tile.state!==t.State.LOADED||this.bucket.renderer.requestOverlayTextureForTile(this)},s.prototype.dispose=function(e,t){this.ownTexture&&(t.disposeGLTexture(this.ownTexture),this.ownTexture=null)};var a=function(e){this.layer=e,this.renderer=null,this.style=e.style,this.renderables=[]};a.prototype.createRenderable=function(){return new s(this)},o.prototype.addOverlay=function(e){e._numRequests=0;var i=new a(e);i.renderer=this,i.id=this.rendererManager.bucketId++,this.buckets.push(i),e._bucket=i;for(var r=0;r<this.tileManager.level0Tiles.length;r++){var n=this.tileManager.level0Tiles[r];n.state===t.State.LOADED&&this.addOverlayToTile(n,i)}},o.prototype.removeOverlay=function(e,t){var i=this.buckets.indexOf(e._bucket);this.buckets.splice(i,1);var r=this.tileManager.renderContext,n=this.tileManager.tilePool;this.tileManager.visitTiles(function(i){var o=i.extension.renderer,s=o?o.getRenderable(e._bucket):null;if(s){var a=o.renderables.indexOf(s);o.renderables.splice(a,1),t||s.dispose(r,n),0===o.renderables.length&&delete i.extension.renderer}})},o.prototype.updateOverlay=function(e){var t=e._bucket,i=this.tileManager.renderContext,r=this.tileManager.tilePool;if(t)for(var n=0;n<t.renderables.length;++n){const e=t.renderables[n];if(e.ownTexture){const{level:t,x:n,y:o}=e.tile;try{this.oldRenderables[t][n][o].dispose(i,r)}catch(e){}this.oldRenderables[t]||(this.oldRenderables[t]={}),this.oldRenderables[t][n]||(this.oldRenderables[t][n]={}),this.oldRenderables[t][n][o]=e}}this.removeOverlay(e,!0),this.addOverlay(e)},o.prototype.addOverlayToTile=function(e,i,n){if(this.overlayIntersects(e.geoBound,i.layer)){e.extension.renderer||(e.extension.renderer=new r(this.rendererManager));var o=i.createRenderable();if(o.tile=e,e.extension.renderer.renderables.push(o),n&&n.texture&&o.updateTextureFromParent(n),e.children)for(var s=0;s<4;s++)e.children[s].state===t.State.LOADED&&this.addOverlayToTile(e.children[s],i,o)}};var l=function(e,t,i){return[t[0]+e*(i[0]-t[0]),t[1]+e*(i[1]-t[1])]};return o.prototype.clipPolygonToSide=function(e,t,i,r){for(var n,o=[],s=0;s<r.length;s++){var a=r[s],u=r[(s+1)%r.length],c=a[e],h=u[e],d=(c-i)*t>=0,p=(h-i)*t>=0;!d&&p?(n=l((i-c)/(h-c),a,u),o.push(n),o.push(u)):d&&p?o.push(u):d&&!p&&(n=l((i-c)/(h-c),a,u),o.push(n))}return o},o.prototype.overlayIntersects=function(e,t){var i;return t.coordinates?(i=this.clipPolygonToSide(0,1,e.west,t.coordinates),i=this.clipPolygonToSide(0,-1,e.east,i),i=this.clipPolygonToSide(1,1,e.south,i),(i=this.clipPolygonToSide(1,-1,e.north,i)).length>0):!t.geoBound||t.geoBound.intersects(e)},o.prototype.generateLevelZero=function(e){for(var t=0;t<this.buckets.length;t++)this.addOverlayToTile(e,this.buckets[t])},o.prototype.requestOverlayTextureForTile=function(e){if(e.request)e.request.frameNumber=this.frameNumber;else{for(var t,i=0;i<this.imageRequests.length;i++)if(!this.imageRequests[i].renderable){t=this.imageRequests[i];break}if(t)null!==e.bucket.layer.getUrl(e.tile)&&(e.onRequestStarted(t),t.renderable=e,t.frameNumber=this.frameNumber,t.send(e.bucket.layer.getUrl(e.tile),e.bucket.layer.crossOrigin))}},o.prototype.createProgram=function(t){var i=new e(this.tileManager.renderContext);return i.createFromSource(this.vertexShader,t.fragmentCode),i.id=this.programs.length,this.programs.push({fragmentCode:t.fragmentCode,program:i}),i},o.prototype.getProgram=function(e){for(var t,i=0;i<this.programs.length;i++)this.programs[i].fragmentCode===e.fragmentCode&&(t=this.programs[i].program);return t||(t=this.createProgram(e)),t},o.prototype.render=function(e,i,r){var n=this.tileManager.renderContext,o=n.gl;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.depthFunc(o.LEQUAL);for(var s=mat4.create(),a=null,l=null,u=i;u<r;u++){var c,h,d=e[u],p=d.bucket.layer;p.customShader?(h=this.getProgram(p.customShader),c=p.customShader.updateUniforms):h=d.needsLerp?this.getProgram({vertexCode:this.vertexShader,fragmentCode:this.lerpFragmentShader,updateUniforms:null}):this.getProgram({vertexCode:this.vertexShader,fragmentCode:this.fragmentShader,updateUniforms:null}),h!==l&&(l=h,h.apply(),o.uniformMatrix4fv(h.uniforms.projectionMatrix,!1,n.projectionMatrix),d.needsLerp?(o.uniform1i(h.uniforms.fromOverlayTexture,0),o.uniform1i(h.uniforms.toOverlayTexture,1)):o.uniform1i(h.uniforms.overlayTexture,0),o.bindBuffer(o.ARRAY_BUFFER,this.tileManager.tcoordBuffer),o.vertexAttribPointer(h.attributes.tcoord,2,o.FLOAT,!1,0,0)),c&&c(o,h),o.bindBuffer(o.ARRAY_BUFFER,d.tile.vertexBuffer),o.vertexAttribPointer(h.attributes.vertex,3,o.FLOAT,!1,4*d.tile.config.vertexSize,0);var f=d.tile.state===t.State.LOADED?this.tileManager.tileIndexBuffer.getSolid():this.tileManager.tileIndexBuffer.getSubSolid(d.tile.parentIndex);a!==f&&(o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f),a=f),mat4.multiply(n.viewMatrix,d.tile.matrix,s),o.uniformMatrix4fv(h.uniforms.modelViewMatrix,!1,s),o.uniform1f(h.uniforms.opacity,p.getOpacity()),o.uniform4f(h.uniforms.textureTransform,d.uvScale,d.uvScale,d.uTrans,d.vTrans),o.uniform3f(h.uniforms.levelColRow,d.tile.level,d.tile.x,d.tile.y),d.needsLerp?(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,d.oldRenderable.texture),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,d.texture),o.uniform1f(h.uniforms.time,d.time),o.uniform1f(h.uniforms.totalTime,500)):(o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,d.texture||d.oldRenderable.texture)),d.needsLerp&&(d.time+=n.deltaTime,d.time>500&&(d.needsLerp=!1,d.oldRenderable=null)),o.drawElements(o.TRIANGLES,a.numIndices,o.UNSIGNED_SHORT,0)}o.disable(o.BLEND),o.depthFunc(o.LESS)},o.prototype.canApply=function(e,t){return!1},o}),r("gw/Utils/Cache",[],function(){var e=function(e){this.layer=e.layer,this.cacheLevel=e.hasOwnProperty("cacheLevel")?e.cacheLevel:1,localStorage.getItem(this.layer.getName())||localStorage.setItem(this.layer.getName(),JSON.stringify({})),this._cacheMap=JSON.parse(localStorage.getItem(this.layer.getName())),this.imgCanvas=document.createElement("canvas"),this.imgCanvas.width=e.tilePixelSize||256,this.imgCanvas.height=e.tilePixelSize||256,this.imgContext=this.imgCanvas.getContext("2d")};return e.prototype.getFromCache=function(e){var t=null;if(this.cacheLevel>=e.level){var i=this.layer.getUrl(e),r=this._cacheMap[i];if(r){r.lastAccess=Date.now();var n=new Image;n.src=r.dataUrl,n.dataType="byte",t={image:n,elevations:r.elevations}}}return t},e.prototype._createDataURL=function(e){return this.imgContext.drawImage(e,0,0,e.width,e.height),this.imgCanvas.toDataURL("image/png")},e.prototype.storeInCache=function(e){var t=e.tile;if(this.cacheLevel>=t.level){var i=this.layer.getUrl(t);this._cacheMap[i]={dataUrl:this._createDataURL(e.image),elevations:e.elevations,lastAccess:Date.now()},localStorage.setItem(this.layer.getName(),JSON.stringify(this._cacheMap))}},e}),r("gw/Layer/AbstractRasterLayer",["../Utils/Utils","../Utils/Constants","./AbstractLayer","../Renderer/RasterOverlayRenderer","../Utils/Cache"],function(e,t,i,r,n){var o=function(e,r){r.zIndex=r.zIndex||t.DISPLAY.DEFAULT_RASTER,i.prototype.constructor.call(this,e,r),this.tilePixelSize=r.tilePixelSize,this.tiling=r.tiling,this.numberOfLevels=r.numberOfLevels||21,this.minLevel=r.minLevel,this.maxLevel=r.maxLevel,this.geoBound=r.geoBound||null,this.coordinates=r.coordinates||null,this.crossOrigin=r.crossOrigin||"anonymous",r.cache&&(r.cache.layer=this,this.cache=new n(r.cache)),this._ready=!0};return e.inherits(i,o),o.prototype.getInformationType=function(){return t.INFORMATION_TYPE.RASTER},o.prototype.loadOverview=function(){},o.prototype.getUrl=function(e){throw new SyntaxError("getUrl() not implemented","AbstractRasterLayer.js")},o.prototype.allowRequest=function(e,t){return this.isBetweenMinMaxLevel(t)?e:null},o.prototype.isBetweenMinMaxLevel=function(e){return null!=this.minLevel&&null!=this.maxLevel?this.minLevel<=e&&e<=this.maxLevel:null!=this.minLevel?e>=this.minLevel:null==this.maxLevel||e<=this.maxLevel},o.prototype._attach=function(e){if(this.isBackground()&&(this.id=0),i.prototype._attach.call(this,e),!this.isBackground()){if(!e.rasterOverlayRenderer){var t=new r(e);e.getRendererManager().renderers.push(t),e.rasterOverlayRenderer=t}e.rasterOverlayRenderer.addOverlay(this)}},o.prototype._detach=function(){!this.isBackground()&&this.getGlobe().rasterOverlayRenderer&&this.getGlobe().rasterOverlayRenderer.removeOverlay(this),i.prototype._detach.call(this)},o}),r("gw/Crs/Geoide",[],function(){var e=function(e){if(this.radius=e&&e.hasOwnProperty("radius")?e.radius:null,this.realPlanetRadius=e&&e.hasOwnProperty("realPlanetRadius")?e.realPlanetRadius:null,null===this.radius||null===this.realPlanetRadius)throw new ReferenceError("Radius and realPlanetRadius must be set to define a geoide","Geoide.js");this.heightScale=this.radius/this.realPlanetRadius};return e.prototype.getRealPlanetRadius=function(){return this.realPlanetRadius},e.prototype.getRadius=function(){return this.radius},e.prototype.getHeightScale=function(){return this.heightScale},e}),r("gw/Crs/AstroCoordTransform",[],function(){var e=2*Math.PI,t=4*Math.PI,i=180/Math.PI,r=[[.57595865315,4.9261918136,0,0,.11129056012,4.7005372834],[.574770433,4.9368292465,0,0,.11142137093,4.71279419371]],n=[[.88781538514,-.88781538514,.39788119938,-.39788119938,.86766174755,-.86766174755],[.88998808748,-.88998808748,.39777715593,-.39777715593,.86766622025,-.86766622025]],o=[[.46019978478,.46019978478,.9174369467,.9174369467,.49715499774,.49715499774],[.45598377618,.45598377618,.91748206207,.91748206207,.49714719172,.49714719172]],s=[[4.9261918136,.57595865315,0,0,4.7005372834,.11129056012],[4.9368292465,.574770433,0,0,4.71279419371,.11142137093]],a={transform:function(i,a){var l,u,c,h,d,p;return u=i[0]-s[1][a],c=i[1],h=Math.sin(c),p=(d=Math.cos(c))*Math.sin(u),c=-n[1][a]*p+o[1][a]*h,c=Math.max(-1,Math.min(c,1)),l=Math.asin(c),[((u=Math.atan2(o[1][a]*p+n[1][a]*h,d*Math.cos(u)))+r[1][a]+t)%e,l]},transformInDeg:function(a,l){var u,c,h,d,p,f;return c=a[0]/i-s[1][l],h=a[1]/i,d=Math.sin(h),f=(p=Math.cos(h))*Math.sin(c),h=-n[1][l]*f+o[1][l]*d,h=Math.max(-1,Math.min(h,1)),u=Math.asin(h)*i,[((c=Math.atan2(o[1][l]*f+n[1][l]*d,p*Math.cos(c)))+r[1][l]+t)%e*i,u]},Type:{EQ2GAL:0,GAL2EQ:1,EQ2ECL:2,ECL2EQ:3,ECL2GAL:4,GAL2ECL:5}};return a}),r("gw/Crs/AbstractCrs",["../Utils/Numeric","./Geoide","../Utils/Constants","./AstroCoordTransform","../Gui/dialog/ErrorDialog","../Renderer/glMatrix"],function(e,t,i,r,n){var o=function(e){if(this.flat=!1,this.geoide=null,this.type=null,this.geoBound=null,!(e&&e.geoideName&&e.type&&e.geoBound))throw new ReferenceError("The geoide's parameters, the geoBound and the type of context must be defined",o.js);this.geoide=new t(e),this.geoideName=e.geoideName,this.type=e.type,this.geoBound=e.geoBound};return o.prototype.isFlat=function(){return this.flat},o.prototype.getVerticalAt3D=function(e,t){return t||(t=new Array(3)),this.isFlat()?(t[0]=0,t[1]=0,t[2]=1):vec3.normalize(e,t),t},o.prototype.fromGeoTo3D=function(t,r){if(r||(r=new Array(3)),!t||t.length<2)return n.open(i.LEVEL.DEBUG,"AbstractCrs.js","geo is 2D or does not exist"),r[0]=0,r[1]=0,r[2]=0,r;var o=e.toRadian(t[0]),s=e.toRadian(t[1]),a=Math.cos(s),l=t.length>2?this.geoide.getHeightScale()*t[2]:0,u=this.geoide.getRadius()+l;return r[0]=u*Math.cos(o)*a,r[1]=u*Math.sin(o)*a,r[2]=u*Math.sin(s),r},o.prototype.from3DToGeo=function(t,i){i||(i=new Array(3));var r=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]),n=Math.atan2(t[1]/r,t[0]/r),o=Math.asin(t[2]/r);return i[0]=e.toDegree(n),i[1]=e.toDegree(o),i[2]=this.geoide.getRealPlanetRadius()*(r-this.geoide.getRadius()),i},o.prototype.getLocalTransform=function(e,t){t||(t=mat4.create());var i=e[0]*Math.PI/180,r=e[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],o=[-Math.sin(i),Math.cos(i),0],s=vec3.create();return vec3.cross(n,o,s),t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=0,t[4]=s[0],t[5]=s[1],t[6]=s[2],t[7]=0,t[8]=n[0],t[9]=n[1],t[10]=n[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},o.prototype.getLHVTransform=function(e,t){t||(t=mat4.create());var i=e[0]*Math.PI/180,r=e[1]*Math.PI/180,n=[Math.cos(i)*Math.cos(r),Math.sin(i)*Math.cos(r),Math.sin(r)],o=[-Math.sin(i),Math.cos(i),0],s=vec3.create();vec3.cross(n,o,s);var a=this.get3DFromWorld(e);return t[0]=o[0],t[1]=o[1],t[2]=o[2],t[3]=0,t[4]=s[0],t[5]=s[1],t[6]=s[2],t[7]=0,t[8]=n[0],t[9]=n[1],t[10]=n[2],t[11]=0,t[12]=a[0],t[13]=a[1],t[14]=a[2],t[15]=1,t},o.prototype.getSideVector=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},o.prototype.getFrontVector=function(e,t){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t},o.prototype.getUpVector=function(e,t){return t[0]=e[8],t[1]=e[9],t[2]=e[10],t},o.prototype.formatCoordinates=function(e){throw new SyntaxError("Not implemented")},o.prototype.getGeoide=function(){return this.geoide},o.prototype.getGeoideName=function(){return this.geoideName},o.prototype.getType=function(){return this.type},o.prototype.getElevation=function(e,t){return e.getElevation(t.coordinates[0],t.coordinates[1])},o.prototype.getWorldFrom3D=function(e,t){t||(t=new Array(3));var i=this.from3DToGeo(e);return this._setupPosAfterTrans(i),t[0]=i[0],t[1]=i[1],t[2]=i.length>2?i[2]:0,t},o.prototype.get3DFromWorld=function(e,t){t||(t=vec3.create());var i=e.slice(0);return this._setupPosBeforeTrans(i),this.fromGeoTo3D(i,t),t},o.prototype.get3DFromWorldInCrs=function(e,t,i){i||(i=vec3.create());var r=this.convert(e,t,this.getGeoideName());return this.get3DFromWorld(r,i),i},o.prototype.getSexagesimalFromDeg=function(e,t){t=t||[];var i=e[0];return i<0&&(i+=360),t[0]=this.fromDegreesToHMS(i),t[1]=this.fromDegreesToDMS(e[1]),t},o.prototype.getDecimalDegFromSexagesimal=function(e,t){t=t||[];var i=e[0].split(" "),r=parseFloat(i[0]),n=parseFloat(i[1]),o=parseFloat(i[2]);t[0]=15*(r+n/60+o/3600);var s=e[1].split(" ");return r=parseFloat(s[0]),n=parseFloat(s[1]),o=parseFloat(s[2]),t[1]=("-"===s[0][0]?-1:1)*(Math.abs(r)+n/60+o/3600),t},o.prototype.convert=function(e,t,o){if(t===o)return e;var s=null,a=null;switch(t+"2"+o){case i.CRS.Galactic+"2"+i.CRS.Equatorial:a=r.Type.GAL2EQ,s=r.transformInDeg(e,a);break;case i.CRS.Equatorial+"2"+i.CRS.Galactic:a=r.Type.EQ2GAL,(s=r.transformInDeg(e,a))[0]<0&&(n.open(i.LEVEL.DEBUG,"AbstractCRs.js","EQ2GAL transformation returned negative value"),s[0]+=360);break;case i.CRS.Mars_2000+"2"+i.CRS.Mars_2000_old:case i.CRS.Mars_2000_old+"2"+i.CRS.Mars_2000:s=e;break;case i.CRS.Moon_2000+"2"+i.CRS.Moon_2000_old:case i.CRS.Moon_2000_old+"2"+i.CRS.Moon_2000:s=e;break;default:throw new RangeError("Conversion "+t+" to "+o+" is not implemented","AbstractCrs.js")}return s},o.prototype._pad2Digits=function(e){return e<10?"0"+e:e},o.prototype.fromDegreesToHMS=function(t){var i=t/15,r=Math.abs(i),n=Math.floor(r),o=60*(r-n),s=Math.floor(o),a=60*(o-s);return this._pad2Digits(n)+"h "+this._pad2Digits(s)+"m "+this._pad2Digits(e.roundNumber(a,2))+"s"},o.prototype.fromDegreesToDMS=function(t){var i=Math.abs(t),r=Math.floor(i),n=60*(i-r),o=Math.floor(n),s=60*(n-o);return(t>=0?"+":"-")+this._pad2Digits(r)+String.fromCharCode(176)+" "+this._pad2Digits(o)+"' "+this._pad2Digits(e.roundNumber(s,2))+'"'},o.prototype._setupPosBeforeTrans=function(e){throw new SyntaxError("Not implemented")},o.prototype._setupPosAfterTrans=function(e){throw new SyntaxError("Not implemented")},o.prototype.getGeoBound=function(){return this.geoBound},o.prototype.getName=function(){throw new SyntaxError("Not implemented")},o.prototype.getDescription=function(){throw new SyntaxError("Not implemented")},o.prototype.getLongitudeLabel=function(){throw new SyntaxError("Not implemented")},o.prototype.getLatitudeLabel=function(){throw new SyntaxError("Not implemented")},o.prototype.isProjected=function(){return!1},o.prototype.destroy=function(){this.flat=null,this.geoide=null,this.type=null,this.geoBound=null,this.projected=null},o}),r("gw/Crs/WGS84Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.WGS84,radius:1,realPlanetRadius:6378137,type:r.CONTEXT.Planet,geoBound:new t(-180,-90,180,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[],i=n.roundNumber(e[0],3),r=n.roundNumber(e[1],3);return t[0]=this.getLatitudeLabel()+" = ",t[0]+=r>=0?r+" N":-1*r+" S",t[1]=this.getLongitudeLabel()+" = ",t[1]+=i>=0?i+" E":-1*i+" W",t},o.prototype.getLongitudeLabel=function(){return"Long"},o.prototype.getLatitudeLabel=function(){return"Lat"},o.prototype._setupPosAfterTrans=function(e){},o.prototype._setupPosBeforeTrans=function(e){},o.prototype.getName=function(){return r.CRS.WGS84},o.prototype.getDescription=function(){return"WGS84 coordinate Reference System is a coordinate system using the Earth geoide in which the geographic longitude increases to the east. The geographic latitude is measured in degrees north or south of the Earth equator. In Mizar, the latitudes are projected on a sphere"},o}),r("gw/Crs/Mars2000Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.Mars_2000,radius:1,realPlanetRadius:3396190,type:r.CONTEXT.Planet,geoBound:new t(-180,-90,180,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[],i=n.roundNumber(e[0],3),r=n.roundNumber(e[1],3);return t[0]=this.getLatitudeLabel()+" = ",t[0]+=r>=0?r+" N":-1*r+" S",t[1]=this.getLongitudeLabel()+" = ",t[1]+=i>=0?i+" E":-1*i+" W",t},o.prototype.getLongitudeLabel=function(){return"Long"},o.prototype.getLatitudeLabel=function(){return"Lat"},o.prototype._setupPosAfterTrans=function(e){},o.prototype._setupPosBeforeTrans=function(e){},o.prototype.getName=function(){return r.CRS.Mars_2000},o.prototype.getDescription=function(){return"Mars 2000 coordinate Reference System is a coordinate system using the Mars sphere and in which the planetocentric longitude increases to the east. The planetocentric latitude is measured in degrees north or south of the Mars equator."},o}),r("gw/Crs/Moon2000Crs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.Moon_2000,radius:1,realPlanetRadius:1737400,type:r.CONTEXT.Planet,geoBound:new t(-180,-90,180,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[],i=n.roundNumber(e[0],3),r=n.roundNumber(e[1],3);return t[0]=this.getLatitudeLabel()+" = ",t[0]+=r>=0?r+" N":-1*r+" S",t[1]=this.getLongitudeLabel()+" = ",t[1]+=i>=0?i+" E":-1*i+" W",t},o.prototype.getLongitudeLabel=function(){return"Long"},o.prototype.getLatitudeLabel=function(){return"Lat"},o.prototype._setupPosAfterTrans=function(e){},o.prototype._setupPosBeforeTrans=function(e){},o.prototype.getName=function(){return r.CRS.Moon_2000},o.prototype.getDescription=function(){return"Moon 2000 coordinate Reference System is a coordinate system using the Moon sphere and in which the planetocentric longitude increases to the east. The planetocentric latitude is measured in degrees north or south of the Moon equator."},o}),r("gw/Crs/EquatorialCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i,r){var n=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.Equatorial,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new t(0,-90,360,90)})};return i.inherits(e,n),n.prototype.transformVec=function(e){var t=this.computeTransformMatrix(),i=[];return mat4.multiplyVec3(t,e,i),i},n.prototype.computeTransformMatrix=function(){var e=[],t=this.convert([0,90],r.CRS.Galactic,r.CRS.Equatorial),i=this.fromGeoTo3D(t),n=this.convert([0,0],r.CRS.Galactic,r.CRS.Equatorial),o=this.fromGeoTo3D(n),s=this.convert([90,0],r.CRS.Galactic,r.CRS.Equatorial),a=this.fromGeoTo3D(s);return e[0]=o[0],e[1]=o[1],e[2]=o[2],e[3]=0,e[4]=a[0],e[5]=a[1],e[6]=a[2],e[7]=0,e[8]=i[0],e[9]=i[1],e[10]=i[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},n.prototype.formatCoordinates=function(e){var t=this.getSexagesimalFromDeg(e),i=[];return i[0]=this.getLongitudeLabel()+" = "+t[0],i[1]=this.getLatitudeLabel()+" = "+t[1],i},n.prototype.getLongitudeLabel=function(){return"&alpha;"},n.prototype.getLatitudeLabel=function(){return"&delta;"},n.prototype._setupPosAfterTrans=function(e){e[0]<0&&(e[0]+=360)},n.prototype._setupPosBeforeTrans=function(e){e[0]>180&&(e[0]-=360)},n.prototype.getName=function(){return r.CRS.Equatorial},n.prototype.getDescription=function(){return"System in which a celestial object's position on the celestial sphere is described in terms of its declination and right ascension, measured with respect to the celestial equator. Declination and right ascension correspond directly to geographic latitude and longitude as projected outward onto the celestial sphere. Declination is measured in degrees north or south of the celestial equator but right ascension  is measured in hours, minutes, and seconds eastward along the celestial equator from the point of the vernal equinox. Because the celestial equator moves among the fixed stars with the precession of the Earth's poles, an object's declination and right ascension change gradually over time, and coordinates in the equatorial system must be specified for particular years. By Default J2000 is used"},n}),r("gw/Crs/GalacticCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.Galactic,radius:10,realPlanetRadius:1,type:r.CONTEXT.Sky,geoBound:new t(0,-90,360,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[];return t[0]=this.getLongitudeLabel()+" = "+n.roundNumber(e[0],3),t[0]+="&deg;",t[1]=this.getLatitudeLabel()+" = "+n.roundNumber(e[1],3),t[1]+="&deg;",t},o.prototype.getLongitudeLabel=function(){return"l"},o.prototype.getLatitudeLabel=function(){return"b"},o.prototype._setupPosAfterTrans=function(e){e[0]<0&&(e[0]+=360),e=this.convert(e,r.CRS.Equatorial,r.CRS.Galactic)},o.prototype._setupPosBeforeTrans=function(e){(e=this.convert(e,r.CRS.Galactic,r.CRS.Equatorial))[0]>180&&(e[0]-=360)},o.prototype.getName=function(){return r.CRS.Galactic},o.prototype.getDescription=function(){return"System in which a celestial object's position on the celestial sphere is described in relation to the structure of the Milky Way galaxy. An object's galactic longitude is measured along the galactic equator, a great circle on the celestial sphere that follows the band of the Milky Way. The galactic equator, also called the galactic circle, is inclined at an angle of approximately 62° to the celestial equator; distances are measured along it beginning at a point in the constellation Sagittarius lying in the direction of the Milky Way's nucleus. The galactic poles are the two points where a perpendicular line through the middle of the plane of the galactic equator intersect the celestial sphere. An object's galactic latitude is measured in degrees north or south of the galactic equator toward the galactic poles."},o}),r("gw/Projection/AbstractProjection",["../Renderer/GeoBound"],function(e){var t=function(t,i,r){this.geoBound=new e(i[0],i[1],i[2],i[3]),this.projectionCenter=t,this.options=r||{}};return t.prototype.getProjectionCenter=function(){return this.projectionCenter},t.prototype.getGeoBound=function(){return this.geoBound},t.prototype.unProject=function(e,t){throw new SyntaxError("unProject not implemented","AbstractProjection.js")},t.prototype.project=function(e,t){throw new SyntaxError("project not implemented","AbstractProjection.js")},t.prototype.getName=function(){throw new SyntaxError("getName not implemented","AbstractProjection.js")},t}),r("gw/Projection/AitoffProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){e.prototype.constructor.call(this,[0,0],[-180,-90,180,90],t)};t.inherits(e,r);return r.prototype.unProject=function(e,t){t||(t=new Array(3));var i,r;if(!(e[0]*e[0]+4*e[1]*e[1]>Math.PI*Math.PI+.005)){var n=e[0],o=e[1],s=25;do{var a,l=Math.sin(n),u=Math.sin(n/2),c=Math.cos(n/2),h=Math.sin(o),d=Math.cos(o),p=Math.sin(2*o),f=h*h,g=d*d,m=u*u,v=1-g*c*c,y=v?Math.acos(d*c)*Math.sqrt(a=1/v):a=0,b=2*y*d*u-e[0],x=y*h-e[1],w=a*(g*m+y*d*c*f),T=a*(.5*l*p-2*y*h*u),_=.25*a*(p*u-y*h*g*l),C=a*(f*c+y*m*d),S=T*_-C*w;if(!S)break;n-=i=(x*T-b*C)/S,o-=r=(b*_-x*w)/S}while((Math.abs(i)>.005||Math.abs(r)>.005)&&--s>0);return t[0]=180*n/Math.PI,t[1]=180*o/Math.PI,t[2]=e[2],t}},r.prototype.project=function(e,t){t||(t=new Array(3));var i,r=e[0]*Math.PI/180,n=e[1]*Math.PI/180,o=Math.cos(n),s=(i=Math.acos(o*Math.cos(r/=2)))?i/Math.sin(i):1;return t[0]=2*o*Math.sin(r)*s,t[1]=Math.sin(n)*s,t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.Aitoff},r}),r("gw/Projection/AugustProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){e.prototype.constructor.call(this,[0,0],[-180,-90,180,90],t)};return t.inherits(e,r),r.prototype.unProject=function(e,t){throw new SyntaxError("must be implemented")},r.prototype.project=function(e,t){t||(t=new Array(3));var i=e[0]*Math.PI/180,r=e[1]*Math.PI/180,n=Math.tan(r/2),o=Math.sqrt(1-n*n),s=1+o*Math.cos(i/=2),a=Math.sin(i)*o/s,l=n/s,u=a*a,c=l*l;return t[0]=4/3*a*(3+u-3*c),t[1]=4/3*l*(3+3*u-c),t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.August},r}),r("gw/Projection/MercatorProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){e.prototype.constructor.call(this,[0,0],[-180,-80,180,84],t),this.lambda0=t&&t.lambda0?t.lambda0:0};t.inherits(e,r);return r.prototype.unProject=function(e,t){var i,r;return t||(t=new Array(3)),t[0]=this.lambda0+180*e[0]/Math.PI,t[1]=180*Math.atan((i=e[1],((r=Math.exp(i))-1/r)/2))/Math.PI,t[2]=e[2],Math.abs(t[1])>85.05?null:t},r.prototype.project=function(e,t){t||(t=new Array(3)),e[1]>85.05&&(e[1]=85.05),e[1]<-85.05&&(e[1]=-85.05);var i=e[0]*Math.PI/180,r=e[1]*Math.PI/180,n=i-this.lambda0*Math.PI/180,o=Math.log(Math.tan(r)+1/Math.cos(r));return t[0]=n,t[1]=o,t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.Mercator},r}),r("gw/Projection/MollweideProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){e.prototype.constructor.call(this,[0,0],[-180,-90,180,90],t)};return t.inherits(e,r),r.prototype.unProject=function(e,t){t||(t=new Array(3));var i=Math.asin(e[1]/Math.sqrt(2)),r=Math.asin((2*i+Math.sin(2*i))/Math.PI),n=Math.PI*e[0]/(2*Math.sqrt(2)*Math.cos(i));return t[0]=180*n/Math.PI,t[1]=180*r/Math.PI,t[2]=e[2],t},r.prototype.project=function(e,t){t||(t=new Array(3));var i=e[0]*Math.PI/180,r=function(e){if(Math.abs(e)===Math.PI/2)return e;var t,i=e;do{var r=2*i;(i=t)||(i=e),t=r/2-(r+Math.sin(r)-Math.PI*Math.sin(e))/(2+2*Math.cos(r))}while(Math.abs(t-i)>=.001);return t}(e[1]*Math.PI/180),n=2*Math.sqrt(2)/Math.PI*i*Math.cos(r),o=Math.sqrt(2)*Math.sin(r);return t[0]=n,t[1]=o,t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.Mollweide},r}),r("gw/Projection/PlateProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){e.prototype.constructor.call(this,[0,0],[-180,-90,180,90],t)};return t.inherits(e,r),r.prototype.unProject=function(e,t){return t||(t=new Array(3)),t[0]=180*e[0]/Math.PI,t[1]=180*e[1]/Math.PI,t[2]=e[2],t},r.prototype.project=function(e,t){return t||(t=new Array(3)),t[0]=e[0]*Math.PI/180,t[1]=e[1]*Math.PI/180,t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.Plate},r}),r("gw/Projection/AzimuthProjection",["./AbstractProjection","../Utils/Utils","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i){var r=function(t){var i,r;this.pole=t&&t.pole||"north","south"===this.pole?(i=[-180,-90,180,0],r=[0,-90]):(i=[-180,0,180,90],r=[0,90],this.pole="north"),e.prototype.constructor.call(this,r,i,t)};return t.inherits(e,r),r.prototype.unProject=function(e,t){var i=Math.sqrt(e[0]*e[0]+e[1]*e[1]),r=Math.atan2(e[0],-e[1]);return i=180*i/Math.PI,r=180*r/Math.PI,r*="south"===this.pole?-1:1,i>90?null:(t||(t=new Array(3)),t[0]=r,t[1]="south"===this.pole?i-90:90-i,t[2]=e[2],t)},r.prototype.project=function(e,t){t||(t=new Array(3));var i="south"===this.pole?90+e[1]:90-e[1];i=i*Math.PI/180;var r=e[0]*Math.PI/180;return r*="south"===this.pole?-1:1,t[0]=i*Math.sin(r),t[1]=-i*Math.cos(r),t[2]=e[2],t},r.prototype.getName=function(){return i.PROJECTION.Azimuth},r}),r("gw/Projection/ProjectionFactory",["../Utils/Constants","./AitoffProjection","./AugustProjection","./MercatorProjection","./MollweideProjection","./PlateProjection","./AzimuthProjection"],function(e,t,i,r,n,o,s){return{create:function(a){if(!a||!a.projectionName)throw new ReferenceError("Unable to get options.projectionName","ProjectionFactory.js");return function(a,l){var u;switch(a){case e.PROJECTION.Aitoff:u=new t(l);break;case e.PROJECTION.August:u=new i(l);break;case e.PROJECTION.Azimuth:u=new s(l);break;case e.PROJECTION.Mercator:u=new r(l);break;case e.PROJECTION.Mollweide:u=new n(l);break;case e.PROJECTION.Plate:u=new o(l);break;default:throw new RangeError("Unable to create the projection "+l.projectionName,"ProjectionFactory.js")}return u}(a.projectionName,a)}}}),r("gw/Crs/ProjectedCrs",["./AbstractCrs","../Utils/Utils","../Projection/ProjectionFactory","../Renderer/glMatrix"],function(e,t,i){var r=function(t,r){e.prototype.constructor.call(this,{geoideName:t.getGeoideName(),radius:t.getGeoide().getRadius(),realPlanetRadius:t.getGeoide().getRealPlanetRadius(),type:t.getType(),geoBound:t.getGeoBound()}),this.cs=t,this.projection=i.create(r),this.geoBound.setWest(this.projection.getGeoBound().getWest()),this.geoBound.setSouth(this.projection.getGeoBound().getSouth()),this.geoBound.setEast(this.projection.getGeoBound().getEast()),this.geoBound.setNorth(this.projection.getGeoBound().getNorth()),this.flat=!0};return t.inherits(e,r),r.prototype.formatCoordinates=function(e){return this.cs.formatCoordinates(e)},r.prototype.getLongitudeLabel=function(){return this.cs.getLongitudeLabel()},r.prototype.getLatitudeLabel=function(){return this.cs.getLatitudeLabel()},r.prototype.getWorldFrom3D=function(e,t){return t||(t=new Array(3)),this.projection.unProject(e,t),this.cs._setupPosAfterTrans(t),t[2]=t[2]/this.geoide.getHeightScale(),t},r.prototype.get3DFromWorld=function(e,t){t||(t=vec3.create());var i=e.slice(0);return this.cs._setupPosBeforeTrans(i),this.projection.project(i,t),t[2]=t[2]?t[2]*this.geoide.getHeightScale():0,t},r.prototype.getLocalTransform=function(e,t){return t||(t=mat4.create()),mat4.identity(t),t},r.prototype.getLHVTransform=function(e,t){t||(t=mat4.create());var i=this.projection.project(e);return mat4.identity(t),t[12]=i[0],t[13]=i[1],t[14]=i[2]?i[2]*this.geoide.getHeightScale():0,t[15]=1,t},r.prototype.getProjection=function(){return this.projection},r.prototype.getName=function(){return this.cs.getName()},r.prototype.getDescription=function(){return this.cs.getDescription()},r.prototype.isProjected=function(){return!0},r}),r("gw/Crs/HorizontalLocalCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.HorizontalLocal,radius:1,realPlanetRadius:1,type:r.CONTEXT.Ground,geoBound:new t(0,-90,360,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[],i=n.roundNumber(e[0],3),r=n.roundNumber(e[1],3);return t[0]=this.getLongitudeLabel()+" = "+i,t[0]+="&deg;",t[1]=this.getLatitudeLabel()+" = "+r,t[1]+="&deg;",t},o.prototype.getLongitudeLabel=function(){return"Az"},o.prototype.getLatitudeLabel=function(){return"Alt"},o.prototype._setupPosAfterTrans=function(e){e[0]<0?e[0]=-1*e[0]:e[0]=360-e[0]},o.prototype._setupPosBeforeTrans=function(e){e[0]<180?e[0]=-1*e[0]:e[0]=360-e[0]},o.prototype.getName=function(){return r.CRS.HorizontalLocal},o.prototype.getDescription=function(){return"System in which an local object's position is described in the observer's local horizon.It is expressed in terms of altitude (or elevation) angle and azimuth. The elevation is measured for -90° (nadir) to 90° (zenith) but azimuth is measured in degrees eastward along the horizon from the North"},o}),r("gw/Crs/SunCrs",["./AbstractCrs","../Renderer/GeoBound","../Utils/Utils","../Utils/Constants","../Utils/Numeric"],function(e,t,i,r,n){var o=function(i){e.prototype.constructor.call(this,{geoideName:r.CRS.Sun,radius:1,realPlanetRadius:696342e3,type:r.CONTEXT.Planet,geoBound:new t(-180,-90,180,90)})};return i.inherits(e,o),o.prototype.formatCoordinates=function(e){var t=[],i=n.roundNumber(e[0],3),r=n.roundNumber(e[1],3);return t[0]=this.getLatitudeLabel()+" = ",t[0]+=r>=0?r+" N":-1*r+" S",t[1]=this.getLongitudeLabel()+" = ",t[1]+=i>=0?i+" E":-1*i+" W",t},o.prototype.getLongitudeLabel=function(){return"Long"},o.prototype.getLatitudeLabel=function(){return"Lat"},o.prototype._setupPosAfterTrans=function(e){},o.prototype._setupPosBeforeTrans=function(e){},o.prototype.getName=function(){return r.CRS.Sun},o.prototype.getDescription=function(){return"Sun coordinate Reference System is a coordinate system using the Sun sphere and in which the heliocentric longitude increases to the east. The heliocentric latitude is measured in degrees north or south of the Sun equator."},o}),r("gw/Crs/CoordinateSystemFactory",["../Utils/Constants","./WGS84Crs","./Mars2000Crs","./Moon2000Crs","./EquatorialCrs","./GalacticCrs","./ProjectedCrs","./HorizontalLocalCrs","./SunCrs"],function(e,t,i,r,n,o,s,a,l){return{create:function(u){var c;if(!u||!u.geoideName)throw new ReferenceError("geoideName not defined in "+JSON.stringify(u),"CoordinateSystemFactory.js");return c=function(s,u){var c;switch(s){case e.CRS.Equatorial:c=new n(u);break;case e.CRS.Galactic:c=new o(u);break;case e.CRS.WGS84:c=new t(u);break;case e.CRS.Mars_2000_old:case e.CRS.Mars_2000:c=new i(u);break;case e.CRS.Moon_2000_old:case e.CRS.Moon_2000:c=new r(u);break;case e.CRS.HorizontalLocal:c=new a(u);break;case e.CRS.Sun:c=new l(u);break;default:throw new RangeError("Datum "+s+" not implemented","CoordinateSystemFactory.js")}return c}(u.geoideName,u),u&&u.projectionName&&(c=new s(c,u)),c}}}),r("gw/Layer/HipsMetadata",["jquery","../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy"],function(e,t,i,r){var n={Radio:"Radio",Millimeter:"Millimeter",Infrared:"Infrared",Optical:"Optical",UV:"UV",EUV:"EUV","X-ray":"X-ray","Gamma-ray":"Gamma-ray"},o={equatorial:t.CRS.Equatorial,galactic:t.CRS.Galactic,ecliptic:"ecliptic",horizontalLocal:t.CRS.HorizontalLocal},s={jpeg:"jpeg",png:"png",fits:"fits",tsv:"tsv"},a={none:"non",nearest:"nearest",bilinear:"bilinear"},l={add:"add",mean:"mean",first:"first",border_fading:"border_fading",custom:"custom"},u={none:"none",hips_estimation:"hips_estimation",fits_keyword:"fits_keyword"},c={image:"image",cube:"cube",catalog:"catalog",meta:"meta"},h={color:"color",live:"live"},d={creator_did:["R","Unique ID of the HiPS - Format: IVOID - Ex : ivo://CDS/P/2MASS/J",!1,null,null,!1],publisher_id:[null,"Unique ID of the HiPS publisher – Format: IVOID - Ex : ivo://CDS",!1,null,null,!1],obs_collection:[null,"Short name of original data set – Format: one word – Ex : 2MASS",!1,null,null,!1],obs_title:["R","Data set title – Format: free text, one line – Ex : HST F110W observations",!1,null,null,!1],obs_description:["S","Data set description – Format: free text, longer free text description of the dataset",!1,null,null,!1],obs_ack:[null,"Acknowledgment mention",!1,null,null,!1],prov_progenitor:["S","Provenance of the original data – Format: free text",!0,null,null,!1],bib_reference:[null,"Bibliographic reference",!0,null,null,!1],bib_reference_url:[null,"URL to bibliographic reference",!0,null,null,!1],obs_copyright:[null,"Copyright mention – Format: free text",!1,null,null,!1],obs_copyright_url:[null,"URL to a copyright mention",!1,null,null,!1],obs_regime:["S","General wavelength – Format: word",!0,null,n,!1],data_ucd:[null,"UCD describing data contents",!0,null,null,!1],hips_version:["R","Number of HiPS version – Format: number",!1,"1.4",null,!1],hips_builder:[null,"Name and version of the tool used for building the HiPS – Format: free text",!1,null,null,!1],hips_publisher:[null,"Institute or person who built the HiPS – Format: free text – Ex : CDS (T.Boch)",!1,null,null,!1],hips_creation_date:["S","HiPS first creation date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_release_date:["R","Last HiPS update date - Format: ISO 8601 => YYYY-mm-ddTHH:MMZ",!1,null,null,!1],hips_service_url:[null,"HiPS access url – Format: URL",!1,null,null,!1],hips_status:["R","HiPS status",!1,"public master clonableOnce",null,!0],hips_estsize:[null,"HiPS size estimation – Format: positive integer – Unit : KB",!1,null,null,!1],hips_frame:["R","Coordinate frame reference",!1,null,o,!1],hips_order:["R","Deepest HiPS order – Format: positive integer",!1,null,null,!1],hips_tile_width:[null,"Tiles width in pixels – Format: positive integer",!1,512,null,!1],hips_tile_format:["R","List of available tile formats. The first one is the default suggested to the client",!1,null,s,!0],hips_pixel_cut:[null,"Suggested pixel display cut range (physical values) – Format: min max",null,null,null,!0],hips_data_range:[null,"Pixel data range taken into account during the HiPS generation (physical values) – Format: min max – Ex : -18.5 510.5",!1,null,null,!0],hips_sampling:[null,"Sampling applied for the HiPS generation",!1,null,a,!1],hips_overlay:[null,"Pixel composition method applied on the image overlay region during HiPS generation",!1,null,l,!1],hips_skyval:[null,"Sky background subtraction method applied during HiPS generation",!1,null,u,!1],hips_pixel_bitpix:[null,"Fits tile BITPIX code",!1,null,null,!1],data_pixel_bitpix:[null,"Original data BITPIX code",!1,null,null],dataproduct_type:["R","Type of data",!1,null,c,!1],dataproduct_subtype:["RD","Subtype of data",!1,null,h,!1],hips_progenitor_url:[null,"URL to an associated progenitor HiPS",!1,null,null,!1],hips_cat_nrows:["S","Number of rows of the HiPS catalog",!1,null,null,!1],hips_cube_depth:["RD","Number of frames of the HiPS cube",!1,null,null,!1],hips_cube_firstframe:[null,"Initial first index frame to display for a HiPS cube",!1,0,null,!1],data_cube_crpix3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_crval3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_cdelt3:[null,"Coef for computing physical channel value (see FITS doc)",!1,null,null,!1],data_cube_bunit3:[null,"Third axis unit (see FITS doc)",!1,null,null,!1],hips_initial_ra:["S","Default RA display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_dec:["S","Default DEC display position (ICRS frame) – Unit : degrees",!1,null,null,!1],hips_initial_fov:["S","Default display size – Unit : degrees",!1,null,null,!1],hips_pixel_scale:[null,"HiPS pixel angular resolution at the highest order – Unit : degrees",!1,null,null,!1],s_pixel_scale:[null,"Best pixel angular resolution of the original images – Unit : degrees",!1,null,null,!1],t_min:["S","Start time of the observations - Representation: MJD",!1,null,null,!1],t_max:["S","Stop time of the observations - Representation: MJD",!1,null,null,!1],em_min:["S","Start in spectral coordinates – Unit: meters",!1,null,null,!1],em_max:["S","Stop in spectral coordinates – Unit: meters",!1,null,null,!1],client_category:[null,"/ separated keywords suggesting a display hierarchy to the client – Ex : Image/InfraRed",!1,null,null,!1],client_sort_key:[null,"Sort key suggesting a display order to the client inside a client_category – Sort : alphanumeric",!1,null,null,!1],addendum_did:[null,"In case of “live” HiPS, creator_did of the added HiPS",!0,null,null,!1],moc_sky_fraction:[null,"Fraction of the sky covers by the MOC associated to the HiPS – Format: real between 0 and 1",!1,null,null,!1]};function p(e,r,n,o,s){"R"!==r||e.hasOwnProperty(n)||("creator_did"===n&&"1.2"===e.hips_version?(e.creator_did=e.publisher_did,i.open(t.LEVEL.WARNING,"Deprecated Hips version <b>1.2</b> for "+e.obs_title,"please update it - <i>use creator_did=publisher_did</i>")):"creator_did"===n&&"1.3"===e.hips_version?(e.creator_did=e.publisher_did,i.open(t.LEVEL.WARNING,"Deprecated Hips version <b>1.3</b> for "+e.obs_title,"please update it - <i>use creator_did=publisher_did</i>")):"obs_title"===n&&"1.3"===e.hips_version?(e.obs_title=e.obs_collection,i.open(t.LEVEL.WARNING,"Deprecated Hips version <b>1.3</b> for "+e.obs_title,"please update it - <i>use obs_title=obs_collection</i>")):"obs_title"===n&&"1.4"===e.hips_version?(e.obs_title=e.obs_collection,i.open(t.LEVEL.WARNING,"obs_title not found in v1.4 for "+e.obs_title,"use obs_title, please fix it")):"creator_did"===n&&"1.4"===e.hips_version?(e.creator_did=e.publisher_did,i.open(t.LEVEL.WARNING,"creator_did not found in v1.4 for "+e.obs_title,"use creator_did, please fix it")):"hips_version"!==n||e.hasOwnProperty("hips_version")?"creator_did"!==n||e.hasOwnProperty("hips_version")?s.push(n+" ("+o+") is not present. "):(e.creator_did=e.publisher_did,i.open(t.LEVEL.WARNING,"Deprecated Hips version <b>unknown</b> for "+e.obs_title,"please update it - <i>use creator_did = pulisher_did</i>")):(e.hips_version="very old one",i.open(t.LEVEL.WARNING,"Deprecated Hips version <b>unknown</b> for "+e.obs_title,"please update it - <i>use a version in your metadata</i>")))}function f(e,t,i){e&&i.hasOwnProperty(t)&&(i[t]=i[t].split(/\s+/))}function g(e,t,i){null===t||i.hasOwnProperty(e)||(i[e]=t)}function m(e){var t,i,r,n,o,s=[],a=[];for(var l in d)d.hasOwnProperty(l)&&(i=(t=d[l])[0],r=t[1],n=t[3],t[4],o=t[5],p.call(this,e,i,l,r,s),f.call(this,o,l,e),g.call(this,l,n,e));if(s.length>0||a.length>0){var u=e.obs_title?e.obs_title:e.obs_collection,c=e.hips_service_url?e.hips_service_url:this.baseUrl;throw new RangeError("unvalid hips metadata for "+u+" ("+c+"): \n"+s.toString()+"\n"+a.toString(),"HipsMetadata.js")}}function v(t){var i=e.ajax({type:"GET",datatype:"text",url:r.proxify(t+"/properties"),async:!1,beforeSend:function(e){e.setRequestHeader("Accept","text/plain")}}).responseText;if(void 0===i)throw new ReferenceError("Unable to load the Hips at "+t,"HipsMetadata.js");var n=function(t){var i={},r=t.split(/\r?\n/),n="";return e.each(r,function(e,t){if(!/^\s*(#|!|$)/.test(t))if(t=t.replace(/^\s*/,""),/(\\\\)*\\$/.test(n+=t))n=n.replace(/\\$/,"");else{/^\s*((?:[^\s:=\\]|\\.)+)\s*[:=\s]\s*(.*)$/.test(n);var r=RegExp.$1,o=RegExp.$2;i.hasOwnProperty(r)?i[r]=i[r].isPrototypeOf(Array)?i[r].push(o):[i[r],o]:i[r]=o,n=""}}),i}.call(this,i);return m.call(this,n),n}var y=function(e){if(null==e);else if("string"==typeof e)this.baseUrl=e,this.hipsMetadata=v.call(this,e);else{this.hipsMetadata=e;try{m.call(this,this.hipsMetadata)}catch(e){this.baseUrl=this.hipsMetadata.hips_service_url,this.hipsMetadata=v.call(this,this.baseUrl)}}};return y.prototype.setMetadata=function(e){this.hipsMetadata=e,this.baseUrl=e.hips_service_url},y.prototype.GeneralWavelength=n,y.prototype.HipsFrame=o,y.prototype.HipsTileFormat=s,y.prototype.Sampling=a,y.prototype.PixelOverlay=l,y.prototype.SkyVal=u,y.prototype.DataProductType=c,y.prototype.SubTypeData=h,y.prototype.getHipsMetadata=function(){return this.hipsMetadata},y.prototype.getBaseUrl=function(){return this.baseUrl},y}),r("gw/Layer/AbstractHipsLayer",["underscore-min","./AbstractRasterLayer","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","../Crs/CoordinateSystemFactory","./HipsMetadata"],function(e,t,i,r,n,o,s){var a=function(i,a){(function(e){if(!e)throw new ReferenceError("Some required parameters are missing","AbstractHipsLayer.js");e.category=e.category||"Image",e.pickable=e.pickable||!1}).call(this,a),this.hipsMetadata=function(e,t){var i=e;if(void 0===i){var r=new s(t);i=r.getHipsMetadata()}return i}.call(this,i,a.baseUrl),function(e,t){e.coordinateSystem=e.hasOwnProperty("coordinateSystem")?o.create(e.coordinateSystem):o.create({geoideName:r.MappingCrsHips2Mizar[t.hips_frame]}),e.tilePixelSize=e.hasOwnProperty("tilePixelSize")?e.tilePixelSize:t.hips_tile_width,e.baseLevel=e.hasOwnProperty("baseLevel")?e.baseLevel:t.hasOwnProperty("hips_order_min")?t.hips_order_min:2,e.numberOfLevels=e.hasOwnProperty("numberOfLevels")?e.numberOfLevels:t.hips_order,e.name=e.hasOwnProperty("name")?e.name:t.obs_title,e.attribution=e.hasOwnProperty("attribution")?e.attribution:'<a href="'+t.obs_copyright_url+'" target="_blank">'+t.obs_copyright+"</a>",e.copyrightUrl=e.hasOwnProperty("copyrightUrl")?e.copyrightUrl:t.obs_copyright_url,e.ack=e.hasOwnProperty("ack")?e.ack:t.obs_ack,e.description=e.hasOwnProperty("description")?e.description:t.obs_description,e.format=e.hasOwnProperty("format")?e.format:t.hips_tile_format,e.baseUrl=e.hasOwnProperty("baseUrl")?e.baseUrl:t.hips_service_url,e.properties=e.hasOwnProperty("properties")?e.properties:{},t.hasOwnProperty("obs_initial_ra")&&(e.properties.initialRa=parseFloat(t.obs_initial_ra));t.hasOwnProperty("obs_initial_dec")&&(e.properties.initialDec=parseFloat(t.obs_initial_dec));t.hasOwnProperty("obs_initial_fov")&&(e.properties.initialFov=parseFloat(t.obs_initial_fov));t.hasOwnProperty("moc_sky_fraction")&&(e.properties.moc_sky_fraction=parseFloat(t.moc_sky_fraction))}.call(this,a,this.hipsMetadata),a.tiling=new n(a.baseLevel||2,{coordinateSystem:a.coordinateSystem}),a.icon=a.hasOwnProperty("icon")?a.icon:a.mizarBaseUrl?a.mizarBaseUrl+"css/images/star.png":"",a.visible=!!a.hasOwnProperty("visible")&&a.visible,a.properties=a.hasOwnProperty("properties")?a.properties:{},a.pickable=!!a.hasOwnProperty("pickable")&&a.pickable,a.services=a.hasOwnProperty("services")?a.services:{},a.category=a.hasOwnProperty("category")?a.category:"Image",this.hipsMetadata.hasOwnProperty("moc_access_url")&&(a.services.Moc={baseUrl:this.hipsMetadata.moc_access_url,skyFraction:this.hipsMetadata.moc_sky_fraction}),a.coordinateSystem.getGeoideName()===r.CRS.Galactic&&(a.background=!0),t.prototype.constructor.call(this,r.LAYER.Hips,a),this.fitsSupported=e.contains(this.hipsMetadata.hips_tile_format,"fits")};return i.inherits(t,a),a.prototype.getHipsMetadata=function(){return this.hipsMetadata},a}),r("gw/Layer/HipsGraphicLayer",["../Utils/Utils","../Tiling/HEALPixTiling","./AbstractHipsLayer","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n){var o=function(e,t){i.prototype.constructor.call(this,e,t),this._ready=!1,this.levelZeroImage=new Image;var o=this;this.levelZeroImage.crossOrigin="",this.levelZeroImage.onload=function(){o._ready=!0,t.onready&&t.onready instanceof Function&&t.onready(o),o.globe&&o.globe.getRenderContext().requestFrame()},this.levelZeroImage.onerror=function(e){var t=o.getHipsMetadata();t.message="Cannot load "+o.levelZeroImage.src,o.globe.publishEvent(r.EVENT_MSG.BASE_LAYERS_ERROR,t),o._ready=!1,n.open(r.LEVEL.WARNING,"Cannot load "+o.levelZeroImage.src)}};return e.inherits(i,o),o.prototype._attach=function(e){i.prototype._attach.call(this,e),this.loadOverview()},o.prototype.loadOverview=function(){this.isBackground()&&(this.levelZeroImage.src=this.allowRequest(this.baseUrl)+"/Norder3/Allsky."+this.format)},o.prototype.getUrl=function(e){var t=this.allowRequest(this.baseUrl);return t+="/Norder",t+=e.order,t+="/Dir",t+=1e4*Math.floor(e.pixelIndex/1e4),t+="/Npix",t+=e.pixelIndex,t+="."+this.format,this.allowRequest(t)},o.prototype.generateLevel0Textures=function(e,t){var i,r,n,o,s,a=document.createElement("canvas");a.width=128,a.height=128;var l=a.getContext("2d");for(i=0;i<e.length;i++){n=(r=4*(s=e[i]).pixelIndex)%27*64,o=64*Math.floor(r/27),l.drawImage(this.levelZeroImage,n,o,64,64,0,0,64,64),n=(r=4*s.pixelIndex+2)%27*64,o=64*Math.floor(r/27),l.drawImage(this.levelZeroImage,n,o,64,64,64,0,64,64),n=(r=4*s.pixelIndex+1)%27*64,o=64*Math.floor(r/27),l.drawImage(this.levelZeroImage,n,o,64,64,0,64,64,64),n=(r=4*s.pixelIndex+3)%27*64,o=64*Math.floor(r/27),l.drawImage(this.levelZeroImage,n,o,64,64,64,64,64,64);var u=l.getImageData(0,0,128,128);u.dataType="byte",s.texture=t.createGLTexture(u),s.imageSize=128}},o}),r("gw/Parser/JsonProcessor",["../Layer/HipsGraphicLayer","../Utils/Constants","../Gui/dialog/ErrorDialog","../Crs/CoordinateSystemFactory"],function(e,t,i,r){var n=0;function o(i,r){for(var n in r.services){var o=r.services[n];switch(i.subLayers||(i.subLayers=[]),o.type){case t.LAYER.Hips:o.layer=new e({format:o.format,baseUrl:o.url,name:o.name,visible:!1,coordinates:r.geometry.coordinates[0]}),i.subLayers.push(o.layer),i.planet&&i.visible()&&i.planet.addLayer(o.layer)}}}return{handleFeatureCollection:function(e,s){var a={type:"name",properties:{name:t.CRS.WGS84}};if(null==s)throw new ReferenceError("Error, featureCollection is null","JsonProcessor.js");var l=s.crs?s.crs:a;e.coordinateSystem=r.create({geoideName:l.properties.name});var u,c=s.features;if(null!=c)for(u=0;u<c.length;u++){var h=c[u];switch(h.geometry.type){case t.GEOMETRY.Point:e.dataType?"point"!==e.dataType&&(e.dataType="none"):e.dataType="point";break;case t.GEOMETRY.Polygon:case t.GEOMETRY.MultiPolygon:e.dataType?"line"!==e.dataType&&(e.dataType="none"):e.dataType="line",h.properties._imageCoordinates&&(h.geometry._imageCoordinates=h.properties._imageCoordinates)}h.geometry.crs||(h.geometry.crs=l),h.geometry.gid="jsonProc_"+n,n++,h.services&&o(e,h)}else i.open(t.LEVEL.ERROR,"Error, no feature in featureCollection : ",s)}}});var u=function(){TYPE_STRING="string",TYPE_LIST="list",TYPE_MAP="map";var e=function(e){if("string"==typeof e)return TYPE_STRING;if(e instanceof Array)return TYPE_LIST;if(e instanceof Object&&null!==e)return TYPE_MAP;throw new Error("Not legal SAMP object type: "+e)},t=function(e,t){var i,r,n=e.childNodes,o=[];for(r=0;r<n.length;r++)if(1===(i=n[r]).nodeType){if(t&&i.tagName!==t)throw new Error("Child <"+n[r].tagName+"> of <"+e.tagName+"> is not a <"+t+">");o.push(i)}return o},i=function(e,i){var r=t(e,i);if(1===r.length)return r[0];throw new Error("No sole child of <"+e.tagName+">")},r=function(e){var t,i,r="";for(t=0;t<e.childNodes.length;t++){if(1===(i=e.childNodes[t]).nodeType)throw new Error("Element found in text content");3!==i.nodeType&&4!==i.nodeType||(r+=i.nodeValue)}return r},n={escapeXml:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},checkParams:function(t,i){var r;for(r=0;r<i.length;r++)if(i[r]!==TYPE_STRING&&i[r]!==TYPE_LIST&&i[r]!==TYPE_MAP)throw new Error("Unknown type "+i[r]+" in check list");var n=t.length,o=[],s=!0;for(r=0;r<n;r++)o.push(e(t[r]));for(s=s&&i.length===n,r=0;s&&r<n;r++)s=s&&i[r]===o[r];if(!s)throw new Error("Param type list mismatch: ["+i+"] != ["+o+"]")},valueToXml:function t(i,r){var o,s;r=r||"";var a=e(i);if(a===TYPE_STRING)return r+"<value><string>"+n.escapeXml(i)+"</string></value>";if(a===TYPE_LIST){for((s=[]).push(r+"<value>",r+"  <array>",r+"    <data>"),o=0;o<i.length;o++)s.push(t(i[o],r+"      "));return s.push(r+"    </data>",r+"  </array>",r+"</value>"),s.join("\n")}if(a===TYPE_MAP){for(o in(s=[]).push(r+"<value>"),s.push(r+"  <struct>"),i)s.push(r+"    <member>"),s.push(r+"      <name>"+n.escapeXml(o)+"</name>"),s.push(t(i[o],r+"      ")),s.push(r+"    </member>");return s.push(r+"  </struct>"),s.push(r+"</value>"),s.join("\n")}throw new Error("bad type")},xmlToValue:function e(n,o){var s,a,l,u,c=t(n);if(0===c.length)return r(n);if(1===c.length){if("string"===(u=(l=c[0]).tagName))return r(l);if("array"===u){var h=t(i(l,"data"),"value"),d=[];for(s=0;s<h.length;s++)d.push(e(h[s],o));return d}if("struct"===u){var p,f,g,m=t(l,"member"),v={};for(s=0;s<m.length;s++){for(p=void 0,f=void 0,a=0;a<m[s].childNodes.length;a++)1==(g=m[s].childNodes[a]).nodeType&&("name"===g.tagName?p=r(g):"value"===g.tagName&&(f=e(g,o)));if(void 0===p||void 0===f)throw new Error("No <name> and/or <value> in <member>?");v[p]=f}return v}if(!o||"int"!==u&&"i4"!==u)throw new Error("Non SAMP-friendly value content: <"+u+">");return r(l)}throw new Error("Bad XML-RPC <value> content - multiple elements")},decodeParams:function(e){var r,o=t(e,"param"),s=[];for(r=0;r<o.length;r++)s.push(n.xmlToValue(i(o[r],"value")));return s},decodeFault:function(e){var t=n.xmlToValue(i(e,"value"),!0);return new n.Fault(t.faultString,t.faultCode)},decodeResponse:function(e){var t=e.documentElement;if("methodResponse"!==t.tagName)throw new Error("Response element is not <methodResponse>");var r=i(t);if("fault"===r.tagName)return n.decodeFault(r);if("params"===r.tagName)return n.decodeParams(r)[0];throw new Error("Bad XML-RPC response - unknown element <"+r.tagName+">")},Fault:function(e,t){this.faultString=e,this.faultCode=t}};n.Fault.prototype.toString=function(){return"XML-RPC Fault ("+this.faultCode+"): "+this.faultString};var o=function(e,t){this.methodName=e,this.params=t||[]};o.prototype.toString=function(){return this.methodName+"("+(e=this.params,"undefined"==typeof JSON?"...":JSON.stringify(e))+")";var e},o.prototype.addParam=function(e){return this.params.push(e),this},o.prototype.addParams=function(e){var t;for(t=0;t<e.length;t++)this.params.push(e[t]);return this},o.prototype.checkParams=function(e){n.checkParams(this.params,e)},o.prototype.toXml=function(){var e=[];e.push("<?xml version='1.0'?>","<methodCall>","  <methodName>"+this.methodName+"</methodName>","  <params>");for(var t=0;t<this.params.length;t++)e.push("    <param>",n.valueToXml(this.params[t],"      "),"    </param>");return e.push("  </params>","</methodCall>"),e.join("\n")};var s=function(e){this.endpoint=e||"http://localhost:21012/"};s.createXHR=function(){var e=function(e){var t;this.xhr=e,e.onreadystatechange=(t=this,function(){4===e.readyState&&(t.completed||200==+e.status&&(t.completed=!0,t.responseText=e.responseText,t.responseXML=e.responseXML,t.onload&&t.onload()))}),e.onerror=function(e){return function(t){e.completed||(e.completed=!0,e.onerror&&(t?t.toString=function(){return"No hub?"}:t="No hub?",e.onerror(t)))}}(this),e.ontimeout=function(e){return function(t){e.completed||(e.completed=!0,e.onerror&&e.onerror("timeout"))}}(this)};e.prototype.open=function(e,t){this.xhr.open(e,t)},e.prototype.send=function(e){this.xhr.send(e)},e.prototype.abort=function(){this.xhr.abort()},e.prototype.setContentType=function(e){"setRequestHeader"in this.xhr&&this.xhr.setRequestHeader("Content-Type",e)};var t=function(e){var t;this.xdr=e,e.onload=(t=this,function(){var i;if(t.responseText=e.responseText,"text/xml"===e.contentType||"application/xml"===e.contentType||/\/x-/.test(e.contentType))try{var r=new ActiveXObject("Microsoft.XMLDOM");r.loadXML(e.responseText),t.responseXML=r}catch(i){t.responseXML=i}t.onload&&t.onload()}),e.onerror=function(e){return function(t){e.onerror&&e.onerror(t)}}(this),e.ontimeout=function(e){return function(t){e.onerror&&e.onerror(t)}}(this)};if(t.prototype.open=function(e,t){this.xdr.open(e,t)},t.prototype.send=function(e){this.xdr.send(e)},t.prototype.abort=function(){this.xdr.abort()},t.prototype.setContentType=function(e){},"undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;if("withCredentials"in i)return new e(i)}if("undefined"!=typeof XDomainRequest)return new t(new XDomainRequest);if(void 0!==flensed.flXHR)return new e(new flensed.flXHR({instancePooling:!0}));throw new Error("no cross-origin mechanism available")},s.prototype.execute=function(e,t,i){!function(r){var o,a;try{(o=s.createXHR()).open("POST",r.endpoint),o.setContentType("text/xml")}catch(a){throw i(a),a}o.onload=function(){var e,r,s=o.responseXML;if(s){try{e=n.decodeResponse(s)}catch(r){return void(i&&i(r))}e instanceof n.Fault?i&&i(e):t&&t(e)}else i&&i("no XML response")},o.onerror=function(e){e?e.toString=function(){return"No hub?"}:e="No hub",i&&i(e)},o.send(e.toXml())}(this)};var a=function(e){if(this.regInfo=e,this.privateKey=e["samp.private-key"],"string"===(this.privateKey,!1))throw new Error("Bad registration object");this.xClient=new s};!function(){var e,t={call:[TYPE_STRING,TYPE_STRING,TYPE_MAP],callAll:[TYPE_STRING,TYPE_MAP],callAndWait:[TYPE_STRING,TYPE_MAP,TYPE_STRING],declareMetadata:[TYPE_MAP],declareSubscriptions:[TYPE_MAP],getMetadata:[TYPE_STRING],getRegisteredClients:[],getSubscribedClients:[TYPE_STRING],getSubscriptions:[TYPE_STRING],notify:[TYPE_STRING,TYPE_MAP],notifyAll:[TYPE_MAP],ping:[],reply:[TYPE_STRING,TYPE_MAP]};for(e in t)!function(e,t){a.prototype[e]=function(i,r,s){var a,l=(a=this,function(){a.close()});s=s||l,n.checkParams(i,t);var u=new o("samp.webhub."+e);return u.addParam(this.privateKey),u.addParams(i),this.xClient.execute(u,r,s)}}(e,t[e])}(),a.prototype.unregister=function(){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(e){}var e=new o("samp.webhub.unregister");e.addParam(this.privateKey);try{this.xClient.execute(e)}catch(e){}delete this.regInfo,delete this.privateKey},a.prototype.close=function(){if(!this.closed){this.closed=!0;try{this.regInfo&&this.unregister()}catch(e){}if(this.onclose){oc=this.onclose,delete this.onclose;try{oc()}catch(e){}}}},a.prototype.setCallable=function(t,i){if(this.callbackRequest)try{this.callbackRequest.abort()}catch(e){}finally{delete this.callbackRequest}if(t||this.regInfo){var r=new o("samp.webhub.allowReverseCallbacks");r.addParam(this.privateKey),r.addParam(t?"1":"0");var n,s,a,l,u,c,h=(n=this,function(){n.close()});t?(l=function(i){if(e(i)==TYPE_LIST){var r,n,o,s,a;for(r=0;r<i.length;r++)try{n=i[r],void 0,void 0,a=void 0,o=n["samp.methodName"],s=n["samp.params"],a=void 0,"receiveNotification"===o?a=t.receiveNotification:"receiveCall"===o?a=t.receiveCall:"receiveResponse"===o&&(a=t.receiveResponse),a&&a.apply(t,s)}catch(e){}c()}else u(new Error("pullCallbacks result not List"))},u=function(e){(new Date).getTime()-a<1e3?s.close():c()},c=function(){if(s.regInfo){var e=new o("samp.webhub.pullCallbacks");e.addParam(s.privateKey),e.addParam("600"),a=(new Date).getTime(),s.callbackRequest=s.xClient.execute(e,l,u)}},(s=this).xClient.execute(r,function(){c(),i()},h)):this.xClient.execute(r,i,h)}},a.prototype.translateUrl=function(e){return(this.regInfo["samp.url-translator"]||"")+e},a.Action=function(e,t,i){this.actName=e,this.actArgs=t,this.resultKey=i};var l=function(e){this.callHandler={},this.replyHandler={}};l.prototype.init=function(e){},l.prototype.receiveNotification=function(e,t){var i=t["samp.mtype"],r=!1;if(i in this.callHandler){try{this.callHandler[i](e,t,!1)}catch(e){}r=!0}return r},l.prototype.receiveCall=function(e,t,i){var r,n,o=i["samp.mtype"],s=!1;if(o in this.callHandler)try{r={"samp.status":"samp.ok","samp.result":this.callHandler[o](e,i,!0)||{}},s=!0}catch(n){r={"samp.status":"samp.error","samp.error":{"samp.errortxt":n.toString()}}}else r={"samp.status":"samp.warning","samp.result":{},"samp.error":{"samp.errortxt":"no action"}};return this.connection.reply([t,r]),s},l.prototype.receiveResponse=function(e,t,i){var r=!1;if(t in this.replyHandler)try{this.replyHandler[t](e,t,i),r=!0}catch(e){}return r},l.prototype.calculateSubscriptions=function(){var e,t={};for(e in this.callHandler)t[e]={};return t};var c=function(){var e=this;this.ids={},this.metas={},this.subs={},this.replyHandler={},this.callHandler={"samp.hub.event.shutdown":function(t,i){e.connection.close()},"samp.hub.disconnect":function(t,i){e.connection.close()},"samp.hub.event.register":function(t,i){var r=i["samp.params"].id;e.ids[r]=!0,e.changed(r,"register",null)},"samp.hub.event.unregister":function(t,i){var r=i["samp.params"].id;delete e.ids[r],delete e.metas[r],delete e.subs[r],e.changed(r,"unregister",null)},"samp.hub.event.metadata":function(t,i){var r=i["samp.params"].id,n=i["samp.params"].metadata;e.metas[r]=n,e.changed(r,"meta",n)},"samp.hub.event.subscriptions":function(t,i){var r=i["samp.params"].id,n=i["samp.params"].subscriptions;e.subs[r]=n,e.changed(r,"subs",n)}}};(c.prototype=function(e){function t(){}return t.prototype=e,new t}(l.prototype)).changed=function(e,t,i){this.onchange&&this.onchange(e,t,i)},c.prototype.init=function(e){var t=this;this.connection=e;var i=function(i,r,n,o){e[n]([i],function(e){o[i]=e,t.changed(i,r,e)})};e.getRegisteredClients([],function(e){var r,n;for(t.ids={},r=0;r<e.length;r++)n=e[r],t.ids[n]=!0,i(n,"meta","getMetadata",t.metas),i(n,"subs","getSubscriptions",t.subs);t.changed(null,"ids",null)})},c.prototype.getName=function(e){var t=this.metas[e];return t&&t["samp.name"]?t["samp.name"]:"["+e+"]"};var h=function(e,t,i,r){this.name=e,this.meta=t,this.callableClient=i,this.subs=r,this.regTextNodes=[],this.whenRegs=[],this.whenUnregs=[],this.connection=void 0,this.onreg=void 0,this.onunreg=void 0},d=function(e,t){var i,r,n=e.regTextNodes;for(i=0;i<n.length;i++)(r=n[i]).innerHTML="",r.appendChild(document.createTextNode(t))};h.prototype.setConnection=function(e){var t=this;if(this.connection&&(this.connection.close(),this.onunreg))try{this.onunreg()}catch(e){}if(this.connection=e,e&&(e.onclose=function(){if(t.connection=null,t.onunreg)try{t.onunreg()}catch(e){}t.update()},this.meta&&e.declareMetadata([this.meta]),this.callableClient&&(this.callableClient.init&&this.callableClient.init(e),e.setCallable(this.callableClient,function(){e.declareSubscriptions([t.subs])})),this.onreg))try{this.onreg(e)}catch(e){}this.update()},h.prototype.register=function(){var e=this;p(this.name,function(t){e.setConnection(t),d(e,t?"Yes":"No")},function(t){d(e,"no ("+t.toString()+")")})},h.prototype.unregister=function(){this.connection&&(this.connection.unregister([]),this.setConnection(null))},h.prototype.createRegButtons=function(){var e=this,t=document.createElement("button");t.setAttribute("type","button"),t.appendChild(document.createTextNode("Register")),t.onclick=function(){e.register()},this.whenUnregs.push(t);var i=document.createElement("button");i.setAttribute("type","button"),i.appendChild(document.createTextNode("Unregister")),i.onclick=function(){e.unregister()},this.whenRegs.push(i);var r=document.createElement("span");this.regTextNodes.push(r);var n=document.createDocumentFragment();n.appendChild(t),n.appendChild(document.createTextNode(" ")),n.appendChild(i);var o=document.createElement("span");return o.innerHTML=" <strong>Registered: </strong>",n.appendChild(o),n.appendChild(r),this.update(),n},h.prototype.update=function(){var e,t=!!this.connection,i=t?this.whenRegs:this.whenUnregs,r=t?this.whenUnregs:this.whenRegs;for(e=0;e<i.length;e++)i[e].removeAttribute("disabled");for(e=0;e<r.length;e++)r[e].setAttribute("disabled","disabled");d(this,"No")},h.prototype.runWithConnection=function(e,t){var i=this,r=function(t){i.setConnection(t),e(t)},n=function(e){i.setConnection(void 0),t(e)};this.connection?this.connection.getRegisteredClients([],function(t){e(i.connection)},function(e){p(this.name,r,n)}):p(this.name,r,n)},h.prototype.onHubAvailability=function(e,t){return u.ping(e),setInterval(function(){u.ping(e)},t)};var p=function(e,t,i){var r=new s,n=new o("samp.webhub.register"),l={"samp.name":e};n.addParam(l),n.checkParams([TYPE_MAP]);r.execute(n,function(e){var r,n;try{r=new a(e)}catch(n){return void i(n)}t(r)},i)},f={};return f.XmlRpcRequest=o,f.XmlRpcClient=s,f.Message=function(e,t){this["samp.mtype"]=e,this["samp.params"]=t},f.TYPE_STRING=TYPE_STRING,f.TYPE_LIST=TYPE_LIST,f.TYPE_MAP=TYPE_MAP,f.register=p,f.ping=function(e){var t=new s,i=new o("samp.webhub.ping");t.execute(i,function(t){e(!0)},function(t){e(!1)})},f.isSubscribed=function(e,t){var i,r=function(e,t){if(e==t)return!0;if("*"===e)return!0;var r,n=/^(.*)\.\*$/.exec(i);return!(!n||(r=n[1])!==t.substring(0,r.length))};for(i in e)if(r(i,t))return!0;return!1},f.Connector=h,f.CallableClient=l,f.ClientTracker=c,f}();r("samp",function(){}),r("gw/Services/SampCore",["jquery","underscore-min","../Utils/Constants","../Parser/JsonProcessor","../Gui/dialog/ErrorDialog","samp","jquery.ui"],function(e,t,i,r,n){var o,s,a;return{initSamp:function(t){o=t;var r=function(){var t=new u.ClientTracker,r=t.callHandler;return r["samp.app.ping"]=function(e,i,r){if(r)return{text:"ping to you, "+t.getName(e)}},r["table.load.votable"]=function(e,t,r){a||n.open(i.LEVEL.ERROR,"votable2geojson plugin base url isn't defined")},r["image.load.fits"]=function(e,t,i){},r["coord.pointAt.sky"]=function(e,t,i){!0;var r=t["samp.params"],n=parseFloat(r.ra),s=parseFloat(r.dec);o.getActivatedContext().getNavigation().zoomTo([n,s])},r["samp.hub.event.unregister"]=function(t,i,r){e("#registerSamp").removeAttr("disabled").button("refresh"),e("#unregisterSamp").attr("disabled","disabled").button("refresh"),e("#sampInvoker").toggleClass("selected")},t}(),l={receiveNotification:function(t,i){r.receiveNotification(t,i),"samp.hub.event.subscriptions"===i["samp.mtype"]&&(e("#unregisterSamp").removeAttr("disabled").button("refresh"),e("#registerSamp").attr("disabled","disabled").button("refresh"),e("#sampInvoker").addClass("selected"))},receiveCall:function(e,t,i){r.receiveCall(e,t,i)},receiveResponse:function(e,t,i){r.receiveResponse(e,t,i)},init:function(e){r.init(e)}},c=r.calculateSubscriptions();return(s=new u.Connector("Mizar",{"samp.name":"Mizar","samp.description.text":"Module for Interactive visualiZation from Astronomical Repositories","mizar.version":"v1.0","author.affiliation":"CNES/TPZ","home.page":"http://github.com/MizarWeb"},l,c)).regTextNodes.push(e("#sampResult")[0]),s},sendImage:function(e){if(this.isConnected()){var t=new u.Message("image.load.fits",{url:e});return s.connection.notifyAll([t]),"Image has been sent"}return"Connect to SAMP Hub first"},sendVOTable:function(e,t){if(this.isConnected()){var i=new u.Message("table.load.votable",{url:t+"&media=votable"});return s.connection.notifyAll([i]),"VOTable has been sent"}return"Connect to SAMP Hub first"},highlightFeature:function(e,t){},isConnected:function(){return s.connection}}}),r("gw/Services/SelectionToolCore",["jquery","../Utils/Constants","../Utils/UtilsIntersection","../Utils/Numeric","../Layer/VectorLayer","../Renderer/FeatureStyle","../Renderer/Ray","../Renderer/glMatrix"],function(e,t,i,r,n,o,s){var a,l,u,c=function(e){var r;a=e.ctx,l=a.getNavigation(),u=e.onselect,this.activated=e.activated||!1,this.renderContext=a.getRenderContext(),this.coordinateSystem=a.getCoordinateSystem(),(r=e&&e.style?e.style:new o).zIndex=t.DISPLAY.SELECTED_VECTOR,this.selectionLayer=new n({style:r,visible:!0}),a.addDraw(this.selectionLayer),this.selectionFeature=null,this.radius=null,this.pickPoint=null,this.geoRadius=null,this.geoPickPoint=null;var s,c=this,h=!1;this.renderContext.canvas.addEventListener("mousedown",function(e){var t=[e.layerX,e.layerY],r=a.getLonLatFromPixel(e.layerX,e.layerY);if(c.activated||c.selectionFeature)if(c.activated)l.stop(),h=!0,c.pickPoint=t,c.geoPickPoint=r,c.radius=0,s="resize";else{if(!i.pointInRing(r,c.selectionFeature.geometry.coordinates[0]))return;l.stop(),h=!0;for(var n=!1,o=0;o<c.selectionFeature.geometry.coordinates[0].length;o++){var u=c.selectionFeature.geometry.coordinates[0][o];n|=i.pointInSphere(a,r,u,20)}s=n?"resize":"move"}}),this.renderContext.canvas.addEventListener("mousemove",function(e){if(h){var t=a.getLonLatFromPixel(e.layerX,e.layerY);"resize"===s?(c.radius=Math.sqrt(Math.pow(e.layerX-c.pickPoint[0],2)+Math.pow(e.layerY-c.pickPoint[1],2)),c.computeGeoRadius(t)):"move"===s&&(c.pickPoint=[e.layerX,e.layerY],c.geoPickPoint=a.getLonLatFromPixel(e.layerX,e.layerY)),c.updateSelection()}}),this.renderContext.canvas.addEventListener("mouseup",function(e){if(h){a.getLonLatFromPixel(e.layerX,e.layerY);var t=c.computeSelection();c.activated&&u&&u(t),l.start(),h=!1}})};return c.prototype.computeGeoRadius=function(e){var t=vec3.dot(vec3.normalize(this.coordinateSystem.get3DFromWorld(e)),vec3.normalize(this.coordinateSystem.get3DFromWorld(this.geoPickPoint))),i=Math.acos(t);this.geoRadius=r.toDegree(i)},c.prototype.computeSelection=function(){var e=this.renderContext,t=mat4.create();mat4.inverse(e.viewMatrix,t);var i=[t[12],t[13],t[14]];mat4.multiply(e.projectionMatrix,e.viewMatrix,t),mat4.inverse(t);for(var r=2/e.canvas.width,n=2/e.canvas.height,o=[[(this.pickPoint[0]-this.radius)*r-1,(e.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1],[(this.pickPoint[0]-this.radius)*r-1,(e.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(e.canvas.height-this.pickPoint[1]+this.radius)*n-1,1,1],[(this.pickPoint[0]+this.radius)*r-1,(e.canvas.height-this.pickPoint[1]-this.radius)*n-1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(t,o[l]),vec3.scale(o[l],1/o[l][3]),vec3.subtract(o[l],i,o[l]),vec3.normalize(o[l]);var u=new s(i,o[l]),c=u.computePoint(u.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius()));o[l]=this.coordinateSystem.getWorldFrom3D(c)}return o},c.prototype.updateSelection=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature);var e=this.computeSelection();e.push(e[0]),this.selectionFeature={geometry:{gid:"selectionShape",coordinates:[e],type:"Polygon",crs:{type:"name",properties:{name:a.getCoordinateSystem().getGeoideName()}}},type:"Feature"},this.selectionLayer.addFeature(this.selectionFeature)},c.prototype.toggle=function(){this.activated=!this.activated,this.activated?e(this.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)"):e(this.renderContext.canvas).css("cursor","default")},c.prototype.clear=function(){this.selectionFeature&&this.selectionLayer.removeFeature(this.selectionFeature),this.pickPoint=null,this.radius=null,this.geoPickPoint=null,this.geoRadius=null},c}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof r&&r.amd)r("jszip",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).JSZip=e()}}(function(){return function e(i,r,n){function o(a,l){if(!r[a]){if(!i[a]){var u="function"==typeof t&&t;if(!l&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[a]={exports:{}};i[a][0].call(h.exports,function(e){var t=i[a][1][e];return o(t||e)},h,h.exports,e,i,r,n)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){"use strict";var r=e("./utils"),n=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.encode=function(e){for(var t,i,n,s,a,l,u,c=[],h=0,d=e.length,p=d,f="string"!==r.getTypeOf(e);h<e.length;)p=d-h,f?(t=e[h++],i=h<d?e[h++]:0,n=h<d?e[h++]:0):(t=e.charCodeAt(h++),i=h<d?e.charCodeAt(h++):0,n=h<d?e.charCodeAt(h++):0),s=t>>2,a=(3&t)<<4|i>>4,l=p>1?(15&i)<<2|n>>6:64,u=p>2?63&n:64,c.push(o.charAt(s)+o.charAt(a)+o.charAt(l)+o.charAt(u));return c.join("")},i.decode=function(e){var t,i,r,s,a,l,u=0,c=0,h="data:";if(e.substr(0,h.length)===h)throw new Error("Invalid base64 input, it looks like a data url.");var d,p=3*(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(e.charAt(e.length-1)===o.charAt(64)&&p--,e.charAt(e.length-2)===o.charAt(64)&&p--,p%1!=0)throw new Error("Invalid base64 input, bad content length.");for(d=n.uint8array?new Uint8Array(0|p):new Array(0|p);u<e.length;)t=o.indexOf(e.charAt(u++))<<2|(s=o.indexOf(e.charAt(u++)))>>4,i=(15&s)<<4|(a=o.indexOf(e.charAt(u++)))>>2,r=(3&a)<<6|(l=o.indexOf(e.charAt(u++))),d[c++]=t,64!==a&&(d[c++]=i),64!==l&&(d[c++]=r);return d}},{"./support":30,"./utils":32}],2:[function(e,t,i){"use strict";function r(e,t,i,r,n){this.compressedSize=e,this.uncompressedSize=t,this.crc32=i,this.compression=r,this.compressedContent=n}var n=e("./external"),o=e("./stream/DataWorker"),s=e("./stream/DataLengthProbe"),a=e("./stream/Crc32Probe");s=e("./stream/DataLengthProbe");r.prototype={getContentWorker:function(){var e=new o(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new s("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new o(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},r.createWorkerFrom=function(e,t,i){return e.pipe(new a).pipe(new s("uncompressedSize")).pipe(t.compressWorker(i)).pipe(new s("compressedSize")).withStreamInfo("compression",t)},t.exports=r},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,i){"use strict";var r=e("./stream/GenericWorker");i.STORE={magic:"\0\0",compressWorker:function(e){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},i.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,i){"use strict";var r=e("./utils"),n=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t){return void 0!==e&&e.length?"string"!==r.getTypeOf(e)?function(e,t,i,r){var o=n,s=r+i;e^=-1;for(var a=r;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}(0|t,e,e.length,0):function(e,t,i,r){var o=n,s=r+i;e^=-1;for(var a=r;a<s;a++)e=e>>>8^o[255&(e^t.charCodeAt(a))];return-1^e}(0|t,e,e.length,0):0}},{"./utils":32}],5:[function(e,t,i){"use strict";i.base64=!1,i.binary=!1,i.dir=!1,i.createFolders=!0,i.date=null,i.compression=null,i.compressionOptions=null,i.comment=null,i.unixPermissions=null,i.dosPermissions=null},{}],6:[function(e,t,i){"use strict";var r;r="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:r}},{lie:58}],7:[function(e,t,i){"use strict";function r(e,t){a.call(this,"FlateWorker/"+e),this._pako=null,this._pakoAction=e,this._pakoOptions=t,this.meta={}}var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=e("pako"),s=e("./utils"),a=e("./stream/GenericWorker"),l=n?"uint8array":"array";i.magic="\b\0",s.inherits(r,a),r.prototype.processChunk=function(e){this.meta=e.meta,null===this._pako&&this._createPako(),this._pako.push(s.transformTo(l,e.data),!1)},r.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},r.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},r.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var e=this;this._pako.onData=function(t){e.push({data:t,meta:e.meta})}},i.compressWorker=function(e){return new r("Deflate",e)},i.uncompressWorker=function(){return new r("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(e,t,i){"use strict";function r(e,t,i,r){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=i,this.encodeFileName=r,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var n=e("../utils"),o=e("../stream/GenericWorker"),s=e("../utf8"),a=e("../crc32"),l=e("../signature"),u=function(e,t){var i,r="";for(i=0;i<t;i++)r+=String.fromCharCode(255&e),e>>>=8;return r},c=function(e,t,i,r,o,c){var h,d,p=e.file,f=e.compression,g=c!==s.utf8encode,m=n.transformTo("string",c(p.name)),v=n.transformTo("string",s.utf8encode(p.name)),y=p.comment,b=n.transformTo("string",c(y)),x=n.transformTo("string",s.utf8encode(y)),w=v.length!==p.name.length,T=x.length!==y.length,_="",C="",S="",E=p.dir,A=p.date,I={crc32:0,compressedSize:0,uncompressedSize:0};t&&!i||(I.crc32=e.crc32,I.compressedSize=e.compressedSize,I.uncompressedSize=e.uncompressedSize);var M=0;t&&(M|=8),g||!w&&!T||(M|=2048);var k=0,D=0;E&&(k|=16),"UNIX"===o?(D=798,k|=function(e,t){var i=e;return e||(i=t?16893:33204),(65535&i)<<16}(p.unixPermissions,E)):(D=20,k|=function(e,t){return 63&(e||0)}(p.dosPermissions)),h=A.getUTCHours(),h<<=6,h|=A.getUTCMinutes(),h<<=5,h|=A.getUTCSeconds()/2,d=A.getUTCFullYear()-1980,d<<=4,d|=A.getUTCMonth()+1,d<<=5,d|=A.getUTCDate(),w&&(C=u(1,1)+u(a(m),4)+v,_+="up"+u(C.length,2)+C),T&&(S=u(1,1)+u(a(b),4)+x,_+="uc"+u(S.length,2)+S);var R="";return R+="\n\0",R+=u(M,2),R+=f.magic,R+=u(h,2),R+=u(d,2),R+=u(I.crc32,4),R+=u(I.compressedSize,4),R+=u(I.uncompressedSize,4),R+=u(m.length,2),R+=u(_.length,2),{fileRecord:l.LOCAL_FILE_HEADER+R+m+_,dirRecord:l.CENTRAL_FILE_HEADER+u(D,2)+R+u(b.length,2)+"\0\0\0\0"+u(k,4)+u(r,4)+m+_+b}};n.inherits(r,o),r.prototype.push=function(e){var t=e.meta.percent||0,i=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:i?(t+100*(i-r-1))/i:100}}))},r.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var i=c(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:i.fileRecord,meta:{percent:0}})}else this.accumulate=!0},r.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,i=c(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(i.dirRecord),t)this.push({data:function(e){return l.DATA_DESCRIPTOR+u(e.crc32,4)+u(e.compressedSize,4)+u(e.uncompressedSize,4)}(e),meta:{percent:100}});else for(this.push({data:i.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},r.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var i=this.bytesWritten-e,r=function(e,t,i,r,o){var s=n.transformTo("string",o(r));return l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+u(e,2)+u(e,2)+u(t,4)+u(i,4)+u(s.length,2)+s}(this.dirRecords.length,i,e,this.zipComment,this.encodeFileName);this.push({data:r,meta:{percent:100}})},r.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},r.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},r.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},r.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var i=0;i<t.length;i++)try{t[i].error(e)}catch(e){}return!0},r.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=r},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,i){"use strict";var r=e("../compressions"),n=e("./ZipFileWorker"),o=function(e,t){var i=e||t,n=r[i];if(!n)throw new Error(i+" is not a valid compression method !");return n};i.generateWorker=function(e,t,i){var r=new n(t.streamFiles,i,t.platform,t.encodeFileName),s=0;try{e.forEach(function(e,i){s++;var n=o(i.options.compression,t.compression),a=i.options.compressionOptions||t.compressionOptions||{},l=i.dir,u=i.date;i._compressWorker(n,a).withStreamInfo("file",{name:e,dir:l,date:u,comment:i.comment||"",unixPermissions:i.unixPermissions,dosPermissions:i.dosPermissions}).pipe(r)}),r.entriesCount=s}catch(e){r.error(e)}return r}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,i){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=e("./object"),r.prototype.loadAsync=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.version="3.1.5",r.loadAsync=function(e,t){return(new r).loadAsync(e,t)},r.external=e("./external"),t.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,i){"use strict";function r(e){return new o.Promise(function(t,i){var r=e.decompressed.getContentWorker().pipe(new l);r.on("error",function(e){i(e)}).on("end",function(){r.streamInfo.crc32!==e.decompressed.crc32?i(new Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}var n=e("./utils"),o=e("./external"),s=e("./utf8"),a=(n=e("./utils"),e("./zipEntries")),l=e("./stream/Crc32Probe"),u=e("./nodejsUtils");t.exports=function(e,t){var i=this;return t=n.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),u.isNode&&u.isStream(e)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var i=new a(t);return i.load(e),i}).then(function(e){var i=[o.Promise.resolve(e)],n=e.files;if(t.checkCRC32)for(var s=0;s<n.length;s++)i.push(r(n[s]));return o.Promise.all(i)}).then(function(e){for(var r=e.shift(),n=r.files,o=0;o<n.length;o++){var s=n[o];i.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(i.comment=r.zipComment),i})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,i){"use strict";function r(e,t){o.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}var n=e("../utils"),o=e("../stream/GenericWorker");n.inherits(r,o),r.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},r.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},r.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=r},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,i){"use strict";function r(e,t,i){n.call(this,t),this._helper=e;var r=this;e.on("data",function(e,t){r.push(e)||r._helper.pause(),i&&i(t)}).on("error",function(e){r.emit("error",e)}).on("end",function(){r.push(null)})}var n=e("readable-stream").Readable;e("../utils").inherits(r,n),r.prototype._read=function(){this._helper.resume()},t.exports=r},{"../utils":32,"readable-stream":16}],14:[function(e,t,i){"use strict";t.exports={isNode:"undefined"!=typeof Buffer,newBufferFrom:function(e,t){return new Buffer(e,t)},allocBuffer:function(e){return Buffer.alloc?Buffer.alloc(e):new Buffer(e)},isBuffer:function(e){return Buffer.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,i){"use strict";function r(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var n=e("./utf8"),o=e("./utils"),s=e("./stream/GenericWorker"),a=e("./stream/StreamHelper"),l=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),h=e("./generate"),d=e("./nodejsUtils"),p=e("./nodejs/NodejsStreamInputAdapter"),f=function(e,t,i){var r,n=o.getTypeOf(t),a=o.extend(i||{},l);a.date=a.date||new Date,null!==a.compression&&(a.compression=a.compression.toUpperCase()),"string"==typeof a.unixPermissions&&(a.unixPermissions=parseInt(a.unixPermissions,8)),a.unixPermissions&&16384&a.unixPermissions&&(a.dir=!0),a.dosPermissions&&16&a.dosPermissions&&(a.dir=!0),a.dir&&(e=m(e)),a.createFolders&&(r=g(e))&&v.call(this,r,!0);var h="string"===n&&!1===a.binary&&!1===a.base64;i&&void 0!==i.binary||(a.binary=!h),(t instanceof u&&0===t.uncompressedSize||a.dir||!t||0===t.length)&&(a.base64=!1,a.binary=!0,t="",a.compression="STORE",n="string");var f;f=t instanceof u||t instanceof s?t:d.isNode&&d.isStream(t)?new p(e,t):o.prepareContent(e,t,a.binary,a.optimizedBinaryString,a.base64);var y=new c(e,f,a);this.files[e]=y},g=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},m=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},v=function(e,t){return t=void 0!==t?t:l.createFolders,e=m(e),this.files[e]||f.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,i,r;for(t in this.files)this.files.hasOwnProperty(t)&&(r=this.files[t],(i=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(i,r))},filter:function(e){var t=[];return this.forEach(function(i,r){e(i,r)&&t.push(r)}),t},file:function(e,t,i){if(1===arguments.length){if(r(e)){var n=e;return this.filter(function(e,t){return!t.dir&&n.test(e)})}var o=this.files[this.root+e];return o&&!o.dir?o:null}return e=this.root+e,f.call(this,e,t,i),this},folder:function(e){if(!e)return this;if(r(e))return this.filter(function(t,i){return i.dir&&e.test(t)});var t=this.root+e,i=v.call(this,t),n=this.clone();return n.root=i.name,n},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var i=this.filter(function(t,i){return i.name.slice(0,e.length)===e}),r=0;r<i.length;r++)delete this.files[i[r].name];return this},generate:function(e){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,i={};try{if((i=o.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=i.type.toLowerCase(),i.compression=i.compression.toUpperCase(),"binarystring"===i.type&&(i.type="string"),!i.type)throw new Error("No output type specified.");o.checkSupport(i.type),"darwin"!==i.platform&&"freebsd"!==i.platform&&"linux"!==i.platform&&"sunos"!==i.platform||(i.platform="UNIX"),"win32"===i.platform&&(i.platform="DOS");var r=i.comment||this.comment||"";t=h.generateWorker(this,i,r)}catch(e){(t=new s("error")).error(e)}return new a(t,i.type||"string",i.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return(e=e||{}).type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=y},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,i){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,i){"use strict";function r(e){n.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}var n=e("./DataReader");e("../utils").inherits(r,n),r.prototype.byteAt=function(e){return this.data[this.zero+e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===i&&this.data[o+2]===r&&this.data[o+3]===n)return o-this.zero;return-1},r.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),i=e.charCodeAt(1),r=e.charCodeAt(2),n=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&i===o[1]&&r===o[2]&&n===o[3]},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],18:[function(e,t,i){"use strict";function r(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}var n=e("../utils");r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,i=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)i=(i<<8)+this.byteAt(t);return this.index+=e,i},readString:function(e){return n.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=r},{"../utils":32}],19:[function(e,t,i){"use strict";function r(e){n.call(this,e)}var n=e("./Uint8ArrayReader");e("../utils").inherits(r,n),r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,i){"use strict";function r(e){n.call(this,e)}var n=e("./DataReader");e("../utils").inherits(r,n),r.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},r.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},r.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./DataReader":18}],21:[function(e,t,i){"use strict";function r(e){n.call(this,e)}var n=e("./ArrayReader");e("../utils").inherits(r,n),r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,i){"use strict";var r=e("../utils"),n=e("../support"),o=e("./ArrayReader"),s=e("./StringReader"),a=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=r.getTypeOf(e);return r.checkSupport(t),"string"!==t||n.uint8array?"nodebuffer"===t?new a(e):n.uint8array?new l(r.transformTo("uint8array",e)):new o(r.transformTo("array",e)):new s(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,i){"use strict";i.LOCAL_FILE_HEADER="PK",i.CENTRAL_FILE_HEADER="PK",i.CENTRAL_DIRECTORY_END="PK",i.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",i.ZIP64_CENTRAL_DIRECTORY_END="PK",i.DATA_DESCRIPTOR="PK\b"},{}],24:[function(e,t,i){"use strict";function r(e){n.call(this,"ConvertWorker to "+e),this.destType=e}var n=e("./GenericWorker"),o=e("../utils");o.inherits(r,n),r.prototype.processChunk=function(e){this.push({data:o.transformTo(this.destType,e.data),meta:e.meta})},t.exports=r},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,i){"use strict";function r(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var n=e("./GenericWorker"),o=e("../crc32");e("../utils").inherits(r,n),r.prototype.processChunk=function(e){this.streamInfo.crc32=o(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=r},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,i){"use strict";function r(e){o.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}var n=e("../utils"),o=e("./GenericWorker");n.inherits(r,o),r.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}o.prototype.processChunk.call(this,e)},t.exports=r},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,i){"use strict";function r(e){o.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=n.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}var n=e("../utils"),o=e("./GenericWorker");n.inherits(r,o),r.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},r.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},r.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},r.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=null,t=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":e=this.data.substring(this.index,t);break;case"uint8array":e=this.data.subarray(this.index,t);break;case"array":case"nodebuffer":e=this.data.slice(this.index,t)}return this.index=t,this.push({data:e,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=r},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,i){"use strict";function r(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var i=0;i<this._listeners[e].length;i++)this._listeners[e][i].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=r},{}],29:[function(e,t,i){"use strict";function r(e,t,i){switch(e){case"blob":return s.newBlob(s.transformTo("arraybuffer",t),i);case"base64":return u.encode(t);default:return s.transformTo(e,t)}}function n(e,t){return new h.Promise(function(i,n){var o=[],s=e._internalType,a=e._outputType,l=e._mimeType;e.on("data",function(e,i){o.push(e),t&&t(i)}).on("error",function(e){o=[],n(e)}).on("end",function(){try{var e=r(a,function(e,t){var i,r=0,n=null,o=0;for(i=0;i<t.length;i++)o+=t[i].length;switch(e){case"string":return t.join("");case"array":return Array.prototype.concat.apply([],t);case"uint8array":for(n=new Uint8Array(o),i=0;i<t.length;i++)n.set(t[i],r),r+=t[i].length;return n;case"nodebuffer":return Buffer.concat(t);default:throw new Error("concat : unsupported type '"+e+"'")}}(s,o),l);i(e)}catch(e){n(e)}o=[]}).resume()})}function o(e,t,i){var r=t;switch(t){case"blob":case"arraybuffer":r="uint8array";break;case"base64":r="string"}try{this._internalType=r,this._outputType=t,this._mimeType=i,s.checkSupport(r),this._worker=e.pipe(new a(r)),e.lock()}catch(e){this._worker=new l("error"),this._worker.error(e)}}var s=e("../utils"),a=e("./ConvertWorker"),l=e("./GenericWorker"),u=e("../base64"),c=e("../support"),h=e("../external"),d=null;if(c.nodestream)try{d=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}o.prototype={accumulate:function(e){return n(this,e)},on:function(e,t){var i=this;return"data"===e?this._worker.on(e,function(e){t.call(i,e.data,e.meta)}):this._worker.on(e,function(){s.delay(t,arguments,i)}),this},resume:function(){return s.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(s.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new d(this,{objectMode:"nodebuffer"!==this._outputType},e)}},t.exports=o},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,t,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer="undefined"!=typeof Buffer,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);n.append(r),i.blob=0===n.getBlob("application/zip").size}catch(e){i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,i){"use strict";function r(){l.call(this,"utf-8 decode"),this.leftOver=null}function n(){l.call(this,"utf-8 encode")}for(var o=e("./utils"),s=e("./support"),a=e("./nodejsUtils"),l=e("./stream/GenericWorker"),u=new Array(256),c=0;c<256;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1;i.utf8encode=function(e){return s.nodebuffer?a.newBufferFrom(e,"utf-8"):function(e){var t,i,r,n,o,a=e.length,l=0;for(n=0;n<a;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=s.uint8array?new Uint8Array(l):new Array(l),o=0,n=0;o<l;n++)55296==(64512&(i=e.charCodeAt(n)))&&n+1<a&&56320==(64512&(r=e.charCodeAt(n+1)))&&(i=65536+(i-55296<<10)+(r-56320),n++),i<128?t[o++]=i:i<2048?(t[o++]=192|i>>>6,t[o++]=128|63&i):i<65536?(t[o++]=224|i>>>12,t[o++]=128|i>>>6&63,t[o++]=128|63&i):(t[o++]=240|i>>>18,t[o++]=128|i>>>12&63,t[o++]=128|i>>>6&63,t[o++]=128|63&i);return t}(e)},i.utf8decode=function(e){return s.nodebuffer?o.transformTo("nodebuffer",e).toString("utf-8"):function(e){var t,i,r,n,s=e.length,a=new Array(2*s);for(i=0,t=0;t<s;)if((r=e[t++])<128)a[i++]=r;else if((n=u[r])>4)a[i++]=65533,t+=n-1;else{for(r&=2===n?31:3===n?15:7;n>1&&t<s;)r=r<<6|63&e[t++],n--;n>1?a[i++]=65533:r<65536?a[i++]=r:(r-=65536,a[i++]=55296|r>>10&1023,a[i++]=56320|1023&r)}return a.length!==i&&(a.subarray?a=a.subarray(0,i):a.length=i),o.applyFromCharCode(a)}(e=o.transformTo(s.uint8array?"uint8array":"array",e))},o.inherits(r,l),r.prototype.processChunk=function(e){var t=o.transformTo(s.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(s.uint8array){var r=t;(t=new Uint8Array(r.length+this.leftOver.length)).set(this.leftOver,0),t.set(r,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var n=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+u[e[i]]>t?i:t}(t),a=t;n!==t.length&&(s.uint8array?(a=t.subarray(0,n),this.leftOver=t.subarray(n,t.length)):(a=t.slice(0,n),this.leftOver=t.slice(n,t.length))),this.push({data:i.utf8decode(a),meta:e.meta})},r.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:i.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},i.Utf8DecodeWorker=r,o.inherits(n,l),n.prototype.processChunk=function(e){this.push({data:i.utf8encode(e.data),meta:e.meta})},i.Utf8EncodeWorker=n},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,i){"use strict";function r(e){return o(e,l.uint8array?new Uint8Array(e.length):new Array(e.length))}function n(e){return e}function o(e,t){for(var i=0;i<e.length;++i)t[i]=255&e.charCodeAt(i);return t}function s(e){var t=65536,r=i.getTypeOf(e),n=!0;if("uint8array"===r?n=p.applyCanBeUsed.uint8array:"nodebuffer"===r&&(n=p.applyCanBeUsed.nodebuffer),n)for(;t>1;)try{return p.stringifyByChunk(e,r,t)}catch(e){t=Math.floor(t/2)}return p.stringifyByChar(e)}function a(e,t){for(var i=0;i<e.length;i++)t[i]=e[i];return t}var l=e("./support"),u=e("./base64"),c=e("./nodejsUtils"),h=e("core-js/library/fn/set-immediate"),d=e("./external");i.newBlob=function(e,t){i.checkSupport("blob");try{return new Blob([e],{type:t})}catch(i){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(e),r.getBlob(t)}catch(e){throw new Error("Bug : can't construct the Blob.")}}};var p={stringifyByChunk:function(e,t,i){var r=[],n=0,o=e.length;if(o<=i)return String.fromCharCode.apply(null,e);for(;n<o;)"array"===t||"nodebuffer"===t?r.push(String.fromCharCode.apply(null,e.slice(n,Math.min(n+i,o)))):r.push(String.fromCharCode.apply(null,e.subarray(n,Math.min(n+i,o)))),n+=i;return r.join("")},stringifyByChar:function(e){for(var t="",i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return t},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,c.allocBuffer(1)).length}catch(e){return!1}}()}};i.applyFromCharCode=s;var f={};f.string={string:n,array:function(e){return o(e,new Array(e.length))},arraybuffer:function(e){return f.string.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:function(e){return o(e,c.allocBuffer(e.length))}},f.array={string:s,array:n,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c.newBufferFrom(e)}},f.arraybuffer={string:function(e){return s(new Uint8Array(e))},array:function(e){return a(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:n,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c.newBufferFrom(new Uint8Array(e))}},f.uint8array={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:n,nodebuffer:function(e){return c.newBufferFrom(e)}},f.nodebuffer={string:s,array:function(e){return a(e,new Array(e.length))},arraybuffer:function(e){return f.nodebuffer.uint8array(e).buffer},uint8array:function(e){return a(e,new Uint8Array(e.length))},nodebuffer:n},i.transformTo=function(e,t){if(t||(t=""),!e)return t;i.checkSupport(e);var r=i.getTypeOf(t);return f[r][e](t)},i.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":l.nodebuffer&&c.isBuffer(e)?"nodebuffer":l.uint8array&&e instanceof Uint8Array?"uint8array":l.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},i.checkSupport=function(e){if(!l[e.toLowerCase()])throw new Error(e+" is not supported by this platform")},i.MAX_VALUE_16BITS=65535,i.MAX_VALUE_32BITS=-1,i.pretty=function(e){var t,i,r="";for(i=0;i<(e||"").length;i++)r+="\\x"+((t=e.charCodeAt(i))<16?"0":"")+t.toString(16).toUpperCase();return r},i.delay=function(e,t,i){h(function(){e.apply(i||null,t||[])})},i.inherits=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i},i.extend=function(){var e,t,i={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===i[t]&&(i[t]=arguments[e][t]);return i},i.prepareContent=function(e,t,n,o,s){return d.Promise.resolve(t).then(function(e){return l.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new d.Promise(function(t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=function(e){i(e.target.error)},r.readAsArrayBuffer(e)}):e}).then(function(t){var a=i.getTypeOf(t);return a?("arraybuffer"===a?t=i.transformTo("uint8array",t):"string"===a&&(s?t=u.decode(t):n&&!0!==o&&(t=r(t))),t):d.Promise.reject(new Error("Can't read the data of '"+e+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(e,t,i){"use strict";function r(e){this.files=[],this.loadOptions=e}var n=e("./reader/readerFor"),o=e("./utils"),s=e("./signature"),a=e("./zipEntry"),l=(e("./utf8"),e("./support"));r.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")}},isSignature:function(e,t){var i=this.reader.index;this.reader.setIndex(e);var r=this.reader.readString(4)===t;return this.reader.setIndex(i),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=l.uint8array?"uint8array":"array",i=o.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(i)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,i,r=this.zip64EndOfCentralSize-44;0<r;)e=this.reader.readInt(2),t=this.reader.readInt(4),i=this.reader.readData(t),this.zip64ExtensibleData[e]={id:e,length:t,value:i}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(e=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(e<0)throw!this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(e);var t=e;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var i=this.centralDirOffset+this.centralDirSize;this.zip64&&(i+=20,i+=12+this.zip64EndOfCentralSize);var r=t-i;if(r>0)this.isSignature(t,s.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(e){this.reader=n(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=r},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,i){"use strict";function r(e,t){this.options=e,this.loadOptions=t}var n=e("./reader/readerFor"),o=e("./utils"),s=e("./compressedObject"),a=e("./crc32"),l=e("./utf8"),u=e("./compressions"),c=e("./support");r.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,i;if(e.skip(22),this.fileNameLength=e.readInt(2),i=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(i),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=n(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,i,r,n=e.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});e.index<n;)t=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[t]={id:t,length:i,value:r}},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var i=o.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(i)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var n=o.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(n)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileName)!==t.readInt(4)?null:l.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=n(e.value);return 1!==t.readInt(1)?null:a(this.fileComment)!==t.readInt(4)?null:l.utf8decode(t.readData(e.length-5))}return null}},t.exports=r},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,i){"use strict";var r=e("./stream/StreamHelper"),n=e("./stream/DataWorker"),o=e("./utf8"),s=e("./compressedObject"),a=e("./stream/GenericWorker"),l=function(e,t,i){this.name=e,this.dir=i.dir,this.date=i.date,this.comment=i.comment,this.unixPermissions=i.unixPermissions,this.dosPermissions=i.dosPermissions,this._data=t,this._dataBinary=i.binary,this.options={compression:i.compression,compressionOptions:i.compressionOptions}};l.prototype={internalStream:function(e){var t=null,i="string";try{if(!e)throw new Error("No output type specified.");var n="string"===(i=e.toLowerCase())||"text"===i;"binarystring"!==i&&"text"!==i||(i="string"),t=this._decompressWorker();var s=!this._dataBinary;s&&!n&&(t=t.pipe(new o.Utf8EncodeWorker)),!s&&n&&(t=t.pipe(new o.Utf8DecodeWorker))}catch(e){(t=new a("error")).error(e)}return new r(t,i,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof s&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var i=this._decompressWorker();return this._dataBinary||(i=i.pipe(new o.Utf8EncodeWorker)),s.createWorkerFrom(i,e,t)},_decompressWorker:function(){return this._data instanceof s?this._data.getContentWorker():this._data instanceof a?this._data:new n(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},h=0;h<u.length;h++)l.prototype[u[h]]=c;t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,i){e("../modules/web.immediate"),t.exports=e("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(e,t,i){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],38:[function(e,t,i){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":51}],39:[function(e,t,i){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],40:[function(e,t,i){var r=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=r)},{}],41:[function(e,t,i){var r=e("./_a-function");t.exports=function(e,t,i){if(r(e),void 0===t)return e;switch(i){case 1:return function(i){return e.call(t,i)};case 2:return function(i,r){return e.call(t,i,r)};case 3:return function(i,r,n){return e.call(t,i,r,n)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":37}],42:[function(e,t,i){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(e,t,i){var r=e("./_is-object"),n=e("./_global").document,o=r(n)&&r(n.createElement);t.exports=function(e){return o?n.createElement(e):{}}},{"./_global":46,"./_is-object":51}],44:[function(e,t,i){var r=e("./_global"),n=e("./_core"),o=e("./_ctx"),s=e("./_hide"),a="prototype",l=function(e,t,i){var u,c,h,d=e&l.F,p=e&l.G,f=e&l.S,g=e&l.P,m=e&l.B,v=e&l.W,y=p?n:n[t]||(n[t]={}),b=y[a],x=p?r:f?r[t]:(r[t]||{})[a];for(u in p&&(i=t),i)(c=!d&&x&&void 0!==x[u])&&u in y||(h=c?x[u]:i[u],y[u]=p&&"function"!=typeof x[u]?i[u]:m&&c?o(h,r):v&&x[u]==h?function(e){var t=function(t,i,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,i)}return new e(t,i,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(h):g&&"function"==typeof h?o(Function.call,h):h,g&&((y.virtual||(y.virtual={}))[u]=h,e&l.R&&b&&!b[u]&&s(b,u,h)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(e,t,i){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],46:[function(e,t,i){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],47:[function(e,t,i){var r=e("./_object-dp"),n=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,i){return r.f(e,t,n(1,i))}:function(e,t,i){return e[t]=i,e}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(e,t,i){t.exports=e("./_global").document&&document.documentElement},{"./_global":46}],49:[function(e,t,i){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(e,t,i){t.exports=function(e,t,i){var r=void 0===i;switch(t.length){case 0:return r?e():e.call(i);case 1:return r?e(t[0]):e.call(i,t[0]);case 2:return r?e(t[0],t[1]):e.call(i,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(i,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(i,t[0],t[1],t[2],t[3])}return e.apply(i,t)}},{}],51:[function(e,t,i){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,i){var r=e("./_an-object"),n=e("./_ie8-dom-define"),o=e("./_to-primitive"),s=Object.defineProperty;i.f=e("./_descriptors")?Object.defineProperty:function(e,t,i){if(r(e),t=o(t,!0),r(i),n)try{return s(e,t,i)}catch(e){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(e[t]=i.value),e}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(e,t,i){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],54:[function(e,t,i){var r,n,o,s=e("./_ctx"),a=e("./_invoke"),l=e("./_html"),u=e("./_dom-create"),c=e("./_global"),h=c.process,d=c.setImmediate,p=c.clearImmediate,f=c.MessageChannel,g=0,m={},v="onreadystatechange",y=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},b=function(e){y.call(e.data)};d&&p||(d=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return m[++g]=function(){a("function"==typeof e?e:Function(e),t)},r(g),g},p=function(e){delete m[e]},"process"==e("./_cof")(h)?r=function(e){h.nextTick(s(y,e,1))}:f?(o=(n=new f).port2,n.port1.onmessage=b,r=s(o.postMessage,o,1)):c.addEventListener&&"function"==typeof postMessage&&!c.importScripts?(r=function(e){c.postMessage(e+"","*")},c.addEventListener("message",b,!1)):r=v in u("script")?function(e){l.appendChild(u("script"))[v]=function(){l.removeChild(this),y.call(e)}}:function(e){setTimeout(s(y,e,1),0)}),t.exports={set:d,clear:p}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(e,t,i){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var i,n;if(t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;if("function"==typeof(i=e.valueOf)&&!r(n=i.call(e)))return n;if(!t&&"function"==typeof(i=e.toString)&&!r(n=i.call(e)))return n;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(e,t,i){var r=e("./_export"),n=e("./_task");r(r.G+r.B,{setImmediate:n.set,clearImmediate:n.clear})},{"./_export":44,"./_task":54}],57:[function(e,t,i){(function(e){"use strict";function i(){u=!0;for(var e,t,i=c.length;i;){for(t=c,c=[],e=-1;++e<i;)t[e]();i=c.length}u=!1}var r,n=e.MutationObserver||e.WebKitMutationObserver;if(n){var o=0,s=new n(i),a=e.document.createTextNode("");s.observe(a,{characterData:!0}),r=function(){a.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){i(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(i,0)};else{var l=new e.MessageChannel;l.port1.onmessage=i,r=function(){l.port2.postMessage(0)}}var u,c=[];t.exports=function(e){1!==c.push(e)||u||r()}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(e,t,i){"use strict";function r(){}function n(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=f,this.queue=[],this.outcome=void 0,e!==r&&l(this,e)}function o(e,t,i){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof i&&(this.onRejected=i,this.callRejected=this.otherCallRejected)}function s(e,t,i){c(function(){var r;try{r=t(i)}catch(t){return h.reject(e,t)}r===e?h.reject(e,new TypeError("Cannot resolve promise with itself")):h.resolve(e,r)})}function a(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function l(e,t){function i(t){n||(n=!0,h.reject(e,t))}function r(t){n||(n=!0,h.resolve(e,t))}var n=!1,o=u(function(){t(r,i)});"error"===o.status&&i(o.value)}function u(e,t){var i={};try{i.value=e(t),i.status="success"}catch(e){i.status="error",i.value=e}return i}var c=e("immediate"),h={},d=["REJECTED"],p=["FULFILLED"],f=["PENDING"];t.exports=n,n.prototype.catch=function(e){return this.then(null,e)},n.prototype.then=function(e,t){if("function"!=typeof e&&this.state===p||"function"!=typeof t&&this.state===d)return this;var i=new this.constructor(r);this.state!==f?s(i,this.state===p?e:t,this.outcome):this.queue.push(new o(i,e,t));return i},o.prototype.callFulfilled=function(e){h.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){h.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},h.resolve=function(e,t){var i=u(a,t);if("error"===i.status)return h.reject(e,i.value);var r=i.value;if(r)l(e,r);else{e.state=p,e.outcome=t;for(var n=-1,o=e.queue.length;++n<o;)e.queue[n].callFulfilled(t)}return e},h.reject=function(e,t){e.state=d,e.outcome=t;for(var i=-1,r=e.queue.length;++i<r;)e.queue[i].callRejected(t);return e},n.resolve=function(e){return e instanceof this?e:h.resolve(new this(r),e)},n.reject=function(e){var t=new this(r);return h.reject(t,e)},n.all=function(e){function t(e,t){i.resolve(e).then(function(e){s[t]=e,++a!==n||o||(o=!0,h.resolve(u,s))},function(e){o||(o=!0,h.reject(u,e))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,o=!1;if(!n)return this.resolve([]);for(var s=new Array(n),a=0,l=-1,u=new this(r);++l<n;)t(e[l],l);return u},n.race=function(e){function t(e){i.resolve(e).then(function(e){o||(o=!0,h.resolve(a,e))},function(e){o||(o=!0,h.reject(a,e))})}var i=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,o=!1;if(!n)return this.resolve([]);for(var s=-1,a=new this(r);++s<n;)t(e[s]);return a}},{immediate:57}],59:[function(e,t,i){"use strict";var r={};(0,e("./lib/utils/common").assign)(r,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=r},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=s.assign({level:d,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var i=o.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==h)throw new Error(l[i]);if(t.header&&o.deflateSetHeader(this.strm,t.header),t.dictionary){var n;if(n="string"==typeof t.dictionary?a.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=o.deflateSetDictionary(this.strm,n))!==h)throw new Error(l[i]);this._dict_set=!0}}function n(e,t){var i=new r(t);if(i.push(e,!0),i.err)throw i.msg||l[i.err];return i.result}var o=e("./zlib/deflate"),s=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/messages"),u=e("./zlib/zstream"),c=Object.prototype.toString,h=0,d=-1,p=0,f=8;r.prototype.push=function(e,t){var i,r,n=this.strm,l=this.options.chunkSize;if(this.ended)return!1;r=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=a.string2buf(e):"[object ArrayBuffer]"===c.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(l),n.next_out=0,n.avail_out=l),1!==(i=o.deflate(n,r))&&i!==h)return this.onEnd(i),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==r&&2!==r)||("string"===this.options.to?this.onData(a.buf2binstring(s.shrinkBuf(n.output,n.next_out))):this.onData(s.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==i);return 4===r?(i=o.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===h):2!==r||(this.onEnd(h),n.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===h&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Deflate=r,i.deflate=n,i.deflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},i.gzip=function(e,t){return(t=t||{}).gzip=!0,n(e,t)}},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(e,t,i){"use strict";function r(e){if(!(this instanceof r))return new r(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var i=o.inflateInit2(this.strm,t.windowBits);if(i!==l.Z_OK)throw new Error(u[i]);this.header=new h,o.inflateGetHeader(this.strm,this.header)}function n(e,t){var i=new r(t);if(i.push(e,!0),i.err)throw i.msg||u[i.err];return i.result}var o=e("./zlib/inflate"),s=e("./utils/common"),a=e("./utils/strings"),l=e("./zlib/constants"),u=e("./zlib/messages"),c=e("./zlib/zstream"),h=e("./zlib/gzheader"),d=Object.prototype.toString;r.prototype.push=function(e,t){var i,r,n,u,c,h,p=this.strm,f=this.options.chunkSize,g=this.options.dictionary,m=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?l.Z_FINISH:l.Z_NO_FLUSH,"string"==typeof e?p.input=a.binstring2buf(e):"[object ArrayBuffer]"===d.call(e)?p.input=new Uint8Array(e):p.input=e,p.next_in=0,p.avail_in=p.input.length;do{if(0===p.avail_out&&(p.output=new s.Buf8(f),p.next_out=0,p.avail_out=f),(i=o.inflate(p,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&g&&(h="string"==typeof g?a.string2buf(g):"[object ArrayBuffer]"===d.call(g)?new Uint8Array(g):g,i=o.inflateSetDictionary(this.strm,h)),i===l.Z_BUF_ERROR&&!0===m&&(i=l.Z_OK,m=!1),i!==l.Z_STREAM_END&&i!==l.Z_OK)return this.onEnd(i),this.ended=!0,!1;p.next_out&&(0!==p.avail_out&&i!==l.Z_STREAM_END&&(0!==p.avail_in||r!==l.Z_FINISH&&r!==l.Z_SYNC_FLUSH)||("string"===this.options.to?(n=a.utf8border(p.output,p.next_out),u=p.next_out-n,c=a.buf2string(p.output,n),p.next_out=u,p.avail_out=f-u,u&&s.arraySet(p.output,p.output,n,u,0),this.onData(c)):this.onData(s.shrinkBuf(p.output,p.next_out)))),0===p.avail_in&&0===p.avail_out&&(m=!0)}while((p.avail_in>0||0===p.avail_out)&&i!==l.Z_STREAM_END);return i===l.Z_STREAM_END&&(r=l.Z_FINISH),r===l.Z_FINISH?(i=o.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l.Z_OK):r!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),p.avail_out=0,!0)},r.prototype.onData=function(e){this.chunks.push(e)},r.prototype.onEnd=function(e){e===l.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},i.Inflate=r,i.inflate=n,i.inflateRaw=function(e,t){return(t=t||{}).raw=!0,n(e,t)},i.ungzip=n},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(e,t,i){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;i.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var r in i)i.hasOwnProperty(r)&&(e[r]=i[r])}}return e},i.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var n={arraySet:function(e,t,i,r,n){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+r),n);else for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){var t,i,r,n,o,s;for(r=0,t=0,i=e.length;t<i;t++)r+=e[t].length;for(s=new Uint8Array(r),n=0,t=0,i=e.length;t<i;t++)o=e[t],s.set(o,n),n+=o.length;return s}},o={arraySet:function(e,t,i,r,n){for(var o=0;o<r;o++)e[n+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};i.setTyped=function(e){e?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,n)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,o))},i.setTyped(r)},{}],63:[function(e,t,i){"use strict";function r(e,t){if(t<65537&&(e.subarray&&s||!e.subarray&&o))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var i="",r=0;r<t;r++)i+=String.fromCharCode(e[r]);return i}var n=e("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){s=!1}for(var a=new n.Buf8(256),l=0;l<256;l++)a[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;a[254]=a[254]=1,i.string2buf=function(e){var t,i,r,o,s,a=e.length,l=0;for(o=0;o<a;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<a&&(56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++)),l+=i<128?1:i<2048?2:i<65536?3:4;for(t=new n.Buf8(l),s=0,o=0;s<l;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<a&&(56320==(64512&(r=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(r-56320),o++)),i<128?t[s++]=i:i<2048?(t[s++]=192|i>>>6,t[s++]=128|63&i):i<65536?(t[s++]=224|i>>>12,t[s++]=128|i>>>6&63,t[s++]=128|63&i):(t[s++]=240|i>>>18,t[s++]=128|i>>>12&63,t[s++]=128|i>>>6&63,t[s++]=128|63&i);return t},i.buf2binstring=function(e){return r(e,e.length)},i.binstring2buf=function(e){for(var t=new n.Buf8(e.length),i=0,r=t.length;i<r;i++)t[i]=e.charCodeAt(i);return t},i.buf2string=function(e,t){var i,n,o,s,l=t||e.length,u=new Array(2*l);for(n=0,i=0;i<l;)if((o=e[i++])<128)u[n++]=o;else if((s=a[o])>4)u[n++]=65533,i+=s-1;else{for(o&=2===s?31:3===s?15:7;s>1&&i<l;)o=o<<6|63&e[i++],s--;s>1?u[n++]=65533:o<65536?u[n++]=o:(o-=65536,u[n++]=55296|o>>10&1023,u[n++]=56320|1023&o)}return r(u,n)},i.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+a[e[i]]>t?i:t}},{"./common":62}],64:[function(e,t,i){"use strict";t.exports=function(e,t,i,r){for(var n=65535&e|0,o=e>>>16&65535|0,s=0;0!==i;){i-=s=i>2e3?2e3:i;do{o=o+(n=n+t[r++]|0)|0}while(--s);n%=65521,o%=65521}return n|o<<16|0}},{}],65:[function(e,t,i){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(e,t,i){"use strict";var r=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();t.exports=function(e,t,i,n){var o=r,s=n+i;e^=-1;for(var a=n;a<s;a++)e=e>>>8^o[255&(e^t[a])];return-1^e}},{}],67:[function(e,t,i){"use strict";function r(e,t){return e.msg=A[t],t}function n(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function s(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(_.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function a(e,t){C._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,s(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,i,r){var n=e.avail_in;return n>r&&(n=r),0===n?0:(e.avail_in-=n,_.arraySet(t,e.input,e.next_in,n,i),1===e.state.wrap?e.adler=S(e.adler,t,n,i):2===e.state.wrap&&(e.adler=E(e.adler,t,n,i)),e.next_in+=n,e.total_in+=n,n)}function h(e,t){var i,r,n=e.max_chain_length,o=e.strstart,s=e.prev_length,a=e.nice_match,l=e.strstart>e.w_size-ie?e.strstart-(e.w_size-ie):0,u=e.window,c=e.w_mask,h=e.prev,d=e.strstart+te,p=u[o+s-1],f=u[o+s];e.prev_length>=e.good_match&&(n>>=2),a>e.lookahead&&(a=e.lookahead);do{if(u[(i=t)+s]===f&&u[i+s-1]===p&&u[i]===u[o]&&u[++i]===u[o+1]){o+=2,i++;do{}while(u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&u[++o]===u[++i]&&o<d);if(r=te-(d-o),o=d-te,r>s){if(e.match_start=t,s=r,r>=a)break;p=u[o+s-1],f=u[o+s]}}}while((t=h[t&c])>l&&0!=--n);return s<=e.lookahead?s:e.lookahead}function d(e){var t,i,r,n,o,s=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-ie)){_.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=i=e.hash_size;do{r=e.head[--t],e.head[t]=r>=s?r-s:0}while(--i);t=i=s;do{r=e.prev[--t],e.prev[t]=r>=s?r-s:0}while(--i);n+=s}if(0===e.strm.avail_in)break;if(i=c(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=i,e.lookahead+e.insert>=ee)for(o=e.strstart-e.insert,e.ins_h=e.window[o],e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[o+ee-1])&e.hash_mask,e.prev[o&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=o,o++,e.insert--,!(e.lookahead+e.insert<ee)););}while(e.lookahead<ie&&0!==e.strm.avail_in)}function p(e,t){for(var i,r;;){if(e.lookahead<ie){if(d(e),e.lookahead<ie&&t===I)return he;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-ie&&(e.match_length=h(e,i)),e.match_length>=ee)if(r=C._tr_tally(e,e.strstart-e.match_start,e.match_length-ee),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=ee){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else r=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(a(e,!1),0===e.strm.avail_out))return he}return e.insert=e.strstart<ee-1?e.strstart:ee-1,t===D?(a(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?he:de}function f(e,t){for(var i,r,n;;){if(e.lookahead<ie){if(d(e),e.lookahead<ie&&t===I)return he;if(0===e.lookahead)break}if(i=0,e.lookahead>=ee&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=ee-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-ie&&(e.match_length=h(e,i),e.match_length<=5&&(e.strategy===G||e.match_length===ee&&e.strstart-e.match_start>4096)&&(e.match_length=ee-1)),e.prev_length>=ee&&e.match_length<=e.prev_length){n=e.strstart+e.lookahead-ee,r=C._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-ee),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=n&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+ee-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=ee-1,e.strstart++,r&&(a(e,!1),0===e.strm.avail_out))return he}else if(e.match_available){if((r=C._tr_tally(e,0,e.window[e.strstart-1]))&&a(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return he}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=C._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<ee-1?e.strstart:ee-1,t===D?(a(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?he:de}function g(e,t){for(var i,r,n,o,s=e.window;;){if(e.lookahead<=te){if(d(e),e.lookahead<=te&&t===I)return he;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=ee&&e.strstart>0&&((r=s[n=e.strstart-1])===s[++n]&&r===s[++n]&&r===s[++n])){o=e.strstart+te;do{}while(r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&r===s[++n]&&n<o);e.match_length=te-(o-n),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=ee?(i=C._tr_tally(e,1,e.match_length-ee),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(a(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===D?(a(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?he:de}function m(e,t){for(var i;;){if(0===e.lookahead&&(d(e),0===e.lookahead)){if(t===I)return he;break}if(e.match_length=0,i=C._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(a(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===D?(a(e,!0),0===e.strm.avail_out?pe:fe):e.last_lit&&(a(e,!1),0===e.strm.avail_out)?he:de}function v(e,t,i,r,n){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r,this.func=n}function y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Y,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new _.Buf16(2*Q),this.dyn_dtree=new _.Buf16(2*(2*K+1)),this.bl_tree=new _.Buf16(2*(2*J+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new _.Buf16($+1),this.heap=new _.Buf16(2*Z+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new _.Buf16(2*Z+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function b(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=W,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?ne:ue,e.adler=2===t.wrap?0:1,t.last_flush=I,C._tr_init(t),P):r(e,N)}function x(e){var t=b(e);return t===P&&function(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=T[e.level].max_lazy,e.good_match=T[e.level].good_length,e.nice_match=T[e.level].nice_length,e.max_chain_length=T[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=ee-1,e.match_available=0,e.ins_h=0}(e.state),t}function w(e,t,i,n,o,s){if(!e)return N;var a=1;if(t===B&&(t=6),n<0?(a=0,n=-n):n>15&&(a=2,n-=16),o<1||o>H||i!==Y||n<8||n>15||t<0||t>9||s<0||s>V)return r(e,N);8===n&&(n=9);var l=new y;return e.state=l,l.strm=e,l.wrap=a,l.gzhead=null,l.w_bits=n,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+ee-1)/ee),l.window=new _.Buf8(2*l.w_size),l.head=new _.Buf16(l.hash_size),l.prev=new _.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new _.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=s,l.method=i,x(e)}var T,_=e("../utils/common"),C=e("./trees"),S=e("./adler32"),E=e("./crc32"),A=e("./messages"),I=0,M=1,k=3,D=4,R=5,P=0,L=1,N=-2,O=-3,F=-5,B=-1,G=1,U=2,z=3,V=4,j=0,W=2,Y=8,H=9,q=15,X=8,Z=286,K=30,J=19,Q=2*Z+1,$=15,ee=3,te=258,ie=te+ee+1,re=32,ne=42,oe=69,se=73,ae=91,le=103,ue=113,ce=666,he=1,de=2,pe=3,fe=4,ge=3;T=[new v(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(d(e),0===e.lookahead&&t===I)return he;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var r=e.block_start+i;if((0===e.strstart||e.strstart>=r)&&(e.lookahead=e.strstart-r,e.strstart=r,a(e,!1),0===e.strm.avail_out))return he;if(e.strstart-e.block_start>=e.w_size-ie&&(a(e,!1),0===e.strm.avail_out))return he}return e.insert=0,t===D?(a(e,!0),0===e.strm.avail_out?pe:fe):(e.strstart>e.block_start&&(a(e,!1),e.strm.avail_out),he)}),new v(4,4,8,4,p),new v(4,5,16,8,p),new v(4,6,32,32,p),new v(4,4,16,16,f),new v(8,16,32,32,f),new v(8,16,128,128,f),new v(8,32,128,256,f),new v(32,128,258,1024,f),new v(32,258,258,4096,f)],i.deflateInit=function(e,t){return w(e,t,Y,q,X,j)},i.deflateInit2=w,i.deflateReset=x,i.deflateResetKeep=b,i.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?N:(e.state.gzhead=t,P):N},i.deflate=function(e,t){var i,a,c,h;if(!e||!e.state||t>R||t<0)return e?r(e,N):N;if(a=e.state,!e.output||!e.input&&0!==e.avail_in||a.status===ce&&t!==D)return r(e,0===e.avail_out?F:N);if(a.strm=e,i=a.last_flush,a.last_flush=t,a.status===ne)if(2===a.wrap)e.adler=0,l(a,31),l(a,139),l(a,8),a.gzhead?(l(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),l(a,255&a.gzhead.time),l(a,a.gzhead.time>>8&255),l(a,a.gzhead.time>>16&255),l(a,a.gzhead.time>>24&255),l(a,9===a.level?2:a.strategy>=U||a.level<2?4:0),l(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(l(a,255&a.gzhead.extra.length),l(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=E(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=oe):(l(a,0),l(a,0),l(a,0),l(a,0),l(a,0),l(a,9===a.level?2:a.strategy>=U||a.level<2?4:0),l(a,ge),a.status=ue);else{var d=Y+(a.w_bits-8<<4)<<8;d|=(a.strategy>=U||a.level<2?0:a.level<6?1:6===a.level?2:3)<<6,0!==a.strstart&&(d|=re),d+=31-d%31,a.status=ue,u(a,d),0!==a.strstart&&(u(a,e.adler>>>16),u(a,65535&e.adler)),e.adler=1}if(a.status===oe)if(a.gzhead.extra){for(c=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),s(e),c=a.pending,a.pending!==a.pending_buf_size));)l(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=se)}else a.status=se;if(a.status===se)if(a.gzhead.name){c=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),s(e),c=a.pending,a.pending===a.pending_buf_size)){h=1;break}h=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,l(a,h)}while(0!==h);a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),0===h&&(a.gzindex=0,a.status=ae)}else a.status=ae;if(a.status===ae)if(a.gzhead.comment){c=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),s(e),c=a.pending,a.pending===a.pending_buf_size)){h=1;break}h=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,l(a,h)}while(0!==h);a.gzhead.hcrc&&a.pending>c&&(e.adler=E(e.adler,a.pending_buf,a.pending-c,c)),0===h&&(a.status=le)}else a.status=le;if(a.status===le&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&s(e),a.pending+2<=a.pending_buf_size&&(l(a,255&e.adler),l(a,e.adler>>8&255),e.adler=0,a.status=ue)):a.status=ue),0!==a.pending){if(s(e),0===e.avail_out)return a.last_flush=-1,P}else if(0===e.avail_in&&n(t)<=n(i)&&t!==D)return r(e,F);if(a.status===ce&&0!==e.avail_in)return r(e,F);if(0!==e.avail_in||0!==a.lookahead||t!==I&&a.status!==ce){var p=a.strategy===U?m(a,t):a.strategy===z?g(a,t):T[a.level].func(a,t);if(p!==pe&&p!==fe||(a.status=ce),p===he||p===pe)return 0===e.avail_out&&(a.last_flush=-1),P;if(p===de&&(t===M?C._tr_align(a):t!==R&&(C._tr_stored_block(a,0,0,!1),t===k&&(o(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),s(e),0===e.avail_out))return a.last_flush=-1,P}return t!==D?P:a.wrap<=0?L:(2===a.wrap?(l(a,255&e.adler),l(a,e.adler>>8&255),l(a,e.adler>>16&255),l(a,e.adler>>24&255),l(a,255&e.total_in),l(a,e.total_in>>8&255),l(a,e.total_in>>16&255),l(a,e.total_in>>24&255)):(u(a,e.adler>>>16),u(a,65535&e.adler)),s(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?P:L)},i.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==ne&&t!==oe&&t!==se&&t!==ae&&t!==le&&t!==ue&&t!==ce?r(e,N):(e.state=null,t===ue?r(e,O):P):N},i.deflateSetDictionary=function(e,t){var i,r,n,s,a,l,u,c,h=t.length;if(!e||!e.state)return N;if(2===(s=(i=e.state).wrap)||1===s&&i.status!==ne||i.lookahead)return N;for(1===s&&(e.adler=S(e.adler,t,h,0)),i.wrap=0,h>=i.w_size&&(0===s&&(o(i.head),i.strstart=0,i.block_start=0,i.insert=0),c=new _.Buf8(i.w_size),_.arraySet(c,t,h-i.w_size,i.w_size,0),t=c,h=i.w_size),a=e.avail_in,l=e.next_in,u=e.input,e.avail_in=h,e.next_in=0,e.input=t,d(i);i.lookahead>=ee;){r=i.strstart,n=i.lookahead-(ee-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+ee-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--n);i.strstart=r,i.lookahead=ee-1,d(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=ee-1,i.match_available=0,e.next_in=l,e.input=u,e.avail_in=a,i.wrap=s,P},i.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(e,t,i){"use strict";t.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],69:[function(e,t,i){"use strict";t.exports=function(e,t){var i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_,C,S,E;i=e.state,r=e.next_in,S=e.input,n=r+(e.avail_in-5),o=e.next_out,E=e.output,s=o-(t-e.avail_out),a=o+(e.avail_out-257),l=i.dmax,u=i.wsize,c=i.whave,h=i.wnext,d=i.window,p=i.hold,f=i.bits,g=i.lencode,m=i.distcode,v=(1<<i.lenbits)-1,y=(1<<i.distbits)-1;e:do{f<15&&(p+=S[r++]<<f,f+=8,p+=S[r++]<<f,f+=8),b=g[p&v];t:for(;;){if(p>>>=x=b>>>24,f-=x,0===(x=b>>>16&255))E[o++]=65535&b;else{if(!(16&x)){if(0==(64&x)){b=g[(65535&b)+(p&(1<<x)-1)];continue t}if(32&x){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}w=65535&b,(x&=15)&&(f<x&&(p+=S[r++]<<f,f+=8),w+=p&(1<<x)-1,p>>>=x,f-=x),f<15&&(p+=S[r++]<<f,f+=8,p+=S[r++]<<f,f+=8),b=m[p&y];i:for(;;){if(p>>>=x=b>>>24,f-=x,!(16&(x=b>>>16&255))){if(0==(64&x)){b=m[(65535&b)+(p&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(T=65535&b,f<(x&=15)&&(p+=S[r++]<<f,(f+=8)<x&&(p+=S[r++]<<f,f+=8)),(T+=p&(1<<x)-1)>l){e.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=x,f-=x,T>(x=o-s)){if((x=T-x)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(_=0,C=d,0===h){if(_+=u-x,x<w){w-=x;do{E[o++]=d[_++]}while(--x);_=o-T,C=E}}else if(h<x){if(_+=u+h-x,(x-=h)<w){w-=x;do{E[o++]=d[_++]}while(--x);if(_=0,h<w){w-=x=h;do{E[o++]=d[_++]}while(--x);_=o-T,C=E}}}else if(_+=h-x,x<w){w-=x;do{E[o++]=d[_++]}while(--x);_=o-T,C=E}for(;w>2;)E[o++]=C[_++],E[o++]=C[_++],E[o++]=C[_++],w-=3;w&&(E[o++]=C[_++],w>1&&(E[o++]=C[_++]))}else{_=o-T;do{E[o++]=E[_++],E[o++]=E[_++],E[o++]=E[_++],w-=3}while(w>2);w&&(E[o++]=E[_++],w>1&&(E[o++]=E[_++]))}break}}break}}while(r<n&&o<a);r-=w=f>>3,p&=(1<<(f-=w<<3))-1,e.next_in=r,e.next_out=o,e.avail_in=r<n?n-r+5:5-(r-n),e.avail_out=o<a?a-o+257:257-(o-a),i.hold=p,i.bits=f}},{}],70:[function(e,t,i){"use strict";function r(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function n(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=D,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new d.Buf32(ue),t.distcode=t.distdyn=new d.Buf32(ce),t.sane=1,t.back=-1,_):E}function o(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,n(e)):E}function s(e,t){var i,r;return e&&e.state?(r=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?E:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=i,r.wbits=t,o(e))):E}function a(e,t){var i,r;return e?(r=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new d.Buf16(320),this.work=new d.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=r,r.window=null,(i=s(e,t))!==_&&(e.state=null),i):E}function l(e){if(de){var t;for(c=new d.Buf32(512),h=new d.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(m(y,e.lens,0,288,c,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;m(b,e.lens,0,32,h,0,e.work,{bits:5}),de=!1}e.lencode=c,e.lenbits=9,e.distcode=h,e.distbits=5}function u(e,t,i,r){var n,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new d.Buf8(o.wsize)),r>=o.wsize?(d.arraySet(o.window,t,i-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):((n=o.wsize-o.wnext)>r&&(n=r),d.arraySet(o.window,t,i-r,n,o.wnext),(r-=n)?(d.arraySet(o.window,t,i-r,r,0),o.wnext=r,o.whave=o.wsize):(o.wnext+=n,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=n))),0}var c,h,d=e("../utils/common"),p=e("./adler32"),f=e("./crc32"),g=e("./inffast"),m=e("./inftrees"),v=0,y=1,b=2,x=4,w=5,T=6,_=0,C=1,S=2,E=-2,A=-3,I=-4,M=-5,k=8,D=1,R=2,P=3,L=4,N=5,O=6,F=7,B=8,G=9,U=10,z=11,V=12,j=13,W=14,Y=15,H=16,q=17,X=18,Z=19,K=20,J=21,Q=22,$=23,ee=24,te=25,ie=26,re=27,ne=28,oe=29,se=30,ae=31,le=32,ue=852,ce=592,he=15,de=!0;i.inflateReset=o,i.inflateReset2=s,i.inflateResetKeep=n,i.inflateInit=function(e){return a(e,he)},i.inflateInit2=a,i.inflate=function(e,t){var i,n,o,s,a,c,h,ue,ce,he,de,pe,fe,ge,me,ve,ye,be,xe,we,Te,_e,Ce,Se,Ee=0,Ae=new d.Buf8(4),Ie=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return E;(i=e.state).mode===V&&(i.mode=j),a=e.next_out,o=e.output,h=e.avail_out,s=e.next_in,n=e.input,c=e.avail_in,ue=i.hold,ce=i.bits,he=c,de=h,_e=_;e:for(;;)switch(i.mode){case D:if(0===i.wrap){i.mode=j;break}for(;ce<16;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(2&i.wrap&&35615===ue){i.check=0,Ae[0]=255&ue,Ae[1]=ue>>>8&255,i.check=f(i.check,Ae,2,0),ue=0,ce=0,i.mode=R;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&ue)<<8)+(ue>>8))%31){e.msg="incorrect header check",i.mode=se;break}if((15&ue)!==k){e.msg="unknown compression method",i.mode=se;break}if(ce-=4,Te=8+(15&(ue>>>=4)),0===i.wbits)i.wbits=Te;else if(Te>i.wbits){e.msg="invalid window size",i.mode=se;break}i.dmax=1<<Te,e.adler=i.check=1,i.mode=512&ue?U:V,ue=0,ce=0;break;case R:for(;ce<16;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(i.flags=ue,(255&i.flags)!==k){e.msg="unknown compression method",i.mode=se;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=se;break}i.head&&(i.head.text=ue>>8&1),512&i.flags&&(Ae[0]=255&ue,Ae[1]=ue>>>8&255,i.check=f(i.check,Ae,2,0)),ue=0,ce=0,i.mode=P;case P:for(;ce<32;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.head&&(i.head.time=ue),512&i.flags&&(Ae[0]=255&ue,Ae[1]=ue>>>8&255,Ae[2]=ue>>>16&255,Ae[3]=ue>>>24&255,i.check=f(i.check,Ae,4,0)),ue=0,ce=0,i.mode=L;case L:for(;ce<16;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.head&&(i.head.xflags=255&ue,i.head.os=ue>>8),512&i.flags&&(Ae[0]=255&ue,Ae[1]=ue>>>8&255,i.check=f(i.check,Ae,2,0)),ue=0,ce=0,i.mode=N;case N:if(1024&i.flags){for(;ce<16;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.length=ue,i.head&&(i.head.extra_len=ue),512&i.flags&&(Ae[0]=255&ue,Ae[1]=ue>>>8&255,i.check=f(i.check,Ae,2,0)),ue=0,ce=0}else i.head&&(i.head.extra=null);i.mode=O;case O:if(1024&i.flags&&((pe=i.length)>c&&(pe=c),pe&&(i.head&&(Te=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),d.arraySet(i.head.extra,n,s,pe,Te)),512&i.flags&&(i.check=f(i.check,n,pe,s)),c-=pe,s+=pe,i.length-=pe),i.length))break e;i.length=0,i.mode=F;case F:if(2048&i.flags){if(0===c)break e;pe=0;do{Te=n[s+pe++],i.head&&Te&&i.length<65536&&(i.head.name+=String.fromCharCode(Te))}while(Te&&pe<c);if(512&i.flags&&(i.check=f(i.check,n,pe,s)),c-=pe,s+=pe,Te)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=B;case B:if(4096&i.flags){if(0===c)break e;pe=0;do{Te=n[s+pe++],i.head&&Te&&i.length<65536&&(i.head.comment+=String.fromCharCode(Te))}while(Te&&pe<c);if(512&i.flags&&(i.check=f(i.check,n,pe,s)),c-=pe,s+=pe,Te)break e}else i.head&&(i.head.comment=null);i.mode=G;case G:if(512&i.flags){for(;ce<16;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(ue!==(65535&i.check)){e.msg="header crc mismatch",i.mode=se;break}ue=0,ce=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=V;break;case U:for(;ce<32;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}e.adler=i.check=r(ue),ue=0,ce=0,i.mode=z;case z:if(0===i.havedict)return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=c,i.hold=ue,i.bits=ce,S;e.adler=i.check=1,i.mode=V;case V:if(t===w||t===T)break e;case j:if(i.last){ue>>>=7&ce,ce-=7&ce,i.mode=re;break}for(;ce<3;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}switch(i.last=1&ue,ce-=1,3&(ue>>>=1)){case 0:i.mode=W;break;case 1:if(l(i),i.mode=K,t===T){ue>>>=2,ce-=2;break e}break;case 2:i.mode=q;break;case 3:e.msg="invalid block type",i.mode=se}ue>>>=2,ce-=2;break;case W:for(ue>>>=7&ce,ce-=7&ce;ce<32;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if((65535&ue)!=(ue>>>16^65535)){e.msg="invalid stored block lengths",i.mode=se;break}if(i.length=65535&ue,ue=0,ce=0,i.mode=Y,t===T)break e;case Y:i.mode=H;case H:if(pe=i.length){if(pe>c&&(pe=c),pe>h&&(pe=h),0===pe)break e;d.arraySet(o,n,s,pe,a),c-=pe,s+=pe,h-=pe,a+=pe,i.length-=pe;break}i.mode=V;break;case q:for(;ce<14;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(i.nlen=257+(31&ue),ue>>>=5,ce-=5,i.ndist=1+(31&ue),ue>>>=5,ce-=5,i.ncode=4+(15&ue),ue>>>=4,ce-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=se;break}i.have=0,i.mode=X;case X:for(;i.have<i.ncode;){for(;ce<3;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.lens[Ie[i.have++]]=7&ue,ue>>>=3,ce-=3}for(;i.have<19;)i.lens[Ie[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,Ce={bits:i.lenbits},_e=m(v,i.lens,0,19,i.lencode,0,i.work,Ce),i.lenbits=Ce.bits,_e){e.msg="invalid code lengths set",i.mode=se;break}i.have=0,i.mode=Z;case Z:for(;i.have<i.nlen+i.ndist;){for(;ve=(Ee=i.lencode[ue&(1<<i.lenbits)-1])>>>16&255,ye=65535&Ee,!((me=Ee>>>24)<=ce);){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(ye<16)ue>>>=me,ce-=me,i.lens[i.have++]=ye;else{if(16===ye){for(Se=me+2;ce<Se;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(ue>>>=me,ce-=me,0===i.have){e.msg="invalid bit length repeat",i.mode=se;break}Te=i.lens[i.have-1],pe=3+(3&ue),ue>>>=2,ce-=2}else if(17===ye){for(Se=me+3;ce<Se;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}ce-=me,Te=0,pe=3+(7&(ue>>>=me)),ue>>>=3,ce-=3}else{for(Se=me+7;ce<Se;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}ce-=me,Te=0,pe=11+(127&(ue>>>=me)),ue>>>=7,ce-=7}if(i.have+pe>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=se;break}for(;pe--;)i.lens[i.have++]=Te}}if(i.mode===se)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=se;break}if(i.lenbits=9,Ce={bits:i.lenbits},_e=m(y,i.lens,0,i.nlen,i.lencode,0,i.work,Ce),i.lenbits=Ce.bits,_e){e.msg="invalid literal/lengths set",i.mode=se;break}if(i.distbits=6,i.distcode=i.distdyn,Ce={bits:i.distbits},_e=m(b,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,Ce),i.distbits=Ce.bits,_e){e.msg="invalid distances set",i.mode=se;break}if(i.mode=K,t===T)break e;case K:i.mode=J;case J:if(c>=6&&h>=258){e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=c,i.hold=ue,i.bits=ce,g(e,de),a=e.next_out,o=e.output,h=e.avail_out,s=e.next_in,n=e.input,c=e.avail_in,ue=i.hold,ce=i.bits,i.mode===V&&(i.back=-1);break}for(i.back=0;ve=(Ee=i.lencode[ue&(1<<i.lenbits)-1])>>>16&255,ye=65535&Ee,!((me=Ee>>>24)<=ce);){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(ve&&0==(240&ve)){for(be=me,xe=ve,we=ye;ve=(Ee=i.lencode[we+((ue&(1<<be+xe)-1)>>be)])>>>16&255,ye=65535&Ee,!(be+(me=Ee>>>24)<=ce);){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}ue>>>=be,ce-=be,i.back+=be}if(ue>>>=me,ce-=me,i.back+=me,i.length=ye,0===ve){i.mode=ie;break}if(32&ve){i.back=-1,i.mode=V;break}if(64&ve){e.msg="invalid literal/length code",i.mode=se;break}i.extra=15&ve,i.mode=Q;case Q:if(i.extra){for(Se=i.extra;ce<Se;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.length+=ue&(1<<i.extra)-1,ue>>>=i.extra,ce-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=$;case $:for(;ve=(Ee=i.distcode[ue&(1<<i.distbits)-1])>>>16&255,ye=65535&Ee,!((me=Ee>>>24)<=ce);){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(0==(240&ve)){for(be=me,xe=ve,we=ye;ve=(Ee=i.distcode[we+((ue&(1<<be+xe)-1)>>be)])>>>16&255,ye=65535&Ee,!(be+(me=Ee>>>24)<=ce);){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}ue>>>=be,ce-=be,i.back+=be}if(ue>>>=me,ce-=me,i.back+=me,64&ve){e.msg="invalid distance code",i.mode=se;break}i.offset=ye,i.extra=15&ve,i.mode=ee;case ee:if(i.extra){for(Se=i.extra;ce<Se;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}i.offset+=ue&(1<<i.extra)-1,ue>>>=i.extra,ce-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=se;break}i.mode=te;case te:if(0===h)break e;if(pe=de-h,i.offset>pe){if((pe=i.offset-pe)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=se;break}pe>i.wnext?(pe-=i.wnext,fe=i.wsize-pe):fe=i.wnext-pe,pe>i.length&&(pe=i.length),ge=i.window}else ge=o,fe=a-i.offset,pe=i.length;pe>h&&(pe=h),h-=pe,i.length-=pe;do{o[a++]=ge[fe++]}while(--pe);0===i.length&&(i.mode=J);break;case ie:if(0===h)break e;o[a++]=i.length,h--,i.mode=J;break;case re:if(i.wrap){for(;ce<32;){if(0===c)break e;c--,ue|=n[s++]<<ce,ce+=8}if(de-=h,e.total_out+=de,i.total+=de,de&&(e.adler=i.check=i.flags?f(i.check,o,de,a-de):p(i.check,o,de,a-de)),de=h,(i.flags?ue:r(ue))!==i.check){e.msg="incorrect data check",i.mode=se;break}ue=0,ce=0}i.mode=ne;case ne:if(i.wrap&&i.flags){for(;ce<32;){if(0===c)break e;c--,ue+=n[s++]<<ce,ce+=8}if(ue!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=se;break}ue=0,ce=0}i.mode=oe;case oe:_e=C;break e;case se:_e=A;break e;case ae:return I;case le:default:return E}return e.next_out=a,e.avail_out=h,e.next_in=s,e.avail_in=c,i.hold=ue,i.bits=ce,(i.wsize||de!==e.avail_out&&i.mode<se&&(i.mode<re||t!==x))&&u(e,e.output,e.next_out,de-e.avail_out)?(i.mode=ae,I):(he-=e.avail_in,de-=e.avail_out,e.total_in+=he,e.total_out+=de,i.total+=de,i.wrap&&de&&(e.adler=i.check=i.flags?f(i.check,o,de,e.next_out-de):p(i.check,o,de,e.next_out-de)),e.data_type=i.bits+(i.last?64:0)+(i.mode===V?128:0)+(i.mode===K||i.mode===Y?256:0),(0===he&&0===de||t===x)&&_e===_&&(_e=M),_e)},i.inflateEnd=function(e){if(!e||!e.state)return E;var t=e.state;return t.window&&(t.window=null),e.state=null,_},i.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?E:(i.head=t,t.done=!1,_):E},i.inflateSetDictionary=function(e,t){var i,r=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==z?E:i.mode===z&&p(1,t,r,0)!==i.check?A:u(e,t,r,r)?(i.mode=ae,I):(i.havedict=1,_):E},i.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(e,t,i){"use strict";var r=e("../utils/common"),n=15,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],l=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,i,u,c,h,d,p){var f,g,m,v,y,b,x,w,T,_=p.bits,C=0,S=0,E=0,A=0,I=0,M=0,k=0,D=0,R=0,P=0,L=null,N=0,O=new r.Buf16(16),F=new r.Buf16(16),B=null,G=0;for(C=0;C<=n;C++)O[C]=0;for(S=0;S<u;S++)O[t[i+S]]++;for(I=_,A=n;A>=1&&0===O[A];A--);if(I>A&&(I=A),0===A)return c[h++]=20971520,c[h++]=20971520,p.bits=1,0;for(E=1;E<A&&0===O[E];E++);for(I<E&&(I=E),D=1,C=1;C<=n;C++)if(D<<=1,(D-=O[C])<0)return-1;if(D>0&&(0===e||1!==A))return-1;for(F[1]=0,C=1;C<n;C++)F[C+1]=F[C]+O[C];for(S=0;S<u;S++)0!==t[i+S]&&(d[F[t[i+S]]++]=S);if(0===e?(L=B=d,b=19):1===e?(L=o,N-=257,B=s,G-=257,b=256):(L=a,B=l,b=-1),P=0,S=0,C=E,y=h,M=I,k=0,m=-1,v=(R=1<<I)-1,1===e&&R>852||2===e&&R>592)return 1;for(;;){x=C-k,d[S]<b?(w=0,T=d[S]):d[S]>b?(w=B[G+d[S]],T=L[N+d[S]]):(w=96,T=0),f=1<<C-k,E=g=1<<M;do{c[y+(P>>k)+(g-=f)]=x<<24|w<<16|T|0}while(0!==g);for(f=1<<C-1;P&f;)f>>=1;if(0!==f?(P&=f-1,P+=f):P=0,S++,0==--O[C]){if(C===A)break;C=t[i+d[S]]}if(C>I&&(P&v)!==m){for(0===k&&(k=I),y+=E,D=1<<(M=C-k);M+k<A&&!((D-=O[M+k])<=0);)M++,D<<=1;if(R+=1<<M,1===e&&R>852||2===e&&R>592)return 1;c[m=P&v]=I<<24|M<<16|y-h|0}}return 0!==P&&(c[y+P]=C-k<<24|64<<16|0),p.bits=I,0}},{"../utils/common":62}],72:[function(e,t,i){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(e,t,i){"use strict";function r(e){for(var t=e.length;--t>=0;)e[t]=0}function n(e,t,i,r,n){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=r,this.max_length=n,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function s(e){return e<256?X[e]:X[256+(e>>>7)]}function a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,i){e.bi_valid>O-i?(e.bi_buf|=t<<e.bi_valid&65535,a(e,e.bi_buf),e.bi_buf=t>>O-e.bi_valid,e.bi_valid+=i-O):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function u(e,t,i){l(e,i[2*t],i[2*t+1])}function c(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function h(e,t,i){var r,n,o=new Array(N+1),s=0;for(r=1;r<=N;r++)o[r]=s=s+i[r-1]<<1;for(n=0;n<=t;n++){var a=e[2*n+1];0!==a&&(e[2*n]=c(o[a]++,a))}}function d(e){var t;for(t=0;t<D;t++)e.dyn_ltree[2*t]=0;for(t=0;t<R;t++)e.dyn_dtree[2*t]=0;for(t=0;t<P;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*B]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function p(e){e.bi_valid>8?a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function f(e,t,i,r){var n=2*t,o=2*i;return e[n]<e[o]||e[n]===e[o]&&r[t]<=r[i]}function g(e,t,i){for(var r=e.heap[i],n=i<<1;n<=e.heap_len&&(n<e.heap_len&&f(t,e.heap[n+1],e.heap[n],e.depth)&&n++,!f(t,r,e.heap[n],e.depth));)e.heap[i]=e.heap[n],i=n,n<<=1;e.heap[i]=r}function m(e,t,i){var r,n,o,a,c=0;if(0!==e.last_lit)do{r=e.pending_buf[e.d_buf+2*c]<<8|e.pending_buf[e.d_buf+2*c+1],n=e.pending_buf[e.l_buf+c],c++,0===r?u(e,n,t):(u(e,(o=Z[n])+k+1,t),0!==(a=V[o])&&l(e,n-=K[o],a),u(e,o=s(--r),i),0!==(a=j[o])&&l(e,r-=J[o],a))}while(c<e.last_lit);u(e,B,t)}function v(e,t){var i,r,n,o=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,l=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=L,i=0;i<l;i++)0!==o[2*i]?(e.heap[++e.heap_len]=u=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(n=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[n]=0,e.opt_len--,a&&(e.static_len-=s[2*n+1]);for(t.max_code=u,i=e.heap_len>>1;i>=1;i--)g(e,o,i);n=l;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],g(e,o,1),r=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=r,o[2*n]=o[2*i]+o[2*r],e.depth[n]=(e.depth[i]>=e.depth[r]?e.depth[i]:e.depth[r])+1,o[2*i+1]=o[2*r+1]=n,e.heap[1]=n++,g(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,r,n,o,s,a,l=t.dyn_tree,u=t.max_code,c=t.stat_desc.static_tree,h=t.stat_desc.has_stree,d=t.stat_desc.extra_bits,p=t.stat_desc.extra_base,f=t.stat_desc.max_length,g=0;for(o=0;o<=N;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<L;i++)(o=l[2*l[2*(r=e.heap[i])+1]+1]+1)>f&&(o=f,g++),l[2*r+1]=o,r>u||(e.bl_count[o]++,s=0,r>=p&&(s=d[r-p]),a=l[2*r],e.opt_len+=a*(o+s),h&&(e.static_len+=a*(c[2*r+1]+s)));if(0!==g){do{for(o=f-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(r=e.bl_count[o];0!==r;)(n=e.heap[--i])>u||(l[2*n+1]!==o&&(e.opt_len+=(o-l[2*n+1])*l[2*n],l[2*n+1]=o),r--)}}(e,t),h(o,u,e.bl_count)}function y(e,t,i){var r,n,o=-1,s=t[1],a=0,l=7,u=4;for(0===s&&(l=138,u=3),t[2*(i+1)+1]=65535,r=0;r<=i;r++)n=s,s=t[2*(r+1)+1],++a<l&&n===s||(a<u?e.bl_tree[2*n]+=a:0!==n?(n!==o&&e.bl_tree[2*n]++,e.bl_tree[2*G]++):a<=10?e.bl_tree[2*U]++:e.bl_tree[2*z]++,a=0,o=n,0===s?(l=138,u=3):n===s?(l=6,u=3):(l=7,u=4))}function b(e,t,i){var r,n,o=-1,s=t[1],a=0,c=7,h=4;for(0===s&&(c=138,h=3),r=0;r<=i;r++)if(n=s,s=t[2*(r+1)+1],!(++a<c&&n===s)){if(a<h)do{u(e,n,e.bl_tree)}while(0!=--a);else 0!==n?(n!==o&&(u(e,n,e.bl_tree),a--),u(e,G,e.bl_tree),l(e,a-3,2)):a<=10?(u(e,U,e.bl_tree),l(e,a-3,3)):(u(e,z,e.bl_tree),l(e,a-11,7));a=0,o=n,0===s?(c=138,h=3):n===s?(c=6,h=3):(c=7,h=4)}}function x(e,t,i,r){l(e,(E<<1)+(r?1:0),3),function(e,t,i,r){p(e),r&&(a(e,i),a(e,~i)),w.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}var w=e("../utils/common"),T=4,_=0,C=1,S=2,E=0,A=1,I=2,M=29,k=256,D=k+1+M,R=30,P=19,L=2*D+1,N=15,O=16,F=7,B=256,G=16,U=17,z=18,V=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],j=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],W=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Y=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(D+2));r(H);var q=new Array(2*R);r(q);var X=new Array(512);r(X);var Z=new Array(256);r(Z);var K=new Array(M);r(K);var J=new Array(R);r(J);var Q,$,ee,te=!1;i._tr_init=function(e){te||(function(){var e,t,i,r,o,s=new Array(N+1);for(i=0,r=0;r<M-1;r++)for(K[r]=i,e=0;e<1<<V[r];e++)Z[i++]=r;for(Z[i-1]=r,o=0,r=0;r<16;r++)for(J[r]=o,e=0;e<1<<j[r];e++)X[o++]=r;for(o>>=7;r<R;r++)for(J[r]=o<<7,e=0;e<1<<j[r]-7;e++)X[256+o++]=r;for(t=0;t<=N;t++)s[t]=0;for(e=0;e<=143;)H[2*e+1]=8,e++,s[8]++;for(;e<=255;)H[2*e+1]=9,e++,s[9]++;for(;e<=279;)H[2*e+1]=7,e++,s[7]++;for(;e<=287;)H[2*e+1]=8,e++,s[8]++;for(h(H,D+1,s),e=0;e<R;e++)q[2*e+1]=5,q[2*e]=c(e,5);Q=new n(H,V,k+1,D,N),$=new n(q,j,0,R,N),ee=new n(new Array(0),W,0,P,F)}(),te=!0),e.l_desc=new o(e.dyn_ltree,Q),e.d_desc=new o(e.dyn_dtree,$),e.bl_desc=new o(e.bl_tree,ee),e.bi_buf=0,e.bi_valid=0,d(e)},i._tr_stored_block=x,i._tr_flush_block=function(e,t,i,r){var n,o,s=0;e.level>0?(e.strm.data_type===S&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return _;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return C;for(t=32;t<k;t++)if(0!==e.dyn_ltree[2*t])return C;return _}(e)),v(e,e.l_desc),v(e,e.d_desc),s=function(e){var t;for(y(e,e.dyn_ltree,e.l_desc.max_code),y(e,e.dyn_dtree,e.d_desc.max_code),v(e,e.bl_desc),t=P-1;t>=3&&0===e.bl_tree[2*Y[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),n=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=n&&(n=o)):n=o=i+5,i+4<=n&&-1!==t?x(e,t,i,r):e.strategy===T||o===n?(l(e,(A<<1)+(r?1:0),3),m(e,H,q)):(l(e,(I<<1)+(r?1:0),3),function(e,t,i,r){var n;for(l(e,t-257,5),l(e,i-1,5),l(e,r-4,4),n=0;n<r;n++)l(e,e.bl_tree[2*Y[n]+1],3);b(e,e.dyn_ltree,t-1),b(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,s+1),m(e,e.dyn_ltree,e.dyn_dtree)),d(e),r&&p(e)},i._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(Z[i]+k+1)]++,e.dyn_dtree[2*s(t)]++),e.last_lit===e.lit_bufsize-1},i._tr_align=function(e){l(e,A<<1,3),u(e,B,H),function(e){16===e.bi_valid?(a(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},{"../utils/common":62}],74:[function(e,t,i){"use strict";t.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}]},{},[10])(10)});var c,h=h||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n="download"in r,o=/Version\/[\d\.]+.*Safari/.test(navigator.userAgent),s=e.webkitRequestFileSystem,a=e.requestFileSystem||s||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u=0,c=function(t){var r=function(){"string"==typeof t?i().revokeObjectURL(t):t.remove()};e.chrome?r():setTimeout(r,500)},h=function(e,t,i){for(var r=(t=[].concat(t)).length;r--;){var n=e["on"+t[r]];if("function"==typeof n)try{n.call(e,i||e)}catch(e){l(e)}}},d=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e},p=function(t,l,p){p||(t=d(t));var f,g,m,v=this,y=t.type,b=!1,x=function(){h(v,"writestart progress write writeend".split(" "))},w=function(){if(g&&o&&"undefined"!=typeof FileReader){var r=new FileReader;return r.onloadend=function(){var e=r.result;g.location.href="data:attachment/file"+e.slice(e.search(/[,;]/)),v.readyState=v.DONE,x()},r.readAsDataURL(t),void(v.readyState=v.INIT)}(!b&&f||(f=i().createObjectURL(t)),g)?g.location.href=f:null==e.open(f,"_blank")&&o&&(e.location.href=f);v.readyState=v.DONE,x(),c(f)},T=function(e){return function(){if(v.readyState!==v.DONE)return e.apply(this,arguments)}},_={create:!0,exclusive:!1};if(v.readyState=v.INIT,l||(l="download"),n)return f=i().createObjectURL(t),void setTimeout(function(){var e,t;r.href=f,r.download=l,e=r,t=new MouseEvent("click"),e.dispatchEvent(t),x(),c(f),v.readyState=v.DONE});e.chrome&&y&&"application/octet-stream"!==y&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,"application/octet-stream"),b=!0),s&&"download"!==l&&(l+=".download"),("application/octet-stream"===y||s)&&(g=e),a?(u+=t.size,a(e.TEMPORARY,u,T(function(e){e.root.getDirectory("saved",_,T(function(e){var i=function(){e.getFile(l,_,T(function(e){e.createWriter(T(function(i){i.onwriteend=function(t){g.location.href=e.toURL(),v.readyState=v.DONE,h(v,"writeend",t),c(e)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&w()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=v["on"+e]}),i.write(t),v.abort=function(){i.abort(),v.readyState=v.DONE},v.readyState=v.WRITING}),w)}),w)};e.getFile(l,{create:!1},T(function(e){e.remove(),i()}),T(function(e){e.code===e.NOT_FOUND_ERR?i():w()}))}),w)}),w)):w()},f=p.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,i){return i||(e=d(e)),navigator.msSaveOrOpenBlob(e,t||"download")}:(f.abort=function(){this.readyState=this.DONE,h(this,"abort")},f.readyState=f.INIT=0,f.WRITING=1,f.DONE=2,f.error=f.onwritestart=f.onprogress=f.onwrite=f.onabort=f.onerror=f.onwriteend=null,function(e,t,i){return new p(e,t,i)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=h:null!=r&&null!=r.amd&&r("saveAs",[],function(){return h}),function(e){e.fn.mask=function(t,i){e(this).each(function(){if(void 0!==i&&i>0){var r=e(this);r.data("_mask_timeout",setTimeout(function(){e.maskElement(r,t)},i))}else e.maskElement(e(this),t)})},e.fn.unmask=function(){e(this).each(function(){e.unmaskElement(e(this))})},e.fn.isMasked=function(){return this.hasClass("masked")},e.maskElement=function(t,i){void 0!==t.data("_mask_timeout")&&(clearTimeout(t.data("_mask_timeout")),t.removeData("_mask_timeout")),t.isMasked()&&e.unmaskElement(t),"static"==t.css("position")&&t.addClass("masked-relative"),t.addClass("masked");var r=e('<div class="loadmask"></div>');if(navigator.userAgent.toLowerCase().indexOf("msie")>-1&&(r.height(t.height()+parseInt(t.css("padding-top"))+parseInt(t.css("padding-bottom"))),r.width(t.width()+parseInt(t.css("padding-left"))+parseInt(t.css("padding-right")))),navigator.userAgent.toLowerCase().indexOf("msie 6")>-1&&t.find("select").addClass("masked-hidden"),t.append(r),void 0!==i){var n=e('<div class="loadmask-msg" style="display:none;"></div>');n.append("<div>"+i+"</div>"),t.append(n),n.css("top",Math.round(t.height()/2-(n.height()-parseInt(n.css("padding-top"))-parseInt(n.css("padding-bottom")))/2)+"px"),n.css("left",Math.round(t.width()/2-(n.width()-parseInt(n.css("padding-left"))-parseInt(n.css("padding-right")))/2)+"px"),n.show()}},e.unmaskElement=function(e){void 0!==e.data("_mask_timeout")&&(clearTimeout(e.data("_mask_timeout")),e.removeData("_mask_timeout")),e.find(".loadmask-msg,.loadmask").remove(),e.removeClass("masked"),e.removeClass("masked-relative"),e.find("select").removeClass("masked-hidden")}}(jQuery),r("loadmask",["jquery"],function(){}),r("gw/Services/ExportToolCore",["jquery","underscore-min","jszip","saveAs","../Gui/dialog/ErrorDialog","../Utils/Constants","../Utils/Proxy","loadmask"],function(e,i,r,n,o,s,a){var l,u,c,h;return{init:function(e,t){c=(u=e).getLayers(s.CONTEXT.Sky),l=this},exportSelection:function(r){l.coordinates=r.data,e("body").mask("Exporting data...");var n=new(t("jszip")),c=[],d=[];i.each(h,function(t){e("#"+t.layerId).is(":checked")&&(t.getType()===s.LAYER.OpenSearch||t.getType()===s.LAYER.GeoJSON?d.push(t):t.getType()!==s.LAYER.Hips&&t.getType()!==s.LAYER.HipsCat||c.push(t))});var p=[(l.coordinates[0][1]+l.coordinates[1][1])/2,(l.coordinates[0][0]+l.coordinates[3][0])/2,0];l.coordinates.push(p);var f=[];if(i.each(d,function(e,t){for(var r=0;r<l.coordinates.length;r++){var n=u.getActivatedContext().getTileManager().getVisibleTile(l.coordinates[r][0],l.coordinates[r][1]);if(i.isEmpty(n))return;var o=n.extension[e.extId];i.isEmpty(o)||i.isEmpty(o.featureIds)||i.each(o.featureIds,function(t){var r=e.featuresSet[t];if(!i.isEmpty(r)){var n=e.features[r.index],o=!0;switch(n.geometry.type){case s.GEOMETRY.Point:o=l.checkIfPointInBbox(n.geometry.coordinates,l.coordinates);break;case s.GEOMETRY.Polygon:for(var a=0;a<n.geometry.coordinates.length;a++){if(!o)return;o=l.checkIfPointInBbox(n.geometry.coordinates[0][a],l.coordinates)}}o&&(n.parentInformation={copyright:e.copyright||"",copyrightUrl:e.copyrightUrl||"",category:e.category,name:e.name},f.push(n))}})}}),i.each(f,function(e){var t=n.folder(e.parentInformation.category+"/"+e.parentInformation.name);if(!i.isEmpty(e.parentInformation.copyright)||!i.isEmpty(e.parentInformation.copyrightUrl)){var r="Copyright : "+e.parentInformation.copyright+" - link : "+e.parentInformation.copyrightUrl;t.file(e.parentInformation.name+".txt",r)}var o={geometry:{coordinates:e.geometry.coordinates,gid:e.geometry.gid,type:e.geometry.type,crs:{type:"name",properties:{name:u.getCrs().getGeoideName()}}},id:e.id,properties:e.properties,type:e.type};t.file(e.properties.identifier+".json",JSON.stringify(o,null,"\t"))}),0===c.length)l.downloadArchive(n);else{var g=0,m=!1;i.each(c,function(e,t){e.urlImages=[],e.images=[];for(var r=0;r<l.coordinates.length;r++){var c=u.getActivatedContext().getTileManager().getVisibleTile(l.coordinates[r][0],l.coordinates[r][1]);if(i.isEmpty(c))return;g++;var h=e.getUrl(c),d=new Image;d.aborted=!1,d.crossOrigin="",d.backgroundName=e.name,d.parentFolder=e.category+"/"+e.name+"/images",d.imageName=h.substring(h.lastIndexOf("/")+1,h.length),d.onload=function(){l.addImageToArchive(this,n),0==--g&&l.downloadArchive(n)},d.onerror=function(){m=!0,o.open(s.LEVEL.WARNING,"Error while retrieving image : "+this.imageName),0==--g&&(m&&o.open(s.LEVEL.WARNING,"Some images not found","Change zoom level and retry download"),l.downloadArchive(n))},d.src=a.proxify(h)}})}},addImageToArchive:function(e,t){t.folder(e.parentFolder).file(e.imageName,l.getBase64Image(e),{base64:!0})},downloadArchive:function(i){var r=t("saveAs"),n=new Date,o=e.datepicker.formatDate("yy/mm/dd "+n.getHours()+":"+n.getMinutes(),n),s="Date : "+o+"\nQuery :"+JSON.stringify(l.coordinates,null,"\t")+"\nCopyright : Generated by MIZAR";i.file("README.txt",s),r(i.generate({type:"blob"}),"archive_"+o+".zip"),e("body").unmask()},getBase64Image:function(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),t.toDataURL("image/png").replace(/^data:image\/(png|jpg);base64,/,"")},filterServicesAvailableOnLayers:function(){return h=[],i.each(c,function(e){e.isVisible()&&"Other"!==e.category&&"Solar System"!==e.category&&"SAMP"!==e.getName()&&"Planets"!==e.getName()&&(e.layerId=i.uniqueId("layer_"),h.push(e))}),h}}}),r("gw/NameResolver/AbstractNameResolver",[],function(){var e=function(e){this.ctx=e};return e.prototype.handle=function(e){throw new SyntaxError("handle from NameResolver not implemented","AbstractNameResolver.js")},e.prototype.remove=function(){throw new SyntaxError("remove from NameResolver not implemented","AbstractNameResolver.js")},e}),r("gw/NameResolver/DefaultNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver"],function(e,t,i,r){var n=function(e){r.prototype.constructor.call(this,e)};return i.inherits(r,n),n.prototype.handle=function(e){var t=this.ctx,r=e.objectName,n=e.onError,o=e.onComplete,s=e.onSuccess,a=e.searchLayer,l=e.zoomTo,u=t.getMizarConfiguration().nameResolver.baseUrl+"/"+r+"/EQUATORIAL";i.requestUrl(u,"text","text/plain",null,function(e){if("FeatureCollection"===e.type){var t=e.features[0];l(t.geometry.coordinates[0],t.geometry.coordinates[1],null,function(){a(r,s,n,e)},e)}else n()},function(e){a(r,s,n)},function(e,t){o&&o(e)})},n.prototype.remove=function(){},n}),r("gw/NameResolver/CDSNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractNameResolver"],function(e,t,i,r,n){var o=function(e){n.prototype.constructor.call(this,e)};return r.inherits(n,o),o.prototype.handle=function(n){this.ctx;var o=n.objectName,s=n.onError,a=n.onComplete,l=n.onSuccess,u=n.searchLayer,c=n.zoomTo,h="http://cdsweb.u-strasbg.fr/cgi-bin/nph-sesame/-oxp/A?"+o;r.requestUrl(h,"xml","application/xml",null,function(r){var n=e(r).find("Target"),a=e(n).find("name").text(),h=[];e(n).find("Resolver").each(function(i){var r=e(this).find("jradeg"),n=e(this).find("jdedeg");if(!t.isEmpty(r.text())&&!t.isEmpty(n.text())){r=parseFloat(r.text()),n=parseFloat(n.text());var o={};o.ra=r,o.dec=n,o.credit=e(this).attr("name"),h.push(o)}});var d={totalResults:h.length,type:"FeatureCollection",features:[]};if(t.each(h,function(e){d.features.push({type:"Feature",geometry:{coordinates:[e.ra,e.dec],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{identifier:"CDS0",name:a,credits:'Powered by <a href="http://cdsweb.u-strasbg.fr/cgi-bin/Sesame">Sesame API</a> ('+e.credit+")"}})}),"FeatureCollection"===d.type&&d.features.length>0){var p=d.features[0];c(p.geometry.coordinates[0],p.geometry.coordinates[1],null,i.CRS.Equatorial,function(){u(o,l,s,d)},d)}else u(o,l,s,d)},function(e){u(o,l,s)},function(e,t){a&&a(e)})},o.prototype.remove=function(){},o}),r("gw/NameResolver/DictionaryNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Layer/VectorLayer","../Renderer/FeatureStyle","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a){var l,u=function(e){r.prototype.constructor.call(this,e),l=function(e){if(e.getContextConfiguration().nameResolver.baseUrl.indexOf("json")>=0){var t=e.getContextConfiguration().nameResolver.baseUrl;i.requestUrl(t,"json","application/json",null,function(e){l=e},function(e){a.open(s.LEVEL.ERROR,"Failed ot request "+t,e)})}else l=null}(e)};function c(e,t){var i=[parseFloat(t[0])-parseFloat(e[0]),parseFloat(t[1])-parseFloat(e[1])];return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function h(e,t){for(var i=0,r=0;r<t.length;r++){var n=c.call(this,e,t[r]);n>i&&(i=n)}return i}function d(e,t){return h.call(this,e,t)}function p(e,t){return[parseFloat(e[0])+parseFloat(t[0]),parseFloat(e[1])+parseFloat(t[1])]}function f(e){for(var t=e[0],i=1;i<e.length;i++)t=p.call(this,t,e[i]);return t=[t[0]/e.length,t[1]/e.length]}return i.inherits(r,u),u.prototype.handle=function(e){var i=this.ctx,r=this.ctx.getCoordinateSystem(),n=e.objectName,o=e.onError,s=(e.onComplete,e.onSuccess),a=e.searchLayer,u=e.zoomTo,c=t.find(l.features,function(e){var t=null==e.properties.Name?e.properties.name:e.properties.Name;return null!=t&&t.toLowerCase()===n.toLowerCase()});if(c){var g,m,v;if(null==c.properties.center_lon||null==c.properties.center_lat){var y=function(e){var t,i,r=e.type,n=e.coordinates,o=null,s=null,a=null;switch(r){case"Point":t=n,i=null;break;case"LineString":t=f.call(this,n),i=d.call(this,t,n);break;case"Polygon":var l=n[0];t=f.call(this,l),i=d.call(this,t,l);break;case"MultiPoint":t=f.call(this,n),i=d.call(this,t,n);break;case"MultiLineString":var u=n[0];(t=f.call(this,u[0]))[0]=t[0]*u[0].length,t[1]=t[1]*u[0].length,o=0;for(var c=1;c<u.length;c++)(s=f.call(this,u[c]))[0]=s[0]*u[c].length,s[1]=s[1]*u[c].length,o+=u[c].length,t=p(t,s);for(t[0]=t[0]/o,t[1]=t[1]/o,i=0,c=0;c<u.length;c++)(a=h.call(this,t,u[c]))>i&&(i=a);break;case"MultiPolygon":var g=n[0];for((t=f.call(this,g[0][0]))[0]=t[0]*g[0][0].length,t[1]=t[1]*g[0][0].length,o=0,c=1;c<g.length;c++)(s=f.call(this,u[c][0]))[0]=s[0]*u[c][0].length,s[1]=s[1]*u[c][0].length,o+=u[c][0].length,t=p.call(this,t,s);for(t[0]=t[0]/o,t[1]=t[1]/o,i=0,c=0;c<g.length;c++)(a=h.call(this,t,g[c][0]))>i&&(i=a);break;default:throw"geometry "+r+" is not supported"}return[t,i]}.call(this,c.geometry);g=parseFloat(y[0][0]),m=parseFloat(y[0][1]),v=y[1]}else g=parseFloat(c.properties.center_lon),m=parseFloat(c.properties.center_lat),v=null;c.geometry.crs={type:"name",properties:{name:i.getCoordinateSystem().getGeoideName()}};var b,x=i.getRenderContext().getFov();null==v?b=null:(v=v>180?180:v,b=(v=2*Math.PI*r.getGeoide().getRealPlanetRadius()*v/360)/Math.tan(.5*x*Math.PI/180)),u(g,m,b,r.getGeoideName(),function(){a(n,s,o,{features:[c]})},{features:[c]})}else a(n,s,o)},u.prototype.remove=function(){l=null},u}),r("gw/NameResolver/IMCCENameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractNameResolver","../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy"],function(e,t,i,r,n,o,s){var a=function(e){r.prototype.constructor.call(this,e)};return i.inherits(r,a),a.prototype.handle=function(r){var a=r.objectName,l=r.onError,u=r.onComplete,c=r.onSuccess,h=r.searchLayer,d=r.zoomTo,p="https://api.ssodnet.imcce.fr/quaero/1/sso?q="+a+"&from=Mizar";e.ajax({type:"GET",url:s.proxify(p),dataType:"json",beforeSend:function(e){e.setRequestHeader("Accept","application/json")},success:function(r){!function(r,s){var a=[],u=0,c=r.length;0===c?l():t.each(r,function(r){!function(r,s){var a=r.type,l=r.id,u=r.name;if(-1!==e.inArray(a,["Planet","Asteroid","Satellite","Star","Comet"])){var c="https://api.ssodnet.imcce.fr/quaero/1/sso/"+l+"/resolver";i.requestUrl(c,"json","application/json",null,function(e){var i=e.geometry.coordinates,r=360*i[0]/24,n=i[1];if(t.isNumber(r)&&t.isNumber(n)){r=parseFloat(r),n=parseFloat(n);var o={};o.ra=r,o.dec=n,o.credits='Powered by <a href="http://vo.imcce.fr/webservices/ssodnet/?quaero" target="_blank">SsODNet/Quaero API</a>.',o.id=l,o.type=a,o.name=u,s(o)}},function(e){o.open(n.LEVEL.ERROR,"Failed ot request "+c,e)})}else s()}(r,function(e){u++,t.isEmpty(e)||a.push(e),u===c&&s(a)})})}(r.data,function(e){var i={totalResults:e.length,type:"FeatureCollection",features:[]};if(t.each(e,function(e){i.features.push({type:"Feature",geometry:{coordinates:[e.ra,e.dec],type:"Point",crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{identifier:e.id,type:e.type,name:e.name,credits:e.credits}})}),"FeatureCollection"===i.type&&i.features.length>0){var r=i.features[0];d(r.geometry.coordinates[0],r.geometry.coordinates[1],null,n.CRS.Equatorial,function(){h(a,c,l,i)},i)}else l()})},error:function(e){h(a,c,l),o.open(n.LEVEL.ERROR,e.responseText)},complete:function(e){u&&u(e)}})},a.prototype.remove=function(){},a}),r("gw/NameResolver/NameResolver",["jquery","underscore-min","../Utils/Constants","../Gui/dialog/ErrorDialog","../Renderer/FeatureStyle","../Layer/VectorLayer","../Tiling/HEALPixBase","./DefaultNameResolver","jquery.ui","./CDSNameResolver","./DictionaryNameResolver","./IMCCENameResolver"],function(e,i,r,n,o,s,a,l){var u,c,h,d,p,f,g=null;function m(e,t,r,n){var o,s=u.searchOnLayerDescription(e,u.getActivatedContext().getMode());0!==s.length||n&&0!==n.totalResults?(s=i.sortBy(s,function(e){return"background"===e.category?0:1}),n&&"FeatureCollection"===n.type?o=n:((o={}).type="FeatureCollection",o.features=[]),i.each(s,function(e){o.features.push({type:"Feature",properties:{type:"layer",name:e.getName(),description:e.getDescription(),layerType:e.getType(),visible:e.isVisible(),background:"background"===e.category}})}),t(o)):r&&r()}function v(e,t,i,n,o,s){if(null!=s)for(var a=0;a<s.features.length;)s.features[a].geometry.coordinates=u.getCrs().convert(s.features[a].geometry.coordinates,n,u.getCrs().getGeoideName()),s.features[a].geometry.crs.properties.name=n,a++;var l=function(){!function(e,t,i){f={geometry:{coordinates:[e,t],type:r.GEOMETRY.Point,crs:{type:"name",properties:{name:i}}},type:"Feature"},p.addFeature(f)}(e,t,n),o&&o.call(this,s)},c=u.getCrs().convert([e,t],n,u.getCrs().getGeoideName());if(u.getActivatedContext().getMode()===r.CONTEXT.Sky)u.getActivatedContext().getNavigation().zoomTo(c,{fov:d,duration:h,callback:l});else{var g=null==i?u.getActivatedContext().getNavigation().getDistance():i;u.getActivatedContext().getNavigation().zoomTo([e,t],{distance:g,duration:h,callback:l})}}function y(){f&&(p.removeFeature(f),f=null)}return{init:function(e){c?n.open(r.LEVEL.DEBUG,"Name resolver is already initialized"):(u=e,this.setContext(u.getActivatedContext()))},remove:function(){c&&(u.getActivatedContext().removeDraw(p),void 0!==g&&g.remove(),u.getActivatedContext().unsubscribe(r.EVENT_MSG.NAVIGATION_MODIFIED,y),c=null)},goTo:function(e,t,i,n,o){e=e.replace(/\s{2,}/g," ");var s=new RegExp("\\d{1,2}[h|:]\\d{1,2}[m|:]\\d{1,2}([\\.]\\d+)?s?\\s[-+]?[\\d]+[°|:]\\d{1,2}['|:]\\d{1,2}([\\.]\\d+)?\"?","g"),l=/^healpix\((\d)+,(\d+)\)/.exec(e),c=/^(-?\d+(\.\d+)?),?\s(-?\d+(\.\d+)?)/.exec(e);if(/^layer:(.)*?/.exec(e),l)!function(e,t){var i=parseInt(e[1],10),r=parseInt(e[2],10),n=Math.pow(2,i),o=r&n*n-1,s=a.compress_bits(o),l=a.compress_bits(o>>>1),c=r>>>2*i,h=a.fxyf((s+.5)/n,(l+.5)/n,c),d=[];u.getCrs().getWorldFrom3D(h,d),v(d[0],d[1],null,u.getCrs().getGeoideName(),t)}(l,t);else if(e.match(s))!function(e,t){var i=e.split(" ");i[0]=i[0].replace(/h|m|:/g," "),i[0]=i[0].replace("s",""),i[1]=i[1].replace(/°|'|:/g," "),i[1]=i[1].replace('"',"");var r=[];u.getCrs().getDecimalDegFromSexagesimal([i[0],i[1]],r),v(r[0],r[1],null,u.getCrs().getGeoideName(),t)}(e,s);else if(c)!function(e,t,i){var r=u.getCrs().getGeoBound(),n=[parseFloat(e[1]),parseFloat(e[3])];r.isPointInside(n)?v(n[0],n[1],null,u.getCrs().getGeoideName(),t):i.call(this)}(c,t,n);else{var h={objectName:e,onError:i,onComplete:o,onSuccess:t,searchLayer:m,zoomTo:v};g?g.handle(h):u.publish(r.EVENT_MSG.PLUGIN_NOT_FOUND,"No name resolver found")}},zoomTo:v,setContext:function(e){var i,n;this.remove(),void 0!==(c=e).getContextConfiguration().nameResolver?(n=t(c.getContextConfiguration().nameResolver.jsObject),i=!1,g=new n(c)):(i=!0,g=new l(c));var a=new o({iconUrl:e.getMizarConfiguration().mizarBaseUrl+"css/images/target.png",fillColor:[1,1,1,1]});p=new s({style:a,visible:!0}),u.getActivatedContext().addDraw(p),i?(h=3e3,d=15):(h=c.getContextConfiguration().nameResolver.duration||3e3,d=c.getContextConfiguration().nameResolver.zoomFov||15),e.subscribe(r.EVENT_MSG.NAVIGATION_MODIFIED,y)}}}),r("gw/ReverseNameResolver/AbstractReverseNameResolver",[],function(){var e=function(e){this.ctx=e};return e.prototype.handle=function(){throw new SyntaxError("handle from AbstractReverseNameResolver not implemented","AbstractReverseNameResolver.js")},e.prototype.remove=function(){throw new SyntaxError("remove from AbstractReverseNameResolver not implemented","AbstractReverseNameResolver.js")},e}),r("gw/ReverseNameResolver/DefaultReverseNameResolver",["jquery","underscore-min","../Utils/Utils","./AbstractReverseNameResolver"],function(e,t,i,r){var n=function(e){r.prototype.constructor.call(this,e)};return i.inherits(r,n),n.prototype.handle=function(e){var t=e.maxOrder,r=e.equatorialCoordinates,n=e.context.getMizarConfiguration().reverseNameResolver.baseUrl+"/EQUATORIAL/"+r[0]+" "+r[1]+";"+t;i.requestUrl(n,"text","text/plain",null,function(t){e&&e.success&&e.success(t)},function(t){e&&e.error&&e.error(t)})},n.prototype.remove=function(e){},n}),r("gw/ReverseNameResolver/CDSReverseNameResolver",["jquery","underscore-min","../Utils/Constants","../Utils/Utils","./AbstractReverseNameResolver","../Tiling/HEALPixBase"],function(e,t,i,r,n,o){var s=null,a=function(e){n.prototype.constructor.call(this,e)};return r.inherits(n,a),a.prototype.handle=function(e){var t=Date.now();if(null!==s&&t-6e3<=s)e&&e.error&&e.error({status:503});else{var n=this,a=e.maxOrder,l=e.pos,u=e.mizarAPI;l=u.getCrs().convert(l,u.getCrs().getGeoideName(),i.CRS.Equatorial);var c=[];u.getCrs().getSexagesimalFromDeg(l,c),c[0]=c[0].replace("h ",":"),c[0]=c[0].replace("m ",":"),c[0]=c[0].replace("s",""),c[1]=c[1].replace("° ",":"),c[1]=c[1].replace("' ",":"),c[1]=c[1].replace('"',"");var h=Math.pow(2,a),d=o.getPixRes(h),p=d>1800?1800:d/2;p*=1/3600;var f=u.getActivatedContext().getContextConfiguration().reverseNameResolver.baseUrl;f=(f=f.replace("{coordinates}",c[0]+" "+c[1])).replace("{radius}",p),r.requestUrl(f,"text","text/plain",null,function(t){s=Date.now();var r=t.indexOf("("),o=t.indexOf(","),a=t.indexOf("/"),l=t.substring(0,a),u=t.substring(a+1,r),c=parseFloat(t.substring(r+1,o)),h=t.substring(o+1,t.length-2),d=l.split(" "),p=parseFloat(d[0]),f=parseFloat(d[1]),g=parseFloat(d[2]),m=parseFloat(d[3]),v=parseFloat(d[4]),y=parseFloat(d[5]),b={totalResults:1,type:"FeatureCollection",features:[{type:"Feature",geometry:{coordinates:[n._parseRa(p,f,g),n._parseDec(m,v,y)],type:i.GEOMETRY.Point,crs:{type:"name",properties:{name:i.CRS.Equatorial}}},properties:{title:u,magnitude:c,credits:"CDS",seeAlso:"http://simbad.u-strasbg.fr/simbad/sim-id?Ident="+u,type:h,identifier:u}}]};e&&e.success&&e.success(b)},function(t){e&&e.error&&e.error(t)})}},a.prototype._parseRa=function(e,t,i){var r=parseInt(e,10),n=(i/60+t)/60;return e<=0?(n=e-n,r=-r):n=r+n,15*n},a.prototype._parseDec=function(e,t,i){var r=parseInt(e,10),n=(i/60+t)/60;return e<=0?(n=e-n,r=-r):n=r+n,n},a.prototype.remove=function(){},a}),r("gw/ReverseNameResolver/ReverseNameResolver",["jquery","../Utils/Constants","./DefaultReverseNameResolver","./CDSReverseNameResolver","../Gui/dialog/ErrorDialog"],function(e,i,r,n){var o,s,a=null;return{init:function(e){o=e,this.setContext(o.getActivatedContext())},sendRequest:function(e,t){if(o.getActivatedContext().getMode()===i.CONTEXT.Sky){var r=3;o.getActivatedContext().getTileManager().visitTiles(function(e){r<e.order&&(r=e.order)}),t.maxOrder=r,t.pos=e,t.mizarAPI=o,a?a.handle(t):o.publish(i.EVENT_MSG.PLUGIN_NOT_FOUND,"No reserve name resolver found")}else n.open(i.LEVEL.DEBUG,"ReverseNameResolver.js","Not implemented yet"),t&&t.error&&t.error()},setContext:function(e){var i;void 0!==(s=e).getContextConfiguration().reverseNameResolver?(i=t(s.getContextConfiguration().reverseNameResolver.jsObject),a=new i(s)):a=new r(s)}}}),r("gw/Time/TimeSample",["jquery","moment","../Utils/Constants","../Utils/Utils"],function(e,t,i,r){var n=function(){this.start=null,this.end=null,this.stepValue=null,this.stepKind=null,this.layerID=null};return n.prototype.getStart=function(){return this.start},n.prototype.setStart=function(e){this.start=t.utc(e)},n.prototype.getEnd=function(){return this.end},n.prototype.setEnd=function(e){this.end=t.utc(e)},n.prototype.getStepValue=function(){return this.stepValue},n.prototype.setStepValue=function(e){this.stepValue=e},n.prototype.getStepKind=function(){return this.stepKind},n.prototype.setStepKind=function(e){this.stepKind=e},n.prototype.setLayerID=function(e){this.layerID=e},n.prototype.getLayerID=function(){return this.layerID},n.prototype.getNextDate=function(e){var i=null;return(i=t.utc(e).add(this.stepValue,this.stepKind))>this.end&&(i=null),i},n.prototype.getPreviousDate=function(e){var i=null;return(i=t.utc(e).subtract(this.stepValue,this.stepKind))<this.start&&(i=null),i},n.prototype.getFirstDateAfter=function(e){var i=null,r={from:null,to:null},n=null;if(e<this.start)i=this.start,n=t(i.toISOString()).format(t(i).creationData().format);else if(e>this.end)i=null;else for(var o=this.start,s=!1;!s;)null===(o=this.getNextDate(o))&&(s=!0,i=null),o>e&&(s=!0,i=o);return null!==i&&(r.from=i,r.to=i,n=t(i.toISOString()).format(t(i).creationData().format)),{date:i,period:r,display:n}},n.prototype.getFirstDateBefore=function(e){var i=null,r={from:null,to:null},n=null;if(e>this.end)i=this.end,n=t(i.toISOString()).format(t(i).creationData().format);else if(e<this.start)i=null;else for(var o=this.start,s=null,a=!1;!a;)s=o,null===(o=this.getNextDate(o))&&(a=!0,i=s),o>e&&(a=!0,i=s);return null!==i&&(n=t(i.toISOString()).format(t(i).creationData().format),r.from=i,r.to=i),{date:i,period:r,display:n}},n.prototype.getMinDate=function(){return this.getStart()},n.prototype.getMaxDate=function(){return this.getEnd()},n.prototype.toString=function(){return t(this.start)+" / "+t(this.end)+" / "+this.stepValue+this.stepKind+" / ID="+this.layerID},n}),r("gw/Time/TimeEnumerated",["jquery","moment","../Utils/Constants","../Utils/Utils","../Time/TimeTravelParams"],function(e,t,i,r,n){var o=function(){this.enumeratedValues=null,this.currentIndex=null};function s(e,t){return e.date>t.date?1:-1}return o.prototype.getCurrentIndex=function(){return this.currentIndex},o.prototype.parseDate=function(e){var r=null,n=null;return"string"==typeof(e=e.trim())?(/^\d{4}$/.test(e)&&(r=t.utc(e,"YYYY"),(n={}).from=r,n.to=t.utc(n.from).endOf(i.TIME_STEP.YEAR)),/^\d{4}-\d{2}$/.test(e)&&(r=t.utc(e,"YYYY-MM"),(n={}).from=r,n.to=t.utc(n.from).endOf(i.TIME_STEP.MONTH)),/^\d{4}-\d{2}-\d{2}$/.test(e)&&(r=t.utc(e,"YYYY-MM-DD"),(n={}).from=r,n.to=t.utc(n.from).endOf(i.TIME_STEP.DAY)),null===r&&(r=t.utc(e))):r=t.utc(e),{date:r,display:e,period:n}},o.prototype.addDateToEnumeratedValues=function(e,t){null===this.enumeratedValues&&(this.enumeratedValues=[]);for(var i=0;i<this.enumeratedValues.length;i++)if(this.enumeratedValues[i].display===e.display&&this.enumeratedValues[i].ids&&this.enumeratedValues[i].ids.length)return void this.enumeratedValues[i].ids.push(t);e.ids=[],e.ids.push(t),this.enumeratedValues.push(e)},o.prototype.removeEnumeratedValuesForID=function(e){if(null===e&&(e=n.NO_ID),this.enumeratedValues)for(var t=this.enumeratedValues.length-1;t>=0;t--)if(this.enumeratedValues[t].ids&&this.enumeratedValues[t].ids.length){var i=this.enumeratedValues[t].ids.indexOf(e);-1!==i&&this.enumeratedValues[t].ids.splice(i,1),0===this.enumeratedValues[t].ids.length&&this.enumeratedValues.splice(t,1)}},o.prototype.addEnumeratedValuesForID=function(e,t){if(null!==e){null===t&&(t=n.NO_ID);for(var i=null,r=0;r<e.length;r++)i=this.parseDate(e[r]),this.addDateToEnumeratedValues(i,t);this.enumeratedValues.sort(s),this.currentIndex=0,this.currentDate=this.enumeratedValues[this.currentIndex].date}},o.prototype.getFirstDateAfter=function(e){return null},o.prototype.getFirstDateBefore=function(e){return null},o.prototype.getFirstDateAfter=function(e){var t=null,i={from:null,to:null},r=null;if(this.enumeratedValues&&this.enumeratedValues.length>0)if(e<this.enumeratedValues[0].date)t=this.enumeratedValues[0].date,i=this.enumeratedValues[0].period,r=this.enumeratedValues[0].display;else if(e>this.enumeratedValues[this.enumeratedValues.length-1].date)t=null;else for(var n=0,o=!1;!o;){this.enumeratedValues[n].date>e&&(o=!0,t=this.enumeratedValues[n].date,i=this.enumeratedValues[n].period,r=this.enumeratedValues[n].display),n++,o=o||n>=this.enumeratedValues.length}return{date:t,period:i,display:r}},o.prototype.getFirstDateBefore=function(e){var t=null,i={from:null,to:null},r=null;if(this.enumeratedValues&&this.enumeratedValues.length>0)if(e>this.enumeratedValues[this.enumeratedValues.length-1].date)t=this.enumeratedValues[this.enumeratedValues.length-1].date,i=this.enumeratedValues[this.enumeratedValues.length-1].period,r=this.enumeratedValues[this.enumeratedValues.length-1].display;else if(e<this.enumeratedValues[0].date)t=null;else for(var n=this.enumeratedValues.length-1,o=!1;!o;)for(;!o;){this.enumeratedValues[n].date<e&&(o=!0,t=this.enumeratedValues[n].date,i=this.enumeratedValues[n].period,r=this.enumeratedValues[n].display),n--,o=o||n<0}return{date:t,period:i,display:r}},o.prototype.toString=function(){var e="";if(this.enumeratedValues)for(var t=0;t<this.enumeratedValues.length;t++)e+=this.enumeratedValues[t].display+" / ";return e},o.prototype.isEmpty=function(){return!(this.enumeratedValues&&this.enumeratedValues.length>0)},o.prototype.getMinDate=function(){var e=null;return this.enumeratedValues&&this.enumeratedValues.length>0&&(e=this.enumeratedValues[0].date),e},o.prototype.getMaxDate=function(){var e=null;return this.enumeratedValues&&this.enumeratedValues.length>0&&(e=this.enumeratedValues[this.enumeratedValues.length-1].date),e},o}),r("gw/Time/TimeTravelParams",["jquery","moment","./TimeSample","./TimeEnumerated","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s=function(){this.currentDate=new Date,this.currentPeriod={from:null,to:null},this.currentDisplayDate=t(this.currentDate).format(t(this.currentDate).creationData().format),this.minDate=null,this.maxDate=null,this.ctx=null,this.samples=[],this.enumeratedValues=new r,t.locale("fr")};return s.prototype.setContext=function(e){this.ctx=e,this.apply()},s.prototype.setCurrentDate=function(e){this.currentDate=t.utc(e)},s.prototype.getCurrentDate=function(){return this.currentDate},s.prototype.getCurrentPeriod=function(){return this.currentPeriod},s.prototype.addSample=function(e,t,r,n,o){var s=new i;s.setStart(e),s.setEnd(t),s.setStepKind(r),s.setStepValue(n),s.setLayerID(o),this.samples.push(s)},s.prototype.addValues=function(e){if(e){var t=this.currentDate;e.enumeratedValues?this.enumeratedValues.addEnumeratedValuesForID(e.enumeratedValues,e.ID):e.start&&e.end&&e.stepKind&&e.stepValue&&e.ID?this.addSample(e.start,e.end,e.stepKind,e.stepValue,e.ID):o.open(n.LEVEL.WARNING,"Can't understand add values for time travel with parameters : "+e),this.setToNearestValue(t)}},s.prototype.removeValues=function(e){if(e){var t=this.currentDate;if(e.ID){this.enumeratedValues.removeEnumeratedValuesForID(e.ID);for(var i=[],r=0;r<this.samples.length;r++)this.samples[r].getLayerID()!==e.ID&&i.push(this.samples[r]);this.samples=i}this.setToNearestValue(t)}},s.prototype.getNextDate=function(e){for(var t={date:null},i=[],r=null,n=0;n<this.samples.length;n++)null!==(r=this.samples[n].getFirstDateAfter(e)).date&&i.push(r);for(null!==(r=this.enumeratedValues.getFirstDateAfter(e)).date&&i.push(r),n=0;n<i.length;n++){var o=i[n];null===t.date?t=o:Math.abs(o-e<t-e)&&(t=o)}return t},s.prototype.getPreviousDate=function(e){for(var t={date:null},i=[],r=null,n=0;n<this.samples.length;n++)null!==(r=this.samples[n].getFirstDateBefore(e)).date&&i.push(r);for(null!==(r=this.enumeratedValues.getFirstDateBefore(e)).date&&i.push(r),n=0;n<i.length;n++){var o=i[n];null===t.date?t=o:Math.abs(o.date-e<t.date-e)&&(t=o)}return t},s.prototype.setToNearestValue=function(e){var i=this.getPreviousDate(e),r=this.getNextDate(e);if(null===i.date&&null===r.date)this.currentDate=new Date,this.currentDisplayDate=t(this.currentDate).format("Do MMM Y"),this.currentPeriod={from:this.currentDate,to:this.currentDate};else if(null===i.date)this.currentDate=r.date,this.currentDisplayDate=r.display,this.currentPeriod=r.period;else if(null===r.date)this.currentDate=i.date,this.currentDisplayDate=i.display,this.currentPeriod=i.period;else{Math.abs(e-i.date)<Math.abs(r.date-e)?(this.currentDate=i.date,this.currentDisplayDate=i.display,this.currentPeriod=i.period):(this.currentDate=r.date,this.currentDisplayDate=r.display,this.currentPeriod=r.period)}this.apply()},s.prototype.update=function(e){e&&(e.add&&this.addValues(e.add),e.remove&&this.removeValues(e.remove),this.minDate=this.getMinDate(),this.maxDate=this.getMaxDate(),this.apply())},s.prototype.apply=function(){var e={date:this.currentDate,display:this.currentDisplayDate,period:this.currentPeriod};this.ctx.publish(n.EVENT_MSG.GLOBAL_TIME_CHANGED,e)},s.prototype.rewind=function(){if(!this.isEmpty()){var e=this.getPreviousDate(t(this.currentDate).subtract(1,n.TIME_STEP.MILLISECOND));null!==e.date&&(this.currentDate=e.date,this.currentPeriod=e.period,this.currentDisplayDate=e.display,this.apply())}},s.prototype.forward=function(){if(!this.isEmpty()){var e=this.getNextDate(t(this.currentDate).add(1,n.TIME_STEP.MILLISECOND));null!==e.date&&(this.currentDate=e.date,this.currentPeriod=e.period,this.currentDisplayDate=e.display,this.apply())}},s.prototype.getDateFormated=function(e){var i="LLLL";return i=this.stepKind===n.TIME_STEP.YEAR?"Y":this.stepKind===n.TIME_STEP.QUARTER||this.stepKind===n.TIME_STEP.MONTH?"MMM Y":this.stepKind===n.TIME_STEP.WEEK||this.stepKind===n.TIME_STEP.DAY||this.stepKind===n.TIME_STEP.ENUMERATED?"Do MMM Y":this.stepKind===n.TIME_STEP.HOUR||this.stepKind===n.TIME_STEP.MINUTE?"Do MMM Y HH:mm":this.stepKind===n.TIME_STEP.SECOND?"Do MMM Y   HH:mm:ss":"Do MMM Y   HH:mm:ss.SSS",t.utc(this.currentDate).format(i)},s.prototype.getCurrentDisplayDate=function(){return this.currentDisplayDate},s.prototype.isCurrentDateTheFirst=function(){if(!0===this.isEmpty())this.isFirstDate=!0;else{var e=this.getPreviousDate(t(this.currentDate).subtract(1,n.TIME_STEP.MILLISECOND));this.isFirstDate=null===e.date}return this.isFirstDate},s.prototype.isCurrentDateTheLast=function(){if(!0===this.isEmpty())this.isLastDate=!0;else{var e=this.getNextDate(t(this.currentDate).add(1,n.TIME_STEP.MILLISECOND));this.isLastDate=null===e.date}return this.isLastDate},s.prototype.getMinDate=function(){for(var e=null,t=[],i=0;i<this.samples.length;i++)t.push(this.samples[i].getMinDate());for(t.push(this.enumeratedValues.getMinDate()),i=0;i<t.length;i++)null===e?e=t[i]:t[i]<e&&null!==t[i]&&(e=t[i]);return e},s.prototype.getMaxDate=function(){for(var e=null,t=[],i=0;i<this.samples.length;i++)t.push(this.samples[i].getMaxDate());for(t.push(this.enumeratedValues.getMaxDate()),i=0;i<t.length;i++)null===e?e=t[i]:t[i]>e&&null!==t[i]&&(e=t[i]);return e},s.prototype.isEmpty=function(){return!(this.samples&&this.samples.length>0)&&this.enumeratedValues.isEmpty()},s.prototype.toString=function(){var e="";if(e+="Metadata : \n",e+="  Start date : "+t(this.minDate).format(n.TIME.DEFAULT_FORMAT)+" : "+this.minDate+"\n",e+="  End date   : "+t(this.maxDate).format(n.TIME.DEFAULT_FORMAT)+" : "+this.maxDate+"\n",this.samples)for(var i=0;i<this.samples.length;i++)e+="Sample : "+this.samples[i].toString()+"\n";return this.enumeratedValues.isEmpty()||(e+="Enumerated : "+this.enumeratedValues.toString()+"\n"),e},s}),r("gw/Services/TimeTravelCore",["jquery","../Time/TimeTravelParams","../Utils/Constants"],function(e,t,i){var r=new t,n=null,o=null;function s(){r.rewind()}function a(){r.forward()}function l(e){(e instanceof Date||"string"==typeof e)&&r.setCurrentDate(e)}return{init:function(e){n=e.element,o=e.ctx,r.setContext(o),o&&(o.subscribe(i.EVENT_MSG.GLOBAL_TIME_FORWARD,a),o.subscribe(i.EVENT_MSG.GLOBAL_TIME_REWIND,s),o.subscribe(i.EVENT_MSG.GLOBAL_TIME_SET,l))},reset:function(){r.reset()},update:function(e){r.update(e)},goForward:a,goRewind:s,isCurrentDateTheFirst:function(){return r.isCurrentDateTheFirst()},isCurrentDateTheLast:function(){return r.isCurrentDateTheLast()},chooseTime:l,remove:function(){o.unsubscribe(i.EVENT_MSG.GLOBAL_TIME_FORWARD,a),o.unsubscribe(i.EVENT_MSG.GLOBAL_TIME_REWIND,s),o.unsubscribe(i.EVENT_MSG.GLOBAL_TIME_SET,l),document.getElementById(n).innerHTML=""},getCurrentDate:function(){return r.getCurrentDate()}}}),r("gw/Services/ServiceFactory",["../Utils/Constants","../Services/FitsVisu","../Services/FitsHips","../Services/HistogramCore","../Services/ImageProcessingCore","../Services/MeasureToolPlanetCore","../Services/MeasureToolSkyCore","../Services/MocBase","../Services/MollweideViewerCore","../Services/PickingManagerCore","../Services/SampCore","../Services/SelectionToolCore","../Services/ExportToolCore","../NameResolver/NameResolver","../ReverseNameResolver/ReverseNameResolver","../Services/TimeTravelCore"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g){return{create:function(m,v){var y;switch(m){case e.SERVICE.FitsVisu:y=t;break;case e.SERVICE.Histogram:y=r;break;case e.SERVICE.ImageProcessing:y=n;break;case e.SERVICE.MeasureToolPlanet:y=o;break;case e.SERVICE.MeasureToolSky:y=s;break;case e.SERVICE.MocBase:y=a;break;case e.SERVICE.MollweideViewer:y=l;break;case e.SERVICE.TimeTravel:y=g;break;case e.SERVICE.PickingManager:y=u;break;case e.SERVICE.Samp:y=c;break;case e.SERVICE.SelectionTool:y=new h(v);break;case e.SERVICE.NameResolver:y=p;break;case e.SERVICE.ReverseNameResolver:y=f;break;case e.SERVICE.ExportTool:y=d;break;case e.SERVICE.FitsHips:y=i;break;default:throw new RangeError("Cannot retrieve service "+m,"ServiceFactory.js")}return y}}}),r("gw/Tiling/GeoTiling",["../Utils/Utils","../Utils/Constants","../Utils/UtilsIntersection","./Tile","../Renderer/GeoBound","./HEALPixBase","../Renderer/glMatrix"],function(e,t,i,r,n,o){var s=function(e,i,n,o){r.prototype.constructor.call(this),this.bound=this.geoBound=e,this.level=i,this.x=n,this.y=o,this.key=this.level+"#"+this.x+"#"+this.y,this.type=t.TILE.GEO_TILE};(s.prototype=new r).getElevation=function(e,t){var i=(e-this.geoBound.getWest())/(this.geoBound.getEast()-this.geoBound.getWest()),n=(t-this.geoBound.getNorth())/(this.geoBound.getSouth()-this.geoBound.getNorth()),o=2*(n>=1?1:Math.floor(2*n))+Math.floor(2*i);if(this.children&&this.children[o]&&this.children[o].state===r.State.LOADED)return this.children[o].getElevation(e,t);var s=this.config.tesselation,a=Math.floor(i*s),l=Math.floor(n*s),u=this.config.vertexSize*(l*s+a),c=[this.vertices[u],this.vertices[u+1],this.vertices[u+2]];return mat4.multiplyVec3(this.matrix,c),this.config.coordinateSystem.getWorldFrom3D(c)[2]},s.prototype.getKey=function(){return this.key},s.prototype.createChildren=function(){var e=.5*(this.geoBound.getEast()+this.geoBound.getWest()),t=.5*(this.geoBound.getNorth()+this.geoBound.getSouth()),i=this.level+1,r=new s(new n(this.geoBound.getWest(),t,e,this.geoBound.getNorth()),i,2*this.x,2*this.y),o=new s(new n(e,t,this.geoBound.getEast(),this.geoBound.getNorth()),i,2*this.x+1,2*this.y),a=new s(new n(this.geoBound.getWest(),this.geoBound.getSouth(),e,t),i,2*this.x,2*this.y+1),l=new s(new n(e,this.geoBound.getSouth(),this.geoBound.getEast(),t),i,2*this.x+1,2*this.y+1);r.initFromParent(this,0,0),o.initFromParent(this,1,0),a.initFromParent(this,0,1),l.initFromParent(this,1,1),this.children=[r,o,a,l]},s.prototype.lonlat2tile=function(e){for(var t=this.geoBound.getEast()-this.geoBound.getWest(),i=this.geoBound.getSouth()-this.geoBound.getNorth(),r=this.config.tesselation-1,n=[],o=0;o<e.length;o++){var s=r*(e[o][0]-this.geoBound.getWest())/t,a=r*(e[o][1]-this.geoBound.getNorth())/i;n.push([s,a])}return n},s.prototype.generateVertices=function(e){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var t=mat4.create();mat4.inverse(this.matrix,t),this.inverseMatrix=t;for(var i=this.config.vertexSize,r=this.config.tesselation,n=new Float32Array(i*r*(r+6)),o=(this.geoBound.getEast()-this.geoBound.getWest())/(r-1),s=(this.geoBound.getSouth()-this.geoBound.getNorth())/(r-1),a=(this.config.coordinateSystem.getGeoide().getRadius(),this.config.coordinateSystem.getGeoide().getHeightScale(),0),l=this.geoBound.getNorth(),u=[0,0,0],c=0;c<r;c++){for(var h=this.geoBound.getWest(),d=0;d<r;d++){var p=e?e[a]:0;this.config.coordinateSystem.get3DFromWorld([h,l,p],u);var f=u[0],g=u[1],m=u[2],v=a*i;n[v]=t[0]*f+t[4]*g+t[8]*m+t[12],n[v+1]=t[1]*f+t[5]*g+t[9]*m+t[13],n[v+2]=t[2]*f+t[6]*g+t[10]*m+t[14],a++,h+=o}l+=s}return n};var a=function(e,t){this.level0NumTilesX=e,this.level0NumTilesY=t};a.prototype.generateLevelZeroTiles=function(e){e.skirt=!e.coordinateSystem.isFlat(),e.cullSign=1,e.srs="CRS:84";var t=[],i=(e.coordinateSystem.getGeoBound().getNorth()-e.coordinateSystem.getGeoBound().getSouth())/this.level0NumTilesY,r=(e.coordinateSystem.getGeoBound().getEast()-e.coordinateSystem.getGeoBound().getWest())/this.level0NumTilesX;this.latStart=e.coordinateSystem.getGeoBound().getSouth(),this.latDelta=e.coordinateSystem.getGeoBound().getNorth()-e.coordinateSystem.getGeoBound().getSouth();for(var o=0;o<this.level0NumTilesY;o++)for(var a=0;a<this.level0NumTilesX;a++){var l=new n(e.coordinateSystem.getGeoBound().getWest()+a*r,e.coordinateSystem.getGeoBound().getNorth()-(o+1)*i,e.coordinateSystem.getGeoBound().getWest()+(a+1)*r,e.coordinateSystem.getGeoBound().getNorth()-o*i),u=new s(l,0,a,o);u.config=e,t.push(u)}return t};return a.prototype._lon2LevelZeroIndex=function(e){return Math.min(this.level0NumTilesX-1,Math.floor((e+180)*this.level0NumTilesX/360))},a.prototype._lat2LevelZeroIndex=function(e){var t=this.latStart+this.latDelta;return Math.min(this.level0NumTilesY-1,Math.floor((t-e)*this.level0NumTilesY/this.latDelta))},a.prototype.lonlat2LevelZeroIndex=function(e,t){return this._lat2LevelZeroIndex(t)*this.level0NumTilesX+this._lon2LevelZeroIndex(e)},a.prototype.getOverlappedLevelZeroTiles=function(e){var r=[],n=function(e){var r,n=!0;switch(e.type){case t.GEOMETRY.Point:return[(r=e.coordinates)[0],r[1],r[0],r[1]];case t.GEOMETRY.MultiPoint:r=e.coordinates,n=!1;break;case t.GEOMETRY.Polygon:r=e.coordinates[0];break;case t.GEOMETRY.MultiPolygon:r=e.coordinates[0][0];break;case t.GEOMETRY.LineString:r=e.coordinates;break;case t.GEOMETRY.MultiLineString:r=e.coordinates[0]}if(r&&0!==r.length){for(var o=r[0][0],s=r[0][1],a=r[0][0],l=r[0][1],u=e.type===t.GEOMETRY.MultiPolygon||e.type===t.GEOMETRY.MultiLineString?e.coordinates.length:1,c=0;c<u;c++){switch(e.type){case t.GEOMETRY.MultiPolygon:r=e.coordinates[c][0];break;case t.GEOMETRY.MultiLineString:r=e.coordinates[c]}for(var h=0;h<r.length;h++)o=Math.min(o,r[h][0]),s=Math.min(s,r[h][1]),a=Math.max(a,r[h][0]),l=Math.max(l,r[h][1]),n&&h>0&&i.isCrossDateLine(r[h-1][0],r[h][0])&&(o=-180,a=180)}return[o,s,a,l]}}(e);if(n)for(var o=this._lon2LevelZeroIndex(n[0]),s=this._lat2LevelZeroIndex(n[3]),a=this._lon2LevelZeroIndex(n[2]),l=this._lat2LevelZeroIndex(n[1]),u=s;u<=l;u++)for(var c=o;c<=a;c++)r.push(u*this.level0NumTilesX+c);return r},a.prototype.findInsideTile=function(e,t,i){for(var r=null,n=0;n<i.length;n++){if(r=i[n],o.lonLat2pix(r.order,e,t)===r.pixelIndex)return r}for(n=0;n<i.length;n++){if(!0===(t<=(r=i[n]).bound.north&&t>=r.bound.south&&e<=r.bound.east&&e>=r.bound.west))return r}return null},a}),r("gw/Layer/WMSLayer",["jquery","../Utils/Utils","./AbstractLayer","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling","../Utils/UtilsIntersection"],function(e,t,i,r,n,o,s){var a=function(e){e.tilePixelSize=e.tilePixelSize||256,e.tiling=new o(4,2),e.numberOfLevels=e.numberOfLevels||21,e.transparent=e.transparent||!1,this.restrictTo=e.restrictTo,this.autoFillTimeTravel=e.autoFillTimeTravel,r.prototype.constructor.call(this,e.type,e),this.timeTravelValues=null,!0===this.autoFillTimeTravel&&this.containsDimension("time")&&this.generateTimeTravel(e.dimension.time),this.getMapBaseUrl=l.call(this,this.getBaseUrl(),this.tilePixelSize,this.tilePixelSize,e),this.layers=e.layers};function l(e,i,r,n){var o=e;for(var s in o=t.addParameterTo(o,"service","wms"),o=t.addParameterTo(o,"version",n.hasOwnProperty("version")?n.version:"1.3.0"),o=t.addParameterTo(o,"request","getMap"),o=t.addParameterTo(o,"layers",n.layers),o=t.addParameterTo(o,"styles",n.hasOwnProperty("styles")?n.styles:""),o=t.addParameterTo(o,"format",n.hasOwnProperty("format")?n.format:"image/jpeg"),n.hasOwnProperty("transparent")&&(o=t.addParameterTo(o,"transparent",n.transparent)),o=t.addParameterTo(o,"width",i),o=t.addParameterTo(o,"height",r),n.hasOwnProperty("time")&&(o=t.addParameterTo(o,"time",n.time)),this.imageLoadedAtTime)"time"!==s&&null!==this.imageLoadedAtTime[s]&&(o=t.addParameterTo(o,s,this.imageLoadedAtTime[s]));return o}return t.inherits(r,a),a.prototype.setTime=function(e){i.prototype.setTime(e),this.setParameter("time",e)},a.prototype.getLegend=function(){var e,t=this.metadataAPI;if(t.Style){var i=t.Style[0],r=i.Title,n=i.LegendURL[0].Format,o=i.LegendURL[0].OnlineResource,s=i.LegendURL[0].size;e=void 0===r||"default"===r?{}:{title:r,format:n,url:o,size:s}}else e={};return e},a.prototype.setVisible=function(e){if(r.prototype.setVisible.call(this,e),document.getElementById("legendDiv")){var t=this.getLegend();Object.keys(t).length>0&&(document.getElementById("legendDiv").innerHTML="",!0===e&&(document.getElementById("legendDiv").innerHTML="<div id='legendTxt' class='column'>"+t.title+"</div><div id='legendUrl' class='column'><img src='"+t.url+"'/></div>"))}},a.prototype.getUrl=function(e){var i,r,n=e.bound;return this.allowedHTTPRequest&&(this.isBackground()||function(e,t){return null==t||s.boundsIntersects(e,t)}(n,this.restrictTo))?(r=n.west+","+n.south+","+n.east+","+n.north,i=this.getMapBaseUrl,i=t.addParameterTo(i,"transparent",this.options.transparent),i=t.addParameterTo(i,"crs",e.config.srs),i=t.addParameterTo(i,"bbox",r)):i=null,this.allowRequest(i,e.level)},a.prototype.setParameter=function(e,t){this._hasToBeRefreshed(e,t)&&(this.options[e]=this.imageLoadedAtTime[e],this.getMapBaseUrl=l.call(this,this.getBaseUrl(),this.tilePixelSize,this.tilePixelSize,this.options),this.forceRefresh())},a}),r("gw/Registry/WMTSMetadata",[],function(){var e=function(r){this.serviceIdentification=new t(r.Capabilities.ServiceIdentification),this.serviceProvider=new i(r.Capabilities.ServiceProvider),this.contents=new a(r.Capabilities.Contents),this.serviceMetadataURL=e.getValueTag(r.Capabilities._attrhref)},t=function(t){void 0===t?(this.version=null,this.title=null,this.abstract=null,this.keywords=null,this.serviceType=null,this.fees=null,this.accessConstraints=null):(this.version=e.getValueTag(t._attrversion),this.title=e.getValueTag(t.Title),this.abstract=e.getValueTag(t.Abstract),this.keywords=e.parseKeywordList(t.Keywords),this.serviceType=e.getValueTag(t.ServiceType),this.fees=e.getValueTag(t.Fees),this.accessConstraints=e.parseAccessConstraints(t.AccessConstraints))},i=function(t){void 0===t?(this.providerName=null,this.providerSite=null,this.serviceContact=null):(this.providerName=e.getValueTag(t.ProviderName),this.providerSite=null,this.serviceContact=new r(t.ServiceContact))},r=function(t){void 0===t?(this.individualName=null,this.positionName=null,this.contactInfo=null,this.role=null):(this.individualName=e.getValueTag(t.IndividualName),this.positionName=e.getValueTag(t.PositionName),this.contactInfo=new n(t.ContactInfo),this.role=e.getValueTag(t.Role))},n=function(t){void 0===t?(this.phone=null,this.address=null,this.onlineResource=null,this.hoursOfService=null,this.contactInstructions=null):(this.phone=new o(t.Phone),this.address=new s(t.Address),this.onlineResource=null,this.hoursOfService=e.getValueTag(t.HoursOfService),this.contactInstructions=e.getValueTag(t.ContactInstructions))},o=function(t){void 0===t?(this.voice=null,this.facsimile=null):(this.voice=e.parseVoice(t.Voice),this.facsimile=e.parsePhone(t.Facsimile))},s=function(t){void 0===t?(this.deliveryPoint=null,this.city=null,this.administrativeArea=null,this.postalCode=null,this.country=null,this.electronicMailAddress=null):(this.deliveryPoint=e.getValueTag(t.DeliveryPoint),this.city=e.getValueTag(t.City),this.administrativeArea=e.getValueTag(t.AdministrativeArea),this.postalCode=e.getValueTag(t.PostalCode),this.country=e.getValueTag(t.Country),this.electronicMailAddress=e.getValueTag(t.ElectronicMailAddress))},a=function(t){void 0===t?(this.layers=null,this.tileMatrixSets=null):(this.layers=e.parseLayer(t.Layer),this.tileMatrixSets=new u(t.TileMatrixSet))},l=function(t){void 0===t?(this.identifier=null,this.format=null,this.infoFormat=null,this.style=null,this.tileMatrixSetLink=null,this.title=null,this.abstract=null,this.wgs84BoundingBox=null,this.boundingBox=null,this.keywords=null,this.metadata=null,this.datasetDescriptionSummary=null,this.otherSource=null,this.dimension=null,this.resourceURL=null):(this.identifier=e.getValueTag(t.Identifier),this.format=e.parseFormat(t.Format),this.infoFormat=null,this.style=null,this.tileMatrixSetLink=e.parseTileMatrixSetLink(t.TileMatrixSetLink),this.title=e.getValueTag(t.Title),this.abstract=e.getValueTag(t.Abstract),this.wgs84BoundingBox=e.parseWGS84BoundingBox(t.WGS84BoundingBox),this.boundingBox=e.parseBoundingBox(t.BoundingBox),this.keywords=e.parseKeywordList(t.Keywords),this.metadata=null,this.datasetDescriptionSummary=null,this.otherSource=null,this.dimension=null,this.resourceURL=null)},u=function(e){this.identifier=null,this.supportedCRS=null,this.wellKnownScaleSet=null,this.tileMatrix=null};return e.parseLayer=function(e){var t=[];if(void 0===e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)t.push(new l(e[i]));else t.push(new l(e));return t},e.parseTileMatrixSetLink=function(t){var i=[];if(void 0===t);else if(Array.isArray(t))for(var r=0;r<t.length;r++)i.push(e.getValueTag(t.TileMatrixSet[r]));else i.push(e.getValueTag(t.TileMatrixSet));return i},e.parseFormat=function(t){var i=[];if(void 0===t);else if(Array.isArray(t))for(var r=0;r<t.length;r++)i.push(e.getValueTag(t.Format[r]));else i.push(e.getValueTag(t));return i},e.getValueTag=function(t){return void 0!==t?t.hasOwnProperty("_text")?e.getText(t):e.getValue(t):null},e.getText=function(e){return e._text},e.getValue=function(e){return e._value},e.parseKeywordList=function(t){var i=[];if(void 0!==t&&t.hasOwnProperty("Keyword"))if(Array.isArray(t.Keyword))for(var r in t.Keyword)i.push(e.getValueTag(t.Keyword[r]));else i.push(e.getValueTag(t.Keyword));return i},e.parseVoice=function(t){var i=[];if(void 0!==t&&t.hasOwnProperty("Voice"))if(Array.isArray(t.Voice))for(var r in t.Voice)i.push(e.getValueTag(t.Voice[r]));else i.push(e.getValueTag(t.Voice));return i},e.parseFacsimile=function(t){var i=[];if(void 0!==t&&t.hasOwnProperty("Facsimile"))if(Array.isArray(t.Facsimile))for(var r in t.Facsimile)i.push(e.getValueTag(t.Facsimile[r]));else i.push(e.getValueTag(t.Facsimile));return i},e.parseAccessConstraints=function(t){var i=[];if(void 0!==t&&t.hasOwnProperty("AccessConstraints"))if(Array.isArray(t.AccessConstraints))for(var r in t.AccessConstraints)i.push(e.getValueTag(t.AccessConstraints[r]));else i.push(e.getValueTag(t.AccessConstraints));return i},e.parseWGS84BoundingBox=function(t){var i=[];if(void 0!==t)if(Array.isArray(t))for(var r in t)i.push({lowerCorner:e.getValueTag(r.LowerCorner),upperCorner:e.getValueTag(r.UpperCorner)});else i.push({lowerCorner:e.getValueTag(t.LowerCorner),upperCorner:e.getValueTag(t.UpperCorner)});return i},e.parseBoundingBox=function(t){var i=[];if(void 0!==t)if(Array.isArray(t))for(var r in t)i.push({lowerCorner:e.getValueTag(r.LowerCorner),upperCorner:e.getValueTag(r.UpperCorner)});else i.push({lowerCorner:e.getValueTag(t.LowerCorner),upperCorner:e.getValueTag(t.UpperCorner)});return i},e}),r("gw/Layer/WMTSLayer",["../Utils/Utils","./AbstractLayer","./AbstractRasterLayer","../Utils/Constants","../Registry/WMTSMetadata"],function(e,t,i,r,n){var o=function(e){i.prototype.constructor.call(this,r.LAYER.WMTS,e),this.getTileBaseUrl=s.call(this,this.getBaseUrl(),e),this.imageLoadedAtTime=null};function s(t,i){var r=t;for(var n in r=e.addParameterTo(r,"service","wmts"),r=e.addParameterTo(r,"version",i.version||"1.0.0"),r=e.addParameterTo(r,"request","GetTile"),r=e.addParameterTo(r,"layer",i.layers),r=e.addParameterTo(r,"tilematrixset","WGS84"),i.hasOwnProperty("style")&&(r=e.addParameterTo(r,"style",i.style)),r=e.addParameterTo(r,"format",i.hasOwnProperty("format")?i.format:"image/png"),i.hasOwnProperty("time")&&(r=e.addParameterTo(r,"time",i.time)),this.imageLoadedAtTime)"time"!==n&&null!==this.imageLoadedAtTime[n]&&(r=e.addParameterTo(r,n,this.imageLoadedAtTime[n]));return r}return e.inherits(i,o),o.prototype.setTime=function(e){t.prototype.setTime(e),this.setParameter("time",e)},o.getCapabilitiesFromBaseURl=function(t,i){var r=t;return r=e.addParameterTo(r,"service","WMTS"),r=e.addParameterTo(r,"request","getCapabilities"),r=e.addParameterTo(r,"version",i.hasOwnProperty("version")?i.version:"1.0.0")},o.prototype.getUrl=function(t){var i;return this.allowedHTTPRequest?(i=this.getTileBaseUrl,i=e.addParameterTo(i,"tilematrix",t.level+1),i=e.addParameterTo(i,"tilecol",t.x),i=e.addParameterTo(i,"tilerow",t.y)):i=null,this.allowRequest(i,t.level)},o.prototype.setParameter=function(e,t){this._hasToBeRefreshed(e,t)&&(this.options[e]=this.imageLoadedAtTime[e],this.getCoverageBaseUrl=s.call(this,this.getBaseUrl(),this.options),this.forceRefresh())},o}),r("gw/Layer/WCSElevationLayer",["../Utils/Utils","./AbstractLayer","./AbstractRasterLayer","../Utils/Constants","../Tiling/GeoTiling","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s=function(e){e.tilePixelSize=e.tilePixelSize||33,e.tiling=new n(4,2),e.numberOfLevels=e.numberOfLevels||21,e.version=e.version||"2.0.0",e.format=e.format||"image/x-aaigrid",e.minElevation=e.minElevation||0,e.scale=e.scale||1,e.scaleData=e.scaleData||1,e.crs=e.crs||"EPSG:4326",i.prototype.constructor.call(this,r.LAYER.WCSElevation,e),this.getCoverageBaseUrl=a.call(this,this.getBaseUrl(),e),this.level=null};function a(t,i){var r=t;switch(r=e.addParameterTo(r,"service","wcs"),r=e.addParameterTo(r,"version",i.version),r=e.addParameterTo(r,"request","GetCoverage"),i.version.substring(0,3)){case"2.0":r=e.addParameterTo(r,"outputCRS",i.crs),r=e.addParameterTo(r,"size","x("+i.tilePixelSize+")"),r=e.addParameterTo(r,"size","y("+i.tilePixelSize+")"),r=e.addParameterTo(r,"coverageid",i.coverage);break;case"1.0":r=e.addParameterTo(r,"width",i.tilePixelSize),r=e.addParameterTo(r,"height",i.tilePixelSize),r=e.addParameterTo(r,"crs",i.crs),r=e.addParameterTo(r,"coverage",i.coverage)}for(var n in r=e.addParameterTo(r,"format",i.format),i.hasOwnProperty("time")&&(r=e.addParameterTo(r,"time",i.time)),this.imageLoadedAtTime)"time"!==n&&null!==this.imageLoadedAtTime[n]&&(r=e.addParameterTo(r,n,this.imageLoadedAtTime[n]));return r}return e.inherits(i,s),s.prototype.parseElevations=function(e){if(null===e||null!=e.match("ServiceExceptionReport"))return this._returnZeroElevations();switch(this.options.format){case"image/x-aaigrid":return this._parseAAIGrid(e);default:return o.open(r.LEVEL.WARNING,"Format '"+this.format+"' could not be parsed."),this._returnZeroElevations()}},s.prototype._returnZeroElevations=function(){for(var e=[],t=0;t<this.options.tilePixelSize*this.options.tilePixelSize;++t)e.push(0);return e},s.prototype._parseAAIGrid=function(e){var t,i=[],r=e.trim().split("\n"),n=0,o=Number.NEGATIVE_INFINITY;for(t=0;t<r.length;++t){if(" "===r[t].substring(0,1)){n=t;break}"NODATA_value"===r[t].substring(0,1)&&(o=r[t].trim().split(/\s+/)[1])}var s=Number.NEGATIVE_INFINITY;for(t=n;t<r.length;t++)for(var a=r[t].trim().split(/\s+/),l=0;l<a.length;l++){var u;isNaN(a[l])||a[l]===o?u=s:s=u=parseFloat(a[l],10),u<this.options.minElevation&&(u=this.options.minElevation),i.push(u*this.options.scale*this.options.scaleData)}return i},s.prototype.isRequested=function(){return null!=this.level&&this.isBetweenMinMaxLevel(this.level)},s.prototype.getUrl=function(t){var i,r=t.geoBound;return this.allowedHTTPRequest?(i=this.getCoverageBaseUrl,"2.0"===this.options.version.substring(0,3)?(i=e.addParameterTo(i,"subset","x"+this.options.crs+"("+r.west+","+r.east+")"),i=e.addParameterTo(i,"subset","y"+this.options.crs+"("+r.south+","+r.north+")")):"1.0"===this.options.version.substring(0,3)&&(i=e.addParameterTo(i,"bbox",r.west+","+r.south+","+r.east+","+r.north)),this.level=t.level):(i=null,this.level=null),this.allowRequest(i,t.level)},s.prototype.setParameter=function(e,t){this._hasToBeRefreshed(e,t)&&(this.options[e]=this.imageLoadedAtTime[e],this.getCoverageBaseUrl=a.call(this,this.getBaseUrl(),this.options),this.forceRefresh())},s.prototype.getScale=function(){return this.options.scale},s.prototype.getScaleData=function(){return this.options.scaleData},s.prototype.setTime=function(e){t.prototype.setTime(e),this.setParameter("time",e)},s}),r("gw/Provider/AbstractProvider",["jquery"],function(e){var t=function(e){this.options=e};return t.prototype.loadFiles=function(e,t){},t.prototype.handleFeatures=function(e){},t}),r("gw/Provider/PlanetProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Constants"],function(e,t,i,r){var n,o,s,a=180/Math.PI,l=Math.PI/180,u=1e-12,c=new Array("Mercury","Venus","Sun","Mars","Jupiter","Saturn","Uranus","Neptune","Pluto");function h(e,t,n,o){var s;return s=t===r.GEOMETRY.Point?new i({iconUrl:e.style.iconUrl,strokeColor:i.fromStringToColor(o.color),fillColor:i.fromStringToColor(o.color)}):new i({label:n,strokeColor:i.fromStringToColor(o.color),fillColor:i.fromStringToColor(o.color)}),{geometry:{type:r.GEOMETRY.Point,gid:"planet"+t+"_"+n,coordinates:[o.ra,o.dec],crs:{type:"name",properties:{name:r.CRS.Equatorial}}},properties:{name:n,distance:function(e,t,i){var r,n=e.toFixed(i),o=n.length,s="";for(r=0;r<t-o;r++)s+=" ";for(r=0;r<o;r++)s+=n.charAt(r);return s}(o.rvec,9,6)+" AU",style:s}}}function d(){this.ra=parseFloat("0"),this.dec=parseFloat("0"),this.rvec=parseFloat("0")}function p(e,t,i,r,n){var o=r+n/60;return 367*e-Math.floor(7*(e+Math.floor((t+9)/12))/4)+Math.floor(275*t/9)+i-730531.5+o/24}function f(){this.color="",this.a=parseFloat("0"),this.e=parseFloat("0"),this.i=parseFloat("0"),this.O=parseFloat("0"),this.w=parseFloat("0"),this.L=parseFloat("0")}function g(e){var t=e/(2*Math.PI),i=2*Math.PI*(t-function(e){return e>=0?Math.floor(e):Math.ceil(e)}(t));return i<0&&(i=2*Math.PI+i),i}function m(e,t){var i,r,n=e+t*Math.sin(e)*(1+t*Math.cos(e));do{n=(r=n)-(r-t*Math.sin(r)-e)/(1-t*Math.cos(r))}while(Math.abs(n-r)>u);return(i=2*Math.atan(Math.sqrt((1+t)/(1-t))*Math.tan(.5*n)))<0&&(i+=2*Math.PI),i}function v(e,t,i){var r=i/36525;switch(t){case 0:e.color="rgb(170,150,170)",e.a=.38709893+6.6e-7*r,e.e=.20563069+2527e-8*r,e.i=(7.00487-23.51*r/3600)*l,e.O=(48.33167-446.3*r/3600)*l,e.w=(77.45645+573.57*r/3600)*l,e.L=g((252.25084+538101628.29*r/3600)*l);break;case 1:e.color="rgb(245,222,179)",e.a=.72333199+9.2e-7*r,e.e=.00677323-4938e-8*r,e.i=(3.39471-2.86*r/3600)*l,e.O=(76.68069-996.89*r/3600)*l,e.w=(131.53298-108.8*r/3600)*l,e.L=g((181.97973+210664136.06*r/3600)*l);break;case 2:e.color="rgb(255,193,37)",e.a=1.00000011-5e-8*r,e.e=.01671022-3804e-8*r,e.i=(5e-5-46.94*r/3600)*l,e.O=(-11.26064-18228.25*r/3600)*l,e.w=(102.94719+1198.28*r/3600)*l,e.L=g((100.46435+129597740.63*r/3600)*l);break;case 3:e.color="rgb(255,50,50)",e.a=1.52366231-7221e-8*r,e.e=.09341233+11902e-8*r,e.i=(1.85061-25.47*r/3600)*l,e.O=(49.57854-1020.19*r/3600)*l,e.w=(336.04084+1560.78*r/3600)*l,e.L=g((355.45332+68905103.78*r/3600)*l);break;case 4:e.color="rgb(255,150,150)",e.a=5.20336301+60737e-8*r,e.e=.04839266-1288e-7*r,e.i=(1.3053-4.15*r/3600)*l,e.O=(100.55615+1217.17*r/3600)*l,e.w=(14.75385+839.93*r/3600)*l,e.L=g((34.40438+10925078.35*r/3600)*l);break;case 5:e.color="rgb(200,150,150)",e.a=9.53707032-.0030153*r,e.e=.0541506-36762e-8*r,e.i=(2.48446+6.11*r/3600)*l,e.O=(113.71504-1591.05*r/3600)*l,e.w=(92.43194-1948.89*r/3600)*l,e.L=g((49.94432+4401052.95*r/3600)*l);break;case 6:e.color="rgb(130,150,255)",e.a=19.19126393+.00152025*r,e.e=.04716771-1915e-7*r,e.i=(.76986-2.09*r/3600)*l,e.O=(74.22988-1681.4*r/3600)*l,e.w=(170.96424+1312.56*r/3600)*l,e.L=g((313.23218+1542547.79*r/3600)*l);break;case 7:e.color="rgb(100,100,255)",e.a=30.06896348-.00125196*r,e.e=.00858587+251e-7*r,e.i=(1.76917-3.64*r/3600)*l,e.O=(131.72169-151.25*r/3600)*l,e.w=(44.97135-844.43*r/3600)*l,e.L=g((304.88003+786449.21*r/3600)*l);break;case 8:e.color="rgb(100,100,255)",e.a=39.48168677-76912e-8*r,e.e=.24880766+6465e-8*r,e.i=(17.14175+11.07*r/3600)*l,e.O=(110.30347-37.33*r/3600)*l,e.w=(224.06676-132.25*r/3600)*l,e.L=g((238.92881+522747.9*r/3600)*l);break;default:throw RangeError("function mean_elements() failed!","PlanetProvider.js")}}function y(e,t,i){var r=new f;v(r,t,i);var n=r.a,o=r.e,s=r.i,u=r.O,c=r.w,h=r.L,d=new f;v(d,2,i);var p=d.a,y=d.e,b=d.w,x=m(g(d.L-b),y),w=p*(1-y*y)/(1+y*Math.cos(x)),T=w*Math.cos(x+b),_=w*Math.sin(x+b),C=m(g(h-c),r.e),S=n*(1-o*o)/(1+o*Math.cos(C)),E=S*(Math.cos(u)*Math.cos(C+c-u)-Math.sin(u)*Math.sin(C+c-u)*Math.cos(s)),A=S*(Math.sin(u)*Math.cos(C+c-u)+Math.cos(u)*Math.sin(C+c-u)*Math.cos(s)),I=S*(Math.sin(C+c-u)*Math.sin(s));2===t&&(E=0,A=0,I=0);var M=A-_,k=I-0,D=23.439281*l,R=E-T,P=M*Math.cos(D)-k*Math.sin(D),L=M*Math.sin(D)+k*Math.cos(D);e.ra=g(Math.atan2(P,R))*a,e.dec=Math.atan(L/Math.sqrt(R*R+P*P))*a,e.rvec=Math.sqrt(R*R+P*P+L*L),e.color=r.color}var b=function(e){for(var t=[],i=new Date,n=p(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes()+i.getUTCSeconds()/60),o=new d,a=0;a<9;a++){y(o,a,n);var l=h(e,"Label",c[a],o);t.push(l);var u=h(e,r.GEOMETRY.Point,c[a],o);t.push(u)}s={type:"FeatureCollection",features:t},e.addFeatureCollection(s)},x=function(e){t.prototype.constructor.call(this,e),n=this};return x.prototype.loadFiles=function(e,t){o=t.interval?t.interval:6e4,n.handleFeatures(e)},x.prototype.handleFeatures=function(e){b(e),setInterval(function(){e.removeFeatureCollection(s),b(e)},o)},x.prototype.getSunPosition=function(e){var t=p(e.getUTCFullYear(),e.getUTCMonth()+1,e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes()+e.getUTCSeconds()/60),i=new d;return y(i,2,t),i},x}),r("gw/Layer/AtmosphereLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Provider/PlanetProvider","../Renderer/Program","../Time/Time"],function(e,t,i,r,n,o){var s=function(e){var r=new Date,n=new Date;n.setDate(r.getDate()+1),e.dimension={time:{units:"ISO8601",unitSymbol:null,default:null,multipleValues:null,nearestValue:null,current:null,value:r.toISOString()+"/"+n.toISOString()+"/PT1H"}},e.zIndex=i.DISPLAY.RENDERING,t.prototype.constructor.call(this,i.LAYER.Atmosphere,e),this.name||(this.name="Atmosphere"),this.kr=e&&e.kr||.0025,this.km=e&&e.km||.0015,this.sunBrightness=e&&e.sunBrightness||15,this.exposure=e&&e.exposure||2,this.wavelength=e&&e.wavelength||[.65,.57,.475],this.lightDir=e&&e.lightDir||a.call(this,new Date),this._skyProgram=null,this._groundProgram=null,this._originalProgram=null,this._isValid=!1};function a(t){var i=(new r).getSunPosition(t),n=i.dec,o=-e.GHA(t,i.ra),s=e.longLat2XYZ(o,n);return[s.x,s.y,s.z]}return e.inherits(t,s),s.prototype.getInformationType=function(){return i.INFORMATION_TYPE.ATMOSPHERE},s.prototype._attach=function(e){this.globe=e,this._innerRadius=this.getGlobe().getCoordinateSystem().getGeoide().getRadius(),this._outerRadius=1.005*this._innerRadius;var t=e.getRenderContext();if(this._skyFromSpaceProgram=new n(t),this._skyFromSpaceProgram.loadFromFile("SkyFromSpaceVert.glsl","SkyFrag.glsl"),this._skyFromAtmosphereProgram=new n(t),this._skyFromAtmosphereProgram.loadFromFile("SkyFromAtmosphereVert.glsl","SkyFrag.glsl"),this._groundFromSpaceProgram=new n(t),this._groundFromSpaceProgram.loadFromFile("GroundFromSpaceVert.glsl","GroundFrag.glsl"),this._groundFromAtmosphereProgram=new n(t),this._groundFromAtmosphereProgram.loadFromFile("GroundFromAtmosphereVert.glsl","GroundFrag.glsl"),this._isValid=null!==this._skyFromSpaceProgram.glProgram&&null!==this._skyFromAtmosphereProgram.glProgram&&null!==this._groundFromSpaceProgram.glProgram&&null!==this._groundFromAtmosphereProgram.glProgram,this._isValid){this._skyFromSpaceProgram.apply(),this._initUniforms(this._skyFromSpaceProgram.uniforms),this._skyFromAtmosphereProgram.apply(),this._initUniforms(this._skyFromAtmosphereProgram.uniforms),this._groundFromSpaceProgram.apply(),this._initUniforms(this._groundFromSpaceProgram.uniforms),this._groundFromAtmosphereProgram.apply(),this._initUniforms(this._groundFromAtmosphereProgram.uniforms);var i,r,o=[],s=[];for(i=-72;i<=72;i++){var a=i*(.5*Math.PI)/72;for(r=-144;r<=144;r++){var l=r*Math.PI/144,u=this._outerRadius*Math.cos(l)*Math.cos(a),c=this._outerRadius*Math.sin(l)*Math.cos(a),h=this._outerRadius*Math.sin(a);o.push(u),o.push(c),o.push(h)}}for(i=0;i<144;i++)for(r=0;r<288;r++)s.push(289*i+r),s.push(289*(i+1)+r+1),s.push(289*i+r+1),s.push(289*(i+1)+r+1),s.push(289*i+r),s.push(289*(i+1)+r);var d=t.gl;this._vertexBuffer=d.createBuffer(),d.bindBuffer(d.ARRAY_BUFFER,this._vertexBuffer),d.bufferData(d.ARRAY_BUFFER,new Float32Array(o),d.STATIC_DRAW),this._indexBuffer=d.createBuffer(),d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,this._indexBuffer),d.bufferData(d.ELEMENT_ARRAY_BUFFER,new Uint16Array(s),d.STATIC_DRAW),this._numIndices=s.length,this._originalProgram=e.getTileManager().program,e.preRenderers.push(this),e.getTileManager().addPostRenderer(this)}},s.prototype._initUniforms=function(e){var t=this.getGlobe().getRenderContext().gl,i=-.95,r=1/(this._outerRadius-this._innerRadius);vec3.normalize(this.lightDir),t.uniform1f(e.fKrESun,this.kr*this.sunBrightness),t.uniform1f(e.fKmESun,this.kr*this.sunBrightness),t.uniform1f(e.fKr4PI,4*this.kr*Math.PI),t.uniform1f(e.fKm4PI,4*this.km*Math.PI),t.uniform1f(e.fExposure,this.exposure);var n=[Math.pow(this.wavelength[0],4),Math.pow(this.wavelength[1],4),Math.pow(this.wavelength[2],4)];t.uniform3f(e.v3InvWavelength,1/n[0],1/n[1],1/n[2]),t.uniform3f(e.v3LightPos,this.lightDir[0],this.lightDir[1],this.lightDir[2]),t.uniform1f(e.fInnerRadius,this._innerRadius),t.uniform1f(e.fInnerRadius2,this._innerRadius*this._innerRadius),t.uniform1f(e.fOuterRadius,this._outerRadius),t.uniform1f(e.fOuterRadius2,this._outerRadius*this._outerRadius),t.uniform1f(e.fScale,r),t.uniform1f(e.fScaleDepth,.25),t.uniform1f(e.fScaleOverScaleDepth,r/.25),t.uniform1f(e.g,i),t.uniform1f(e.g2,i*i)},s.prototype.preRender=function(){if(this._isValid){var e=this.getGlobe().getTileManager();if(this.isVisible()){var t,i,r,n=this.getGlobe().getRenderContext(),o=n.gl,s=n.viewMatrix;t=s[12],i=s[13],r=s[14];var a=[-(s[0]*t+s[1]*i+s[2]*r),-(s[4]*t+s[5]*i+s[6]*r),-(s[8]*t+s[9]*i+s[10]*r)],l=vec3.length(a);this._skyProgram=l<this._outerRadius?this._skyFromAtmosphereProgram:this._skyFromSpaceProgram,this._groundProgram=l<this._outerRadius?this._groundFromAtmosphereProgram:this._groundFromSpaceProgram,this._skyProgram.apply(),o.uniform3f(this._skyProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),o.uniform1f(this._skyProgram.uniforms.fCameraHeight2,l*l),o.uniform1f(this._skyProgram.uniforms.fCameraHeight,l),this._groundProgram.apply();var u=[0,0,0];mat4.multiplyVec3(n.viewMatrix,u),o.uniform3f(this._groundProgram.uniforms.earthCenter,u[0],u[1],u[2]),vec3.normalize(this.lightDir),t=this.lightDir[0],i=this.lightDir[1],r=this.lightDir[2];var c=n.viewMatrix,h=[];h[0]=c[0]*t+c[4]*i+c[8]*r,h[1]=c[1]*t+c[5]*i+c[9]*r,h[2]=c[2]*t+c[6]*i+c[10]*r,o.uniform3f(this._groundProgram.uniforms.lightDir,h[0],h[1],h[2]),o.uniform3f(this._groundProgram.uniforms.v3CameraPos,a[0],a[1],a[2]),o.uniform1f(this._groundProgram.uniforms.fCameraHeight2,l*l),o.uniform1f(this._groundProgram.uniforms.fCameraHeight,l),e.program=this._groundProgram}else e.program=this._originalProgram}},s.prototype.render=function(){if(this._isValid&&this.isVisible()&&this.getGlobe()){var e=this.getGlobe().getRenderContext(),t=e.gl;t.enable(t.CULL_FACE),this._skyProgram.apply(),t.uniformMatrix4fv(this._skyProgram.uniforms.projectionMatrix,!1,e.projectionMatrix),t.uniformMatrix4fv(this._skyProgram.uniforms.viewMatrix,!1,e.viewMatrix),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(this._skyProgram.attributes.vertex,3,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.drawElements(t.TRIANGLES,this._numIndices,t.UNSIGNED_SHORT,0),t.disable(t.CULL_FACE)}},s.prototype.setTime=function(e){t.prototype.setTime(e),this.setParameter("time",e)},s.prototype.setParameter=function(e,t){if("time"===e){var i=o.parse(t),r=new Date(i.date);this.lightDir=a.call(this,r),this._skyFromSpaceProgram.apply(),this._initUniforms(this._skyFromSpaceProgram.uniforms),this._skyFromAtmosphereProgram.apply(),this._initUniforms(this._skyFromAtmosphereProgram.uniforms),this._groundFromSpaceProgram.apply(),this._initUniforms(this._groundFromSpaceProgram.uniforms),this._groundFromAtmosphereProgram.apply(),this._initUniforms(this._groundFromAtmosphereProgram.uniforms),this.forceRefresh()}},s}),r("gw/Tiling/MercatorTiling",["./Tile","../Utils/Constants","../Renderer/GeoBound","./GeoTiling"],function(e,t,i,r){var n=function(e){return 20037508.34*e/180},o=function(e){return 20037508.34*(Math.log(Math.tan((90+e)*Math.PI/360))/(Math.PI/180))/180},s=function(e,t){return e/Math.pow(2,t)*360-180},a=function(e,t){var i=Math.PI-2*Math.PI*e/Math.pow(2,t);return 180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))},l=function(r,l,u){e.prototype.constructor.call(this),this.level=r,this.x=l,this.y=u,this.key=this.level+"#"+this.x+"#"+this.y,this.type=t.TILE.MERCATOR_TILE,this.geoBound=new i(s(l,r),a(u+1,r),s(l+1,r),a(u,r)),this.bound=new i(n(this.geoBound.west),o(this.geoBound.south),n(this.geoBound.east),o(this.geoBound.north))};(l.prototype=new e).getElevation=function(e,t){return 0},l.prototype.getKey=function(){return this.key},l.prototype.createChildren=function(){var e=new l(this.level+1,2*this.x,2*this.y),t=new l(this.level+1,2*this.x+1,2*this.y),i=new l(this.level+1,2*this.x,2*this.y+1),r=new l(this.level+1,2*this.x+1,2*this.y+1);e.initFromParent(this,0,0),t.initFromParent(this,1,0),i.initFromParent(this,0,1),r.initFromParent(this,1,1),this.children=[e,t,i,r]},l.prototype.lonlat2tile=function(e){for(var t=Math.pow(2,this.level),i=this.config.tesselation-1,r=[],n=0;n<e.length;n++){var o=(e[n][0]+180)/360,s=Math.sin(e[n][1]*Math.PI/180),a=.5-Math.log((1+s)/(1-s))/(4*Math.PI);r.push([i*(o*t-this.x),i*(a*t-this.y)])}return r},l.prototype.generateVertices=function(e){this.matrix=this.config.coordinateSystem.getLHVTransform(this.geoBound.getCenter());var t=mat4.create();mat4.inverse(this.matrix,t),this.inverseMatrix=t;for(var i=this.config.tesselation,r=new Float32Array(3*i*(i+6)),n=1/(i-1),o=(this.config.coordinateSystem.geoide.radius,this.config.coordinateSystem.geoide.heightScale),s=0,a=Math.pow(2,this.level),l=[0,0,0],u=this.y,c=0;c<i;c++){var h=Math.PI*(1-2*u/a),d=Math.atan(.5*(Math.exp(h)-Math.exp(-h)));d=180*d/Math.PI;Math.cos(d),Math.sin(d);for(var p=this.x,f=0;f<i;f++){var g=180*(2*p/a-1),m=e?o*e[s]:0;this.config.coordinateSystem.fromGeoTo3D([g,d,m],l);var v=l[0],y=l[1],b=l[2],x=3*s;r[x]=t[0]*v+t[4]*y+t[8]*b+t[12],r[x+1]=t[1]*v+t[5]*y+t[9]*b+t[13],r[x+2]=t[2]*v+t[6]*y+t[10]*b+t[14],s++,p+=n}u+=n}return r},l.prototype.buildSkirtVertices=function(t,i,r,n){var o=this.config.tesselation,s=this.config.vertexSize,a=Math.pow(2,this.level),l=0===this.y&&n===s*(o*o),u=this.y===a-1&&n===s*((o+1)*o);if(l||u){var c=this.vertices,h=this.config.coordinateSystem.fromGeoTo3D(l?[0,90,0]:[0,-90,0]);mat4.multiplyVec3(this.inverseMatrix,h);for(var d=0;d<o;d++){c[n]=h[0],c[n+1]=h[1],c[n+2]=h[2];for(var p=3;p<s;p++)c[n+p]=c[i+p];n+=s}}else e.prototype.buildSkirtVertices.call(this,t,i,r,n)};var u=function(e){this.startLevel=e,this.level0NumTilesX=Math.pow(2,this.startLevel)};return(u.prototype=new r).generateLevelZeroTiles=function(e){e.skirt=!e.coordinateSystem.isFlat(),e.cullSign=1,e.srs="EPSG:3857",e.project=function(e){return[n(e[0]),o(e[1])]};for(var t=[],i=Math.pow(2,this.startLevel),r=Math.pow(2,this.startLevel),s=0;s<r;s++)for(var a=0;a<i;a++){var u=new l(this.startLevel,a,s);u.config=e,t.push(u)}return t},u.prototype._lon2LevelZeroIndex=function(e){var t=(e+180)/360;return Math.min(this.level0NumTilesX-1,Math.floor(t*this.level0NumTilesX))},u.prototype._lat2LevelZeroIndex=function(e){var t=Math.sin(e*Math.PI/180),i=.5-Math.log((1+t)/(1-t))/(4*Math.PI);return Math.min(this.level0NumTilesX-1,Math.floor(i*this.level0NumTilesX))},u}),r("gw/Layer/BingLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling","../Utils/Proxy"],function(e,t,i,r,n){var o=function(){var e=-85.05112878,t=85.05112878,i=-180,r=180;function n(e,t,i){return Math.min(Math.max(e,t),i)}function o(e){return 256<<e}return{tileXYToQuadKey:function(e,t,i){for(var r="",n=i;n>0;n--){var o="0",s=1<<n-1;0!=(e&s)&&o++,0!=(t&s)&&(o++,o++),r+=o}return r},latLongToPixelXY:function(s,a,l){s=n(s,e,t);var u=((a=n(a,i,r))+180)/360,c=Math.sin(s*Math.PI/180),h=.5-Math.log((1+c)/(1-c))/(4*Math.PI),d=o(l),p=n(u*d+.5,0,d-1),f=n(h*d+.5,0,d-1);return[Math.floor(p),Math.floor(f)]}}}(),s=function(e){t.prototype.constructor.call(this,i.LAYER.Bing,e),this.tilePixelSize=256,this.tiling=new r(e.baseLevel||2),this.numberOfLevels=18,this.baseUrl="",this.baseUrlSubDomains=[],this._ready=!1;var o=this;window._bingTileProviderCallback=function(t){o.baseUrl=n.proxify(t.resourceSets[0].resources[0].imageUrl),o.baseUrlSubDomains=n.proxify(t.resourceSets[0].resources[0].imageUrlSubdomains),o._ready=!0,e.onready&&e.onready instanceof Function&&e.onready(o),o.globe&&o.globe.getRenderContext().requestFrame()};var s=document.createElement("script");s.type="text/javascript",s.src=n.proxify("http://dev.virtualearth.net/REST/V1/Imagery/Metadata/"+e.imageSet+"?jsonp=_bingTileProviderCallback&key="+e.key),s.id="_bingTileProviderCallback",document.getElementsByTagName("head")[0].appendChild(s)};return e.inherits(t,s),s.prototype.getUrl=function(e){var t=this.baseUrl.replace("{quadkey}",o.tileXYToQuadKey(e.x,e.y,e.level));return t=t.replace("{subdomain}",this.baseUrlSubDomains[Math.floor(Math.random()*this.baseUrlSubDomains.length)]),this.allowRequest(t,e.level)},s}),r("gw/Layer/OSMLayer",["../Utils/Utils","./AbstractRasterLayer","../Utils/Constants","../Tiling/MercatorTiling"],function(e,t,i,r){var n=function(e){e.tilePixelSize=e.tilePixelSize||256,e.tiling=new r(e.baseLevel||2),e.numberOfLevels=e.numberOfLevels||21,t.prototype.constructor.call(this,i.LAYER.OSM,e)};return e.inherits(t,n),n.prototype.getUrl=function(e){var t=this.baseUrl+"/"+e.level+"/"+e.x+"/"+e.y+".png";return this.allowRequest(t,e.level)},n}),r("gw/Layer/TileWireframeLayer",["../Utils/Utils","./AbstractLayer","../Utils/Constants","../Renderer/Program","../Tiling/Tile"],function(e,t,i,r,n){var o=function(e){e.zIndex=i.DISPLAY.RENDERING,t.prototype.constructor.call(this,i.LAYER.TileWireframe,e),this.outline=!(!e||!e.outline)&&e.outline,this.globe=null,this.program=null,this.indexBuffer=null,this.subIndexBuffer=[null,null,null,null]};return e.inherits(t,o),o.prototype.getInformationType=function(){return i.INFORMATION_TYPE.VECTOR},o.prototype.buildIndexBuffer=function(){var e,t,i,r,n,o,s=this.getGlobe().getRenderContext().gl,a=this.getGlobe().getTileManager().tileConfig.tesselation,l=[],u=this.outline?a-1:1;for(t=0;t<a;t+=u)for(e=0;e<a-1;e++)l.push(t*a+e),l.push(t*a+e+1);for(t=0;t<a;t+=u)for(e=0;e<a-1;e++)l.push(e*a+t),l.push((e+1)*a+t);o=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),s.STATIC_DRAW),o.numIndices=l.length,this.indexBuffer=o;var c=(a-1)/2;for(u=this.outline?c:1,i=0;i<4;i++){for(e=i%2,l=[],r=c*(t=Math.floor(i/2));r<c*(t+1)+1;r+=u)for(n=c*e;n<c*(e+1);n++)l.push(r*a+n),l.push(r*a+n+1);for(r=c*e;r<c*(e+1)+1;r+=u)for(n=c*t;n<c*(t+1);n++)l.push(n*a+r),l.push((n+1)*a+r);o=s.createBuffer(),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,o),s.bufferData(s.ELEMENT_ARRAY_BUFFER,new Uint16Array(l),s.STATIC_DRAW),o.numIndices=l.length,this.subIndexBuffer[i]=o}},o.prototype._attach=function(e){if(t.prototype._attach.call(this,e),this.isVisible()&&this.getGlobe().getTileManager().addPostRenderer(this),!this.program){"uniform mat4 modelViewMatrix;\n","uniform mat4 projectionMatrix;\n","void main(void) \n","{\n","\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n","}\n";"uniform vec3 color; \n","uniform float alpha; \n","void main(void)\n","{\n","\tgl_FragColor = vec4(color,alpha);\n","}\n",this.program=new r(this.getGlobe().getRenderContext()),this.program.createFromSource("attribute vec3 vertex;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nvoid main(void) \n{\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n}\n","precision highp float; \nuniform vec3 color; \nuniform float alpha; \nvoid main(void)\n{\n\tgl_FragColor = vec4(color,alpha);\n}\n"),this.buildIndexBuffer()}},o.prototype._detach=function(){this.getGlobe().getTileManager().removePostRenderer(this),t.prototype._detach.call(this)},o.prototype.render=function(e){var t=this.getGlobe().getRenderContext(),i=t.gl;i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),i.depthFunc(i.LEQUAL),this.program.apply(),i.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,t.projectionMatrix);for(var r=this.program.attributes.vertex,o=null,s=0;s<e.length;s++){var a=e[s],l=a.state===n.State.LOADED,u=-1===a.parentIndex;mat4.multiply(t.viewMatrix,a.matrix,t.modelViewMatrix),i.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,t.modelViewMatrix);var c=this.getStyle().getStrokeColor();i.uniform3f(this.program.uniforms.color,c[0],c[1],c[2]),i.uniform1f(this.program.uniforms.alpha,this.getOpacity()),i.bindBuffer(i.ARRAY_BUFFER,a.vertexBuffer),i.vertexAttribPointer(r,3,i.FLOAT,!1,4*a.config.vertexSize,0);var h=l||u?this.indexBuffer:this.subIndexBuffer[a.parentIndex];o!==h&&(i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,h),o=h);var d=o.numIndices;i.drawElements(i.LINES,d,i.UNSIGNED_SHORT,0)}i.disable(i.BLEND),i.depthFunc(i.LESS)},o.prototype.setVisible=function(e){return t.prototype.setVisible.call(this,e),"boolean"==typeof e&&(this.isVisible()?this.getGlobe().getTileManager().addPostRenderer(this):this.getGlobe().getTileManager().removePostRenderer(this)),this.isVisible()},o}),r("gw/Tiling/Mesh",[],function(){var e=function(e){this.renderContext=e,this.vertexBuffer=null,this.tcoordBuffer=null,this.indexBuffer=null,this.colorBuffer=null,this.numVertices=0,this.mode=e.gl.TRIANGLES};return e.prototype.setVertices=function(e){var t=this.renderContext.gl;null===this.vertexBuffer&&(this.vertexBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),this.numVertices=e.length},e.prototype.setTexCoords=function(e){var t=this.renderContext.gl;null===this.tcoordBuffer&&(this.tcoordBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.tcoordBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)},e.prototype.setColors=function(e){var t=this.renderContext.gl;null===this.colorBuffer&&(this.colorBuffer=t.createBuffer()),t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)},e.prototype.setIndices=function(e){var t=this.renderContext.gl;null===this.indexBuffer&&(this.indexBuffer=t.createBuffer()),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),t.STATIC_DRAW),this.numIndices=e.length},e.prototype.setIndicesToWireframe=function(e){this.mode=this.renderContext.gl.LINES;var t=[];t.length=2*e.length;for(var i=0;i<e.length;i+=3)t[2*i]=e[i],t[2*i+1]=e[i+1],t[2*i+2]=e[i+1],t[2*i+3]=e[i+2],t[2*i+4]=e[i+2],t[2*i+5]=e[i];this.setIndices(t)},e.prototype.render=function(e){var t=this.renderContext.gl;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.vertexAttribPointer(e.vertex,3,t.FLOAT,!1,0,0),e.hasOwnProperty("tcoord")&&(t.bindBuffer(t.ARRAY_BUFFER,this.tcoordBuffer),t.vertexAttribPointer(e.tcoord,2,t.FLOAT,!1,0,0)),e.hasOwnProperty("color")&&(t.bindBuffer(t.ARRAY_BUFFER,this.colorBuffer),t.vertexAttribPointer(e.color,4,t.FLOAT,!1,0,0)),this.indexBuffer?(t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer),t.drawElements(this.mode,this.numIndices,t.UNSIGNED_SHORT,0)):t.drawArrays(this.mode,0,this.numVertices/3)},e.prototype.dispose=function(){var e=this.renderContext.gl;this.indexBuffer&&e.deleteBuffer(this.indexBuffer),this.vertexBuffer&&e.deleteBuffer(this.vertexBuffer),this.tcoordBuffer&&e.deleteBuffer(this.tcoordBuffer),this.colorBuffer&&e.deleteBuffer(this.colorBuffer),this.indexBuffer=null,this.vertexBuffer=null,this.tcoordBuffer=null,this.colorBuffer=null},e}),r("gw/Layer/CoordinateGridLayer",["./AbstractLayer","../Utils/Utils","../Renderer/Ray","../Renderer/Program","../Tiling/Mesh","../Renderer/FeatureStyle","../Utils/Constants","../Crs/CoordinateSystemFactory","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l){var u=function(e){var t=e,i=[];this.createGLTexture=function(e){return i.length>0?function(e){var r=i.pop();return t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),r}(e):function(e){var i=t.createTexture();return t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i}(e)},this.disposeGLTexture=function(e){i.push(e)},this.disposeAll=function(){for(var e=0;e<i.length;e++)t.deleteTexture(i[e]);i.length=0}},c=function(t){e.prototype.constructor.call(this,s.LAYER.CoordinateGrid,t),this.globe=null,this.labels={},this.texturePool=null,this.longitudeSample=t.longitudeSample||15,this.latitudeSample=t.latitudeSample||10,this.canvas2d=document.createElement("canvas"),this.canvas2d.width=100,this.canvas2d.height=20,this.vertexBuffer=null,this.indexBuffer=null,this.gridCrs=a.create(t.coordinateSystem),this.longFormat=t.longFormat?t.longFormat:"Deg",this.latFormat=t.latFormat?t.latFormat:"Deg",this.geoBound={},this.tesselation=t.tesselation||2};return t.inherits(e,c),c.prototype.getInformationType=function(){return s.INFORMATION_TYPE.VECTOR},c.prototype.generateImageData=function(e){var t=this.canvas2d.getContext("2d");t.clearRect(0,0,this.canvas2d.width,this.canvas2d.height),t.fillStyle=o.fromColorToString(this.getStyle().getStrokeColor()),t.font="18px sans-serif",t.textBaseline="top",t.textAlign="center";var i=this.canvas2d.width/2;return t.fillText(e,i,0),t.getImageData(0,0,this.canvas2d.width,this.canvas2d.height)},c.prototype._attach=function(t){if(e.prototype._attach.call(this,t),this.isVisible()&&this.getGlobe().getTileManager().addPostRenderer(this),!this.gridProgram){"uniform mat4 viewProjectionMatrix;\n","void main(void) \n","{\n","gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n","}\n";"uniform float alpha; \n","uniform vec3 color; \n","void main(void)\n","{\n","gl_FragColor = vec4(color,alpha);\n","}\n";"uniform mat4 viewProjectionMatrix; \n","uniform vec3 poiPosition; // world position \n","uniform vec2 poiScale; // x,y scale \n","\n","varying vec2 texCoord; \n","\n","void main(void)  \n","{ \n","// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n","texCoord = vertex.xy + vec2(0.5); \n","// Invert y \n","texCoord.y = 1.0 - texCoord.y; \n","\n","// Compute poi position in clip coordinate \n","gl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n","gl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n","} \n";"precision highp float; \n","#endif \n","\n","varying vec2 texCoord; \n","uniform sampler2D texture; \n","uniform float alpha; \n","\n","void main(void) \n","{ \n","\tvec4 textureColor = texture2D(texture, texCoord); \n","\tgl_FragColor = vec4(textureColor.rgb, textureColor.a * alpha); \n","} \n",this.gridProgram=new r(this.getGlobe().getRenderContext()),this.labelProgram=new r(this.getGlobe().getRenderContext()),this.gridProgram.createFromSource("attribute vec3 vertex;\nuniform mat4 viewProjectionMatrix;\nvoid main(void) \n{\ngl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n}\n","precision highp float; \nuniform float alpha; \nuniform vec3 color; \nvoid main(void)\n{\ngl_FragColor = vec4(color,alpha);\n}\n"),this.labelProgram.createFromSource("attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \nuniform mat4 viewProjectionMatrix; \nuniform vec3 poiPosition; // world position \nuniform vec2 poiScale; // x,y scale \n\nvarying vec2 texCoord; \n\nvoid main(void)  \n{ \n// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \ntexCoord = vertex.xy + vec2(0.5); \n// Invert y \ntexCoord.y = 1.0 - texCoord.y; \n\n// Compute poi position in clip coordinate \ngl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \ngl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n} \n","#ifdef GL_ES \nprecision highp float; \n#endif \n\nvarying vec2 texCoord; \nuniform sampler2D texture; \nuniform float alpha; \n\nvoid main(void) \n{ \n\tvec4 textureColor = texture2D(texture, texCoord); \n\tgl_FragColor = vec4(textureColor.rgb, textureColor.a * alpha); \n} \n")}this.labelMesh=new n(this.getGlobe().getRenderContext());this.labelMesh.setVertices([-.5,-.5,0,-.5,.5,0,.5,.5,0,.5,-.5,0]),this.labelMesh.setIndices([0,3,1,1,3,2]);var i=this.getGlobe().getRenderContext().gl;this.vertexBuffer=i.createBuffer(),this.indexBuffer=i.createBuffer(),this.texturePool||(this.texturePool=new u(i))},c.prototype._detach=function(){var t=this.getGlobe().getRenderContext().gl;for(var i in t.deleteBuffer(this.vertexBuffer),t.deleteBuffer(this.indexBuffer),this.texturePool.disposeAll(),this.labels)this.labels.hasOwnProperty(i)&&delete this.labels[i];this.getGlobe().getTileManager().removePostRenderer(this),e.prototype._detach.call(this)},c.prototype.clampGeoBound=function(e){return e.west=Math.floor(e.west/this.longitudeSample)*this.longitudeSample,e.east=Math.ceil(e.east/this.longitudeSample)*this.longitudeSample,e.north=Math.ceil(e.north/this.latitudeSample)*this.latitudeSample,e.south=Math.floor(e.south/this.latitudeSample)*this.latitudeSample,e},c.prototype.render=function(e){var t,i=this.getGlobe().getRenderContext(),r=i.gl;r.disable(r.DEPTH_TEST),r.enable(r.BLEND),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA);var n=this;t=this.getGlobe().getViewportGeoBound(function(e){return n.globe.getCoordinateSystem().convert(e,s.CRS.Equatorial,n.gridCrs.getGeoideName())}),t=this.clampGeoBound(t),this.geoBound.west!==t.west||this.geoBound.east!==t.east||this.geoBound.north!==t.north||this.geoBound.south!==t.south?(this.geoBound=t,this.computeSamples(),this.generateGridBuffers(),this.generateLabels()):this.updateLabels(),this.gridProgram.apply(),mat4.multiply(i.projectionMatrix,i.viewMatrix,i.modelViewMatrix),r.uniformMatrix4fv(this.gridProgram.uniforms.viewProjectionMatrix,!1,i.modelViewMatrix),r.uniform1f(this.gridProgram.uniforms.alpha,this.getOpacity());var o=this.getStyle().getStrokeColor();r.uniform3f(this.gridProgram.uniforms.color,o[0],o[1],o[2]),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.vertexAttribPointer(this.gridProgram.attributes.vertex,this.vertexBuffer.itemSize,r.FLOAT,!1,0,0),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer),r.drawElements(r.LINES,this.indexBuffer.numItems,r.UNSIGNED_SHORT,0),this.labelProgram.apply(),mat4.multiply(i.projectionMatrix,i.viewMatrix,i.modelViewMatrix),r.uniformMatrix4fv(this.labelProgram.uniforms.viewProjectionMatrix,!1,i.modelViewMatrix),r.uniform1i(this.labelProgram.uniforms.texture,0);var a=i.computePixelSizeVector();for(var l in this.labels)if(this.labels.hasOwnProperty(l)){var u=this.labels[l];r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,u.texture);var c=[2*u.textureWidth/i.canvas.width,2*u.textureHeight/i.canvas.height];r.uniform2fv(this.labelProgram.uniforms.poiScale,c);var h=u.pos3d,d=u.vertical;c=u.textureHeight*(a[0]*h[0]+a[1]*h[1]+a[2]*h[2]+a[3]);var p=d[0]*c+h[0],f=d[1]*c+h[1],g=d[2]*c+h[2];r.uniform3f(this.labelProgram.uniforms.poiPosition,p,f,g),r.uniform1f(this.labelProgram.uniforms.alpha,1),this.labelMesh.render(this.labelProgram.attributes),u.needed=!1}r.enable(r.DEPTH_TEST),r.disable(r.BLEND)},c.prototype.setVisible=function(t){e.prototype.setVisible.call(this,t),"boolean"==typeof t&&(this.isVisible()?this.getGlobe().getTileManager().addPostRenderer(this):this.getGlobe().getTileManager().removePostRenderer(this))},c.prototype.computeSamples=function(){var e=this.geoBound.east-this.geoBound.west;for(this.geoBound.north,this.geoBound.south;e/this.longitudeSample<3&&this.longitudeSample>1;)this.longitudeSample/=2,this.latitudeSample/=2;for(;e/this.longitudeSample>7&&this.longitudeSample<15;)this.longitudeSample*=2,this.latitudeSample*=2},c.prototype.generateGridBuffers=function(){var e,t,i,r,n;this.geoBound.east-this.geoBound.west>180?(e=0,t=360):(e=this.geoBound.west,t=this.geoBound.east);var o=[],a=180/this.latitudeSample;for(i=0;i<=a;i++){var l=i*Math.PI/a,u=Math.sin(l),c=Math.cos(l);for(r=e;r<=t;r+=this.longitudeSample){var h=this.longitudeSample/this.tesselation;for(n=0;n<this.tesselation;n++){var d=(r+n*h)*Math.PI/180,p=Math.sin(d),f=Math.cos(d)*u*this.getGlobe().getCoordinateSystem().getGeoide().getRadius(),g=p*u*this.getGlobe().getCoordinateSystem().getGeoide().getRadius(),m=c*this.getGlobe().getCoordinateSystem().getGeoide().getRadius();if(this.gridCrs.getGeoideName()!==s.CRS.Equatorial){var v=this.getGlobe().getCoordinateSystem().from3DToGeo([f,g,m]);v=this.getGlobe().getCoordinateSystem().convert(v,this.gridCrs.getGeoideName(),s.CRS.Equatorial);var y=this.getGlobe().getCoordinateSystem().fromGeoTo3D(v);o.push(y[0],y[1],y[2])}else o.push(f,g,m)}}}var b=this.getGlobe().getRenderContext().gl;b.bindBuffer(b.ARRAY_BUFFER,this.vertexBuffer),b.bufferData(b.ARRAY_BUFFER,new Float32Array(o),b.STATIC_DRAW),this.vertexBuffer.itemSize=3,this.vertexBuffer.numItems=o.length/3;var x,w=[],T=(t-e)/this.longitudeSample+1;for(T*=this.tesselation,i=0;i<a;i++)for(r=e,x=0;r<t;r+=this.longitudeSample,x+=this.tesselation){var _=i*T+x%(T-1),C=_+T;for(n=0;n<this.tesselation;n++)w.push(_+n),w.push(_+n+1);w.push(_+this.tesselation),w.push(C+this.tesselation),w.push(C),w.push(_)}b.bindBuffer(b.ELEMENT_ARRAY_BUFFER,this.indexBuffer),b.bufferData(b.ELEMENT_ARRAY_BUFFER,new Uint16Array(w),b.STATIC_DRAW),this.indexBuffer.itemSize=1,this.indexBuffer.numItems=w.length},c.prototype.buildAngle=function(e,t){var i;switch(e){case"Deg":i=t+"°";break;case"HMS":i=this.getGlobe().getCoordinateSystem().fromDegreesToHMS(t);break;case"DMS":i=this.getGlobe().getCoordinateSystem().fromDegreesToDMS(t);break;default:return l.open(s.LEVEL.ERROR,"Format not supported"),null}return i},c.prototype.computeGeoCenter=function(){var e=i.createFromPixel(this.getGlobe().getRenderContext(),this.getGlobe().getRenderContext().canvas.width/2,this.getGlobe().getRenderContext().canvas.height/2),t=e.computePoint(e.sphereIntersect([0,0,0],this.getGlobe().getCoordinateSystem().getGeoide().getRadius())),r=[];return this.getGlobe().getCoordinateSystem().from3DToGeo(t,r),r=this.getGlobe().getCoordinateSystem().convert(r,s.CRS.Equatorial,this.gridCrs.getGeoideName())},c.prototype.updateLabel=function(e,t){t=this.getGlobe().getCoordinateSystem().convert(t,this.gridCrs.getGeoideName(),s.CRS.Equatorial);var i=this.getGlobe().getCoordinateSystem().fromGeoTo3D(t),r=vec3.create();vec3.normalize(i,r),this.labels[e].pos3d=i,this.labels[e].vertical=r,this.labels[e].needed=!0},c.prototype.updateLabels=function(){var e=this.computeGeoCenter();for(var t in this.labels){var i;if(this.labels.hasOwnProperty(t))"lat"===this.labels[t].type?i=[this.labels[t].angle,e[1]]:"long"===this.labels[t].type&&(i=[e[0],this.labels[t].angle]),this.updateLabel(t,i)}},c.prototype.generateLabels=function(){var e,t,i,r,n,o,s,a;this.geoBound.east-this.geoBound.west>180?(t=0,e=360):(t=this.geoBound.west,e=this.geoBound.east);var l,u=this.computeGeoCenter();for(r=t;r<e;r+=this.longitudeSample)s=r<0?r+360:r,l=this.buildAngle(this.longFormat,s),this.labels["lat_"+l]||(this.labels["lat_"+l]={angle:r,type:"lat"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["lat_"+l],i)),o=[r,u[1]],this.updateLabel("lat_"+l,o);var c=Math.min(this.geoBound.north,this.geoBound.south),h=Math.max(this.geoBound.north,this.geoBound.south);for(a=c;a<=h;a+=this.latitudeSample)l=this.buildAngle(this.latFormat,a),this.labels["long_"+l]||(this.labels["long_"+l]={angle:a,type:"long"},i=this.generateImageData(l),this._buildTextureFromImage(this.labels["long_"+l],i)),o=[u[0],a],this.updateLabel("long_"+l,o);for(n in this.labels)this.labels[n].needed||(this.texturePool.disposeGLTexture(this.labels[n].texture),delete this.labels[n])},c.prototype._buildTextureFromImage=function(e,t){e.texture=this.texturePool.createGLTexture(t),e.textureWidth=t.width,e.textureHeight=t.height},c}),function(e,t){"object"==typeof module?module.exports=t():"function"==typeof r?r("crc32",t):e.crc32=t()}(this,function(){"use strict";var e=[],t=3988292384;function i(e){var i,r,n,o,s=-1;for(i=0,n=e.length;i<n;i+=1){for(o=255&(s^e[i]),r=0;r<8;r+=1)1==(1&o)?o=o>>>1^t:o>>>=1;s=s>>>8^o}return-1^s}function r(t,i){var n,o,s;if(void 0!==r.crc&&i&&t||(r.crc=-1,t)){for(n=r.crc,o=0,s=t.length;o<s;o+=1)n=n>>>8^e[255&(n^t[o])];return r.crc=n,-1^n}}!function(){var i,r,n;for(r=0;r<256;r+=1){for(i=r,n=0;n<8;n+=1)1&i?i=t^i>>>1:i>>>=1;e[r]=i>>>0}}();var n=function(e,t){var n;e="string"==typeof e?(n=e,Array.prototype.map.call(n,function(e){return e.charCodeAt(0)})):e;return((t?i(e):r(e))>>>0).toString(16)};return n.direct=i,n.table=r,n}),r("inflate-js",[],function(){var e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v=32768,y=0,b=1,x=2,w=9,T=6,_=null,C=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],S=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],A=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],I=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function k(){this.next=null,this.list=null}function D(){this.e=0,this.b=0,this.n=0,this.t=null}function R(e,t,i,r,n,o){var s;this.BMAX=16,this.N_MAX=288,this.status=0,this.root=null,this.m=0;var a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_=[],C=[],S=new D,E=[],A=[],I=[];for(T=this.root=null,h=0;h<this.BMAX+1;h++)_[h]=0;for(h=0;h<this.BMAX+1;h++)C[h]=0;for(h=0;h<this.BMAX;h++)E[h]=null;for(h=0;h<this.N_MAX;h++)A[h]=0;for(h=0;h<this.BMAX+1;h++)I[h]=0;a=t>256?e[256]:this.BMAX,f=e,g=0,h=t;do{_[f[g]]++,g++}while(--h>0);if(_[0]===t)return this.root=null,this.m=0,void(this.status=0);for(d=1;d<=this.BMAX&&0===_[d];d++);for(p=d,o<d&&(o=d),h=this.BMAX;0!==h&&0===_[h];h--);for(u=h,o>h&&(o=h),b=1<<d;d<h;d++,b<<=1)if((b-=_[d])<0)return this.status=2,void(this.m=o);if((b-=_[h])<0)return this.status=2,void(this.m=o);for(_[h]+=b,I[1]=d=0,f=_,g=1,y=2;--h>0;)I[y++]=d+=f[g++];f=e,g=0,h=0;do{0!==(d=f[g++])&&(A[I[d]++]=h)}while(++h<t);for(t=I[u],I[0]=h=0,f=A,g=0,c=-1,v=C[0]=0,m=null,x=0;p<=u;p++)for(s=_[p];s-- >0;){for(;p>v+C[1+c];){if(v+=C[1+c],c++,x=(x=u-v)>o?o:x,(l=1<<(d=p-v))>s+1)for(l-=s+1,y=p;++d<x&&!((l<<=1)<=_[++y]);)l-=_[y];for(v+d>a&&v<a&&(d=a-v),x=1<<d,C[1+c]=d,m=[],w=0;w<x;w++)m[w]=new D;(T=T?T.next=new k:this.root=new k).next=null,T.list=m,E[c]=m,c>0&&(I[c]=h,S.b=C[c],S.e=16+d,S.t=m,d=(h&(1<<v)-1)>>v-C[c],E[c-1][d].e=S.e,E[c-1][d].b=S.b,E[c-1][d].n=S.n,E[c-1][d].t=S.t)}for(S.b=p-v,g>=t?S.e=99:f[g]<i?(S.e=f[g]<256?16:15,S.n=f[g++]):(S.e=n[f[g]-i],S.n=r[f[g++]-i]),l=1<<p-v,d=h>>v;d<x;d+=l)m[d].e=S.e,m[d].b=S.b,m[d].n=S.n,m[d].t=S.t;for(d=1<<p-1;0!=(h&d);d>>=1)h^=d;for(h^=d;(h&(1<<v)-1)!==I[c];)v-=C[c],c--}this.m=C[1],this.status=0!==b&&1!==u?1:0}function P(e){for(;s<e;)o|=(g.length===m?-1:255&g[m++])<<s,s+=8}function L(e){return o&C[e]}function N(e){o>>=e,s-=e}function O(i,r,n){var o,s,l;if(0===n)return 0;for(l=0;;){for(P(p),o=(s=h.list[L(p)]).e;o>16;){if(99===o)return-1;N(s.b),P(o-=16),o=(s=s.t[L(o)]).e}if(N(s.b),16!==o){if(15===o)break;for(P(o),u=s.n+L(o),N(o),P(f),o=(s=d.list[L(f)]).e;o>16;){if(99===o)return-1;N(s.b),P(o-=16),o=(s=s.t[L(o)]).e}for(N(s.b),P(o),c=t-s.n-L(o),N(o);u>0&&l<n;)u--,c&=v-1,t&=v-1,i[r+l++]=e[t++]=e[c++];if(l===n)return n}else if(t&=v-1,i[r+l++]=e[t++]=s.n,l===n)return n}return a=-1,l}function F(i,r,n){var l;if(N(l=7&s),P(16),l=L(16),N(16),P(16),l!==(65535&~o))return-1;for(N(16),u=l,l=0;u>0&&l<n;)u--,t&=v-1,P(8),i[r+l++]=e[t++]=L(8),N(8);return 0===u&&(a=-1),l}function B(e,t,o){if(!_){var s,a,l=[];for(s=0;s<144;s++)l[s]=8;for(;s<256;s++)l[s]=9;for(;s<280;s++)l[s]=7;for(;s<288;s++)l[s]=8;if(0!==(a=new R(l,288,257,S,E,r=7)).status)return console.error("HufBuild error: "+a.status),-1;for(_=a.root,r=a.m,s=0;s<30;s++)l[s]=5;if((a=new R(l,30,0,A,I,n=5)).status>1)return _=null,console.error("HufBuild error: "+a.status),-1;i=a.root,n=a.m}return h=_,d=i,p=r,f=n,O(e,t,o)}function G(e,t,i){var r,n,o,s,a,l,u,c,g,m=[];for(r=0;r<316;r++)m[r]=0;if(P(5),u=257+L(5),N(5),P(5),c=1+L(5),N(5),P(4),l=4+L(4),N(4),u>286||c>30)return-1;for(n=0;n<l;n++)P(3),m[M[n]]=L(3),N(3);for(;n<19;n++)m[M[n]]=0;if(0!==(g=new R(m,19,19,null,null,p=7)).status)return-1;for(h=g.root,p=g.m,s=u+c,r=o=0;r<s;)if(P(p),N(n=(a=h.list[L(p)]).b),(n=a.n)<16)m[r++]=o=n;else if(16===n){if(P(2),n=3+L(2),N(2),r+n>s)return-1;for(;n-- >0;)m[r++]=o}else if(17===n){if(P(3),n=3+L(3),N(3),r+n>s)return-1;for(;n-- >0;)m[r++]=0;o=0}else{if(P(7),n=11+L(7),N(7),r+n>s)return-1;for(;n-- >0;)m[r++]=0;o=0}if(g=new R(m,u,257,S,E,p=w),0===p&&(g.status=1),0!==g.status&&1!==g.status)return-1;for(h=g.root,p=g.m,r=0;r<c;r++)m[r]=m[r+u];return g=new R(m,c,0,A,I,f=T),d=g.root,0===(f=g.m)&&u>257?-1:0!==g.status?-1:O(e,t,i)}function U(i,r,n){var o,s;for(o=0;o<n;){if(l&&-1===a)return o;if(u>0){if(a!==y)for(;u>0&&o<n;)u--,c&=v-1,t&=v-1,i[r+o++]=e[t++]=e[c++];else{for(;u>0&&o<n;)u--,t&=v-1,P(8),i[r+o++]=e[t++]=L(8),N(8);0===u&&(a=-1)}if(o===n)return o}if(-1===a){if(l)break;P(1),0!==L(1)&&(l=!0),N(1),P(2),a=L(2),N(2),h=null,u=0}switch(a){case y:s=F(i,r+o,n-o);break;case b:s=h?O(i,r+o,n-o):B(i,r+o,n-o);break;case x:s=h?O(i,r+o,n-o):G(i,r+o,n-o);break;default:s=-1}if(-1===s)return l?0:-1;o+=s}return o}return{inflate:function(i){var r,n=[];e||(e=[]),t=0,o=0,s=0,a=-1,l=!1,u=c=0,h=null,g=i,m=0;do{r=U(n,n.length,1024)}while(r>0);return g=null,n}}}),r("deflate-js",[],function(){var e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_,C,S,E,A,I,M,k,D,R,P,L,N,O,F,B,G,U,z,V,j,W,Y,H,q,X,Z,K,J,Q,$,ee,te,ie=32768,re=0,ne=1,oe=2,se=6,ae=!1,le=8192,ue=2*ie,ce=3,he=258,de=8192,pe=de,fe=32768,ge=fe-1,me=ie-1,ve=0,ye=4096,be=he+ce+1,xe=ie-be,we=1,Te=15,_e=7,Ce=29,Se=256,Ee=256,Ae=Se+1+Ce,Ie=30,Me=19,ke=16,De=17,Re=18,Pe=2*Ae+1,Le=parseInt((15+ce-1)/ce,10),Ne=null;function Oe(){this.fc=0,this.dl=0}function Fe(){this.dyn_tree=null,this.static_tree=null,this.extra_bits=null,this.extra_base=0,this.elems=0,this.max_length=0,this.max_code=0}function Be(e,t,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=r}de>32768&&console.error("error: INBUFSIZ is too small"),ie<<1>65536&&console.error("error: WSIZE is too large"),258!==he&&console.error("error: Code too clever");var Ge=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ue=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ze=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],Ve=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],je=[new Be(0,0,0,0),new Be(4,4,8,4),new Be(4,5,16,8),new Be(4,6,32,32),new Be(4,4,16,16),new Be(8,16,32,32),new Be(8,16,128,128),new Be(8,32,128,256),new Be(32,128,258,1024),new Be(32,258,258,4096)];function We(t){t.next=e,e=t}function Ye(e){return c[ie+e]}function He(e,t){return c[ie+e]=t}function qe(r){Ne[o+n++]=r,o+n===le&&function(){var r,s;if(0!==n){for(null!==e?(a=e,e=e.next):a=new function(){this.next=null,this.len=0,this.ptr=[],this.off=0},a.next=null,a.len=a.off=0,r=a,null===t?t=i=r:i=i.next=r,r.len=n-o,s=0;s<r.len;s++)r.ptr[s]=Ne[o+s];n=o=0}var a}()}function Xe(e){e&=65535,o+n<le-2?(Ne[o+n++]=255&e,Ne[o+n++]=e>>>8):(qe(255&e),qe(e>>>8))}function Ze(){f=(f<<Le^255&a[x+ce-1])&ge,g=Ye(f),c[x&me]=g,He(f,x)}function Ke(e,t){gt(t[e].fc,t[e].dl)}function Je(e){return 255&(e<256?j[e]:j[256+(e>>7)])}function Qe(e,t,i){return e[t].fc<e[i].fc||e[t].fc===e[i].fc&&z[t]<=z[i]}function $e(e,t,i){var r;for(r=0;r<i&&te<ee.length;r++)e[t+r]=255&ee[te++];return r}function et(e){var t,i,r,n,o=C,s=x,l=b,u=x>xe?x-xe:ve,h=x+he,d=a[s+l-1],p=a[s+l];b>=A&&(o>>=2);do{if(a[(t=e)+l]===p&&a[t+l-1]===d&&a[t]===a[s]&&a[++t]===a[s+1]){for(s+=2,t++;s<h;){for(n=!1,r=0;r<8;r+=1)if(t+=1,a[s+=1]!==a[t]){n=!0;break}if(n)break}if(i=he-(h-s),s=h-he,i>l){if(w=e,l=i,ae){if(i>=he)break}else if(i>=I)break;d=a[s+l-1],p=a[s+l]}}}while((e=c[e&me])>u&&0!=--o);return l}function tt(){var e,t,i=ue-_-x;if(-1===i)i--;else if(x>=ie+xe){for(e=0;e<ie;e++)a[e]=a[e+ie];for(w-=ie,x-=ie,p-=ie,e=0;e<fe;e++)He(e,(t=Ye(e))>=ie?t-ie:ve);for(e=0;e<ie;e++)t=c[e],c[e]=t>=ie?t-ie:ve;i+=ie}T||((e=$e(a,x+_,i))<=0?T=!0:_+=e)}function it(){T||(h=0,d=0,function(){var e,t,i,r,n;if(0!==R[0].dl)return;for(L.dyn_tree=M,L.static_tree=D,L.extra_bits=Ge,L.extra_base=Se+1,L.elems=Ae,L.max_length=Te,L.max_code=0,N.dyn_tree=k,N.static_tree=R,N.extra_bits=Ue,N.extra_base=0,N.elems=Ie,N.max_length=Te,N.max_code=0,O.dyn_tree=P,O.static_tree=null,O.extra_bits=ze,O.extra_base=0,O.elems=Me,O.max_length=_e,O.max_code=0,i=0,r=0;r<Ce-1;r++)for(W[r]=i,e=0;e<1<<Ge[r];e++)V[i++]=r;for(V[i-1]=r,n=0,r=0;r<16;r++)for(Y[r]=n,e=0;e<1<<Ue[r];e++)j[n++]=r;for(n>>=7;r<Ie;r++)for(Y[r]=n<<7,e=0;e<1<<Ue[r]-7;e++)j[256+n++]=r;for(t=0;t<=Te;t++)F[t]=0;e=0;for(;e<=143;)D[e++].dl=8,F[8]++;for(;e<=255;)D[e++].dl=9,F[9]++;for(;e<=279;)D[e++].dl=7,F[7]++;for(;e<=287;)D[e++].dl=8,F[8]++;for(at(D,Ae+1),e=0;e<Ie;e++)R[e].dl=5,R[e].fc=mt(e,5);ot()}(),function(){var e;for(e=0;e<fe;e++)c[ie+e]=0;if(S=je[E].max_lazy,A=je[E].good_length,ae||(I=je[E].nice_length),C=je[E].max_chain,x=0,p=0,(_=$e(a,0,2*ie))<=0)return T=!0,void(_=0);for(T=!1;_<be&&!T;)tt();for(f=0,e=0;e<ce-1;e++)f=(f<<Le^255&a[e])&ge}(),t=null,n=0,o=0,E<=3?(b=ce-1,y=0):(y=ce-1,v=!1),s=!1)}function rt(e,i,n){var o;return r||(it(),r=!0,0!==_)?(o=nt(e,i,n))===n?n:s?o:(E<=3?function(){for(;0!==_&&null===t;){var e;if(Ze(),g!==ve&&x-g<=xe&&(y=et(g))>_&&(y=_),y>=ce)if(e=dt(x-w,y-ce),_-=y,y<=S){y--;do{x++,Ze()}while(0!=--y);x++}else x+=y,y=0,f=((f=255&a[x])<<Le^255&a[x+1])&ge;else e=dt(0,255&a[x]),_--,x++;for(e&&(ht(0),p=x);_<be&&!T;)tt()}}():function(){for(;0!==_&&null===t;){if(Ze(),b=y,m=w,y=ce-1,g!==ve&&b<S&&x-g<=xe&&((y=et(g))>_&&(y=_),y===ce&&x-w>ye&&y--),b>=ce&&y<=b){var e;e=dt(x-1-m,b-ce),_-=b-1,b-=2;do{x++,Ze()}while(0!=--b);v=!1,y=ce-1,x++,e&&(ht(0),p=x)}else v?(dt(0,255&a[x-1])&&(ht(0),p=x),x++,_--):(v=!0,x++,_--);for(;_<be&&!T;)tt()}}(),0===_&&(v&&dt(0,255&a[x-1]),ht(1),s=!0),o+nt(e,o+i,n-o)):(s=!0,0)}function nt(e,i,r){var s,a,l;for(s=0;null!==t&&s<r;){for((a=r-s)>t.len&&(a=t.len),l=0;l<a;l++)e[i+s+l]=t.ptr[t.off+l];var u;if(t.off+=a,t.len-=a,s+=a,0===t.len)u=t,t=t.next,We(u)}if(s===r)return s;if(o<n){for((a=r-s)>n-o&&(a=n-o),l=0;l<a;l++)e[i+s+l]=Ne[o+l];s+=a,n===(o+=a)&&(n=o=0)}return s}function ot(){var e;for(e=0;e<Ae;e++)M[e].fc=0;for(e=0;e<Ie;e++)k[e].fc=0;for(e=0;e<Me;e++)P[e].fc=0;M[Ee].fc=1,Q=$=0,q=X=Z=0,K=0,J=1}function st(e,t){for(var i=B[t],r=t<<1;r<=G&&(r<G&&Qe(e,B[r+1],B[r])&&r++,!Qe(e,i,B[r]));)B[t]=B[r],t=r,r<<=1;B[t]=i}function at(e,t){var i,r,n=[],o=0;for(i=1;i<=Te;i++)o=o+F[i-1]<<1,n[i]=o;for(r=0;r<=t;r++){var s=e[r].dl;0!==s&&(e[r].fc=mt(n[s]++,s))}}function lt(e){var t,i,r=e.dyn_tree,n=e.static_tree,o=e.elems,s=-1,a=o;for(G=0,U=Pe,t=0;t<o;t++)0!==r[t].fc?(B[++G]=s=t,z[t]=0):r[t].dl=0;for(;G<2;){var l=B[++G]=s<2?++s:0;r[l].fc=1,z[l]=0,Q--,null!==n&&($-=n[l].dl)}for(e.max_code=s,t=G>>1;t>=1;t--)st(r,t);do{t=B[we],B[we]=B[G--],st(r,we),i=B[we],B[--U]=t,B[--U]=i,r[a].fc=r[t].fc+r[i].fc,z[t]>z[i]+1?z[a]=z[t]:z[a]=z[i]+1,r[t].dl=r[i].dl=a,B[we]=a++,st(r,we)}while(G>=2);B[--U]=B[we],function(e){var t,i,r,n,o,s,a=e.dyn_tree,l=e.extra_bits,u=e.extra_base,c=e.max_code,h=e.max_length,d=e.static_tree,p=0;for(n=0;n<=Te;n++)F[n]=0;for(a[B[U]].dl=0,t=U+1;t<Pe;t++)(n=a[a[i=B[t]].dl].dl+1)>h&&(n=h,p++),a[i].dl=n,i>c||(F[n]++,o=0,i>=u&&(o=l[i-u]),s=a[i].fc,Q+=s*(n+o),null!==d&&($+=s*(d[i].dl+o)));if(0!==p){do{for(n=h-1;0===F[n];)n--;F[n]--,F[n+1]+=2,F[h]--,p-=2}while(p>0);for(n=h;0!==n;n--)for(i=F[n];0!==i;)(r=B[--t])>c||(a[r].dl!==n&&(Q+=(n-a[r].dl)*a[r].fc,a[r].fc=n),i--)}}(e),at(r,s)}function ut(e,t){var i,r,n=-1,o=e[0].dl,s=0,a=7,l=4;for(0===o&&(a=138,l=3),e[t+1].dl=65535,i=0;i<=t;i++)r=o,o=e[i+1].dl,++s<a&&r===o||(s<l?P[r].fc+=s:0!==r?(r!==n&&P[r].fc++,P[ke].fc++):s<=10?P[De].fc++:P[Re].fc++,s=0,n=r,0===o?(a=138,l=3):r===o?(a=6,l=3):(a=7,l=4))}function ct(e,t){var i,r,n=-1,o=e[0].dl,s=0,a=7,l=4;for(0===o&&(a=138,l=3),i=0;i<=t;i++)if(r=o,o=e[i+1].dl,!(++s<a&&r===o)){if(s<l)do{Ke(r,P)}while(0!=--s);else 0!==r?(r!==n&&(Ke(r,P),s--),Ke(ke,P),gt(s-3,2)):s<=10?(Ke(De,P),gt(s-3,3)):(Ke(Re,P),gt(s-11,7));s=0,n=r,0===o?(a=138,l=3):r===o?(a=6,l=3):(a=7,l=4)}}function ht(e){var t,i,r,n,o;if(n=x-p,H[Z]=K,lt(L),lt(N),r=function(){var e;for(ut(M,L.max_code),ut(k,N.max_code),lt(O),e=Me-1;e>=3&&0===P[Ve[e]].dl;e--);return Q+=3*(e+1)+5+5+4,e}(),(i=$+3+7>>3)<=(t=Q+3+7>>3)&&(t=i),n+4<=t&&p>=0)for(gt((re<<1)+e,3),vt(),Xe(n),Xe(~n),o=0;o<n;o++)qe(a[p+o]);else i===t?(gt((ne<<1)+e,3),pt(D,R)):(gt((oe<<1)+e,3),function(e,t,i){var r;for(gt(e-257,5),gt(t-1,5),gt(i-4,4),r=0;r<i;r++)gt(P[Ve[r]].dl,3);ct(M,e-1),ct(k,t-1)}(L.max_code+1,N.max_code+1,r+1),pt(M,k));ot(),0!==e&&vt()}function dt(e,t){if(u[q++]=t,0===e?M[t].fc++:(e--,M[V[t]+Se+1].fc++,k[Je(e)].fc++,l[X++]=e,K|=J),J<<=1,0==(7&q)&&(H[Z++]=K,K=0,J=1),E>2&&0==(4095&q)){var i,r=8*q,n=x-p;for(i=0;i<Ie;i++)r+=k[i].fc*(5+Ue[i]);if(r>>=3,X<parseInt(q/2,10)&&r<parseInt(n/2,10))return!0}return q===de-1||X===pe}function pt(e,t){var i,r,n,o,s=0,a=0,c=0,h=0;if(0!==q)do{0==(7&s)&&(h=H[c++]),r=255&u[s++],0==(1&h)?Ke(r,e):(Ke((n=V[r])+Se+1,e),0!==(o=Ge[n])&&gt(r-=W[n],o),Ke(n=Je(i=l[a++]),t),0!==(o=Ue[n])&&gt(i-=Y[n],o)),h>>=1}while(s<q);Ke(Ee,e)}var ft=16;function gt(e,t){d>ft-t?(Xe(h|=e<<d),h=e>>ft-d,d+=t-ft):(h|=e<<d,d+=t)}function mt(e,t){var i=0;do{i|=1&e,e>>=1,i<<=1}while(--t>0);return i>>1}function vt(){d>8?Xe(h):d>0&&qe(h),h=0,d=0}return{deflate:function(n,o){var s,h;ee=n,te=0,void 0===o&&(o=se),function(n){var o;if(n?n<1?n=1:n>9&&(n=9):n=se,E=n,r=!1,T=!1,null===Ne){for(e=t=i=null,Ne=[],a=[],l=[],u=[],c=[],M=[],o=0;o<Pe;o++)M[o]=new Oe;for(k=[],o=0;o<2*Ie+1;o++)k[o]=new Oe;for(D=[],o=0;o<Ae+2;o++)D[o]=new Oe;for(R=[],o=0;o<Ie;o++)R[o]=new Oe;for(P=[],o=0;o<2*Me+1;o++)P[o]=new Oe;L=new Fe,N=new Fe,O=new Fe,F=[],B=[],z=[],V=[],j=[],W=[],Y=[],H=[]}}(o),h=[];do{s=rt(h,h.length,1024)}while(s>0);return ee=null,h}}}),r("gzip",["crc32","inflate-js","deflate-js"],function(e,t,i){function r(e,t){t.push(255&e)}function n(e,t){t.push(255&e),t.push(e>>>8)}function o(e,t){n(65535&e,t),n(e>>>16,t)}function s(e){return e.shift()}function a(e){return e.shift()|e.shift()<<8}function l(e){var t=a(e),i=a(e);return i>32768?((i-=32768)<<16|t)+32768*Math.pow(2,16):i<<16|t}function u(e){for(var t=[];0!==e[0];)t.push(String.fromCharCode(e.shift()));return e.shift(),t.join("")}return ID1=31,ID2=139,compressionMethods={deflate:8},possibleFlags={FTEXT:1,FHCRC:2,FEXTRA:4,FNAME:8,FCOMMENT:16},osMap={fat:0,amiga:1,vmz:2,unix:3,"vm/cms":4,atari:5,hpfs:6,macintosh:7,"z-system":8,cplm:9,"tops-20":10,ntfs:11,qdos:12,acorn:13,vfat:14,vms:15,beos:16,tandem:17,theos:18},os="unix",DEFAULT_LEVEL=6,{zip:function(t,n){var s,a=0,l=[];return n||(n={}),s=n.level||DEFAULT_LEVEL,"string"==typeof t&&(t=Array.prototype.map.call(t,function(e){return e.charCodeAt(0)})),r(ID1,l),r(ID2,l),r(compressionMethods.deflate,l),n.name&&(a|=possibleFlags.FNAME),r(a,l),o(n.timestamp||parseInt(Date.now()/1e3,10),l),r(1===s?4:9===s?2:0,l),r(osMap[os],l),n.name&&(function(e,t){var i,n=e.length;for(i=0;i<n;i+=1)r(e.charCodeAt(i),t)}(n.name.substring(n.name.lastIndexOf("/")+1),l),r(0,l)),i.deflate(t,s).forEach(function(e){r(e,l)}),o(parseInt(e(t),16),l),o(t.length,l),l},unzip:function(i,r){var n,o,c,h,d=Array.prototype.slice.call(i,0);if(s(d)!==ID1||s(d)!==ID2)throw"Not a GZIP file";if(n=s(d),!(n=Object.keys(compressionMethods).some(function(e){return o=e,compressionMethods[e]===n})))throw"Unsupported compression method";if(c=s(d),l(d),s(d),n=s(d),Object.keys(osMap).some(function(e){if(osMap[e]===n)return!0}),c&possibleFlags.FEXTRA&&function(e,t){var i,r=[];for(i=0;i<t;i+=1)r.push(e.shift())}(d,n=a(d)),c&possibleFlags.FNAME&&u(d),c&possibleFlags.FCOMMENT&&u(d),c&possibleFlags.FHCRC&&a(d),"deflate"===o&&(h=t.inflate(d.splice(0,d.length-8))),c&possibleFlags.FTEXT&&(h=Array.prototype.map.call(h,function(e){return String.fromCharCode(e)}).join("")),l(d)!==parseInt(e(h),16))throw"Checksum does not match";if(l(d)!==h.length)throw"Size of decompressed file not correct";return h},get DEFAULT_LEVEL(){return DEFAULT_LEVEL}}}),r("gw/Layer/FitsRequest",["../Utils/ImageRequest","../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy"],function(e,t,i,r){e.prototype.send=function(e,n,o){var s=this;if(o||null==e)s.failCallback(s);else if(e.search("fits")>0){var a=new XMLHttpRequest;a.onreadystatechange=function(r){a&&4===a.readyState&&(200===a.status?a.response&&(s.image=a.response,s.successCallback&&s.successCallback(s)):0!==a.status&&(i.open(t.LEVEL.ERROR,"Error while loading "+e),s.failCallback&&s.failCallback(s)),a=null)},a.onabort=function(e){s.abortCallback&&s.abortCallback(s),s.xhr=null},a.open("GET",r.proxify(e)),a.responseType="arraybuffer",a.send(),this.xhr=a}else this.image=new Image,this.image.aborted=!1,this.image.crossOrigin="",this.image.dataType="byte",this.image.onload=function(){0!==s.image.naturalWidth&&s.image.complete&&!this.aborted&&s.successCallback(s)},this.image.onerror=function(){s.failCallback&&!this.aborted&&s.failCallback(s)},this.image.src=r.proxify(e)},e.prototype.abort=function(){this.xhr?this.xhr.abort():(this.abortCallback&&this.abortCallback(this),this.image.aborted=!0,this.image.src="")}}),r("gw/Layer/HipsFitsLayer",["../Utils/Constants","../Utils/Utils","../Utils/Constants","../Tiling/HEALPixTiling","./AbstractHipsLayer","../Renderer/DynamicImage","./FitsLoader","gzip","../Utils/ImageRequest","./FitsRequest","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l,u){var c=function(e,t){n.prototype.constructor.call(this,e,t),this._ready=!1,this.fitsSupported=!0,this.levelZeroImage=null,this.rawFragShader="precision lowp float; \n",this.rawFragShader+="varying vec2 texCoord;\n",this.rawFragShader+="uniform sampler2D colorTexture; \n",this.rawFragShader+="uniform float opacity; \n",this.rawFragShader+="uniform float inversed; \n",this.rawFragShader+="bool isnan(float val) {\n",this.rawFragShader+="\t\treturn (val <= 0.0 || 0.0 <= val) ? ((val == 5e-324) ? true : false) : true;\n",this.rawFragShader+="}\n",this.rawFragShader+="void main(void)\n",this.rawFragShader+="{\n",this.rawFragShader+="\tvec4 color = texture2D(colorTexture, vec2(texCoord.x, (inversed == 1.) ? 1.0 - texCoord.y : texCoord.y));\n",this.rawFragShader+="\tgl_FragColor = vec4(color.r,color.g,color.b, color.a*opacity);\n",this.rawFragShader+="\tif (isnan( (gl_FragColor.r + gl_FragColor.g + gl_FragColor.b) / 3. ) )\n",this.rawFragShader+="\t{\n",this.rawFragShader+="\t\tgl_FragColor.a = 0.;\n",this.rawFragShader+="\t}\n",this.rawFragShader+="}\n",this.colormapFragShader="precision lowp float; \n",this.colormapFragShader+="varying vec2 texCoord;\n",this.colormapFragShader+="uniform sampler2D colorTexture; \n",this.colormapFragShader+="uniform sampler2D colormap; \n",this.colormapFragShader+="uniform float min; \n",this.colormapFragShader+="uniform float max; \n",this.colormapFragShader+="uniform float opacity; \n",this.colormapFragShader+="bool isnan(float val) {\n",this.colormapFragShader+="\treturn (val <= 0.0 || 0.0 <= val) ? false : true;\n",this.colormapFragShader+="}\n",this.colormapFragShader+="void main(void)\n",this.colormapFragShader+="{\n",this.colormapFragShader+="\tfloat i = texture2D(colorTexture,vec2(texCoord.x, 1.0 - texCoord.y)).r;\n",this.colormapFragShader+="\tfloat d = clamp( ( i - min ) / (max - min), 0.0, 1.0 );\n",this.colormapFragShader+="\tvec4 cmValue = texture2D(colormap, vec2(d,0.));\n",this.colormapFragShader+="\tgl_FragColor = vec4(cmValue.r,cmValue.g,cmValue.b, cmValue.a*opacity);\n",this.colormapFragShader+="\tif (isnan( i ) )\n",this.colormapFragShader+="\t{\n",this.colormapFragShader+="\t\t gl_FragColor.a = 0.;\n",this.colormapFragShader+="\t}\n",this.colormapFragShader+="}\n";var r=this;this.customShader={fragmentCode:this.rawFragShader,updateUniforms:function(e,t){e.uniform1f(t.uniforms.inversed,r.inversed),r.levelZeroImage&&(e.uniform1f(t.uniforms.max,r.levelZeroImage.tmax),e.uniform1f(t.uniforms.min,r.levelZeroImage.tmin),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,r.levelZeroImage.colormapTex),e.uniform1i(t.uniforms.colormap,1),e.uniform1f(t.uniforms.opacity,r.getOpacity()))}},this.imageRequest=new l({successCallback:function(){var e,i;if(r._ready=!0,"fits"===r.format){try{e=new Uint8Array(r.imageRequest.image),i=a.unzip(e),r.imageRequest.image=new Uint8Array(i).buffer}catch(t){if("Not a GZIP file"!==t)return void this.failCallback();e=null}r.handleImage(r.imageRequest);var n=r.imageRequest.image;if(r.globe){var s=r.globe.getRenderContext().gl;r.levelZeroImage=new o(r.globe.getRenderContext(),n.typedArray,s.LUMINANCE,s.FLOAT,n.width,n.height),r.getLevelZeroTexture=function(){return r.levelZeroImage.texture}}}else r.levelZeroImage=this.image,r.getLevelZeroTexture=null;t.onready&&t.onready instanceof Function&&t.onready(r),r.globe&&r.globe.getRenderContext().requestFrame()},failCallback:function(){r.globe&&(r.globe.publishEvent(i.EVENT_MSG.BASE_LAYERS_ERROR,r),r._ready=!1)},abortCallback:function(e){r._ready=!1}})};return t.inherits(n,c),c.prototype._attach=function(e){n.prototype._attach.call(this,e);var t=this.getGlobe().getRenderContext().gl;this.requestLevelZeroImage(),t.getExtension("OES_texture_float")||(u.open(i.LEVEL.DEBUG,"HipsFitsLayer.js","no OES_texture_float"),this.fitsSupported=!1)},c.prototype._detach=function(){this._ready||this.imageRequest.abort(),this._ready=!1,this.disposeResources(),n.prototype._detach.call(this)},c.prototype.getUrl=function(e){var t=this.baseUrl;return t+="/Norder",t+=e.order,t+="/Dir",t+=1e4*Math.floor(e.pixelIndex/1e4),t+="/Npix",t+=e.pixelIndex,t+="."+this.format,this.allowRequest(t)},c.prototype.extractFitsData=function(e,t,i,r){this.levelZeroImage.height;for(var n,o=this.levelZeroImage.width,s=this.levelZeroImage.pixels,a=64*o*(28-Math.floor(e/27))+e%27*64,l=0;l<64;l++)n=s.subarray(a+l*o,a+l*o+64),t.set(n,r+128*l+i)},c.prototype.generateLevel0Textures=function(e,t){var i,r,n,o,s,a,l;if("fits"!==this.format){var u=document.createElement("canvas");u.width=128,u.height=128;var c=u.getContext("2d");for(s=0;s<e.length;s++)n=(r=4*(a=e[s]).pixelIndex)%27*64,o=64*Math.floor(r/27),c.drawImage(this.levelZeroImage,n,o,64,64,0,0,64,64),n=(r=4*a.pixelIndex+2)%27*64,o=64*Math.floor(r/27),c.drawImage(this.levelZeroImage,n,o,64,64,64,0,64,64),n=(r=4*a.pixelIndex+1)%27*64,o=64*Math.floor(r/27),c.drawImage(this.levelZeroImage,n,o,64,64,0,64,64,64),n=(r=4*a.pixelIndex+3)%27*64,o=64*Math.floor(r/27),c.drawImage(this.levelZeroImage,n,o,64,64,64,64,64,64),(l=c.getImageData(0,0,128,128)).dataType="byte",a.texture=t.createGLTexture(l),a.imageSize=128}else for(s=0;s<e.length;s++)a=e[s],i=new Float32Array(16384),r=4*a.pixelIndex,this.extractFitsData(r,i,0,8192),r=4*a.pixelIndex+2,this.extractFitsData(r,i,64,8192),r=4*a.pixelIndex+1,this.extractFitsData(r,i,0,0),r=4*a.pixelIndex+3,this.extractFitsData(r,i,64,0),l={typedArray:i,width:128,height:128,dataType:"float"},a.texture=t.createGLTexture(l),a.imageSize=128},c.prototype.handleImage=function(e){if(!(e.image instanceof Image)){var t,i,r,n=s.parseFits(e.image).getHDU().data,o=n.arrayType.BYTES_PER_ELEMENT;if("Float64Array"===n.arrayType.name)for(i=new Float64Array(n.view.buffer,n.begin,n.length/o),t=new Float32Array(n.length/o),r=0;r<i.length;r++)t[r]=i[r];else t=new Float32Array(n.view.buffer,n.begin,n.length/o);e.image={typedArray:t,width:n.width,height:n.height,dataType:"float"}}},c.prototype.requestLevelZeroImage=function(){this.fitsSupported||(this.format="jpg"),this.customShader.fragmentCode=this.rawFragShader,"fits"===this.format?this.inversed=1:this.inversed=0;var e=this.baseUrl+"/Norder3/Allsky."+this.format;this.imageRequest.send(e)},c.prototype.disposeResources=function(){this.levelZeroImage&&this.levelZeroImage.dispose&&this.levelZeroImage.dispose(),this.levelZeroTexture&&this.getGlobe().getRenderContext().gl.deleteTexture(this.levelZeroTexture),this.levelZeroImage=null,this.levelZeroTexture=null},c}),r("gw/Layer/WMSElevationLayer",["../Utils/Utils","./WMSLayer"],function(e,t){var i=function(e){e.format="image/x-aaigrid",e.tilePixelSize=e.tilePixelSize||33,t.prototype.constructor.call(this,e)};return e.inherits(t,i),i.prototype.parseElevations=function(e){for(var t=[],i=e.trim().split("\n"),r=5;r<i.length;r++)for(var n=i[r].trim().split(/\s+/),o=0;o<n.length;o++)t.push(parseInt(n[o],10));return t},i}),r("gw/Renderer/RendererManager",["../Utils/Constants","./RasterOverlayRenderer","./GroundOverlayRenderer","../Gui/dialog/ErrorDialog"],function(e,t,i,r){var n=function(e){this.renderers=[];for(var t=0;t<n.factory.length;t++)this.renderers.push(n.factory[t](e));this.renderables=[],this.bucketId=0};n.factory=[],n.prototype.setSelectedRasterBucket=function(r){for(var n=this.renderers.length;n--;){var o=this.renderers[n];if(o instanceof t||o instanceof i)for(var s=o.buckets,a=s.length;a--;){var l=s[a],u=l.layer;l.style.zIndex==e.DISPLAY.SELECTED_RASTER&&l.style.zIndex<=e.DISPLAY.SELECTED_RASTER&&(l.style.zIndex=e.DISPLAY.DEFAULT_RASTER),u.getID()===r.getID()&&l.style.zIndex<=e.DISPLAY.SELECTED_RASTER&&(l.style.zIndex=e.DISPLAY.SELECTED_RASTER)}}},n.prototype.getRenderer=function(e,t){for(var i=0;i<this.renderers.length;i++)if(this.renderers[i].canApply(e.type,t))return this.renderers[i];return null},n.prototype.generate=function(e){var t;if(e.parent){var i=e.parent.extension.renderer;if(i)for(delete e.extension.renderer,t=0;t<i.renderables.length;t++){var r=i.renderables[t];r.generateChild&&r.generateChild(e)}}else for(t=0;t<this.renderers.length;t++)this.renderers[t].generateLevelZero(e)},n.prototype.addGeometry=function(t,i,n){var o=this.getRenderer(i,n);o?o.addGeometry(t,i,n):r.open(e.LEVEL.DEBUG,"RendererManager.js","No renderer for RendererManager")},n.prototype.removeGeometry=function(e,t){var i=e._bucket;return!(!i||i.layer!==t)&&(i.renderer.removeGeometry(e),!0)},n.prototype.addGeometryToTile=function(e,t,i,r){this.getRenderer(t,i).addGeometryToTile(e,t,i,r)},n.prototype.removeGeometryFromTile=function(e,t){e._bucket.renderer.removeGeometryFromTile(e,t,!1)};var o=function(e,t){var i=e.bucket.style.zIndex-t.bucket.style.zIndex;return 0===i?e.bucket.id-t.bucket.id:i};return n.prototype.render=function(){var e,t;for(t=0;t<this.renderers.length;t++){var i=this.renderers[t].buckets;for(e=0;e<i.length;e++)i[e].layer.isVisible()&&i[e].mainRenderable&&this.renderables.push(i[e].mainRenderable)}for(this.renderables.sort(o),e=0;e<this.renderables.length;){t=e+1;for(var r=this.renderables[e].bucket.renderer;t<this.renderables.length&&this.renderables[t].bucket.renderer===r;)t++;r.render(this.renderables,e,t),e=t}this.renderables.length=0},n}),function(e,t){"function"==typeof r&&r.amd?r("jsvotable",["jquery"],t):e.mylib=t(e.$)}(this,function(e){var t,r;return function(e){function i(e,t){return v.call(e,t)}function n(e,t){var i,r,n,o,s,a,l,u,c,h,d=t&&t.split("/"),p=g.map,f=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=(d=d.slice(0,d.length-1)).concat(e.split("/")),u=0;u<e.length;u+=1)if("."===(h=e[u]))e.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||f)&&p){for(u=(i=e.split("/")).length;u>0;u-=1){if(r=i.slice(0,u).join("/"),d)for(c=d.length;c>0;c-=1)if((n=p[d.slice(0,c).join("/")])&&(n=n[r])){o=n,s=u;break}if(o)break;!a&&f&&f[r]&&(a=f[r],l=u)}!o&&a&&(o=a,s=l),o&&(i.splice(0,s,o),e=i.join("/"))}return e}function o(t,i){return function(){return c.apply(e,y.call(arguments,0).concat([t,i]))}}function s(e){return function(t){p[e]=t}}function a(t){if(i(f,t)){var r=f[t];delete f[t],m[t]=!0,u.apply(e,r)}if(!i(p,t)&&!i(m,t))throw new Error("No "+t);return p[t]}function l(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}var u,c,h,d,p={},f={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;h=function(e,t){var i,r=l(e),o=r[0];return e=r[1],o&&(i=a(o=n(o,t))),o?e=i&&i.normalize?i.normalize(e,function(e){return function(t){return n(t,e)}}(t)):n(e,t):(o=(r=l(e=n(e,t)))[0],e=r[1],o&&(i=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:i}},d={require:function(e){return o(e)},exports:function(e){var t=p[e];return void 0!==t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:function(e){return function(){return g&&g.config&&g.config[e]||{}}}(e)}}},u=function(t,r,n,l){var u,c,g,v,y,b,x=[];if(l=l||t,"function"==typeof n){for(r=!r.length&&n.length?["require","exports","module"]:r,y=0;y<r.length;y+=1)if("require"===(c=(v=h(r[y],l)).f))x[y]=d.require(t);else if("exports"===c)x[y]=d.exports(t),b=!0;else if("module"===c)u=x[y]=d.module(t);else if(i(p,c)||i(f,c)||i(m,c))x[y]=a(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,o(l,!0),s(c),{}),x[y]=p[c]}g=n.apply(p[t],x),t&&(u&&u.exports!==e&&u.exports!==p[t]?p[t]=u.exports:g===e&&b||(p[t]=g))}else t&&(p[t]=n)},t=c=function(t,i,r,n,o){return"string"==typeof t?d[t]?d[t](i):a(h(t,i).f):(t.splice||(g=t,i.splice?(t=i,i=r,r=null):t=e),i=i||function(){},"function"==typeof r&&(r=n,n=o),n?u(e,t,i,r):setTimeout(function(){u(e,t,i,r)},4),c)},c.config=function(e){return(g=e).deps&&c(g.deps,g.callback),c},(r=function(e,t,r){t.splice||(r=t,t=[]),i(p,e)||i(f,e)||(f[e]=[e,t,r])}).amd={jQuery:!0}}(),r("../minify/almond",function(){}),r("utils",[],function(){var e={inherits:function(e,t){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},makeHttpObject:function(){try{return new XMLHttpRequest}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}throw new Error("The object creation for making HTTP requests has failed.")},guid:function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},findValueByKeyword:function(e,t){var r=void 0;for(i=0;i<e.length;i++){var n=e[i];if(n[0]===t){r=n[1];break}}return r},parseXML:function(e){if(document.implementation&&document.implementation.createDocument)xmlDoc=(new DOMParser).parseFromString(e,"text/xml");else{if(!window.ActiveXObject)return alert("Your browser cannot handle this script"),null;xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),xmlDoc.loadXML(e)}return xmlDoc}};return e}),r("cache",[],function(){var e=function(){this.nodeID={},this.nodeName={},this.warnings=[]};return e.prototype.getEltsByID=function(){return this.nodeID},e.prototype.getEltsByName=function(){return this.nodeName},e.prototype.getWarnings=function(){return this.warnings},e.prototype.addEntryID=function(e,t){this.nodeID[e]=t},e.prototype.addEntryName=function(e,t){this.nodeName.hasOwnProperty(e)?this.nodeName[e].push(t):(this.nodeName[e]=[],this.nodeName[e].push(t))},e.prototype.addWarning=function(e){this.warnings.push(e)},e}),r("abstractNode",["./utils","./cache"],function(e,t){var i=function(e,t){if(void 0===t)throw new Error("tagName is undefined for "+e);if(this.tagName=t,this.attributes={},null!=e&&1==e.nodeType){for(var i=0,n=e.attributes.length;i<n;i++){var o=e.attributes[i];this.attributes[o.name]=o.value}if(this.attributes.hasOwnProperty("ID"))r.getInstance().addEntryID(this.attributes.ID,this);if(this.attributes.hasOwnProperty("name"))r.getInstance().addEntryName(this.attributes.name,this)}};i.prototype.getAttributes=function(){return this.attributes},i.prototype.hasAttribute=function(e){return this.attributes.hasOwnProperty(e)},i.prototype.hasAttributes=function(){return 0!=Object.keys(this.attributes).length},i.prototype.getTagName=function(){return this.tagName},i.prototype.getCache=function(){return r.getInstance()};var r=function(){var e;return{getInstance:function(){return e||(e=new t),e}}}();return i}),r("constants",[],function(){var e=function(){};return e.API={version:"2.0.2"},e.TAG={BINARY:"BINARY",BINARY2:"BINARY2",COOSYS:"COOSYS",DATA:"DATA",DEFINITIONS:"DEFINITIONS",DESCRIPTION:"DESCRIPTION",FIELD:"FIELD",FIELDref:"FIELDref",FITS:"FITS",GROUP:"GROUP",INFO:"INFO",VOTABLE:"VOTABLE",LINK:"LINK",MAX:"MAX",MIN:"MIN",OPTION:"OPTION",PARAM:"PARAM",PARAMref:"PARAMref",RESOURCE:"RESOURCE",STREAM:"STREAM",TABLE:"TABLE",TABLEDATA:"TABLEDATA",TD:"TD",TR:"TR",VALUES:"VALUES"},e}),r("description",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.DESCRIPTION),this.value;var r=e.childNodes[0];null!=r&&3==r.nodeType&&(this.value=null==r.textContent?null:r.textContent.trim())};return e.inherits(t,r),r.prototype.getContent=function(){return this.value},r}),r("fieldref",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.FIELDref)};return e.inherits(t,r),r.prototype.ref=function(){return this.attributes.ref},r.prototype.ucd=function(){return this.attributes.ucd},r.prototype.utype=function(){return this.attributes.utype},r}),r("paramref",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.PARAMref)};return e.inherits(t,r),r.prototype.ref=function(){return this.attributes.ref},r.prototype.ucd=function(){return this.attributes.ucd},r.prototype.utype=function(){return this.attributes.utype},r}),r("min",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.MIN)};return e.inherits(t,r),r.prototype.value=function(){return this.attributes.value},r.prototype.inclusive=function(){return this.attributes.inclusive},r}),r("max",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.MAX)};return e.inherits(t,r),r.prototype.value=function(){return this.attributes.value},r.prototype.inclusive=function(){return this.attributes.inclusive},r}),r("option",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.OPTION);this.options=n(this,e)},n=function(e,t){for(var n=[],o=0;null!=t&&o<t.childNodes.length;o++){var s=t.childNodes[o];if(1==s.nodeType){var a=s.localName;a==i.TAG.OPTION?n.push(new r(s)):e.getCache().addWarning("unknown element "+a+" in Option node")}}return n};return e.inherits(t,r),r.prototype.name=function(){return this.attributes.name},r.prototype.value=function(){return this.attributes.value},r.prototype.getOptions=function(){return this.options},r}),r("values",["./utils","./abstractNode","./min","./max","./option","./constants"],function(e,t,i,r,n,o){var s=function(e){t.prototype.constructor.call(this,e,o.TAG.VALUES);var i=a(this,e);this.min=i[0],this.max=i[1],this.options=i[2]},a=function(e,t){for(var s,a,l=[],u=0;null!=t&&u<t.childNodes.length;u++){var c=t.childNodes[u];if(1==c.nodeType){var h=c.localName;switch(h){case o.TAG.MIN:s=new i(c);break;case o.TAG.MAX:a=new r(c);break;case o.TAG.OPTION:l.push(new n(c));break;default:e.getCache().addWarning("unknown element "+h+" in Values node")}}}return[s,a,l]};return e.inherits(t,s),s.prototype.ID=function(){return this.attributes.ID},s.prototype.type=function(){return this.attributes.type},s.prototype.null=function(){return this.attributes.null},s.prototype.ref=function(){return this.attributes.ref},s.prototype.getMin=function(){return this.min},s.prototype.getMax=function(){return this.max},s.prototype.getOptions=function(){return this.options},s}),r("link",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.LINK)};return e.inherits(t,r),r.prototype.ID=function(){return this.attributes.ID},r.prototype.content_role=function(){return this.attributes["content-role"]},r.prototype.content_type=function(){return this.attributes["content-type"]},r.prototype.title=function(){return this.attributes.title},r.prototype.value=function(){return this.attributes.value},r.prototype.href=function(){return this.attributes.href},r.prototype.gref=function(){return this.attributes.gref},r.prototype.action=function(){return this.attributes.action},r}),r("field",["./utils","./abstractNode","./description","./values","./link","./constants"],function(e,t,i,r,n,o){var s=function(e){t.prototype.constructor.call(this,e,o.TAG.FIELD);var i=a(this,e);this.description=i[0],this.values=i[1],this.links=i[2]},a=function(e,t){for(var s,a,l=[],u=0;null!=t&&u<t.childNodes.length;u++){var c=t.childNodes[u];if(1==c.nodeType){var h=c.localName;switch(h){case o.TAG.DESCRIPTION:s=new i(c);break;case o.TAG.VALUES:a=new r(c);break;case o.TAG.LINK:l.push(new n(c));break;default:e.getCache().addWarning("unknown element "+h+" in Field node")}}}return[s,a,l]};return e.inherits(t,s),s.prototype.ID=function(){return this.attributes.ID},s.prototype.unit=function(){return this.attributes.unit},s.prototype.datatype=function(){return this.attributes.datatype},s.prototype.precision=function(){return this.attributes.precision},s.prototype.width=function(){return this.attributes.width},s.prototype.xtype=function(){return this.attributes.xtype},s.prototype.ref=function(){return this.attributes.ref},s.prototype.name=function(){return this.attributes.name},s.prototype.ucd=function(){return this.attributes.ucd},s.prototype.utype=function(){return this.attributes.utype},s.prototype.arraysize=function(){return this.attributes.arraysize},s.prototype.type=function(){return this.attributes.type},s.prototype.getDescription=function(){return this.description},s.prototype.getValues=function(){return this.values},s.prototype.getLinks=function(){return this.links},s}),r("param",["./utils","./field","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.PARAM)};return e.inherits(t,r),r.prototype.value=function(){return this.attributes.value},r}),r("group",["./utils","./abstractNode","./description","./fieldref","./paramref","./param","./constants"],function(e,t,i,r,n,o,s){var a=function(e){t.prototype.constructor.call(this,e,s.TAG.GROUP);var i=l(this,e);this.description=i[0],this.fieldrefs=i[1],this.paramrefs=i[2],this.params=i[3],this.groups=i[4]},l=function(e,t){for(var l,u=[],c=[],h=[],d=[],p=0;null!=t&&p<t.childNodes.length;p++){var f=t.childNodes[p];if(1==f.nodeType){var g=f.localName;switch(g){case s.TAG.DESCRIPTION:l=new i(f);break;case s.TAG.FIELDref:u.push(new r(f));break;case s.TAG.PARAMref:c.push(new n(f));break;case s.TAG.PARAM:h.push(new o(f));break;case s.TAG.GROUP:d.push(new a(f));break;default:e.getCache().addWarning("unknown element "+g+" in Group node")}}}return[l,u,c,h,d]};return e.inherits(t,a),a.prototype.ID=function(){return this.attributes.ID},a.prototype.name=function(){return this.attributes.name},a.prototype.ref=function(){return this.attributes.ref},a.prototype.ucd=function(){return this.attributes.ucd},a.prototype.utype=function(){return this.attributes.utype},a.prototype.getDescription=function(){return this.description},a.prototype.getFieldrefs=function(){return this.fieldrefs},a.prototype.getParamrefs=function(){return this.paramrefs},a.prototype.getParams=function(){return this.params},a.prototype.getGroups=function(){return this.groups},a}),r("coosys",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.COOSYS);this.value=n(this,e)};e.inherits(t,r);var n=function(e,t){for(var i,r=0;null!=t&&r<t.childNodes.length;r++){var n=t.childNodes[r];null!=n&&3==n.nodeType?i=null==n.textContent?null:n.textContent.trim():e.getCache().addWarning("unknown element "+n+" in Coosys node")}return i};return r.prototype.ID=function(){return this.attributes.ID},r.prototype.equinox=function(){return this.attributes.equinox},r.prototype.epoch=function(){return this.attributes.epoch},r.prototype.system=function(){return this.attributes.system},r.prototype.getContent=function(){return this.value},r}),r("definitions",["./utils","./abstractNode","./group","./param","./coosys","./constants"],function(e,t,i,r,n,o){var s=function(e){t.prototype.constructor.call(this,e,o.TAG.DEFINITIONS);var i=a(this,e);this.coosys=i[0],this.param=i[1]},a=function(e,t){for(var i=[],s=[],a=0;null!=t&&a<t.childNodes.length;a++){var l=t.childNodes[a];if(1==l.nodeType){var u=l.localName;switch(u){case o.TAG.COOSYS:i.push(new n(l));break;case o.TAG.PARAM:s.push(new r(l));break;default:e.getCache().addWarning("unknown element "+u+" in Definitions node")}u==o.TAG.COOSYS?i.push(new n(l)):u==o.TAG.PARAM?s.push(new r(l)):e.getCache().addWarning("unknown element "+u+" in Definitions node")}}return[i,s]};return e.inherits(t,s),s.prototype.getCoosyss=function(){return this.coosys},s.prototype.getParams=function(){return this.param},s}),r("info",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e,i.TAG.INFO);var r=e.childNodes[0];null!=r&&3==r.nodeType&&(this.val=null==r.textContent?null:r.textContent.trim())};return r.prototype.name=function(){return this.attributes.name},r.prototype.value=function(){return this.attributes.value},r.prototype.ID=function(){return this.attributes.ID},r.prototype.unit=function(){return this.attributes.unit},r.prototype.xtype=function(){return this.attributes.xtype},r.prototype.ref=function(){return this.attributes.ref},r.prototype.ucd=function(){return this.attributes.ucd},r.prototype.utype=function(){return this.attributes.utype},r.prototype.getContent=function(){return this.val},r}),r("td",["./utils","./abstractNode","./constants"],function(e,t,i){var r=function(e,r){t.prototype.constructor.call(this,e,i.TAG.TD),this.value=null==r?null==e.textContent?"":e.textContent.trim():null==r?"":r.trim()};return e.inherits(t,r),r.prototype.encoding=function(){return this.attributes.encoding},r.prototype.getContent=function(){return this.value},r}),r("tr",["./utils","./abstractNode","./td","./constants"],function(e,t,i,r){var n=function(e,n){if(t.prototype.constructor.call(this,e,r.TAG.TR),null==n){this.tds=o(this,e)}else{this.tds=[];for(var s=0;s<n.length;s++)this.tds.push(new i(null,n[s]))}},o=function(e,t){for(var n=[],o=0;null!=t&&o<t.childNodes.length;o++){var s=t.childNodes[o];if(1==s.nodeType){var a=s.localName;a==r.TAG.TD?n.push(new i(s)):e.getCache().addWarning("unknown element "+a+" in Tr node")}}return n};return e.inherits(t,n),n.prototype.ID=function(){return this.attributes.ID},n.prototype.getTds=function(){return this.tds},n}),r("abstractData",["./utils","./abstractNode"],function(e,t){var i=function(e,i){t.prototype.constructor.call(this,e,i)};return e.inherits(t,i),i}),r("tabledata",["./utils","./tr","./abstractData","./constants"],function(e,t,i,r){var n=function(e,n){if(i.prototype.constructor.call(this,e,r.TAG.TABLEDATA),null==n){this.trs=o(this,e)}else{this.trs=[];for(var s=0;s<n.length;s++)this.trs.push(new t(null,n[s]))}},o=function(e,i){for(var n=[],o=0;null!=i&&o<i.childNodes.length;o++){var s=i.childNodes[o];if(1==s.nodeType){var a=s.localName;a==r.TAG.TR?n.push(new t(s)):e.getCache().addWarning("unknown element "+a+" in TableData node")}}return n};return e.inherits(i,n),n.prototype.getTrs=function(){return this.trs},n}),r("converter/base64",[],function(){function e(e){"use strict";var t,i,r;return t=new ArrayBuffer(1),i=new DataView(t),r=e.join(""),i.setUint8(0,parseInt(r,2)),i.getUint8(0)}function t(e){var t;return e>64&&e<91?t=e-65:e>96&&e<123?t=e-71:e>47&&e<58?t=e+4:43===e?t=62:47===e&&(t=63),t}var i={short:16,int:32,float:32,double:64,unsignedByte:8},r=function(e){this.ptrStream=0,this.bufferTabBits=[],this.fields=e};return r.prototype.computeDataSize=function(e,t,r){var n=0;if("char"===e)if(/\*/.test(this.fields[t].arraysize())){var o=this.streamB64(32,r);n=8*function(e){"use strict";var t,i,r;return t=new ArrayBuffer(4),i=new DataView(t),r=e.join(""),i.setUint32(0,parseInt(r,2)),i.getUint32(0)}(o),o=[]}else n=8*this.fields[t].arraysize();else n=i[e];return n},r.prototype.streamB64=function(e,i){for(var r=[],n=this.bufferTabBits.length,o=Math.ceil((e-n)/6),s=0;s<n;s+=1)r.push(this.bufferTabBits[s]);this.bufferTabBits=[];for(s=0;s<o;s+=1){if(10==i.charCodeAt(this.ptrStream))s-=1;else for(var a=t(i.charCodeAt(this.ptrStream)),l=32;l>0;l>>=1)r.length!==e?r.push((a&l)===l?"1":"0"):this.bufferTabBits.push((a&l)===l?"1":"0");this.ptrStream+=1}return r},r.prototype.decodeValue=function(t,i,r,n){var o,s=[];switch("NULL"!=t&&(s=this.streamB64(i,n)),t){case"short":o=function(e){"use strict";var t,i,r;return t=new ArrayBuffer(2),i=new DataView(t),r=e.join(""),i.setUint16(0,parseInt(r,2)),i.getInt16(0)}(s);break;case"int":o=function(e){"use strict";var t,i,r;return t=new ArrayBuffer(4),i=new DataView(t),r=e.join(""),i.setUint32(0,parseInt(r,2)),i.getInt32(0)}(s);break;case"float":o=(o=function(e){"use strict";var t,i,r;return t=new ArrayBuffer(4),i=new DataView(t),r=e.join(""),i.setUint32(0,parseInt(r,2)),i.getFloat32(0)}(s)).toFixed(this.fields[r].precision());break;case"double":o=(o=function(e){"use strict";var t,i,r;return t=new ArrayBuffer(8),i=new DataView(t),r=e.slice(0,32).join(""),i.setUint32(0,parseInt(r,2)),r="",r=e.slice(32,64).join(""),i.setUint32(4,parseInt(r,2)),i.getFloat64(0)}(s)).toFixed(this.fields[r].precision());break;case"unsignedByte":o=e(s);break;case"char":o=function(t){"use strict";var i,r,n,o,s;for(i=t.length/8,r=[],s="",o=0,n=0;n<i;n+=1)r=t.slice(o,o+8),s=s.concat(String.fromCharCode(e(r))),r=[],o+=8;return s}(s);break;case"NULL":o="NULL"}return"NaN"!==o&&"NULL"!==o&&0!==o||(o=""),o},r.prototype.decode=function(e){var t=[],i=0,r=e.length,n=this.fields.length,o=[];do{var s=this.fields[i].datatype(),a=this.computeDataSize(s,i,e);0==a&&(s="NULL");var l=this.decodeValue(s,a,i,e);o.push(l),i===n-1?(i=0,t.push(o),o=[]):i+=1}while(this.ptrStream<r);return t},r}),r("stream",["./utils","./abstractNode","./converter/base64","./tabledata","./constants"],function(e,t,i,r,n){var o=function(e){t.prototype.constructor.call(this,e,n.TAG.STREAM),this.value=e.textContent};return e.inherits(t,o),o.prototype.type=function(){return this.attributes.type},o.prototype.href=function(){return this.attributes.href},o.prototype.actuate=function(){return this.attributes.actuate},o.prototype.encoding=function(){return this.attributes.encoding},o.prototype.expires=function(){return this.attributes.expires},o.prototype.rights=function(){return this.attributes.rights},o.prototype.getContent=function(e,t){var n;if(null!=e&&e){var o=new i(t);n=new r(null,o.decode(this.value))}else n=this.value;return n},o}),r("binary",["./utils","./stream","./abstractData","./constants"],function(e,t,i,r){var n=function(e){i.prototype.constructor.call(this,e,r.TAG.BINARY),this.stream=o(e)},o=function(e){for(var i,n=0;null!=e&&n<e.childNodes.length;n++){var o=e.childNodes[n];if(1==o.nodeType){if(o.localName!=r.TAG.STREAM)throw new Error("Unknown element");i=new t(o)}}return i};return e.inherits(i,n),n.prototype.getStream=function(){return this.stream},n}),r("binary2",["./utils","./stream","./abstractData","./constants"],function(e,t,i,r){var n=function(e){i.prototype.constructor.call(this,e,r.TAG.BINARY2);this.stream=o(this,e)},o=function(e,t){for(var i,n=0;null!=t&&n<t.childNodes.length;n++){var o=t.childNodes[n];if(1==o.nodeType){var s=o.localName;s==r.TAG.STREAM?i=new Definitions(o):e.getCache().addWarning("unknown element "+s+" in Binary2 node")}}return i};return e.inherits(i,n),n.prototype.getStream=function(){return this.stream},n}),r("fits",["./utils","./abstractData","./stream","./constants"],function(e,t,i,r){var n=function(e){t.prototype.constructor.call(this,e,r.TAG.FITS);this.stream=o(this,e)},o=function(e,t){for(var i,n=0;null!=t&&n<t.childNodes.length;n++){var o=t.childNodes[n];if(1==o.nodeType){var s=o.localName;s==r.TAG.STREAM?i=new Definitions(o):e.getCache().addWarning("unknown element "+s+" in Fits node")}}return i};return e.inherits(t,n),n.prototype.getStream=function(){return this.stream},n.prototype.extnum=function(){return this.attributes.extnum},n}),r("data",["./utils","./abstractNode","./tabledata","./binary","./binary2","./fits","./info","./constants"],function(e,t,i,r,n,o,s,a){var l=function(e){t.prototype.constructor.call(this,e,a.TAG.DATA);var i=u(this,e);this.data=i[0],this.infos=i[1]},u=function(e,t){for(var l,u=[],c=0;null!=t&&c<t.childNodes.length;c++){var h=t.childNodes[c];if(1==h.nodeType){var d=h.localName;switch(d){case a.TAG.TABLEDATA:l=new i(h);break;case a.TAG.BINARY:l=new r(h);break;case a.TAG.BINARY2:l=new n(h);break;case a.TAG.FITS:l=new o(h);break;case a.TAG.INFO:u.push(new s(h));break;default:e.getCache().addWarning("unknown element "+d+" in Data node")}}}return[l,u]};return e.inherits(t,l),l.prototype.getData=function(){return this.data},l.prototype.getDataImplementationName=function(){return this.data.getTagName()},l.prototype.getInfos=function(){return this.infos},l}),r("table",["./utils","./abstractNode","./description","./field","./param","./group","./link","./data","./info","./constants"],function(e,t,i,r,n,o,s,a,l,u){var c=function(e){t.prototype.constructor.call(this,e,u.TAG.TABLE);var i=h(this,e);this.fields=i[0],this.params=i[1],this.groups=i[2],this.links=i[3],this.data=i[4],this.description=i[5],this.infos=i[6]},h=function(e,t){for(var c,h,d=[],p=[],f=[],g=[],m=[],v=0;null!=t&&v<t.childNodes.length;v++){var y=t.childNodes[v];if(1==y.nodeType){var b=y.localName;switch(b){case u.TAG.DESCRIPTION:h=new i(y);break;case u.TAG.FIELD:d.push(new r(y));break;case u.TAG.PARAM:p.push(new n(y));break;case u.TAG.GROUP:f.push(new o(y));break;case u.TAG.LINK:g.push(new s(y));break;case u.TAG.DATA:c=new a(y);break;case u.TAG.INFO:m.push(new l(y));break;default:e.getCache().addWarning("unknown element "+b+" in Table node")}}}return[d,p,f,g,c,h,m]};return e.inherits(t,c),c.prototype.ID=function(){return this.attributes.ID},c.prototype.name=function(){return this.attributes.name},c.prototype.ref=function(){return this.attributes.ref},c.prototype.ucd=function(){return this.attributes.ucd},c.prototype.utype=function(){return this.attributes.utype},c.prototype.nrows=function(){return this.attributes.nrows},c.prototype.getFields=function(){return this.fields},c.prototype.getParams=function(){return this.params},c.prototype.getGroups=function(){return this.groups},c.prototype.getLinks=function(){return this.links},c.prototype.getData=function(){return this.data},c.prototype.getInfos=function(){return this.infos},c.prototype.getDescription=function(){return this.description},c}),r("resource",["./utils","./abstractNode","./description","./info","./table","./link","./coosys","./param","./group","./constants"],function(e,t,i,r,n,o,s,a,l,u){var c=function(e){t.prototype.constructor.call(this,e,u.TAG.RESOURCE);var i=h(this,e);this.description=i[0],this.infos=i[1],this.coosyss=i[2],this.params=i[3],this.groups=i[4],this.abstractSequences=i[5]},h=function(e,t){for(var h,d=[],p=[],f=[],g=[],m=[],v=0,y=0,b=0;null!=t&&b<t.childNodes.length;b++){if(1==(x=t.childNodes[b]).nodeType)switch(w=x.localName){case u.TAG.DESCRIPTION:h=new i(x),y++;break;case u.TAG.INFO:d.push(new r(x)),y++;break;case u.TAG.COOSYS:p.push(new s),y++;break;case u.TAG.GROUP:f.push(new l),y++;break;case u.TAG.PARAM:g.push(new a),y++;break;default:v=b}if(0!=v)break}y>v&&(v=y);for(b=v;null!=t&&b<t.childNodes.length;b++){var x,w,T={},_=[],C=[];if(1==(x=t.childNodes[b]).nodeType)switch(w=x.localName){case u.TAG.LINK:_.push(new o(x));break;case u.TAG.TABLE:T.TABLE=new n(x),0!=_.length&&(T.LINKS=_,m.push(T.LINKS),T.LINKS=[],_=[]),0!=C.length&&(T.INFOS=C,m.push(T.INFOS),T.INFOS=[],C=[]),m.push(T.TABLE);break;case u.TAG.RESOURCE:T.RESOURCE=new c(x),0!=_.length&&(T.LINKS=_,m.push(T.LINKS),T.LINKS=[],_=[]),0!=C.length&&(T.INFOS=C,m.push(T.INFOS),T.INFOS=[],C=[]),m.push(T.RESOURCE);break;case u.TAG.INFO:C.push(new r(x)),b==t.childNodes.length-1&&m.push(C);break;default:e.getCache().addWarning("Unkknown element "+w+" in RESOURCE node")}}return[h,d,p,g,f,m]};return e.inherits(t,c),c.prototype.ID=function(){return this.attributes.ID},c.prototype.name=function(){return this.attributes.name},c.prototype.utype=function(){return this.attributes.utype},c.prototype.type=function(){return this.attributes.type},c.prototype.getDescription=function(){return this.description},c.prototype.getInfos=function(){return this.infos},c.prototype.getCoosyss=function(){return this.coosyss},c.prototype.getGroups=function(){return this.groups},c.prototype.getParams=function(){return this.params},c.prototype.getResourcesOrTables=function(){return this.abstractSequences},c}),r("converter/geojson",["../utils","../constants"],function(e,t){function i(e,n){for(var o=e.getResourcesOrTables(),s=0;s<o.length;s++){var a=o[s];a.getTagName()==t.TAG.RESOURCE?i(a,n):a.getTagName()==t.TAG.TABLE&&r(a,n)}}function r(e,i){var r,o=e.getFields(),s=e.getData(),a=e.getInfos();switch(s.getDataImplementationName()){case t.TAG.TABLEDATA:r=s.getData().getTrs();break;case t.TAG.BINARY:r=s.getData().getStream().getContent(!0,o).getTrs();break;case t.TAG.BINARY2:throw new Error("Binary2 not implemented");case t.TAG.FITS:throw new Error("Fits not implemented");default:throw new Error("Type of data not implemented for "+e)}n(o,a,r,i)}function n(e,t,i,r){for(var n=0;n<i.length;n++){var s=i[n].getTds();r.push(o(e,t,s))}}function o(t,i,r){function n(e,t){return 0!=e.filter(function(e){return e===t}).length}for(var o={type:"Feature",geometry:null,properties:{}},u={},c=0;c<r.length;c++){var h=r[c],d=t[c],p=d.getValues(),f=null!=p?p.null():null,g=d.ucd(),m=d.datatype(),v=h.getContent(),y=d.name();if(n(a,g))u.RA=Number.parseFloat(v),u.COOSYS=d.ref();else if(n(l,g))u.DEC=Number.parseFloat(v);else if(n(s,g))u.ID=v;else{var b=o.properties;v!=f&&(b[y]=function(e,t){var i;switch(m){case"short":case"int":case"long":i=Number.parseInt(e);break;case"float":case"double":i=Number.parseFloat(e);break;default:i=e}return i}(v))}}u.hasOwnProperty("ID")||(u.ID=e.guid());for(c=0;c<i.length;c++){var x=i[c];b[x.name()]=x.value()}!function(e){if(!(e.hasOwnProperty("RA")&&e.hasOwnProperty("DEC")&&e.hasOwnProperty("COOSYS")&&e.hasOwnProperty("ID")))throw new Error("core metadata missing "+JSON.stringify(e))}(u);var w={type:"Point",coordinates:[u.RA,u.DEC],crs:{type:"name",properties:{name:u.COOSYS}}};return o.geometry=w,o}var s=["meta.record","meta.id;meta.main","VOX:Image_Titleq"],a=["pos.eq.ra;meta.main","POS_EQ_RA_MAIN"],l=["pos.eq.dec;meta.main","POS_EQ_DEC_MAIN"],u=function(e){this.votable=e,this.featureCollection=function(e){var t={type:"FeatureCollection",features:[]},r=function(e){var t,i=e.getDefinitions();return null!=i&&(t=i.getCoosyss()[0]),null!=e.getCoosyss()[0]&&(t=e.getCoosyss()[0]),t}(e);null!=r&&(t.crs={type:"name",properties:{name:r}});for(var n=[],o=e.getResources(),s=0;s<o.length;s++)i(o[s],n);return t.features=n,t}(this.votable)};return u.prototype.getGeoJSon=function(e){var t=!1|e;return JSON.stringify(this.featureCollection,null,t)},u}),r("votable",["./utils","./abstractNode","./definitions","./info","./resource","./description","./coosys","./group","./param","./converter/geojson","./constants"],function(e,t,i,r,n,o,s,a,l,u,c){var h=function(e){var i=(e=function(e){if(null==e)throw new Error("xml cannot be null");if("string"==typeof e)e=(new DOMParser).parseFromString(e,"application/xml");else if(null==e.documentElement)throw new Error("This object is not supported");if(e.documentElement.localName!=c.TAG.VOTABLE)throw new Error("This input is not a VOTable");return e}(e)).documentElement;t.prototype.constructor.call(this,i,c.TAG.VOTABLE);var r=d(this,i);this.definitions=r[0],this.infos=r[1],this.resources=r[2],this.description=r[3],this.coosyss=r[4],this.groups=r[5],this.params=r[6]},d=function(e,t){for(var u,h,d=t,p=[],f=[],g=[],m=[],v=[],y=0;y<d.childNodes.length;y++){var b=d.childNodes[y];if(1==b.nodeType){var x=b.localName;switch(x){case c.TAG.DEFINITIONS:u=new i(b);break;case c.TAG.INFO:p.push(new r(b));break;case c.TAG.RESOURCE:f.push(new n(b));break;case c.TAG.DESCRIPTION:h=new o(b);break;case c.TAG.COOSYS:g.push(new s(b));break;case c.TAG.GROUP:m.push(new a(b));break;case c.TAG.PARAM:v.push(new l(b));break;default:e.getCache().addWarning("unknown element "+x+" in Votable node")}}}return[u,p,f,h,g,m,v]};return e.inherits(t,h),h.prototype.ID=function(){return this.attributes.ID},h.prototype.version=function(){return this.attributes.version},h.prototype.getInfos=function(){return this.infos},h.prototype.getDefinitions=function(){return this.definitions},h.prototype.getResources=function(){return this.resources},h.prototype.getCoosyss=function(){return this.coosyss},h.prototype.getGroups=function(){return this.groups},h.prototype.getParams=function(){return this.params},h.prototype.getDescription=function(){return this.description},h.prototype.getVotableEltByID=function(e){return this.getCache().getEltsByID()[e]},h.prototype.getVotableEltsByName=function(e){return this.getCache().getEltsByName()[e]},h.prototype.convertToGeoJSon=function(e){return new u(this).getGeoJSon(e)},h}),r("JsVotable",["./votable","./binary","./binary2","./coosys","./data","./definitions","./description","./field","./fieldref","./fits","./group","./info","./link","./max","./min","./option","./param","./paramref","./resource","./stream","./table","./tabledata","./td","./tr","./values","./constants"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x,w,T,_,C,S){var E={};return E.Constants=S,E.Votable=e,E.Binary=t,E.Binary2=i,E.Coosys=r,E.Data=n,E.Definitions=o,E.Description=s,E.Field=a,E.Fieldref=l,E.Fits=u,E.Group=c,E.Info=h,E.Link=d,E.Max=p,E.Min=f,E.Option=g,E.Param=m,E.Paramref=v,E.Resource=y,E.Stream=b,E.Table=x,E.TableData=w,E.Td=T,E.Tr=_,E.Values=C,E.version={major:2,minor:0,patch:2,date:"2019-02-15",toString:function(){return this.major+"."+this.minor+"."+this.patch}},window.JsVotable=E,E}),t(["JsVotable"]),r("jquery",function(){return e}),t("JsVotable")}),function(e,t){"function"==typeof r&&r.amd?r("jscsv",["jquery"],t):e.mylib=t(e.$)}(this,function(e){var t,i;return function(e){function r(e,t){return v.call(e,t)}function n(e,t){var i,r,n,o,s,a,l,u,c,h,d=t&&t.split("/"),p=g.map,f=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(e=(d=d.slice(0,d.length-1)).concat(e.split("/")),u=0;u<e.length;u+=1)if("."===(h=e[u]))e.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||f)&&p){for(u=(i=e.split("/")).length;u>0;u-=1){if(r=i.slice(0,u).join("/"),d)for(c=d.length;c>0;c-=1)if((n=p[d.slice(0,c).join("/")])&&(n=n[r])){o=n,s=u;break}if(o)break;!a&&f&&f[r]&&(a=f[r],l=u)}!o&&a&&(o=a,s=l),o&&(i.splice(0,s,o),e=i.join("/"))}return e}function o(t,i){return function(){return c.apply(e,y.call(arguments,0).concat([t,i]))}}function s(e){return function(t){p[e]=t}}function a(t){if(r(f,t)){var i=f[t];delete f[t],m[t]=!0,u.apply(e,i)}if(!r(p,t)&&!r(m,t))throw new Error("No "+t);return p[t]}function l(e){var t,i=e?e.indexOf("!"):-1;return i>-1&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}var u,c,h,d,p={},f={},g={},m={},v=Object.prototype.hasOwnProperty,y=[].slice;h=function(e,t){var i,r=l(e),o=r[0];return e=r[1],o&&(i=a(o=n(o,t))),o?e=i&&i.normalize?i.normalize(e,function(e){return function(t){return n(t,e)}}(t)):n(e,t):(o=(r=l(e=n(e,t)))[0],e=r[1],o&&(i=a(o))),{f:o?o+"!"+e:e,n:e,pr:o,p:i}},d={require:function(e){return o(e)},exports:function(e){var t=p[e];return void 0!==t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:function(e){return function(){return g&&g.config&&g.config[e]||{}}}(e)}}},u=function(t,i,n,l){var u,c,g,v,y,b,x=[];if(l=l||t,"function"==typeof n){for(i=!i.length&&n.length?["require","exports","module"]:i,y=0;y<i.length;y+=1)if("require"===(c=(v=h(i[y],l)).f))x[y]=d.require(t);else if("exports"===c)x[y]=d.exports(t),b=!0;else if("module"===c)u=x[y]=d.module(t);else if(r(p,c)||r(f,c)||r(m,c))x[y]=a(c);else{if(!v.p)throw new Error(t+" missing "+c);v.p.load(v.n,o(l,!0),s(c),{}),x[y]=p[c]}g=n.apply(p[t],x),t&&(u&&u.exports!==e&&u.exports!==p[t]?p[t]=u.exports:g===e&&b||(p[t]=g))}else t&&(p[t]=n)},t=c=function(t,i,r,n,o){return"string"==typeof t?d[t]?d[t](i):a(h(t,i).f):(t.splice||(g=t,i.splice?(t=i,i=r,r=null):t=e),i=i||function(){},"function"==typeof r&&(r=n,n=o),n?u(e,t,i,r):setTimeout(function(){u(e,t,i,r)},4),c)},c.config=function(e){return(g=e).deps&&c(g.deps,g.callback),c},(i=function(e,t,i){t.splice||(i=t,t=[]),r(p,e)||r(f,e)||(f[e]=[e,t,i])}).amd={jQuery:!0}}(),i("../minify/almond",function(){}),i("csv",[],function(){function e(e,r,n){for(var o=e.split("\n"),s=0,a=0;a<o.length&&t(o[a],r,n.name);a++)s++;return i(o,s,r,n)}function t(e,t,i){return e.startsWith(o)||0==e.length||i.toString()==e.split(t).toString()}function i(e,t,i,n){for(var o=[],s=t;s<e.length;s++)0!==e[s].length&&o.push(r(e[s],i,n));return o}function r(e,t,i){for(var r={},o=e.split(t),s=0;s<o.length;s++)r[i.name[s]]=n(o[s],i.datatype[s]);return r}function n(e,t){var i;switch(t){case"short":case"int":case"long":i=Number.parseInt(e);break;case"float":case"double":i=Number.parseFloat(e);break;default:i=e}return i}var o="#",s=function(t,i,r){(function(e){if(null==e)throw new Error("csv cannot be null");if("string"!=typeof e)throw new Error("This object is not supported")})(t),this.store=e(t,i,r)};return s.prototype.getStore=function(){return this.store},s.prototype.getGeoJSon=function(e,t){for(var i=e.RA,r=e.DEC,n=e.ID,o=[],s=0;s<this.store.length;s++){var a={type:"Feature",id:this.store[s][n],geometry:{type:"Point",coordinates:[this.store[s][i],this.store[s][r]],crs:{type:"name",properties:{name:t}}}},l=JSON.parse(JSON.stringify(this.store[s]));delete l[i],delete l[r],delete l[n],a.properties=l,o.push(a)}return{type:"FeatureCollection",features:o}},s}),i("JsCsv",["./csv"],function(e){var t={};return t.Csv=e,t.version={major:1,minor:1,patch:4,date:"2019-02-15",toString:function(){return this.major+"."+this.minor+"."+this.patch}},window.JsCsv=t,t}),t(["JsCsv"]),i("jquery",function(){return e}),t("JsCsv")}),r("gw/Layer/HipsCatLayer",["./AbstractHipsLayer","../Renderer/FeatureStyle","../Renderer/RendererManager","../Utils/Utils","../Renderer/RendererTileData","../Tiling/Tile","jsvotable","jscsv","../Utils/Constants","../Gui/dialog/ErrorDialog","../Utils/Proxy"],function(e,t,i,r,n,o,s,a,l,u,c){var h=function(t,i){var r;e.prototype.constructor.call(this,t,function(e){return e.icon=e.icon||"css/images/star16x16.png",e.background=!1,e.category=e.category||"Catalog",e.pickable=e.pickable||!0,e}(i));var n=new d(this.allowRequest(i.baseUrl)+"/properties").getProperties().hips_order;this.serviceUrl=this.allowRequest(i.baseUrl),this.minOrder=i.minOrder||2,this.maxOrder=Number.parseInt(n,10),this.maxRequests=i.maxRequests||4,this.invertY=i.invertY||!1;var o=new XMLHttpRequest;o.open("GET",c.proxify(this.allowRequest(i.baseUrl+"/metadata.xml")),!1),o.setRequestHeader("Accept","application/xml"),o.send(null);var a=new s.Votable(o.responseXML).getResources()[0].getResourcesOrTables()[0];for(this.fields=a.getFields(),this.raColNumber=null,this.decColNumber=null,this.sourceId=null,r=0;r<this.fields.length;r++){var l=this.fields[r].ucd();"pos.eq.ra;meta.main"===l?this.raColNumber=this.fields[r].name():"pos.eq.dec;meta.main"===l?this.decColNumber=this.fields[r].name():"meta.id;meta.main"===l&&(this.sourceId=this.fields[r].name())}for(this.extId="hipsCat",this.features=[],this.featuresSet={},this.freeRequests=[],this.tilesToLoad=[],r=0;r<this.maxRequests;r++)o=new XMLHttpRequest,this.freeRequests.push(o)};r.inherits(e,h);var d=function(e){var t;this.properties={};var i=new XMLHttpRequest;i.open("GET",c.proxify(e),!1),i.setRequestHeader("Accept","text/plain"),i.send();var r=i.responseText;r.trim();var n=r.split("\n");for(t=0;null!==n&&t<n.length;t++){var o=n[t];if(null===o||!(o.indexOf("#")>-1)&&o.trim()){var s=o.split("="),a=s[0].replace(/^\s+|\s+$/g,""),l=s[1].replace(/^\s+|\s+$/g,"");this.properties[a]=l}}};d.prototype.getProperties=function(){return this.properties},h.prototype._attach=function(t){e.prototype._attach.call(this,t),this.extId+=this.id,t.getTileManager().addPostRenderer(this)},h.prototype._detach=function(){this.getGlobe().getTileManager().removePostRenderer(this),e.prototype._detach.call(this)},h.prototype.launchRequest=function(e,t){var i=e.extension[this.extId];if(0!==this.freeRequests.length){i.state=h.TileState.LOADING,this.maxRequests===this.freeRequests.length&&this.getGlobe().publishEvent(l.EVENT_MSG.LAYER_START_LOAD,this);var r=this.freeRequests.pop(),n=this;r.open("GET",c.proxify(t)),r.setRequestHeader("Accept","application/xml"),r.send(null),r.onreadystatechange=function(t){if(4===r.readyState){if(200===r.status){var o={},s={name:[],datatype:[]};n.fields.forEach(function(e){s.name.push(e.name()),s.datatype.push(e.datatype())});var u,c=new a.Csv(r.response,"\t",s).getGeoJSon({RA:n.raColNumber,DEC:n.decColNumber,ID:n.sourceId},"Equatorial").features;for(o.features=c,o.totalResults=c.length,i.complete=o.totalResults===o.features.length,u=o.features.length-1;u>=0;u--){var d=o.features[u];n.featuresSet.hasOwnProperty(d.id)&&o.features.splice(u,1),d.properties.style=this.style,n.addFeature(d,e)}n.globe.refresh(),o.hasOwnProperty(c)&&o.features.length>0&&n.globe.publishEvent(l.EVENT_MSG.FEATURED_ADDED,{layer:n,features:o.features})}else r.status>=400&&(i.complete=!0);i.state=h.TileState.LOADED,n.freeRequests.push(r),n.maxRequests===n.freeRequests.length&&n.globe.publishEvent(l.EVENT_MSG.LAYER_END_LOAD,n)}}}},h.prototype.addFeature=function(e,t){var i,r=t.extension[this.extId];this.featuresSet.hasOwnProperty(e.id)?((i=this.featuresSet[e.id]).tiles.push(t),e=this.features[i.index]):(this.features.push(e),i={index:this.features.length-1,tiles:[t]},this.featuresSet[e.id]=i),r.featureIds.push(e.id),e.geometry.gid=e.id;var n=e.properties.style?e.properties.style:this.style;this.getGlobe().getRendererManager().addGeometryToTile(this,e.geometry,n,t)},h.prototype.removeFeature=function(e,t){var i=this.featuresSet[e];if(i){var r=i.tiles.indexOf(t);if(r>=0?i.tiles.splice(r,1):u.open(l.LEVEL.DEBUG,"HipsCatLayer internal error : tile not found when removing feature"),0===i.tiles.length){delete this.featuresSet[e];var n=this.features.pop();i.index<this.features.length&&(this.features[i.index]=n,this.featuresSet[n.id].index=i.index)}}},h.prototype.modifyFeatureStyle=function(e,t){e.properties.style=t;var i,r=this.featuresSet[e.id];if(r)for(i=0;i<r.tiles.length;i++){var n=r.tiles[i];this.getGlobe().getRendererManager().removeGeometryFromTile(e.geometry,n),this.getGlobe().getRendererManager().addGeometryToTile(this,e.geometry,t,n)}},h.TileState={LOADING:0,LOADED:1,NOT_LOADED:2,INHERIT_PARENT:3},h.prototype.generate=function(e){this.minOrder<=e.order&&e.order<=this.maxOrder&&(e.extension[this.extId]=new p(this,e,null))};var p=function(e,t,i){this.layer=e,this.parent=i,this.tile=t,this.featureIds=[],this.state=h.TileState.NOT_LOADED,this.complete=!1,this.childrenCreated=!1};function f(e,t){return e.tile.distance-t.tile.distance}return p.prototype.traverse=function(e){var t;if(this.layer.isVisible()&&e.state===o.State.LOADED&&(this.state===h.TileState.NOT_LOADED&&this.layer.tilesToLoad.push(this),this.state===h.TileState.LOADED&&!this.complete&&e.state===o.State.LOADED&&e.children&&!this.childrenCreated)){for(t=0;t<4;t++)e.children[t].extension[this.layer.extId]||(e.children[t].extension[this.layer.extId]=new p(this.layer,e.children[t],this));this.childrenCreated=!0;var i=e.extension.renderer?e.extension.renderer.renderables:[];for(t=0;t<i.length;t++)i[t].bucket.layer===this.layer&&(i[t].hasChildren=!0)}},p.prototype.dispose=function(e,t){var i;if(this.parent&&this.parent.childrenCreated){this.parent.childrenCreated=!1;var r=this.parent.tile.extension.renderer?this.parent.tile.extension.renderer.renderables:[];for(i=0;i<r.length;i++)r[i].bucket.layer===this.layer&&(r[i].hasChildren=!1)}for(i=0;i<this.featureIds.length;i++)this.layer.removeFeature(this.featureIds[i],this.tile);this.tile=null,this.parent=null},h.prototype.buildUrl=function(e){var t;e.order<=0?t=this.serviceUrl+"/Norder"+e.order+"/Allsky.xml":(t=this.serviceUrl,t+="/Norder",t+=e.order,t+="/Dir",t+=1e4*Math.floor(e.pixelIndex/1e4),t+="/Npix",t+=e.pixelIndex,t+=".tsv");return t},h.prototype.getUrl=function(e){return this.allowRequest(this.buildUrl(e))},h.prototype.render=function(e){var t;if(this.visible){for(this.tilesToLoad.sort(f),t=0;t<this.tilesToLoad.length&&this.freeRequests.length>0;t++){var i=this.tilesToLoad[t].tile,r=this.buildUrl(i);r&&this.launchRequest(i,r)}this.tilesToLoad.length=0}},h}),r("gw/Layer/GeoJsonLayer",["../Utils/Utils","./AbstractVectorLayer","../Utils/Constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,i.LAYER.GeoJSON,e),this.gid=0};return e.inherits(t,r),r.prototype.addFeatureCollection=function(e){if(null==e)throw new ReferenceError("Error, featureCollection is null","GeoJsonLayer.js");var t,r={type:"name",properties:{name:i.CRS.WGS84}},n=e.crs?e.crs:r,o=e.features;if(o){for(var s=0;s<o.length;s++)this.addFeature(o[s],n);(t=o[0].geometry).type===i.GEOMETRY.Point&&3==t.coordinates.length&&(this.pickingNoDEM=!0)}},r.prototype._setDataType=function(e){this.datatype||(e.geometry.type.startsWith(i.GEOMETRY.Point)?this.dataType=i.GEOMETRY.Point:this.dataType=i.GEOMETRY.LineString)},r.prototype.addFeature=function(e,r){(function(e){var t=e.geometry;if(!t||!t.type)throw new RangeError("Invalid GeoJson","GeoJsonLayer.js")}).call(this,e),e=function(e,t){return e.geometry.crs||(e.geometry.crs=t||{type:"name",properties:{name:i.CRS.WGS84}}),e}.call(this,e,r),e=function(e){return e.geometry.gid=this.ID+"_GeoJSON_"+this.gid,this.gid++,e}.call(this,e),this._setDataType(e),t.prototype.addFeature.call(this,e)},r}),r("gw/Layer/OpenSearch/OpenSearchRequestPool",["../../Utils/Constants","../../Gui/dialog/ErrorDialog","../../Utils/Proxy","./OpenSearchUtils"],function(e,t,i,r){var n=function(){this.maxRunningRequests=4,this.maxPoolingRequests=50,this.runningRequests=[],this.resetMode=!1,this.freeRequests=[],this.poolingRequests=[],this.awaitingRequests=[],this.layers=[];for(var i=0;i<this.maxPoolingRequests;i++){var r=new XMLHttpRequest;r.numRequest=i,this.freeRequests.push(r)}t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[New] "+this.getPoolsStatus())};return n.prototype.getPoolsStatus=function(){var e="";return e+="Run : "+this.runningRequests.length+"/"+this.maxRunningRequests+" , ",e+="Wait : "+this.poolingRequests.length+"/"+this.maxPoolingRequests},n.prototype.getFreeRequest=function(){if(t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[getFreeRequest]"),0===this.freeRequests.length){var i=this.poolingRequests.splice(0,1)[0];return t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","Oldest pooling request cancel and reused"),i}return t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","Take one request from pool"),this.freeRequests.pop()},n.prototype.addQuery=function(r,n,o){if(t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[addQuery]"),!0!==this.resetMode){var s=n.getKey();if(void 0===this.layers[o.getID()]&&(this.layers[o.getID()]=o),!this.isQueryStillWanted(s,o.getID(),r)){var a=this.getFreeRequest(),l=this;a.key=s,a.layer=o,a.url=r,a.ontimeout=function(){t.open(e.LEVEL.DEBUG,"OpenSeachRequestPool","Server Timeout, resend later"),l.manageFinishedRequest(a),l.poolingRequests.push(a)},a.onabort=function(){t.open(e.LEVEL.ERROR,"OpenSearchRequestPool","Request aborted"),l.manageFinishedRequest(a)},a.onerror=function(){t.open(e.LEVEL.ERROR,"OpenSearchRequestPool","Request error: "+a.status),l.manageFinishedRequest(a)},a.onload=function(){if(200===a.status&&null!==a.response){const e=JSON.parse(a.response);var i=e.properties.totalResults;a.layer.computeFeaturesResponse(e.features,n,i)}else if(a.status>=400)return void t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool",a.responseText);l.manageFinishedRequest(a)},a.open("GET",i.proxify(r)),a.setRequestHeader("Accept","application/json"),this.poolingRequests.push(a),this.checkPool()}}else t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","addQuery halt, reset mode")},n.prototype.checkEachLayerFinished=function(){for(var t in this.layers){for(var i=this.layers[t],r=0;r<this.runningRequests.length;r++)if(void 0!==this.runningRequests[r].layer&&this.runningRequests[r].layer.getID()===t)return;for(r=0;r<this.poolingRequests.length;r++)if(void 0!==this.poolingRequests[r].layer&&this.poolingRequests[r].layer.getID()===t)return;i.getGlobe().publishEvent(e.EVENT_MSG.LAYER_END_LOAD,i)}},n.prototype.checkPool=function(){if(t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[checkPool]"+this.getPoolsStatus()),!0!==this.resetMode)if(this.runningRequests.length!==this.maxRunningRequests){this.checkEachLayerFinished(),t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","before : "+this.getPoolsStatus());var i=this.poolingRequests.pop();void 0!==i&&(this.runningRequests.push(i),i.layer.getGlobe().publishEvent(e.EVENT_MSG.LAYER_START_LOAD,i.layer),i.send(),t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","after : "+this.getPoolsStatus()),this.checkPool())}else t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","no running slot available, wait");else t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","checkPool halt, reset mode")},n.prototype.manageFinishedRequest=function(i){if(t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[manageFinishedRequest]"),!0!==this.resetMode){t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","before : "+this.getPoolsStatus());for(var r=-1,n=0;n<this.runningRequests.length;n++)this.runningRequests[n].numRequest===i.numRequest&&(r=n);r>=-1&&this.runningRequests.splice(r,1),this.freeRequests.push(i),t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","after : "+this.getPoolsStatus()),this.checkPool()}else t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","manageFinishedRequest halt, reset mode")},n.prototype.isQueryStillWanted=function(i,r,n){t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[isQueryStillWanted]");for(var o=0;o<this.runningRequests.length;o++)if(void 0!==this.runningRequests[o]&&this.runningRequests[o].key===i&&this.runningRequests[o].layer.getID()===r&&this.runningRequests[o].url===n)return!0;for(o=0;o<this.poolingRequests.length;o++)if(void 0!==this.poolingRequests[o]&&this.poolingRequests[o].key===i&&this.poolingRequests[o].url===n)return!0;return!1},n.prototype.resetPool=function(){this.resetMode=!0,t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[resetPool]"),this.removeRunningQueries(),this.removePoolQueries(),this.resetMode=!1},n.prototype.removeRunningQueries=function(){t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[removeRunningQueries]");for(var i=this.runningRequests.pop();null!=i;)i.abort(),this.freeRequests.push(i),i=this.runningRequests.pop()},n.prototype.removePoolQueries=function(){t.open(e.LEVEL.DEBUG,"OpenSearchRequestPool","[removePoolQueries]");for(var i=this.poolingRequests.pop();null!=i;)this.freeRequests.push(i),i=this.poolingRequests.pop()},n}),r("gw/Layer/LayerFactory",["jquery","../Utils/Constants","./WMSLayer","./WMTSLayer","./WCSElevationLayer","./VectorLayer","./AtmosphereLayer","./BingLayer","./GroundOverlayLayer","./OSMLayer","./TileWireframeLayer","./CoordinateGridLayer","./HipsFitsLayer","./HipsGraphicLayer","./MocLayer","./OpenSearchLayer","./WMSElevationLayer","./HipsMetadata","./HipsCatLayer","./GeoJsonLayer","./OpenSearch/OpenSearchRequestPool"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b,x){function w(t,i){var r;void 0===t?r=new v(i.baseUrl):t instanceof v?r=t:(r=new v).setMetadata(t);var n,o=r.getHipsMetadata(),s=i.hasOwnProperty("hips_tile_format")?i.hips_tile_format:o.hips_tile_format;switch(i.hasOwnProperty("dataproduct_type")?i.dataproduct_type:o.dataproduct_type){case r.DataProductType.catalog:n=function(e,t){return new y(e,t)}(o,i);break;case r.DataProductType.cube:throw new RangeError("Hips : cannot handle cube dataproduct","LayerFactor.js");case r.DataProductType.image:i.category=i.hasOwnProperty("category")?i.category:"Image";var a=-1!==e.inArray(r.HipsTileFormat.png,s),l=-1!==e.inArray(r.HipsTileFormat.jpeg,s),u=-1!==e.inArray(r.HipsTileFormat.fits,s);if(i.format)switch(i.format){case r.HipsTileFormat.png:case"jpg":n=_(o,i);break;case r.HipsTileFormat.fits:n=T(o,i);break;default:n=_(o,i)}else a?(i.format=r.HipsTileFormat.png,n=_(o,i)):l?(i.format="jpg",n=_(o,i)):u?(i.format=r.HipsTileFormat.fits,n=T(o,i)):(i.format="jpg",n=_(o,i));break;case r.DataProductType.meta:throw new RangeError("Hips : cannot handle META dataproduct","LayerFactor.js");default:throw new RangeError("Hips : Unknown dataproduct type","LayerFactor.js")}return n}function T(e,t){return new d(e,t)}function _(e,t){return new p(e,t)}return this.openSearchRequestPool=new x,{create:function(e){var d;switch(e.type){case t.LAYER.WMS:d=new i(e);break;case t.LAYER.WMTS:d=new r(e);break;case t.LAYER.WMSElevation:d=new m(e);break;case t.LAYER.WCSElevation:d=new n(e);break;case t.LAYER.GeoJSON:(d=new b(e)).pickable=!e.hasOwnProperty("pickable")||e.pickable;break;case t.LAYER.Vector:(d=new o(e)).pickable=!e.hasOwnProperty("pickable")||e.pickable,d.deletable=!!e.hasOwnProperty("deletable")&&e.deletable;break;case t.LAYER.Atmosphere:d=new s(e);break;case t.LAYER.Bing:d=new a(e);break;case t.LAYER.GroundOverlay:d=new l(e);break;case t.LAYER.OSM:d=new u(e);break;case t.LAYER.HipsGrid:case t.LAYER.TileWireframe:d=new c(e);break;case t.LAYER.HipsCat:d=new y(e.hipsMetadata,e);break;case t.LAYER.CoordinateGrid:d=new h(e);break;case t.LAYER.Hips:d=w(e.hipsMetadata,e);break;case t.LAYER.Moc:d=function(e){e.style.fill=!0,e.style.fillColor[3]=.3;var t=new f(e);return t.dataType="line",t}(e);break;case t.LAYER.OpenSearch:d=function(e){e.openSearchRequestPool=this.openSearchRequestPool;var t=new g(e);return e.displayProperties&&(t.displayProperties=e.displayProperties),t.pickable=!e.hasOwnProperty("pickable")||e.pickable,t}(e);break;default:throw new RangeError("Unable to create the layer "+e.type,"LayerFactor.js")}return d}}}),r("gw/Registry/AbstractRegistryHandler",["underscore-min","../Layer/LayerFactory","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r){var n=function(){this.next={handleRequest:function(e,t,n){r.open(i.LEVEL.DEBUG,"AbstractRegistryHandler.js","All strategies exhausted.")}}};return n.prototype.setNext=function(e){return this.next=e,e},n.prototype.handleRequest=function(e,t,i){},n.prototype._handlePendingLayers=function(e,n){for(var o=0;o<n.length&&0!==e.length;o++){var s=n[o];if(0!=e.length&&s.isBackground()){for(var a=e.length;a>0;){var l=e[--a];try{n.push(t.create(l)),e.splice(a,1)}catch(e){r.open(i.LEVEL.DEBUG,"Failed to create layer",e.message)}}break}}},n}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof r&&r.amd)r("wms-capabilities",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).WMSCapabilities=e()}}(function(){return function e(i,r,n){function o(a,l){if(!r[a]){if(!i[a]){var u="function"==typeof t&&t;if(!l&&u)return u(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[a]={exports:{}};i[a][0].call(h.exports,function(e){var t=i[a][1][e];return o(t||e)},h,h.exports,e,i,r,n)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){"use strict";t.exports=e("./src/wms")},{"./src/wms":6}],2:[function(e,t,i){"use strict";t.exports={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12}},{}],3:[function(e,t,i){"use strict";t.exports=function(e){return void 0!==e}},{}],4:[function(e,t,i){"use strict";t.exports=function(e,t,i){return t in e?e[t]:e[t]=i}},{}],5:[function(e,t,i){"use strict";var r=e("./isdef"),n=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;t.exports={trim:function(e){return e.replace(n,"")},padNumber:function(e,t,i){var n=r(i)?e.toFixed(i):String(e),o=n.indexOf(".");return-1==o&&(o=n.length),function(e,t){return new Array(t+1).join(e)}("0",Math.max(0,t-o))+n}}},{"./isdef":3}],6:[function(e,t,i){"use strict";var r=e("./xml_parser"),n=e("./utils/isdef"),o=e("./node_types"),s=e("./utils/setifundefined"),a=e("./xsd"),l=e("./xlink");function u(e){this.version=void 0,this._parser=new r,this._data=e}var c=r.makeObjectPropertySetter;u.prototype.data=function(e){return this._data=e,this},u.prototype.toJSON=function(e){return e=e||this._data,this.parse(e)},u.prototype.parse=function(e){return this._readFromDocument(this._parser.toDocument(e))},u.prototype._readFromDocument=function(e){for(var t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==o.ELEMENT)return this.readFromNode(t);return null},u.prototype.readFromNode=function(e){return this.version=e.getAttribute("version"),r.pushParseAndPop({version:this.version},u.PARSERS,e,[])||null},u._readAttribution=function(e,t){return r.pushParseAndPop({},u.ATTRIBUTION_PARSERS,e,t)},u._readBoundingBoxExtent=function(e){var t=a.readDecimalString;return[t(e.getAttribute("minx")),t(e.getAttribute("miny")),t(e.getAttribute("maxx")),t(e.getAttribute("maxy"))]},u._readBoundingBox=function(e,t){var i=u._readBoundingBoxExtent(e),r=a.readDecimalString,n=[r(e.getAttribute("resx")),r(e.getAttribute("resy"))];return{crs:e.getAttribute("CRS")||e.getAttribute("SRS"),extent:i,res:n}},u._readLatLonBoundingBox=function(e,t){var i=u._readBoundingBoxExtent(e);if(n(i[0])&&n(i[1])&&n(i[2])&&n(i[3]))return i},u._readScaleHint=function(e,t){return{min:parseFloat(e.getAttribute("min")),max:parseFloat(e.getAttribute("max"))}},u._readEXGeographicBoundingBox=function(e,t){var i=r.pushParseAndPop({},u.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS,e,t);if(n(i)){var o=i.westBoundLongitude,s=i.southBoundLatitude,a=i.eastBoundLongitude,l=i.northBoundLatitude;if(n(o)&&n(s)&&n(a)&&n(l))return[o,s,a,l]}},u._readCapability=function(e,t){return r.pushParseAndPop({},u.CAPABILITY_PARSERS,e,t)},u._readService=function(e,t){return r.pushParseAndPop({},u.SERVICE_PARSERS,e,t)},u._readContactInformation=function(e,t){return r.pushParseAndPop({},u.CONTACT_INFORMATION_PARSERS,e,t)},u._readContactPersonPrimary=function(e,t){return r.pushParseAndPop({},u.CONTACT_PERSON_PARSERS,e,t)},u._readContactAddress=function(e,t){return r.pushParseAndPop({},u.CONTACT_ADDRESS_PARSERS,e,t)},u._readException=function(e,t){return r.pushParseAndPop([],u.EXCEPTION_PARSERS,e,t)},u._readCapabilityLayer=function(e,t){return r.pushParseAndPop({},u.LAYER_PARSERS,e,t)},u._readLayer=function(e,t){var i=t[t.length-1],o=r.pushParseAndPop({},u.LAYER_PARSERS,e,t);if(n(o)){var l=a.readBooleanString(e.getAttribute("queryable"));n(l)||(l=i.queryable),o.queryable=!!n(l)&&l;var c=a.readNonNegativeIntegerString(e.getAttribute("cascaded"));n(c)||(c=i.cascaded),o.cascaded=c;var h=a.readBooleanString(e.getAttribute("opaque"));n(h)||(h=i.opaque),o.opaque=!!n(h)&&h;var d=a.readBooleanString(e.getAttribute("noSubsets"));n(d)||(d=i.noSubsets),o.noSubsets=!!n(d)&&d;var p=a.readDecimalString(e.getAttribute("fixedWidth"));n(p)||(p=i.fixedWidth),o.fixedWidth=p;var f=a.readDecimalString(e.getAttribute("fixedHeight"));n(f)||(f=i.fixedHeight),o.fixedHeight=f;for(var g=["Style","CRS","AuthorityURL"],m=0,v=g.length;m<v;m++){var y=i[x=g[m]];if(n(y))w=(w=s(o,x,[])).concat(y),o[x]=w}var b=["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"];for(m=0,v=b.length;m<v;m++){var x,w=o[x=b[m]];if(!n(w)){y=i[x];o[x]=y}}return o}},u._readDimension=function(e,t){return{name:e.getAttribute("name"),units:e.getAttribute("units"),unitSymbol:e.getAttribute("unitSymbol"),default:e.getAttribute("default"),multipleValues:a.readBooleanString(e.getAttribute("multipleValues")),nearestValue:a.readBooleanString(e.getAttribute("nearestValue")),current:a.readBooleanString(e.getAttribute("current")),values:a.readString(e)}},u._readFormatOnlineresource=function(e,t){return r.pushParseAndPop({},u.FORMAT_ONLINERESOURCE_PARSERS,e,t)},u._readRequest=function(e,t){return r.pushParseAndPop({},u.REQUEST_PARSERS,e,t)},u._readDCPType=function(e,t){return r.pushParseAndPop({},u.DCPTYPE_PARSERS,e,t)},u._readHTTP=function(e,t){return r.pushParseAndPop({},u.HTTP_PARSERS,e,t)},u._readOperationType=function(e,t){return r.pushParseAndPop({},u.OPERATIONTYPE_PARSERS,e,t)},u._readSizedFormatOnlineresource=function(e,t){var i=u._readFormatOnlineresource(e,t);if(n(i)){var r=a.readNonNegativeIntegerString,o=[r(e.getAttribute("width")),r(e.getAttribute("height"))];return i.size=o,i}},u._readAuthorityURL=function(e,t){var i=u._readFormatOnlineresource(e,t);if(n(i))return i.name=e.getAttribute("name"),i},u._readMetadataURL=function(e,t){var i=u._readFormatOnlineresource(e,t);if(n(i))return i.type=e.getAttribute("type"),i},u._readStyle=function(e,t){return r.pushParseAndPop({},u.STYLE_PARSERS,e,t)},u._readKeywordList=function(e,t){return r.pushParseAndPop([],u.KEYWORDLIST_PARSERS,e,t)},u.NAMESPACE_URIS=[null,"http://www.opengis.net/wms"],u.PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Service:c(u._readService),Capability:c(u._readCapability)}),u.CAPABILITY_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Request:c(u._readRequest),Exception:c(u._readException),Layer:c(u._readCapabilityLayer)}),u.SERVICE_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Name:c(a.readString),Title:c(a.readString),Abstract:c(a.readString),KeywordList:c(u._readKeywordList),OnlineResource:c(l.readHref),ContactInformation:c(u._readContactInformation),Fees:c(a.readString),AccessConstraints:c(a.readString),LayerLimit:c(a.readNonNegativeInteger),MaxWidth:c(a.readNonNegativeInteger),MaxHeight:c(a.readNonNegativeInteger)}),u.CONTACT_INFORMATION_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{ContactPersonPrimary:c(u._readContactPersonPrimary),ContactPosition:c(a.readString),ContactAddress:c(u._readContactAddress),ContactVoiceTelephone:c(a.readString),ContactFacsimileTelephone:c(a.readString),ContactElectronicMailAddress:c(a.readString)}),u.CONTACT_PERSON_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{ContactPerson:c(a.readString),ContactOrganization:c(a.readString)}),u.CONTACT_ADDRESS_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{AddressType:c(a.readString),Address:c(a.readString),City:c(a.readString),StateOrProvince:c(a.readString),PostCode:c(a.readString),Country:c(a.readString)}),u.EXCEPTION_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Format:r.makeArrayPusher(a.readString)}),u.LAYER_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Name:c(a.readString),Title:c(a.readString),Abstract:c(a.readString),KeywordList:c(u._readKeywordList),CRS:r.makeObjectPropertyPusher(a.readString),SRS:r.makeObjectPropertyPusher(a.readString),EX_GeographicBoundingBox:c(u._readEXGeographicBoundingBox),LatLonBoundingBox:c(u._readLatLonBoundingBox),BoundingBox:r.makeObjectPropertyPusher(u._readBoundingBox),Dimension:r.makeObjectPropertyPusher(u._readDimension),Attribution:c(u._readAttribution),AuthorityURL:r.makeObjectPropertyPusher(u._readAuthorityURL),Identifier:r.makeObjectPropertyPusher(a.readString),MetadataURL:r.makeObjectPropertyPusher(u._readMetadataURL),DataURL:r.makeObjectPropertyPusher(u._readFormatOnlineresource),FeatureListURL:r.makeObjectPropertyPusher(u._readFormatOnlineresource),Style:r.makeObjectPropertyPusher(u._readStyle),MinScaleDenominator:c(a.readDecimal),MaxScaleDenominator:c(a.readDecimal),ScaleHint:c(u._readScaleHint),Layer:r.makeObjectPropertyPusher(u._readLayer)}),u.ATTRIBUTION_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Title:c(a.readString),OnlineResource:c(l.readHref),LogoURL:c(u._readSizedFormatOnlineresource)}),u.EX_GEOGRAPHIC_BOUNDING_BOX_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{westBoundLongitude:c(a.readDecimal),eastBoundLongitude:c(a.readDecimal),southBoundLatitude:c(a.readDecimal),northBoundLatitude:c(a.readDecimal)}),u.REQUEST_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{GetCapabilities:c(u._readOperationType),GetMap:c(u._readOperationType),GetFeatureInfo:c(u._readOperationType)}),u.OPERATIONTYPE_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Format:r.makeObjectPropertyPusher(a.readString),DCPType:r.makeObjectPropertyPusher(u._readDCPType)}),u.DCPTYPE_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{HTTP:c(u._readHTTP)}),u.HTTP_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Get:c(u._readFormatOnlineresource),Post:c(u._readFormatOnlineresource)}),u.STYLE_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Name:c(a.readString),Title:c(a.readString),Abstract:c(a.readString),LegendURL:r.makeObjectPropertyPusher(u._readSizedFormatOnlineresource),StyleSheetURL:c(u._readFormatOnlineresource),StyleURL:c(u._readFormatOnlineresource)}),u.FORMAT_ONLINERESOURCE_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Format:c(a.readString),OnlineResource:c(l.readHref)}),u.KEYWORDLIST_PARSERS=r.makeParsersNS(u.NAMESPACE_URIS,{Keyword:r.makeArrayPusher(a.readString)}),t.exports=u},{"./node_types":2,"./utils/isdef":3,"./utils/setifundefined":4,"./xlink":7,"./xml_parser":8,"./xsd":9}],7:[function(e,t,i){"use strict";t.exports={readHref:function(e){return e.getAttributeNS("http://www.w3.org/1999/xlink","href")}}},{}],8:[function(e,t,i){"use strict";var r=e("./utils/isdef"),n=e("./utils/setifundefined"),o=e("./node_types");function s(){this._parser=new DOMParser}s.prototype.toDocument=function(e){return this._parser.parseFromString(e,"application/xml")},s.getAllTextContent=function(e,t){return s.getAllTextContent_(e,t,[]).join("")},s.getAllTextContent_=function(e,t,i){var r;if(e.nodeType===o.CDATA_SECTION||e.nodeType===o.TEXT)t?i.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(e.nodeValue);else for(r=e.firstChild;r;r=r.nextSibling)s.getAllTextContent_(r,t,i);return i},s.parseNode=function(e,t,i,n){for(var o=s.firstElementChild(t);o;o=s.nextElementSibling(o)){var a=e[o.namespaceURI||null];if(r(a)){var l=a[o.localName];r(l)&&l.call(n,o,i)}}},s.firstElementChild=function(e){for(var t=e.firstElementChild||e.firstChild;t&&t.nodeType!==o.ELEMENT;)t=t.nextSibling;return t},s.nextElementSibling=function(e){for(var t=e.nextElementSibling||e.nextSibling;t&&t.nodeType!==o.ELEMENT;)t=t.nextSibling;return t},s.makeParsersNS=function(e,t,i){return s.makeStructureNS(e,t,i)},s.makeStructureNS=function(e,t,i){var n,o,s=r(i)?i:{};for(n=0,o=e.length;n<o;++n)s[e[n]]=t;return s},s.makeObjectPropertySetter=function(e,t,i){return function(n,o){var s=e.call(r(i)?i:this,n,o);r(s)&&(o[o.length-1][r(t)?t:n.localName]=s)}},s.makeObjectPropertyPusher=function(e,t,i){return function(o,s){var a=e.call(r(i)?i:this,o,s);if(r(a)){var l=s[s.length-1],u=r(t)?t:o.localName;n(l,u,[]).push(a)}}},s.makeArrayPusher=function(e,t){return function(i,n){var o=e.call(r(t)?t:this,i,n);r(o)&&n[n.length-1].push(o)}},s.pushParseAndPop=function(e,t,i,r,n){return r.push(e),s.parseNode(t,i,r,n),r.pop()},t.exports=s},{"./node_types":2,"./utils/isdef":3,"./utils/setifundefined":4}],9:[function(e,t,i){"use strict";var r=e("./utils/isdef"),n=e("./utils/string"),o=e("./xml_parser"),s={NAMESPACE_URI:"http://www.w3.org/2001/XMLSchema",readBoolean:function(e){var t=o.getAllTextContent(e,!1);return s.readBooleanString(t)},readBooleanString:function(e){var t=/^\s*(true|1)|(false|0)\s*$/.exec(e);return t?r(t[1])||!1:void 0},readDateTime:function(e){var t=o.getAllTextContent(e,!1),i=/^\s*(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(Z|(?:([+\-])(\d{2})(?::(\d{2}))?))\s*$/.exec(t);if(i){var n=parseInt(i[1],10),s=parseInt(i[2],10)-1,a=parseInt(i[3],10),l=parseInt(i[4],10),u=parseInt(i[5],10),c=parseInt(i[6],10),h=Date.UTC(n,s,a,l,u,c)/1e3;if("Z"!=i[7]){var d="-"==i[8]?-1:1;h+=60*d*parseInt(i[9],10),r(i[10])&&(h+=60*d*60*parseInt(i[10],10))}return h}},readDecimal:function(e){var t=o.getAllTextContent(e,!1);return s.readDecimalString(t)},readDecimalString:function(e){var t=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(e);return t?parseFloat(t[1]):void 0},readNonNegativeInteger:function(e){var t=o.getAllTextContent(e,!1);return s.readNonNegativeIntegerString(t)},readNonNegativeIntegerString:function(e){var t=/^\s*(\d+)\s*$/.exec(e);return t?parseInt(t[1],10):void 0},readString:function(e){var t=o.getAllTextContent(e,!1);return n.trim(t)},writeBooleanTextNode:function(e,t){s.writeStringTextNode(e,t?"1":"0")},writeDateTimeTextNode:function(e,t){var i=new Date(1e3*t),r=i.getUTCFullYear()+"-"+r.padNumber(i.getUTCMonth()+1,2)+"-"+r.padNumber(i.getUTCDate(),2)+"T"+r.padNumber(i.getUTCHours(),2)+":"+r.padNumber(i.getUTCMinutes(),2)+":"+r.padNumber(i.getUTCSeconds(),2)+"Z";e.appendChild(o.DOCUMENT.createTextNode(r))},writeDecimalTextNode:function(e,t){var i=t.toPrecision();e.appendChild(o.DOCUMENT.createTextNode(i))},writeNonNegativeIntegerTextNode:function(e,t){var i=t.toString();e.appendChild(o.DOCUMENT.createTextNode(i))},writeStringTextNode:function(e,t){e.appendChild(o.DOCUMENT.createTextNode(t))}};t.exports=s},{"./utils/isdef":3,"./utils/string":5,"./xml_parser":8}]},{},[1])(1)}),r("gw/Registry/WMSServer",["jquery","underscore-min","../Utils/Utils","xmltojson","../Layer/LayerFactory","wms-capabilities"],function(e,t,i,r,n,o){var s=function(e){if(e.getCapabilities)e.baseUrl=i.computeBaseUrlFromCapabilities(e.getCapabilities,["service","request","version"]);else{if(!e.baseUrl)throw new ReferenceError("No URL to access to the server is defined","WMSLayer.js");e.getCapabilities=s.getCapabilitiesFromBaseURl(e.baseUrl,e)}this.options=e};function a(e,i){return 0!==e.length&&!t.contains(e,i)}function l(e){return Array.isArray(e.Layer)}function u(e,t,i){return e.attribution?e.attribution:null!=i.Attribution?(null!=i.Attribution.LogoURL?"<img src='"+i.Attribution.LogoURL.OnlineResource+"' height='25px'/> ":"")+(null!=i.Attribution.Title?i.Attribution.Title:""):null!=t.Attribution?(null!=t.Attribution.LogoURL?"<img src='"+t.Attribution.LogoURL.OnlineResource+"' height='25px'/> ":"")+(null!=t.Attribution.Title?t.Attribution.Title:""):null}function c(e){var t,i=e.EX_GeographicBoundingBox;if(null==i)t=[-180,-90,180,90];else{var r=i[0]>180?i[0]-360:i[0],n=i[2]>180?i[2]-360:i[2];t=[r,i[1],n,i[3]]}return t}function h(e,t,i){var r=[];if(l.call(this,i))for(var o=0;o<i.Layer.length;o++){var s=i.Layer[o];r.push(u.call(this,e,t,s))}else r.push(u.call(this,e,t,i));var a=function(e,t,i){return e.copyrightUrl?e.copyrightUrl:null!=i.Attribution?null!=i.Attribution.OnlineResource?i.Attribution.OnlineResource:"":null!=t.Attribution&&null!=t.Attribution.OnlineResource?t.Attribution.OnlineResource:""}.call(this,e,t,i),h=function(e){var t;if(l.call(this,e)){for(var i,r,n=180,o=-180,s=90,a=-90,u=0;u<e.Layer.length;u++)i=e.Layer[u],r=c.call(this,i),n=Math.min(n,r[0]),s=Math.min(s,r[1]),o=Math.max(o,r[2]),a=Math.max(a,r[3]);t=[n,s,o,a]}else t=c.call(this,e);return t}.call(this,i),d=function(e){var t=.5*(e[0]+e[2]),i=.5*(e[1]+e[3]),r=e[2]-e[0];return r>180&&(r=180),e[3],e[1],[t,i]}.call(this,h),p=Object.assign({},e,{});return p.name=e.name||i.Title,p.format=e.format||"image/png",p.layers=i.Name,p.description=e.description||null!=i.Abstract?i.Abstract:t.Abstract,p.attribution=r.join("<br/>"),p.copyrightUrl=a,p.autoFillTimeTravel=e.autoFillTimeTravel,p.properties={initialRa:d[0],initialDec:d[1],bbox:h},p.dimension=function(e){if(null==e)return null;for(var t={},i=0;i<e.length;i++){var r=e[i],n={units:r.units,unitSymbol:r.unitSymbol,default:r.default,multipleValues:r.multipleValues,nearestValue:r.nearestValue,value:r.values};t[r.name]=n}return t}.call(this,i.Dimension),p.metadataAPI=i,n.create(p)}return s.prototype.getMetadata=function(e,t){var r=this;i.requestUrl(this.options.getCapabilities,"text","application/xml",{},function(t){var i=(new o).parse(t);e(r.options,i)},function(e){t&&(e.setLayerDescription(r.options),t(e))})},s.prototype.createLayers=function(e,t){this.getMetadata(function(t,i){var r=function e(t,i,r){for(var n=[],o=0;o<r.Layer.length;o++){var s=r.Layer[o];null!=s.Layer&&(n=n.concat(e(t,i,s))),a.call(this,i,s.Name)||n.push(h.call(this,t,r,s))}return n}(t,t.hasOwnProperty("layers")?t.layers.trim().split(/\s*,\s*/):[],i.Capability.Layer);e(r)},t)},s.getCapabilitiesFromBaseURl=function(e,t){var r=e;return r=i.addParameterTo(r,"service","WMS"),r=i.addParameterTo(r,"request","getCapabilities"),r=i.addParameterTo(r,"version",t.hasOwnProperty("version")?t.version:"1.3.0")},s}),r("gw/Registry/WMSServerRegistryHandler",["../Utils/Utils","./AbstractRegistryHandler","../Utils/Constants","../Gui/dialog/ErrorDialog","./WMSServer"],function(e,t,i,r,n){var o=function(e){t.prototype.constructor.call(),this.pendingLayers=e};return e.inherits(t,o),o.prototype.handleRequest=function(e,t,o){try{if(e.type===i.LAYER.WMS){var s=new n(e),a=this;s.createLayers(function(e){a._handlePendingLayers(a.pendingLayers,e),t(e)},o)}else this.next.handleRequest(e,t,o)}catch(e){o?o(e):r.open(i.LEVEL.DEBUG,"WMSServerRegistryHandler.js",e)}},o}),r("gw/Registry/WMTSServer",["underscore-min","../Utils/Utils","xmltojson","./WMTSMetadata","../Layer/LayerFactory"],function(e,t,i,r,n){var o=function(e){if(e.getCapabilities)e.baseUrl=t.computeBaseUrlFromCapabilities(e.getCapabilities,["service","request","version"]);else{if(!e.baseUrl)throw new ReferenceError("No URL to access to the server is defined","WMSLayer.js");e.getCapabilities=o.getCapabilitiesFromBaseURl(e.baseUrl,e)}this.options=e};function s(t,i){return 0!==t.length&&!e.contains(t,i.identifier)||!e.contains(i.tileMatrixSetLink,"WGS84")}return o.prototype.getMetadata=function(e,n){var o=this;t.requestUrl(this.options.getCapabilities,"text","application/xml",{},function(t){var n=i.parseString(t,{mergeCDATA:!0,xmlns:!1,attrsAsObject:!1,childrenAsArray:!1}),s=new r(n);e(o.options,s)},function(e){n&&(e.setLayerDescription(o.options),n(e))})},o.prototype.createLayers=function(e,t){this.getMetadata(function(t,i){for(var r=t.hasOwnProperty("layers")?t.layers.trim().split(/\s*,\s*/):[],o=i.contents,a=[],l=0;l<o.layers.length;l++){var u=o.layers[l];if(!s.call(this,r,u)){var c;c=t.attribution?t.attribution:null;var h=Object.assign({},t,{});h.name=t.name||u.identifier,h.format=t.format||"image/png",h.layers=u.title,h.description=t.description||null!=u.abstract?u.abstract:o.abstract,h.attribution=c,h.copyrightUrl=null;var d=n.create(h);a.push(d)}}e(a)},t)},o.getCapabilitiesFromBaseURl=function(e,i){var r=e;return r=t.addParameterTo(r,"service","WMTS"),r=t.addParameterTo(r,"request","getCapabilities"),r=t.addParameterTo(r,"version",i.hasOwnProperty("version")?i.version:"1.0.0")},o}),r("gw/Registry/WMTSServerRegistryHandler",["../Utils/Utils","./AbstractRegistryHandler","../Utils/Constants","../Gui/dialog/ErrorDialog","./WMTSServer"],function(e,t,i,r,n){var o=function(e){t.prototype.constructor.call(),this.pendingLayers=e};return e.inherits(t,o),o.prototype.handleRequest=function(e,t,o){try{if(e.type===i.LAYER.WMTS){var s=new n(e),a=this;s.createLayers(function(e){a._handlePendingLayers(a.pendingLayers,e),t(e)},o)}else this.next.handleRequest(e,t,o)}catch(e){o?o(e):r.open(i.LEVEL.DEBUG,"WMTSServerRegistryHandler.js",e)}},o}),r("gw/Registry/WCSServer",["jquery","underscore-min","../Utils/Utils","xmltojson","../Layer/LayerFactory"],function(e,t,i,r,n,o){var s=function(e){if(e.getCapabilities)e.baseUrl=i.computeBaseUrlFromCapabilities(e.getCapabilities,["service","request","version"]);else{if(!e.baseUrl)throw new ReferenceError("No URL to access to the server is defined","WCSServer.js");e.getCapabilities=s.getCapabilitiesFromBaseURL(e.baseUrl,e)}e.describeCoverage=s.describeCoverageFromBaseURL(e.baseUrl,e),this.options=e};function a(e,i){return 0!==e.length&&!t.contains(e,i.name._text)}function l(e){var t=e.pos,i=t[0]._text.split(" "),r=t[1]._text.split(" ");return[parseFloat(i[0]),parseFloat(i[1]),parseFloat(r[0]),parseFloat(r[1])]}function u(e){var t;if(null==e)t=[0,0,1e5];else{var i=.5*(e[0]+e[2]),r=.5*(e[1]+e[3]),n=e[2]-e[0];n>180&&(n=180);var o=e[3]-e[1],s=n>o?o:n;t=[i,r,3e6*Math.abs(s)/180]}return t}function c(e){var t;if(null==e.timePosition)t=null;else{for(var i=[],r=e.timePosition,n=0;n<r.length;n++)i.push(r[n]._text);t=i.join(",")}return t}return s.prototype.getMetadata=function(e,t){var n=this;i.requestUrl(this.options.getCapabilities,"text","application/xml",{},function(t){var i=r.parseString(t,{mergeCDATA:!0,xmlns:!1,attrsAsObject:!1,childrenAsArray:!1});e(n.options,i)},function(e){t&&(e.setLayerDescription(n.options),t(e))})},s.prototype.getCoverage=function(e,t){var n=this;i.requestUrl(this.options.describeCoverage,"text","application/xml",{},function(t){var i=r.parseString(t,{mergeCDATA:!0,xmlns:!1,attrsAsObject:!1,childrenAsArray:!1});e(n.options,i)},function(e){t&&(e.setLayerDescription(n.options),t(e))})},s.prototype.createLayers=function(e,t){this.getMetadata(function(t,i){var r=t.hasOwnProperty("layers")?t.layers.trim().split(/\s*,\s*/):[],o=[],s=i.WCS_Capabilities.ContentMetadata;Array.isArray(s.CoverageOfferingBrief)?o=s.CoverageOfferingBrief:o.push(s);for(var h=[],d=0;d<o.length;d++){var p=o[d].CoverageOfferingBrief;if(!a.call(this,r,p)){var f;f=t.attribution?t.attribution:null;var g=Object.assign({},t,{});g.name=t.name||p.label._text,g.format=t.format,g.layers=p.name._text,g.description=t.description,g.attribution=f,g.copyrightUrl=null;var m=l.call(this,p.lonLatEnvelope),v=u.call(this,m);g.properties={initialRa:v[0],initialDec:v[1],initialFov:v[2],bbox:m};var y=c.call(this,p.lonLatEnvelope);g.dimension={},null!=y&&(g.dimension.time={units:"ISO8601",unitSymbol:null,default:null,multipleValues:null,nearestValue:null,current:null,value:y}),g.metadataAPI=p,g.dimension.time&&null!=g.dimension.time.value&&(g.time=g.dimension.time.value.split(",")[0]);var b=n.create(g);h.push(b)}}e(h)},t)},s.getCapabilitiesFromBaseURL=function(e,t){var r=e;return r=i.addParameterTo(r,"service","WCS"),r=i.addParameterTo(r,"request","getCapabilities"),r=i.addParameterTo(r,"version",t.hasOwnProperty("version")?t.version:"1.0.0")},s.describeCoverageFromBaseURL=function(e,t){var r=e;return r=i.addParameterTo(r,"service","WCS"),r=i.addParameterTo(r,"request","describeCoverage"),r=i.addParameterTo(r,"version",t.hasOwnProperty("version")?t.version:"1.0.0")},s}),r("gw/Registry/WCSServerRegistryHandler",["underscore-min","../Utils/Utils","./AbstractRegistryHandler","../Utils/Constants","./WCSServer","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s=function(e,t){i.prototype.constructor.call(),this.layers=e,this.pendingLayers=t};function a(e,t,i,n){var o=function(e){var t,i,n=!1;for(t=0;t<e.length;t++)if(e[t].getType()===r.LAYER.TileWireframe){n=!0;break}if(n){var o=e[t];i=o.options,o._detach(),e.splice(t,1)}return i}(e);o&&t.next.handleRequest(o,i,n)}return t.inherits(i,s),s.prototype.handleRequest=function(e,t,i){try{if(e.type===r.LAYER.WCSElevation){var s=new n(e),l=this;s.createLayers(function(e){l._handlePendingLayers(l.pendingLayers,e),t(e),a(l.layers,l,t,i)},i)}else this.next.handleRequest(e,t,i)}catch(e){i?i(e):o.open(r.LEVEL.DEBUG,e)}},s}),r("gw/Layer/OpenSearch/OpenSearchParam",["./OpenSearchUtils"],function(e){var t=function(e){this.name=null,this.value=null,this.title=null,this.minInclusive=null,this.maxInclusive=null,this.pattern=null,this.options=null,this.currentValue=null,this.defaultValue=null,this.displayValue="",this.parseJson(e)};return t.prototype.parseJson=function(t){if(this.name=e.getAttributeValue(t,"name"),this.name=this.name.replace(/\./g,"_"),this.value=e.getAttributeValue(t,"value"),this.title=e.getAttributeValue(t,"title"),this.minInclusive=e.getAttributeValue(t,"minInclusive"),this.maxInclusive=e.getAttributeValue(t,"maxInclusive"),this.pattern=e.getAttributeValue(t,"pattern"),null===this.pattern?this.patternAttribute="":this.patternAttribute='pattern="'+this.pattern+'" ',void 0!==t.Option)if(this.options=[],void 0!==t.Option.length)for(var i=0;i<t.Option.length;i++)this.options.push(e.getAttributeValue(t.Option[i],"value"));else this.options.push(e.getAttributeValue(t.Option,"value"));null!==this.options?this.type="options":null!==this.minInclusive||null!==this.maxInclusive?(this.type="number",null===this.title&&(this.title=""),null===this.maxInclusive?this.title+="( >= "+this.minInclusive+" )":null===this.minInclusive?this.title+="( <= "+this.maxInclusive+" )":this.title+="( between "+this.minInclusive+" and "+this.maxInclusive+" )"):!0===this.value.startsWith("{time:")?this.type="datetime":this.type="text",null===this.title?this.titleAttribute="":this.titleAttribute='title="'+this.title+'" '},t.prototype.toString=function(){var e="";if(null!==this.name&&(e+="     name : "+this.name+"\n"),null!==this.value&&(e+="     value : "+this.value+"\n"),null!==this.title&&(e+="     title : "+this.title+"\n"),null!==this.minInclusive&&(e+="     minInclusive : "+this.minInclusive+"\n"),null!==this.maxInclusive&&(e+="     maxInclusive : "+this.maxInclusive+"\n"),null!==this.pattern&&(e+="     pattern : "+this.pattern+"\n"),null!=this.options){e+="     options : ";for(var t=0;t<this.options.length;t++)e+=this.options[t]+", ";e+="\n"}return e},t.prototype.currentValueTransformed=function(){return"datetime"!==this.type?this.currentValue:null===this.currentValue||void 0===this.currentValue?this.currentValue:this.currentValue.substr(0,10)+"T"+this.currentValue.substr(-5)+":00.00"},t}),r("gw/Layer/OpenSearch/OpenSearchForm",["jquery","underscore-min","./OpenSearchParam","./OpenSearchUtils"],function(e,t,i,r){var n=function(e,t){this.type=null,this.template=null,this.parameters=[],this.ignoredParameters=[],this.ignoredParameters.push("searchTerms"),this.ignoredParameters.push("count"),this.ignoredParameters.push("startIndex"),this.ignoredParameters.push("startPage"),this.ignoredParameters.push("language"),this.ignoredParameters.push("inputEncoding"),this.ignoredParameters.push("outputEncoding");var i=function(e,t,i){var r;if(Array.isArray(e))for(var n=0;n<e.length&&null===(r=o.call(this,e[n],t,i));n++)r=null;else r=o.call(this,e,t,i);return r}.call(this,e,t,this.ignoredParameters);null!==i&&(this.type=i.type,this.template=i.template,this.parameters=i.parameters)};function o(e,t,n){var o=r.getAttributeValue(e,"type");return o!==t?null:{type:o,template:r.getAttributeValue(e,"template"),parameters:function(e,t){var r=[];if(Array.isArray(e))for(var n=0;n<e.length;n++){var o=new i(e[n]);o.isDisplayed=!0;for(var s=0;s<t.length;s++)o.value==="{"+t[s]+"}"&&(o.isDisplayed=!1);o.value.startsWith("{geo:")&&(o.isDisplayed=!1),r.push(o)}else r.push(new i(e));return r}.call(this,e.Parameter,n)}}return n.prototype.toString=function(){var e="";e+="  type : "+this.type+"\n",e+="  template : "+this.template+"\n",e+="  parameters :\n";for(var t=0;t<this.parameters.length;t++)e+=this.parameters[t].toString()+"\n";return e},n.prototype.setParametersValueFrom=function(e){t.each(this.parameters,function(t){Object.keys(e).forEach(function(e,i){t.name==="p_"+e&&(t.value=i[e])})})},n.prototype.updateFromGUI=function(){for(var t=0;t<this.parameters.length;t++){var i=this.parameters[t],r=e("#p_"+i.name).val();i.currentValue=""!==r?r:null}},n}),r("gw/Registry/OpenSearchServer",["jquery","underscore-min","../Utils/Utils","xmltojson","../Layer/LayerFactory","../Layer/OpenSearch/OpenSearchUtils","../Layer/OpenSearch/OpenSearchForm"],function(e,t,i,r,n,o,s){var a=function(e){if(e.baseUrl&&-1!==e.baseUrl.indexOf(".xml")&&(e.getCapabilities=e.baseUrl),!e.getCapabilities)throw new ReferenceError("No URL to access to the server is defined","OpenSearchServer.js");this.options=e};return a.prototype.createLayers=function(e,t){this.getMetadata(function(t,i){var r=[],a=function(e,t){var i=Object.assign({},e,{});i.name=e.name||o.getValue(t,"ShortName"),i.description=e.description||o.getValue(t,"Description"),i.attribution=e.attribution||o.getValue(t,"Attribution"),i.properties={},i.properties.longName=o.getValue(t,"LongName"),i.properties.syndicationRight=o.getValue(t,"SyndicationRight"),i.properties.developper=o.getValue(t,"Developper");var r=t.Url;return i.services={},i.services.queryForm=new s(r,"application/json"),o.initNavigationValues(i.services.queryForm),n.create(i)}(t,i.OpenSearchDescription);r.push(a),e(r)},t)},a.prototype.getMetadata=function(e,t){var n=this;i.requestUrl(this.options.getCapabilities,"text","application/xml",{},function(t){var i=r.parseString(t,{mergeCDATA:!0,xmlns:!1,attrsAsObject:!1,childrenAsArray:!1});e(n.options,i)},function(e){t&&(e.setLayerDescription(n.options),t(e))})},a}),r("gw/Registry/OpenSearchRegistryHandler",["../Utils/Utils","./AbstractRegistryHandler","../Utils/Constants","../Gui/dialog/ErrorDialog","./OpenSearchServer"],function(e,t,i,r,n){var o=function(e){t.prototype.constructor.call(),this.pendingLayers=e};return e.inherits(t,o),o.prototype.handleRequest=function(e,t,o){try{if(e.type===i.LAYER.OpenSearch){var s=new n(e),a=this;s.createLayers(function(e){a._handlePendingLayers(a.pendingLayers,e),t(e)},o)}else this.next.handleRequest(e,t,o)}catch(e){o?o(e):r.open(i.LEVEL.DEBUG,"OpenSearchRegistryHandler.js",e)}},o}),r("gw/Registry/PendingLayersRegistryHandler",["../Utils/Utils","./AbstractRegistryHandler","../Utils/Constants"],function(e,t,i){var r=function(e,i){t.prototype.constructor.call(),this.layers=i,this.pendingLayers=e};return e.inherits(t,r),r.prototype.hasLayerBackground=function(){for(var e=!1,t=0;t<this.layers.length;t++){if(this.layers[t].isBackground()){e=!0;break}}return e},r.prototype.handleRequest=function(e,t,r){e.type!==i.LAYER.Atmosphere&&e.type!==i.LAYER.TileWireframe||this.hasLayerBackground()?this.next.handleRequest(e,t,r):this.pendingLayers.push(e)},r}),r("gw/Registry/LayerRegistryHandler",["../Utils/Utils","./AbstractRegistryHandler","../Layer/LayerFactory","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n){var o=function(e){t.prototype.constructor.call(),this.pendingLayers=e};return e.inherits(t,o),o.prototype.handleRequest=function(e,t,o){var s=[];try{var a=i.create(e);s.push(a),this._handlePendingLayers(this.pendingLayers,s),t(s)}catch(i){i instanceof RangeError&&null!=this.next?this.next.handleRequest(e,t,o):o?o(i):n.open(r.LEVEL.DEBUG,"Unknown error in LayerRegistryHanlder",i)}},o}),r("gw/Services/CompassCore",["jquery","../Utils/Constants"],function(e,t){const i=360;var r=null,n=null,o=null,s=null;return{init:function(e){r=e.element},setSvg:function(e){s=e},setCtx:function(e){n=e,o=e.getCoordinateSystem().getGeoideName()},updateNorth:function(){var e;switch(n.getMode()){case t.CONTEXT.Sky:!function(){var e=[],t=n.getCoordinateSystem(),i=n.getNavigation().center3d?n.getNavigation().center3d:i=n.getNavigation().geoCenter;t.from3DToGeo(i,e),e=t.convert(e,o,t.getGeoideName());var r=[];t.getLHVTransform(e,r);var a=[],l=[r[4],r[5],r[6]],u=[r[8],r[9],r[10]],c=vec3.create(n.getNavigation().up);vec3.scale(c,t.getGeoide().getRadius()),t.from3DToGeo(c,a),a=t.convert(a,o,t.getGeoideName()),t.fromGeoTo3D(a,c),vec3.normalize(c);var h=vec3.dot(c,l)/(vec3.length(c)*vec3.length(l)),d=Math.acos(h);if(!isNaN(d)){var p=180*d/Math.PI;vec3.cross(c,l,a),vec3.dot(a,[u[0],u[1],u[2]])<0&&(p*=-1),s.getElementById("NorthText").setAttribute("transform","rotate("+p+" 40 40)")}}();break;case t.CONTEXT.Planet:e=(n.getNavigation().getHeading()-0+i)%i,s.getElementById("NorthText").setAttribute("transform","rotate("+e+" 40 40)");break;case t.CONTEXT.Ground:!function(){var e=(0-n.getNavigation().getHeading()+i)%i;s.getElementById("NorthText").setAttribute("transform","rotate("+e+" 40 40)")}();break;default:throw new RangeError("CompassCore is not supported for this context","CompassCore.js")}},_alignWithNorth:function(e){var t=n.getCoordinateSystem(),i=[0,0,t.getGeoide().getRadius()],r=[];t.from3DToGeo(i,r),r=t.convert(r,t.getGeoideName(),o),t.fromGeoTo3D(r,i),n.getNavigation().moveUpTo(i)},remove:function(){document.getElementById(r).innerHTML=""}}}),r("gw/Gui/Compass",["jquery","../Utils/Constants","../Services/CompassCore","../Utils/Utils"],function(e,t,i,r){var n=function(e){if(this.svgDoc=null,this.panFactor=e.panFactor?e.panFactor:30,this.parentElement=e.element,this.ctx=null,this.isMobile=e.isMobile,this.options=e,this._lastMouseX=-1,this._lastMouseY=-1,this._balanceX=-1,this._balanceY=-1,this._dx=0,this._dy=0,this.dragging=!1,this.east=null,this.west=null,this.south=null,this.north=null,this.northText=null,this.outerCircle=null,null==this.parentElement)throw new ReferenceError("Can't get the element name from the options parameters");if(null===document.getElementById(this.parentElement))throw new ReferenceError("can't get the Div "+this.parentElement+" to insert the compass");this.init()};function o(e,t){e.type.search("touch")>=0?(e.layerX=e.changedTouches[0].clientX,e.layerY=e.changedTouches[0].clientY,t._balanceX=e.layerX,t._balanceY=e.layerY):(t._balanceX=0,t._balanceY=0),t.dragging=!0;var i=t.outerCircle.ownerSVGElement.clientWidth/2;t._lastMouseX=e.layerX-t._balanceX-i,t._lastMouseY=e.layerY-t._balanceY-i,t._dx=0,t._dy=0}function s(e,t){if(e.type.search("touch")>=0&&(e.layerX=e.changedTouches[0].clientX-t._balanceX,e.layerY=e.changedTouches[0].clientY-t._balanceY),t.dragging){var r=t.outerCircle.ownerSVGElement.clientWidth/2,n=t._lastMouseX*(e.layerY-r)-t._lastMouseY*(e.layerX-r);t.ctx.getNavigation().rotate(n,0),t._lastMouseX=e.layerX-r,t._lastMouseY=e.layerY-r,i.updateNorth()}}function a(e,t){e.preventDefault(),t.dragging=!1}function l(e){e.ctx.getNavigation().pan(e.panFactor,0),i.updateNorth()}function u(e){e.ctx.getNavigation().pan(-e.panFactor,0),i.updateNorth()}function c(e){e.ctx.getNavigation().pan(0,e.panFactor),i.updateNorth()}function h(e){e.ctx.getNavigation().pan(0,-e.panFactor),i.updateNorth()}return n.prototype.init=function(){i.init({element:this.parentElement})},n.prototype.remove=i.remove,n.prototype.setCtx=i.setCtx,n.prototype.setSvg=i.setSvg,n.prototype.attachTo=function(n){var d=this;this.ctx=n,this.setCtx(n),e.get("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjw/eG1sLXN0eWxlc2hlZXQgdHlwZT0idGV4dC9jc3MiIGhyZWY9ImNvbXBhc3MuY3NzIj8+PHN2ZwogICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iCiAgIHhtbG5zOmNjPSJodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9ucyMiCiAgIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyIKICAgeG1sbnM6c3ZnPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIKICAgeG1sbnM6c29kaXBvZGk9Imh0dHA6Ly9zb2RpcG9kaS5zb3VyY2Vmb3JnZS5uZXQvRFREL3NvZGlwb2RpLTAuZHRkIgogICB4bWxuczppbmtzY2FwZT0iaHR0cDovL3d3dy5pbmtzY2FwZS5vcmcvbmFtZXNwYWNlcy9pbmtzY2FwZSIKICAgd2lkdGg9IjUyMCIKICAgaGVpZ2h0PSI1MjAiCiAgIGlkPSJzdmcyIgogICB2ZXJzaW9uPSIxLjEiCiAgIGlua3NjYXBlOnZlcnNpb249IjAuNDguMSByOTc2MCIKICAgc29kaXBvZGk6ZG9jbmFtZT0iY29tcGFzc05vcnRoMi5zdmciCiAgIHZpZXdCb3g9Ii0yMjAgLTIyMCA1MjAgNTIwIj4KICA8bWV0YWRhdGEKICAgICBpZD0ibWV0YWRhdGE0NSI+CiAgICA8cmRmOlJERj4KICAgICAgPGNjOldvcmsKICAgICAgICAgcmRmOmFib3V0PSIiPgogICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2Uvc3ZnK3htbDwvZGM6Zm9ybWF0PgogICAgICAgIDxkYzp0eXBlCiAgICAgICAgICAgcmRmOnJlc291cmNlPSJodHRwOi8vcHVybC5vcmcvZGMvZGNtaXR5cGUvU3RpbGxJbWFnZSIgLz4KICAgICAgICA8ZGM6dGl0bGUgLz4KICAgICAgPC9jYzpXb3JrPgogICAgPC9yZGY6UkRGPgogIDwvbWV0YWRhdGE+CiAgPGRlZnMKICAgICBpZD0iZGVmczQzIj4KICAgIDxyYWRpYWxHcmFkaWVudAogICAgICAgaWQ9ImdyYWQxIgogICAgICAgY3g9IjAiCiAgICAgICBjeT0iMCIKICAgICAgIHI9IjIwNyIKICAgICAgIGZ4PSIwIgogICAgICAgZnk9IjAiCiAgICAgICBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CiAgICAgIDxzdG9wCiAgICAgICAgIG9mZnNldD0iMC43NSIKICAgICAgICAgaWQ9InN0b3A2IgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjojZmZmZmZmO3N0b3Atb3BhY2l0eTowIiAvPgogICAgICA8c3RvcAogICAgICAgICBvZmZzZXQ9IjAuOTQ5OTk5OTkiCiAgICAgICAgIGlkPSJzdG9wOCIKICAgICAgICAgc3R5bGU9InN0b3AtY29sb3I6I2ZmOTkwMDtzdG9wLW9wYWNpdHk6MSIgLz4KICAgICAgPHN0b3AKICAgICAgICAgb2Zmc2V0PSIxMDAlIgogICAgICAgICBzdHlsZT0ic3RvcC1jb2xvcjpyZ2IoMjU1LCAyNTUsIDI1NSk7c3RvcC1vcGFjaXR5OjAiCiAgICAgICAgIGlkPSJzdG9wMTAiIC8+CiAgICA8L3JhZGlhbEdyYWRpZW50PgogIDwvZGVmcz4KICA8c29kaXBvZGk6bmFtZWR2aWV3CiAgICAgcGFnZWNvbG9yPSIjZmZmZmZmIgogICAgIGJvcmRlcmNvbG9yPSIjNjY2NjY2IgogICAgIGJvcmRlcm9wYWNpdHk9IjEiCiAgICAgb2JqZWN0dG9sZXJhbmNlPSIxMCIKICAgICBncmlkdG9sZXJhbmNlPSIxMCIKICAgICBndWlkZXRvbGVyYW5jZT0iMTAiCiAgICAgaW5rc2NhcGU6cGFnZW9wYWNpdHk9IjAiCiAgICAgaW5rc2NhcGU6cGFnZXNoYWRvdz0iMiIKICAgICBpbmtzY2FwZTp3aW5kb3ctd2lkdGg9IjEyODAiCiAgICAgaW5rc2NhcGU6d2luZG93LWhlaWdodD0iMTAwMCIKICAgICBpZD0ibmFtZWR2aWV3NDEiCiAgICAgc2hvd2dyaWQ9ImZhbHNlIgogICAgIGlua3NjYXBlOnpvb209IjAuNDEzMTgxODMiCiAgICAgaW5rc2NhcGU6Y3g9IjEwMy43NDIwNiIKICAgICBpbmtzY2FwZTpjeT0iNDguNTQ5MDc0IgogICAgIGlua3NjYXBlOndpbmRvdy14PSIwIgogICAgIGlua3NjYXBlOndpbmRvdy15PSIyNCIKICAgICBpbmtzY2FwZTp3aW5kb3ctbWF4aW1pemVkPSIxIgogICAgIGlua3NjYXBlOmN1cnJlbnQtbGF5ZXI9IkVhc3QiCiAgICAgc2hvd2d1aWRlcz0idHJ1ZSIKICAgICBpbmtzY2FwZTpndWlkZS1iYm94PSJ0cnVlIj4KICAgIDxpbmtzY2FwZTpncmlkCiAgICAgICB0eXBlPSJ4eWdyaWQiCiAgICAgICBpZD0iZ3JpZDMwMTAiCiAgICAgICBlbXBzcGFjaW5nPSI1IgogICAgICAgdmlzaWJsZT0idHJ1ZSIKICAgICAgIGVuYWJsZWQ9InRydWUiCiAgICAgICBzbmFwdmlzaWJsZWdyaWRsaW5lc29ubHk9InRydWUiIC8+CiAgPC9zb2RpcG9kaTpuYW1lZHZpZXc+CiAgPGcKICAgICBpZD0iT3V0ZXJDaXJjbGUiCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMS4xNDI4MTM4LDAsMCwxLjEwNTc4OCwwLjMwODI3MzYsNC42MTQ3ODQpIj4KICAgIDxnCiAgICAgICBpZD0iZzMyNjciCiAgICAgICBzdHlsZT0ib3BhY2l0eTowLjYiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOnJ4PSIyMDciCiAgICAgICAgIHNvZGlwb2RpOmN5PSIwIgogICAgICAgICBzb2RpcG9kaTpjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJtIDIwNywwIGMgMCwxMTQuMzIyOTQgLTkyLjY3NzA2LDIwNyAtMjA3LDIwNyAtMTE0LjMyMjk0LDAgLTIwNywtOTIuNjc3MDYgLTIwNywtMjA3IDAsLTExNC4zMjI5NCA5Mi42NzcwNiwtMjA3IDIwNywtMjA3IDExNC4zMjI5NCwwIDIwNyw5Mi42NzcwNiAyMDcsMjA3IHoiCiAgICAgICAgIGlkPSJjaXJjbGUyNCIKICAgICAgICAgcj0iMjA3IgogICAgICAgICBzdHlsZT0ib3BhY2l0eTowLjc1O2ZpbGw6dXJsKCNncmFkMSkiCiAgICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDEuMTA1MjI3OSwwLDAsMS4xMDUyMjc5LDM0LDMyKSIgLz4KICAgIDwvZz4KICAgIDxnCiAgICAgICBpZD0iZzE4IgogICAgICAgc3R5bGU9InN0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxMCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KDAuOTY1NTg4OTksMCwwLDAuOTcxMzI0MTUsMzQsMzIpIj4KICAgICAgPGNpcmNsZQogICAgICAgICByPSIyMTEiCiAgICAgICAgIGlkPSJjaXJjbGUyMCIKICAgICAgICAgZD0ibSAyMTEsMCBjIDAsMTE2LjUzMjA4IC05NC40Njc5MiwyMTEgLTIxMSwyMTEgLTExNi41MzIwOCwwIC0yMTEsLTk0LjQ2NzkyIC0yMTEsLTIxMSAwLC0xMTYuNTMyMDggOTQuNDY3OTIsLTIxMSAyMTEsLTIxMSAxMTYuNTMyMDgsMCAyMTEsOTQuNDY3OTIgMjExLDIxMSB6IgogICAgICAgICBjeD0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6cng9IjIxMSIKICAgICAgICAgc29kaXBvZGk6cnk9IjIxMSIgLz4KICAgIDwvZz4KICA8L2c+CiAgPGcKICAgICBpZD0iU291dGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM5LjU3ODM4MywzNi45NzA0MzUpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ciCiAgICAgICBkPSJNIDM5LjQxNiw5NS4xNiBDIDMzLjY1LDEwMy45NSAzMC43NiwxMTAuNSAyOC45MywxMTcuMTggMTUuMjQsMTEzLjQzIDEzLjU0LDEyNy4xNSAyMy4wNCwxMzEgMTMuNzEsMTQ1LjggNy44NCwxNzMuOTMgMCwyMTIgTCAwLDEwMyBhIDEwMywxMDMgMCAwIDAgMzkuNDE2LC03Ljg0IHoiIC8+CiAgICA8dXNlCiAgICAgICBoZWlnaHQ9IjQ0MCIKICAgICAgIHdpZHRoPSI0NDAiCiAgICAgICB5PSIwIgogICAgICAgeD0iMCIKICAgICAgIGlkPSJzb3V0aCIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93IiAvPgogIDwvZz4KICA8ZwogICAgIGlkPSJFYXN0IgogICAgIGNsYXNzPSJhcnJvdyIKICAgICB0cmFuc2Zvcm09Im1hdHJpeCgwLDEsLTEsMCwzOC44MDYyMSwzNy4yMjA0MjkpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNiIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgc3R5bGU9ImZpbGw6I2ZmZmZmZiIKICAgICAgIGlkPSJzb3V0aC01IgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNiIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iTm9ydGgiCiAgICAgY2xhc3M9ImFycm93IgogICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwtMSw0MS45MDI3OCw0My43ODMzNzYpIj4KICAgIDxwYXRoCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmO3N0cm9rZTojZmZmZmZmO3N0cm9rZS13aWR0aDoxIgogICAgICAgaW5rc2NhcGU6Y29ubmVjdG9yLWN1cnZhdHVyZT0iMCIKICAgICAgIGlkPSJIYWxmQXJyb3ctNi0wIgogICAgICAgZD0iTSAzOS40MTYsOTUuMTYgQyAzMy42NSwxMDMuOTUgMzAuNzYsMTEwLjUgMjguOTMsMTE3LjE4IDE1LjI0LDExMy40MyAxMy41NCwxMjcuMTUgMjMuMDQsMTMxIDEzLjcxLDE0NS44IDcuODQsMTczLjkzIDAsMjEyIEwgMCwxMDMgYSAxMDMsMTAzIDAgMCAwIDM5LjQxNiwtNy44NCB6IiAvPgogICAgPHVzZQogICAgICAgaGVpZ2h0PSI0NDAiCiAgICAgICB3aWR0aD0iNDQwIgogICAgICAgeT0iMCIKICAgICAgIHg9IjAiCiAgICAgICBzdHlsZT0iZmlsbDojZmZmZmZmIgogICAgICAgaWQ9InNvdXRoLTUtNiIKICAgICAgIHRyYW5zZm9ybT0ibWF0cml4KC0xLDAsMCwxLDIsMCkiCiAgICAgICB4bGluazpocmVmPSIjSGFsZkFycm93LTYtMCIgLz4KICA8L2c+CiAgPGcKICAgICBpZD0iV2VzdCIKICAgICBjbGFzcz0iYXJyb3ciCiAgICAgdHJhbnNmb3JtPSJtYXRyaXgoMCwtMSwxLDAsMzcuMzc0NzU4LDM5LjU0NzAyMykiPgogICAgPHBhdGgKICAgICAgIHN0eWxlPSJmaWxsOiNmZmZmZmY7c3Ryb2tlOiNmZmZmZmY7c3Ryb2tlLXdpZHRoOjEiCiAgICAgICBpbmtzY2FwZTpjb25uZWN0b3ItY3VydmF0dXJlPSIwIgogICAgICAgaWQ9IkhhbGZBcnJvdy02LTAtNSIKICAgICAgIGQ9Ik0gMzkuNDE2LDk1LjE2IEMgMzMuNjUsMTAzLjk1IDMwLjc2LDExMC41IDI4LjkzLDExNy4xOCAxNS4yNCwxMTMuNDMgMTMuNTQsMTI3LjE1IDIzLjA0LDEzMSAxMy43MSwxNDUuOCA3Ljg0LDE3My45MyAwLDIxMiBMIDAsMTAzIGEgMTAzLDEwMyAwIDAgMCAzOS40MTYsLTcuODQgeiIgLz4KICAgIDx1c2UKICAgICAgIGhlaWdodD0iNDQwIgogICAgICAgd2lkdGg9IjQ0MCIKICAgICAgIHk9IjAiCiAgICAgICB4PSIwIgogICAgICAgaWQ9InNvdXRoLTUtNi0yIgogICAgICAgdHJhbnNmb3JtPSJtYXRyaXgoLTEsMCwwLDEsMiwwKSIKICAgICAgIHhsaW5rOmhyZWY9IiNIYWxmQXJyb3ctNi0wLTUiIC8+CiAgPC9nPgogIDx0ZXh0CiAgICAgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIKICAgICBzdHlsZT0iZm9udC1zaXplOjkwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO2xldHRlci1zcGFjaW5nOjBweDt3b3JkLXNwYWNpbmc6MHB4O3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7ZmlsbC1vcGFjaXR5OjE7c3Ryb2tlOm5vbmU7Zm9udC1mYW1pbHk6VGltZXMgTmV3IFJvbWFuOy1pbmtzY2FwZS1mb250LXNwZWNpZmljYXRpb246J1RpbWVzIE5ldyBSb21hbiwgQm9sZCciCiAgICAgeD0iMTkuMjU0ODc1IgogICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgaWQ9Ik5vcnRoVGV4dCIKICAgICBzb2RpcG9kaTpsaW5lc3BhY2luZz0iMTMwJSIKICAgICB0cmFuc2Zvcm09InNjYWxlKDEuMDA4MzY2NSwwLjk5MTcwMjkyKSI+PHRzcGFuCiAgICAgICBzb2RpcG9kaTpyb2xlPSJsaW5lIgogICAgICAgaWQ9InRzcGFuMzAyNCIKICAgICAgIHg9IjE5LjI1NDg3NSIKICAgICAgIHk9Ii0xNjMuMDY2NzYiCiAgICAgICBzdHlsZT0iZm9udC1zaXplOjgwcHg7Zm9udC1zdHlsZTpub3JtYWw7Zm9udC12YXJpYW50Om5vcm1hbDtmb250LXdlaWdodDpib2xkO2ZvbnQtc3RyZXRjaDpub3JtYWw7dGV4dC1hbGlnbjpzdGFydDtsaW5lLWhlaWdodDoxMjkuOTk5OTk1MjMlO3dyaXRpbmctbW9kZTpsci10Yjt0ZXh0LWFuY2hvcjpzdGFydDtmaWxsOiNmZjdmMmE7c3Ryb2tlOiMwMDAwMDA7c3Ryb2tlLXdpZHRoOjFweDtmb250LWZhbWlseTpUaW1lcyBOZXcgUm9tYW47LWlua3NjYXBlLWZvbnQtc3BlY2lmaWNhdGlvbjonVGltZXMgTmV3IFJvbWFuLCBCb2xkJyI+TjwvdHNwYW4+PC90ZXh0PgogIDxnCiAgICAgaWQ9IklubmVyQ2lyY2xlIgogICAgIHN0eWxlPSJvcGFjaXR5OjAuNiIKICAgICB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzOS4yNjA3MjYsNDEuMjEwMTIxKSI+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6I2ZmZmZmZjtzdHJva2Utd2lkdGg6OCIKICAgICAgIGlkPSJnNyI+CiAgICAgIDxjaXJjbGUKICAgICAgICAgc29kaXBvZGk6cng9Ijc1IgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgY3k9IjAiCiAgICAgICAgIGN4PSIwIgogICAgICAgICBkPSJNIDc1LDAgQyA3NSw0MS40MjEzNTYgNDEuNDIxMzU2LDc1IDAsNzUgLTQxLjQyMTM1Niw3NSAtNzUsNDEuNDIxMzU2IC03NSwwIGMgMCwtNDEuNDIxMzU2IDMzLjU3ODY0NCwtNzUgNzUsLTc1IDQxLjQyMTM1NiwwIDc1LDMzLjU3ODY0NCA3NSw3NSB6IgogICAgICAgICBpZD0iY2lyY2xlOSIKICAgICAgICAgcj0iNzUiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBzb2RpcG9kaTpyeT0iNzUiIC8+CiAgICA8L2c+CiAgICA8ZwogICAgICAgc3R5bGU9ImZpbGw6bm9uZTtzdHJva2U6IzFiMWIxYjtzdHJva2Utd2lkdGg6MSIKICAgICAgIGlkPSJnMTEiPgogICAgICA8Y2lyY2xlCiAgICAgICAgIHNvZGlwb2RpOnJ5PSI3MSIKICAgICAgICAgc29kaXBvZGk6cng9IjcxIgogICAgICAgICBzb2RpcG9kaTpjeT0iMCIKICAgICAgICAgc29kaXBvZGk6Y3g9IjAiCiAgICAgICAgIGN5PSIwIgogICAgICAgICBjeD0iMCIKICAgICAgICAgZD0iTSA3MSwwIEMgNzEsMzkuMjEyMjE3IDM5LjIxMjIxNyw3MSAwLDcxIC0zOS4yMTIyMTcsNzEgLTcxLDM5LjIxMjIxNyAtNzEsMCBjIDAsLTM5LjIxMjIxNyAzMS43ODc3ODMsLTcxIDcxLC03MSAzOS4yMTIyMTcsMCA3MSwzMS43ODc3ODMgNzEsNzEgeiIKICAgICAgICAgaWQ9ImNpcmNsZTEzIgogICAgICAgICByPSI3MSIgLz4KICAgICAgPGNpcmNsZQogICAgICAgICBzb2RpcG9kaTpyeT0iNzkiCiAgICAgICAgIHNvZGlwb2RpOnJ4PSI3OSIKICAgICAgICAgc29kaXBvZGk6Y3k9IjAiCiAgICAgICAgIHNvZGlwb2RpOmN4PSIwIgogICAgICAgICBjeT0iMCIKICAgICAgICAgY3g9IjAiCiAgICAgICAgIGQ9Ik0gNzksMCBDIDc5LDQzLjYzMDQ5NSA0My42MzA0OTUsNzkgMCw3OSAtNDMuNjMwNDk1LDc5IC03OSw0My42MzA0OTUgLTc5LDAgYyAwLC00My42MzA0OTUgMzUuMzY5NTA1LC03OSA3OSwtNzkgNDMuNjMwNDk1LDAgNzksMzUuMzY5NTA1IDc5LDc5IHoiCiAgICAgICAgIGlkPSJjaXJjbGUxNSIKICAgICAgICAgcj0iNzkiIC8+CiAgICA8L2c+CiAgPC9nPgo8L3N2Zz4K",function(p){if(d.svgDoc=document.importNode(p.documentElement,!0),d.ctx=n,d.east=d.svgDoc.getElementById("East"),d.west=d.svgDoc.getElementById("West"),d.south=d.svgDoc.getElementById("South"),d.north=d.svgDoc.getElementById("North"),d.northText=d.svgDoc.getElementById("NorthText"),d.outerCircle=d.svgDoc.getElementById("OuterCircle"),d.svgDoc.height.baseVal.value=100,d.svgDoc.width.baseVal.value=100,document.getElementById(d.parentElement).innerHTML='<div id="objectCompass"></div>',e("#objectCompass").append(d.svgDoc),d.setSvg(d.svgDoc),d.options.svgDoc=d.svgDoc,d.svgDoc.addEventListener("mousedown",function(e){o(e,d)}),d.svgDoc.addEventListener("mousemove",function(e){s(e,d)}),d.svgDoc.addEventListener("mouseup",function(e){a(e,d)}),d.east.addEventListener("click",function(){l(d)}),d.west.addEventListener("click",function(){u(d)}),d.north.addEventListener("click",function(){c(d)}),d.south.addEventListener("click",function(){h(d)}),d.northText.addEventListener("click",i._alignWithNorth),d.isMobile){var f=r.isPassiveSupported();d.svgDoc.addEventListener("touchstart",function(e){o(e,d)},!!f&&{passive:!0}),d.svgDoc.addEventListener("touchup",function(e){a(e,d)}),d.svgDoc.addEventListener("touchmove",function(e){s(e,d)},!!f&&{passive:!0}),d.northText.addEventListener("touchstart",i._alignWithNorth,!!f&&{passive:!0})}d.ctx.subscribe(t.EVENT_MSG.NAVIGATION_MODIFIED,i.updateNorth),d.ctx.subscribe(t.EVENT_MSG.CRS_MODIFIED,i.updateNorth),e("#"+d.parentElement).css("display","block")},"xml")},n.prototype.detach=function(){var e=this;if(this.svgDoc.removeEventListener("mousedown",function(t){o(t,e)}),this.svgDoc.removeEventListener("mousemove",function(t){s(t,e)}),this.svgDoc.removeEventListener("mouseup",function(t){a(t,e)}),this.east.removeEventListener("click",function(){l(e)}),this.west.removeEventListener("click",function(){u(e)}),this.north.removeEventListener("click",function(){c(e)}),this.south.removeEventListener("click",function(){h(e)}),this.northText.removeEventListener("click",i._alignWithNorth),this.isMobile){var n=r.isPassiveSupported();this.svgDoc.removeEventListener("touchstart",function(t){o(t,e)}),this.svgDoc.removeEventListener("touchup",function(t){a(t,e)}),this.svgDoc.removeEventListener("touchmove",function(t){s(t,e)},!!n&&{passive:!0}),this.northText.removeEventListener("touchstart",i._alignWithNorth,!!n&&{passive:!0})}this.ctx.unsubscribe(t.EVENT_MSG.NAVIGATION_MODIFIED,i.updateNorth),this.ctx.unsubscribe(t.EVENT_MSG.CRS_MODIFIED,i.updateNorth),this.ctx=null},n.prototype.destroy=function(){this.detach(),this.remove(),this.svgDoc=null,this.panFactor=null,this.parentElement=null,this.ctx=null,this.isMobile=null,this._lastMouseX=-1,this._lastMouseY=-1,this._balanceX=-1,this._balanceY=-1,this._dx=0,this._dy=0,this.dragging=!1,this.east=null,this.west=null,this.south=null,this.north=null,this.northText=null,this.outerCircle=null},n}),r("gw/Gui/Tracker/AbstractTracker",["jquery","../../Utils/Utils","../dialog/ErrorDialog"],function(e,t,i){var r=function(t){if(this.options=t,this.context=null,this.navigation=null,this.element=t.element,null==this.element)throw new ReferenceError("Can't get the element name from the options parameters");if(null==document.getElementById(this.element))throw new ReferenceError("Can' get the div "+this.element+" in the web page to insert "+this.constructor.name);document.getElementById(this.element).innerHTML="",t.position&&e("#"+this.element).css(t.position,"2px")};return r.prototype._getNavigation=function(){return this.navigation},r.prototype._setNavigation=function(e){this.navigation=e},r.prototype._getGlobe=function(){return this.globe},r.prototype._setGlobe=function(e){this.globe=e},r.prototype._getElement=function(){return this.element},r.prototype.update=function(e){throw new SyntaxError("update from AbstractTracker not implemented","AbstractTracker.js")},r.prototype.compute=function(e){throw new SyntaxError("compute from AbstractTracker not implemented","AbstractTracker.js")},r.prototype.attachTo=function(e){if(this._setGlobe(e._getGlobe()),this._setNavigation(e.getNavigation()),this._getGlobe().getRenderContext().canvas.addEventListener("mousemove",this.update),this.options.isMobile){var i=t.isPassiveSupported();this._getGlobe().getRenderContext().canvas.addEventListener("touchmove",this.update,!!i&&{passive:!0})}},r.prototype.detach=function(){document.getElementById(this._getElement()).innerHTML="",this._getGlobe().getRenderContext().canvas.removeEventListener("mousemove",this.update),this.options.isMobile&&this._getGlobe().getRenderContext().canvas.removeEventListener("touchmove",this.update)},r.prototype.destroy=function(){document.getElementById(this._getElement()).innerHTML="",this.element=null,this.options=null},r}),r("gw/Gui/dialog/CrsDialog",["jquery","jquery.ui"],function(e){var t="",i=e('<div id="crsInfo" style="text-align: left" title="Coordinate Reference System information"></div>').appendTo("body").dialog({autoOpen:!1,width:500,minHeight:300,maxHeight:500,dialogClass:"crsBox"}),r=!1;return{open:function(e){this.isActive()&&this.destroy();var n=e.getGeoBound();t+="<p align='center'><u><i><b>"+e.getName()+" CRS description </b></i></u></p>",t+="<p align='justify'>"+e.getDescription()+"</p>",t+="<table><caption><i>Sphere parameters</i></caption><tr><th>Parameter</th><th>Value</th></tr><tr><td>Projection</td><td>"+(e.isProjected()?e.getProjection().getName():"3D")+"</td></tr><tr><td>radius (meters)</td><td>"+e.getGeoide().getRealPlanetRadius()+"</td></tr><tr><td>"+e.getLongitudeLabel()+"</td><td>["+n.getWest()+"&deg; , "+n.getEast()+"&deg;]</td></tr><tr><td>"+e.getLatitudeLabel()+"</td><td>["+n.getSouth()+"&deg; , "+n.getNorth()+"&deg;]</td></tr></table>",i.on("dialogclose",function(e){r=!1})},view:function(){i.html(t).dialog("open"),i.scrollTop(5e3),r=!0},hide:function(){i.dialog("close"),r=!1},isActive:function(){return r},destroy:function(){this.hide(),t="",r=!1}}}),r("gw/Gui/Tracker/PositionTracker",["jquery","./AbstractTracker","../dialog/CrsDialog","../../Utils/Utils"],function(e,t,i,r){var n,o=function(e){t.prototype.constructor.call(this,e)};return r.inherits(t,o),o.prototype.update=function(t){if(t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),document.getElementById(n._getElement())){var i=e("#"+n._getElement()+"Info"),r=n._getGlobe().getLonLatFromPixel(t.clientX,t.clientY);if(r){var o=n.compute([r[0],r[1]]);document.getElementById(n._getElement()).innerHTML=o[0]+" x "+o[1],"none"==i.css("display")&&i.show()}else document.getElementById(n._getElement()).innerHTML="","none"!=i.css("display")&&i.hide()}},o.prototype.compute=function(e){return this._getGlobe().getCoordinateSystem().formatCoordinates([e[0],e[1]])},o.prototype.attachTo=function(r){t.prototype.attachTo.call(this,r);e('<input type="button" id="posTrackerInfoButton"/>').appendTo("#"+this._getElement()+"Info");i.open(r._getGlobe().getCoordinateSystem()),e("#posTrackerInfoButton").on("click",function(){!0===i.isActive()?i.hide():i.view()}),n=this},o.prototype.detach=function(){e("#posTrackerInfoButton").off("click"),e("#"+this._getElement()+"Info").empty(),i.destroy(),t.prototype.detach.call(this),n=null},o.prototype.destroy=function(){this.detach(this),t.prototype.destroy.call(this),n=null},o}),r("gw/Gui/Tracker/ElevationTracker",["jquery","./AbstractTracker","../../Utils/Utils","../../Utils/Numeric"],function(e,t,i,r){var n,o=function(e){t.prototype.constructor.call(this,e),this.scale=null,null!=e.elevationLayer&&(this.scale=e.elevationLayer.getScale())};return i.inherits(t,o),o.prototype.setScaleLayer=function(e){this.scale=e.getScale(),this.options.elevationLayer=e},o.prototype.update=function(e){if(e.type.search("touch")>=0&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),document.getElementById(n._getElement())&&n.options.elevationLayer&&n.options.elevationLayer.isRequested()){var t=n._getGlobe().getLonLatFromPixel(e.clientX,e.clientY);if(t&&n.scale){var i=n.compute([t[0],t[1]]);document.getElementById(n._getElement()).innerHTML="Elevation : "+r.roundNumber(i/n.scale,0)+" meters"}else document.getElementById(n._getElement()).innerHTML=""}},o.prototype.compute=function(e){return this._getGlobe().getElevation(e[0],e[1])},o.prototype.attachTo=function(e){t.prototype.attachTo.call(this,e),n=this},o.prototype.detach=function(){t.prototype.detach.call(this),n=null},o.prototype.destroy=function(){this.detach.call(this),t.prototype.destroy.call(this),this.scale=null,n=null},o}),r("gw/Utils/AttributionHandler",[],function(){var e=function(e,t){var i=t?t.element:void 0;i&&(this.element="string"==typeof i?document.getElementById(i):i,this.element&&!i.hasOwnProperty(this.element)&&(this.element.id="attribution")),this.element&&(e.attributionHandler=this)};return e.prototype.removeAttribution=function(e){if(this.element){var t=document.getElementById(this.element.id+"_"+e.id);t&&this.element.removeChild(t)}},e.prototype.addAttribution=function(e){if(this.element){var t=document.createElement("div");t.innerHTML=function(e){var t=null!=e.getAck()?e.getAck():"";return""!==e.getCopyrightUrl()&&void 0!==e.getCopyrightUrl()?'<a class="whiteLink" href="'+e.getCopyrightUrl()+'" target="_blank" title="'+t+'">'+e.getAttribution()+"</a>":e.getAttribution()}.call(this,e),t.id=this.element.id+"_"+e.id,0===e.id?this.element.insertBefore(t,this.element.firstChild):this.element.appendChild(t)}},e.prototype.enable=function(e){if(this.element&&e&&e.isVisible()){var t=document.getElementById(this.element.id+"_"+e.id);t&&(t.style.display="block")}},e.prototype.disable=function(e){if(this.element&&e&&e.isVisible()){var t=document.getElementById(this.element.id+"_"+e.id);t&&(t.style.display="none")}},e.prototype.toggleAttribution=function(e){this.element&&(document.getElementById(this.element.id+"_"+e.id)?this.removeAttribution(e):this.addAttribution(e))},e}),r("gw/Renderer/VectorRenderer",["./RendererTileData","../Tiling/Tile","../Utils/Utils","../Utils/UtilsIntersection"],function(e,t,i,r){var n=function(e){this.tileManager=e.tileManager,this.globe=e,this.buckets=[],this.maxTilePerGeometry=100,this.levelZeroTiledGeometries=[]};return n.prototype.findBucket=function(e,t){for(var i=0;i<this.buckets.length;i++){var r=this.buckets[i];if(r.layer===e&&r.isCompatible(t))return r}return null},n.prototype.generateLevelZero=function(e){for(var t=0;t<this.levelZeroTiledGeometries.length;t++){for(var i=this.levelZeroTiledGeometries[t],r=!1,n=0;n<i._tileIndices.length&&!r;n++){r=this.tileManager.level0Tiles[i._tileIndices[n]]===e}r&&this._addGeometryToTile(i._bucket,i,e)}},n.prototype._recursiveAddGeometryToTile=function(e,i,r){var n=this._addGeometryToTile(e,i,r);if(n&&n.generateChild&&r.children)for(var o=0;o<4;o++)r.children[o].state===t.State.LOADED&&(n.hasChildren=!0,this._recursiveAddGeometryToTile(e,i,r.children[o]))},n.prototype.addGeometry=function(e,i,r){var n=this.getOrCreateBucket(e,i,r);i._bucket=n;var o=this.maxTilePerGeometry>0?this.tileManager.tiling.getOverlappedLevelZeroTiles(i):null;if(o&&o.length<this.maxTilePerGeometry){for(var s=0;s<o.length;s++){var a=this.tileManager.level0Tiles[o[s]];a&&void 0!==a&&a.state===t.State.LOADED&&this._recursiveAddGeometryToTile(n,i,a)}i._tileIndices=o,this.levelZeroTiledGeometries.push(i)}else n.mainRenderable||(n.mainRenderable=n.createRenderable()),n.mainRenderable.add(i)},n.prototype.removeGeometry=function(e){var t=e._tileIndices;if(t){for(var i=0;i<t.length;i++){var r=this.tileManager.level0Tiles[t[i]];this.removeGeometryFromTile(e,r)}this.levelZeroTiledGeometries.splice(this.levelZeroTiledGeometries.indexOf(e),1),e._tileIndices=null}else{var n=e._bucket;if(n.mainRenderable)0===n.mainRenderable.remove(e)&&(n.mainRenderable.dispose(this.renderContext),n.mainRenderable=null)}},n.prototype.getOrCreateBucket=function(e,t,i){var r=this.findBucket(e,i);return r||((r=this.createBucket(e,i)).renderer=this,r.id=this.globe.getRendererManager().bucketId++,this.buckets.push(r)),r},n.prototype.addGeometryToTile=function(e,t,i,r){var n=this.getOrCreateBucket(e,t,i);return t._bucket=n,this._addGeometryToTile(n,t,r)},n.prototype._addGeometryToTile=function(t,i,r){var n=r.extension.renderer;n||(n=r.extension.renderer=new e(this.globe.getRendererManager()));var o=n.getRenderable(t),s=!1;return o||(o=t.createRenderable(),s=!0),o.add(i,r)?(s&&n.renderables.push(o),o):null},n.prototype._removeGeometryFromTile=function(e,i,n,o){var s=0;if(null!==i&&!1===r.boundsIntersects(i,n.bound))return s;var a=null;if(n&&n.extension&&(a=n.extension.renderer),a)for(var l=0;l<a.renderables.length;){var u=a.renderables[l];if(u.bucket.renderer===this){if(0===u.remove(e)?a.renderables.splice(l,1):l++,!0===u.hasChildren&&n.children)for(var c=0;c<4;c++)if(n.children[c].state===t.State.LOADED){var h=this._removeGeometryFromTile(e,i,n.children[c],o+1);h>s&&(s=h)}}else l++}return s},n.prototype.removeGeometryFromTile=function(e,t){var r=null;"Point"===!e.type&&(r=i.getBBox(e)),this._removeGeometryFromTile(e,r,t,0)},n}),r("gw/Renderer/PointRenderer",["../Utils/Utils","../Utils/Constants","./VectorRenderer","./RendererManager","./FeatureStyle","./Program","./GeoBound","../Utils/Proxy"],function(e,t,i,r,n,o,s,a){var l,u=(l=null,{generateImageData:function(e,t){l||((l=document.createElement("canvas")).width=512,l.height=20);var i=t;i?i instanceof Array&&(i=n.fromColorToString(t)):i="#fff";var r=l.getContext("2d");r.clearRect(0,0,l.width,l.height),r.fillStyle=i,r.font="18px sans-serif",r.textBaseline="top",r.shadowColor="#000",r.shadowOffsetX=1,r.shadowOffsetY=1,r.shadowBlur=2,r.fillText(e,1,1);var o=r.measureText(e);return r.getImageData(0,0,Math.floor(o.width)+2,l.height)}}),c=function(e){i.prototype.constructor.call(this,e),this.renderContext=e.tileManager.renderContext,this.tileConfig=e.tileManager.tileConfig,this.numberOfRenderPoints=0;this.program=new o(this.renderContext),this.program.createFromSource("attribute vec3 vertex; // vertex have z = 0, spans in x,y from -0.5 to 0.5 \nuniform mat4 viewProjectionMatrix; \nuniform vec3 poiPosition; // world position \nuniform vec2 poiScale; // x,y scale \nuniform vec2 tst; \n\nvarying vec2 texCoord; \n\nvoid main(void)  \n{ \n\t// Generate texture coordinates, input vertex goes from -0.5 to 0.5 (on x,y) \n\ttexCoord = vertex.xy + vec2(0.5) + tst; \n\t// Invert y \n\ttexCoord.y = 1.0 - texCoord.y; \n\t\n\t// Compute poi position in clip coordinate \n\tgl_Position = viewProjectionMatrix * vec4(poiPosition, 1.0); \n\tgl_Position.xy += vertex.xy * gl_Position.w * poiScale; \n} \n","precision lowp float; \nvarying vec2 texCoord; \nuniform sampler2D texture; \nuniform float alpha; \nuniform vec3 color; \n\nvoid main(void) \n{ \n\tvec4 textureColor = texture2D(texture, texCoord); \n\tgl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha); \n\tif (gl_FragColor.a <= 0.0) discard; \n} \n");var t=new Float32Array([-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0]),r=this.renderContext.gl;this.vertexBuffer=r.createBuffer(),r.bindBuffer(r.ARRAY_BUFFER,this.vertexBuffer),r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW),this.defaultTexture=null};e.inherits(i,c),c.prototype._buildDefaultTexture=function(e){if(!this.defaultTexture){var t=this.renderContext.gl;this.defaultTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i)}e.texture=this.defaultTexture,e.textureWidth=10,e.textureHeight=10},c.prototype._buildTextureFromImage=function(e,t){e.texture=this.renderContext.createNonPowerOfTwoTextureFromImage(t),e.textureWidth=t.width,e.textureHeight=t.height};var h=function(e){this.bucket=e,this.points=[],this.geometries=[]};h.prototype.add=function(e,t){var i=this.bucket.layer.getGlobe().getCoordinateSystem(),r=e.coordinates.slice(0);if(!1!==t&&this.geometries.push(e),r=i.convert(r,e.crs.properties.name,i.getGeoideName()),new s(i.getGeoBound().getWest(),i.getGeoBound().getSouth(),i.getGeoBound().getEast(),i.getGeoBound().getNorth()).isPointInside(r)){const t=this.bucket.renderer.globe,s=t.isSky()?0:i.getElevation(t,e)+200;r.push(s);for(var n=i.get3DFromWorld(r),o=i.getVerticalAt3D(n),a=!1,l=0;l<this.points.length;++l)this.points[l].geometry===e&&(a=!0);return a||this.points.push({pos3d:n,vertical:o,geometry:e}),!0}return!1},h.prototype.updateElevations=function(){this.points=[];for(var e=0;e<this.geometries.length;e++)this.add(this.geometries[e],!1)},h.prototype.remove=function(e){for(var t=0;t<this.points.length;t++)if(this.points[t].geometry===e)return this.points.splice(t,1),this.points.length;return this.points.length},h.prototype.dispose=function(e){};var d=function(e,t){this.layer=e,this.style=new n(t),this.renderer=null,this.texture=null};return d.prototype.createRenderable=function(){return new h(this)},d.prototype.isCompatible=function(e){return this.style.iconUrl===e.iconUrl&&this.style.icon===e.icon&&this.style.label===e.label},c.prototype.createBucket=function(e,t){var i=new d(e,t);if(t.label){var r=u.generateImageData(t.label,t.textColor);this._buildTextureFromImage(i,r)}else if(t.iconUrl){var n=new Image;n.crossOrigin="";var o=this;n.onload=function(){o._buildTextureFromImage(i,n),o.renderContext.requestFrame()},n.onerror=function(){o._buildDefaultTexture(i)},n.src=a.proxify(t.iconUrl)}else t.icon?this._buildTextureFromImage(i,t.icon):this._buildDefaultTexture(i);return i},c.prototype.render=function(e,t,i){this.numberOfRenderPoints=0;var r=this.renderContext,n=this.renderContext.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.program.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(this.program.uniforms.texture,0),mat4.inverse(r.viewMatrix,r.modelViewMatrix);var o=[r.modelViewMatrix[8],r.modelViewMatrix[9],r.modelViewMatrix[10]];vec3.normalize(o),vec3.scale(o,this.tileConfig.cullSign,o);var s,a=r.computePixelSizeVector();n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0);for(var l=t;l<i;l++){var u=e[l],c=u.bucket;if(0!==u.points.length){null!==c&&(n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,c.texture),s=[2*c.textureWidth/r.canvas.width,2*c.textureHeight/r.canvas.height],n.uniform2fv(this.program.uniforms.poiScale,s),n.uniform2fv(this.program.uniforms.tst,[.5/c.textureWidth,.5/c.textureHeight]));for(var h=0;h<u.points.length;h++){var d=u.points[h].pos3d,p=u.points[h].vertical;if(s=c.textureHeight*(a[0]*d[0]+a[1]*d[1]+a[2]*d[2]+a[3]),!((s*=this.tileConfig.cullSign)/this.globe.getCoordinateSystem().getGeoide().getHeightScale()*.001>c.style.pointMaxSize)&&vec3.dot(p,o)>0&&r.worldFrustum.containsSphere(d,s)>=0){var f=p[0]*s+d[0],g=p[1]*s+d[1],m=p[2]*s+d[2];n.uniform3f(this.program.uniforms.poiPosition,f,g,m),n.uniform1f(this.program.uniforms.alpha,c.layer.getOpacity());var v=c.style.getFillColor();n.uniform3f(this.program.uniforms.color,v[0],v[1],v[2]),n.drawArrays(n.TRIANGLE_FAN,0,4),this.numberOfRenderPoints++}}}}n.disable(n.BLEND)},c.prototype.canApply=function(e,i){return e===t.GEOMETRY.Point&&null===i.iconUrl},r.factory.push(function(e){return new c(e)}),c}),r("gw/Renderer/BatchRenderable",[],function(){var e=function(e){this.bucket=e,this.vertexBuffer=null,this.indexBuffer=null,this.vertices=[],this.triIndices=[],this.lineIndices=[],this.geometryInfos=[],this.bufferDirty=!0,this.vertexSize=3,this.indexType=0,this.vertexBufferShared=!1};return e.prototype.remove=function(e){for(var t,i=-1,r=0,n=0,o=0,s=0;s<this.geometryInfos.length;s++){var a=this.geometryInfos[s];if(a.geometry===e){this.vertices.splice(r,a.vertexCount),this.lineIndices.splice(n,a.lineIndexCount),this.triIndices.splice(o,a.triIndexCount);var l=a.vertexCount/this.vertexSize;for(t=n;t<this.lineIndices.length;t++)this.lineIndices[t]-=l;for(t=o;t<this.triIndices.length;t++)this.triIndices[t]-=l;i=s;break}r+=a.vertexCount,n+=a.lineIndexCount,o+=a.triIndexCount}return i>=0?(this.bufferDirty=!0,this.geometryInfos.splice(i,1),this.vertices.length):this.vertices.length},e.prototype.add=function(e,t){var i=void 0!==t;this.tile=t;var r=this.vertices.length,n=this.lineIndices.length,o=this.triIndices.length,s=!1===i;return!0===i&&(s=this.build(e,t)),!!s&&(this.geometryInfos.push({geometry:e,vertexCount:this.vertices.length-r,lineIndexCount:this.lineIndices.length-n,triIndexCount:this.triIndices.length-o}),this.bufferDirty=!0,!0)},e.prototype.dispose=function(e){if(void 0!==e){var t=e.gl;this.indexBuffer&&t.deleteBuffer(this.indexBuffer),this.indexBuffer=null,this.vertexBuffer&&!this.vertexBufferShared&&(t.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null)}},e.prototype.bindBuffers=function(e){var t=e.gl;if(this.bufferDirty){this.dispose(e),this.vertexBuffer?t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer):(this.vertexBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW)),this.indexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var i=this.triIndices;i=this.triIndices.length>0?this.lineIndices.length>0?this.triIndices.concat(this.lineIndices):this.triIndices:this.lineIndices,this.vertices.length/this.vertexSize>65535?(t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(i),t.STATIC_DRAW),this.indexType=t.UNSIGNED_INT):(t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),t.STATIC_DRAW),this.indexType=t.UNSIGNED_SHORT),this.bufferDirty=!1}else t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)},e}),r("gw/Tiling/TiledVectorRenderable",["../Utils/Utils","../Renderer/BatchRenderable","../Utils/Constants"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e),this.tile=null,this.hasChildren=!0};return e.inherits(t,r),r.prototype.initChild=function(e,t){var i=new r(this.bucket);return i.tile=this.tile,i.vertexBufferShared=!0,i.vertexBuffer=this.vertexBuffer,i.vertices=this.vertices,i.buildChildrenIndices(this,2*t+e),i},r.prototype.generateChild=function(e){for(var t=0;t<this.geometryInfos.length;t++)this.bucket.renderer._addGeometryToTile(this.bucket,this.geometryInfos[t].geometry,e)},r.prototype.buildChildrenIndices=function(e,t){var i,r,n,o,s,a,l,u,c,h,d,p;for(i=0;i<e.triIndices.length;i+=3)r=3*e.triIndices[i],n=3*e.triIndices[i+1],o=3*e.triIndices[i+2],s=e.vertices[r],a=e.vertices[n],l=e.vertices[o],u=0,(s>0||0===s&&a>0||0===s&&0===a&&l>0)&&(u=1),c=e.vertices[r+1],h=e.vertices[n+1],d=e.vertices[o+1],p=1,(c>0||0===c&&h>0||0===c&&0===h&&d>0)&&(p=0),t===2*p+u&&this.triIndices.push(e.triIndices[i],e.triIndices[i+1],e.triIndices[i+2]);for(i=0;i<e.lineIndices.length/2;i++)r=3*e.lineIndices[2*i],n=3*e.lineIndices[2*i+1],s=e.vertices[r],a=e.vertices[n],u=0,(s>0||0===s&&a>0)&&(u=1),c=e.vertices[r+1],h=e.vertices[n+1],p=1,(c>0||0===c&&h>0)&&(p=0),t===2*p+u&&this.lineIndices.push(e.lineIndices[2*i],e.lineIndices[2*i+1])},r.prototype.build=function(e,t){var r,n;if(this.tile=t,void 0===this.bucket.layer.minLevel||void 0===this.bucket.layer.maxLevel||this.bucket.layer.minLevel<=t.level&&t.level<=this.bucket.layer.maxLevel){var o=e.coordinates;switch(e.type){case i.GEOMETRY.LineString:this.buildVerticesAndIndices(t,o);break;case i.GEOMETRY.Polygon:case i.GEOMETRY.MultiLineString:for(r=0;r<o.length;r++)this.buildVerticesAndIndices(t,o[r]);break;case i.GEOMETRY.MultiPolygon:for(n=0;n<o.length;n++)for(r=0;r<o[n].length;r++)this.buildVerticesAndIndices(t,o[n][r])}}return t.geoBound.intersectsGeometry(e)},r}),r("gw/Tiling/TiledVectorRenderer",["../Utils/Utils","../Renderer/VectorRenderer","../Renderer/Program"],function(e,t,i){var r=function(e){t.prototype.constructor.call(this,e);this.program=new i(this.tileManager.renderContext),this.program.createFromSource("attribute vec3 vertex; \nuniform float zOffset; \nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\n\nvoid main(void)  \n{ \n\tgl_Position = projectionMatrix * modelViewMatrix * vec4(vertex.x, vertex.y, vertex.z + zOffset, 1.0); \n} \n","#ifdef GL_ES \nprecision highp float; \n#endif \nuniform vec4 color; \n\nvoid main(void) \n{ \n\tgl_FragColor = color; \n} \n")};return e.inherits(t,r),r.prototype.render=function(e,t,i){var r=this.tileManager.renderContext,n=r.gl,o=mat4.create();this.program.apply(),n.depthFunc(n.LEQUAL),n.depthMask(!1),n.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,r.projectionMatrix);for(var s=null,a=t;a<i;a++){var l=e[a],u=l.tile;if(mat4.multiply(r.viewMatrix,u.matrix,o),n.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,o),n.uniform1f(this.program.uniforms.zOffset,7e-4*u.radius),s=l.bucket.style,l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,3,n.FLOAT,!1,0,0),l.triIndices.length>0&&(n.uniform4f(this.program.uniforms.color,s.fillColor[0],s.fillColor[1],s.fillColor[2],s.fillColor[3]*l.bucket.layer.getOpacity()),n.drawElements(n.TRIANGLES,l.triIndices.length,l.indexType,0)),l.lineIndices.length>0){n.lineWidth(s.strokeWidth),n.uniform4f(this.program.uniforms.color,s.strokeColor[0],s.strokeColor[1],s.strokeColor[2],s.strokeColor[3]*l.bucket.layer.getOpacity());var c=l.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,l.lineIndices.length,l.indexType,l.triIndices.length*c)}}n.depthMask(!0),n.depthFunc(n.LESS)},r}),r("gw/Renderer/LineStringRenderable",["../Utils/Constants","../Utils/Utils","./FeatureStyle","./RendererManager","../Tiling/TiledVectorRenderable","../Tiling/TiledVectorRenderer","../Utils/Numeric"],function(e,t,i,r,n,o,s){var a=function(e){n.prototype.constructor.call(this,e)};t.inherits(n,a),a.prototype._fixDateLine=function(e,t){for(var i=[],r=[i],n=0;n<t.length-1;n++){i.push(t[n]);var o=t[n][0],s=t[n][1],a=t[n+1][0],l=t[n+1][1];if(Math.abs(a-o)>180){o<0&&(o+=360),a<0&&(a+=360);var u=(180-o)/(a-o);if(u>0&&u<1){var c=s+u*(l-s),h=t[n][0]>0?180:-180;i.push([h,c]),i=[[-h,c]],r.push(i)}}}return i.push(t[t.length-1]),r},a.prototype.buildVerticesAndIndices=function(e,t){if(0!==t.length)for(var i=this._fixDateLine(e,t),r=0;r<i.length;r++)this._buildVerticesAndIndices(e,i[r])},a.prototype._buildVerticesAndIndices=function(e,t){var i=e.config.tesselation,r=e.config.vertexSize;t.push(t[t.length-1]);for(var n=e.lonlat2tile(t),o=0;o<t.length-1;o++){var a,l,u,c,h,d,p,f,g=n[o][0],m=n[o][1],v=n[o+1][0],y=n[o+1][1],b=[],x=Math.max(-1,Math.min(g,v)),w=Math.min(i-1,Math.max(g,v));for(a=Math.floor(x)+1;a<Math.floor(w)+1;a++)if(c=a,(u=s.lineIntersection(g,m,v,y,c,0,c,i-1))[0]>0&&u[0]<1&&u[1]>=0&&u[1]<=1){l=u[1]*(i-1);var T=Math.floor(l),_=l-T;h=r*(T*i+a),d=(1-_)*e.vertices[h]+_*e.vertices[h+r*i],p=(1-_)*e.vertices[h+1]+_*e.vertices[h+r*i+1],f=(1-_)*e.vertices[h+2]+_*e.vertices[h+r*i+2],b.push([u[0],d,p,f])}var C=Math.max(-1,Math.min(m,y)),S=Math.min(i-1,Math.max(m,y));for(a=Math.floor(C)+1;a<Math.floor(S)+1;a++)if(l=a,(u=s.lineIntersection(g,m,v,y,0,l,i-1,l))[0]>0&&u[0]<1&&u[1]>=0&&u[1]<=1){c=u[1]*(i-1);var E=Math.floor(c),A=c-E;h=r*(a*i+E),d=(1-A)*e.vertices[h]+A*e.vertices[h+r],p=(1-A)*e.vertices[h+1]+A*e.vertices[h+r+1],f=(1-A)*e.vertices[h+2]+A*e.vertices[h+r+2],b.push([u[0],d,p,f])}b.sort(function(e,t){return e[0]>t[0]});var I,M=this.vertices.length/3;for(g>=0&&g<=i-1&&m>=0&&m<=i-1&&(I=e.computePosition(g,m),this.vertices.push(I[0]),this.vertices.push(I[1]),this.vertices.push(I[2])),a=0;a<b.length;a++)this.vertices.push(b[a][1]),this.vertices.push(b[a][2]),this.vertices.push(b[a][3]);v>=0&&v<=i-1&&y>=0&&y<=i-1&&(I=e.computePosition(v,y),this.vertices.push(I[0]),this.vertices.push(I[1]),this.vertices.push(I[2]));var k=this.vertices.length/3;for(a=M;a<k-1;a++)this.lineIndices.push(a),this.lineIndices.push(a+1)}};var l=function(e){o.prototype.constructor.call(this,e)};t.inherits(o,l),l.prototype.canApply=function(t,i){if(this.globe.isSky())return!1;if(!i.onTerrain)return!1;return!(t!==e.GEOMETRY.LineString&&t!==e.GEOMETRY.MultiLineString&&(i.fill||t!==e.GEOMETRY.Polygon&&t!==e.GEOMETRY.MultiPolygon)||i.gradientLength)};var u=function(e,t){this.layer=e,this.style=new i(t),this.renderer=null};return u.prototype.createRenderable=function(){return new a(this)},u.prototype.isCompatible=function(e){return this.style.strokeColor[0]===e.strokeColor[0]&&this.style.strokeColor[1]===e.strokeColor[1]&&this.style.strokeColor[2]===e.strokeColor[2]&&this.style.strokeColor[3]===e.strokeColor[3]&&this.style.strokeWidth===e.strokeWidth},l.prototype.createBucket=function(e,t){return new u(e,t)},r.factory.push(function(e){return new l(e)}),a}),r("gw/Renderer/pnltri",[],function(){var e={REVISION:"2.1.1"};return e.Math={random:Math.random,array_shuffle:function(t){for(var i=t.length-1;i>0;i--){var r=Math.floor(e.Math.random()*(i+1)),n=t[i];t[i]=t[r],t[r]=n}return t},compare_pts_yx:function(t,i){var r=t.y-i.y;if(r<e.Math.EPSILON_N)return-1;if(r>e.Math.EPSILON_P)return 1;var n=t.x-i.x;return n<e.Math.EPSILON_N?-1:n>e.Math.EPSILON_P?1:0},ptsCrossProd:function(e,t,i){return(t.x-e.x)*(i.y-e.y)-(t.y-e.y)*(i.x-e.x)}},e.Math.EPSILON_P=Math.pow(2,-43),e.Math.EPSILON_N=-e.Math.EPSILON_P,e.PolygonData=function(e){if(this.vertices=[],this.segments=[],this.diagonals=[],this.idNextPolyChain=0,this.PolyLeftArr=[],this.monoSubPolyChains=[],this.triangles=[],e)for(var t=0,i=e.length;t<i;t++)this.addPolygonChain(e[t])},e.PolygonData.prototype={constructor:e.PolygonData,nbVertices:function(){return this.vertices.length},getSegments:function(){return this.segments},getFirstSegment:function(){return this.segments[0]},getMonoSubPolys:function(){return this.monoSubPolyChains},getTriangles:function(){return this.triangles.concat()},nbPolyChains:function(){return this.idNextPolyChain},get_PolyLeftArr:function(){return this.PolyLeftArr.concat()},set_PolyLeft_wrong:function(e){this.PolyLeftArr[e]=!1},isClockWise:function(e){var t=e,i=0;do{i+=(t.vFrom.x-t.vTo.x)*(t.vFrom.y+t.vTo.y),t=t.snext}while(t!=e);return i<0},appendVertexEntry:function(e,t){var i={id:this.vertices.length,x:e,y:t};return this.vertices.push(i),i},createSegmentEntry:function(t,i){return{chainId:this.idNextPolyChain,vFrom:t,vTo:i,upward:1==e.Math.compare_pts_yx(i,t),sprev:null,snext:null,rootFrom:null,rootTo:null,is_inserted:!1,trLeft:null,trRight:null,mprev:null,mnext:null,marked:!1}},appendSegmentEntry:function(e){return this.segments.push(e),e},appendDiagonalsEntry:function(e){return this.diagonals.push(e),e},addVertexChain:function(t){function i(t,i){return Math.abs(t.x-i.x)<e.Math.EPSILON_P&&Math.abs(t.y-i.y)<e.Math.EPSILON_P}function r(t,i,r){return!(Math.abs(e.Math.ptsCrossProd(i,t,r))>e.Math.EPSILON_P)&&(Math.abs(t.y-i.y)<e.Math.EPSILON_P?(o=i.x,t.x<r.x?(n=t.x,s=r.x):(n=r.x,s=t.x)):(o=i.y,t.y<r.y?(n=t.y,s=r.y):(n=r.y,s=t.y)),n-o<e.Math.EPSILON_P&&o-s<e.Math.EPSILON_P);var n,o,s}for(var n,o,s,a=[],l=0;l<t.length;l++)n=this.appendVertexEntry(t[l].x,t[l].y),o=!0,(s=a.length-1)>=0&&(i(n,a[s])?o=!1:s>0&&r(a[s-1],a[s],n)&&a.pop()),o&&a.push(n);return(s=a.length-1)>0&&i(a[s],a[0])&&(a.pop(),s--),s>1&&(r(a[s-1],a[s],a[0])&&(a.pop(),s--),s>1&&r(a[s],a[0],a[1])&&a.shift()),a},addPolygonChain:function(e){var t=this.addVertexChain(e);if(t.length<3)return console.log("Polygon has < 3 vertices!",t),0;for(var i,r,n,o=this.segments.length,s=0;s<t.length-1;s++)i=this.createSegmentEntry(t[s],t[s+1]),n?(i.sprev=n,n.snext=i):r=i,n=i,this.appendSegmentEntry(i);return(i=this.createSegmentEntry(t[t.length-1],t[0])).sprev=n,n.snext=i,this.appendSegmentEntry(i),r.sprev=i,i.snext=r,this.PolyLeftArr[this.idNextPolyChain++]=!0,this.segments.length-o},create_mono_chains:function(){for(var e,t,i,r,n=0,o=this.segments.length;n<o;n++)e=this.segments[n],this.PolyLeftArr[e.chainId]?(t=e.vTo,e.mprev=e.sprev,e.mnext=e.snext):(t=e.vFrom,(e=e.snext).mprev=e.snext,e.mnext=e.sprev),(r=e.vFrom.lastInDiag)&&(r.mnext=e,e.mprev=r,e.vFrom.lastInDiag=null),(i=t.firstOutDiag)&&(i.mprev=e,e.mnext=i,t.firstOutDiag=null)},unique_monotone_chains_max:function(){function t(t){var i,r,n,o=t;for(r=n=t.vFrom,t.marked=!0,t=t.mnext;i=t.vFrom;){if(t.marked){if(i==r)break;return console.log("ERR unique_monotone: segment in two chains",r,t),null}t.marked=!0,1==e.Math.compare_pts_yx(i,n)&&(n=i,o=t),t=t.mnext}return o}var i,r;this.monoSubPolyChains=[];for(var n=0,o=this.segments.length;n<o;n++)(i=this.segments[n]).marked||(r=t(i))&&this.monoSubPolyChains.push(r);return this.monoSubPolyChains},clearTriangles:function(){this.triangles=[]},addTriangle:function(e,t,i){this.triangles.push([e.id,t.id,i.id])}},e.EarClipTriangulator=function(e){this.polyData=e},e.EarClipTriangulator.prototype={constructor:e.EarClipTriangulator,triangulate_polygon_no_holes:function(){function t(t){var i=t.mprev.vFrom.x,r=t.mprev.vFrom.y,n=t.vFrom.x,o=t.vFrom.y,s=t.mnext.vFrom.x,a=t.mnext.vFrom.y,l=s-n,u=a-o,c=i-s,h=r-a,d=n-i,p=o-r;if(e.Math.EPSILON_P>d*u-l*p)return!1;for(var f=t.mprev.mprev,g=t.mnext;g!=f;){var m=(g=g.mnext).vFrom.x,v=g.vFrom.y,y=m-i,b=v-r;if(0!==y||0!==b){var x=m-n,w=v-o;if(0!==x||0!==w){var T=m-s,_=v-a;if((0!==T||0!==_)&&l*w-u*x>=e.Math.EPSILON_N&&d*b-p*y>=e.Math.EPSILON_N&&c*_-h*T>=e.Math.EPSILON_N)return!1}}}return!0}var i=this.polyData,r=i.getFirstSegment(),n=r;if(i.isClockWise(r)){do{n.mprev=n.snext,n.mnext=n.sprev,n=n.sprev}while(n!=r);i.set_PolyLeft_wrong(0)}else do{n.mprev=n.sprev,n.mnext=n.snext,n=n.snext}while(n!=r);for(var o=r,s=o;o.mnext!=o.mprev;)if(t(o))this.polyData.addTriangle(o.mprev.vFrom,o.vFrom,o.mnext.vFrom),o.mprev.mnext=o.mnext,o.mnext.mprev=o.mprev,s=o=o.mnext;else if((o=o.mnext)==s)return!1;return!0}},e.Trapezoid=function(e,t,i,r){this.vHigh=e||{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},this.vLow=t||{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY},this.lseg=i,this.rseg=r,this.depth=-1,this.monoDone=!1},e.Trapezoid.prototype={constructor:e.Trapezoid,clone:function(){var t=new e.Trapezoid(this.vHigh,this.vLow,this.lseg,this.rseg);return t.uL=this.uL,t.uR=this.uR,t.dL=this.dL,t.dR=this.dR,t.sink=this.sink,t},splitOffLower:function(e){var t=this.clone();return this.vLow=t.vHigh=e,this.dL=t,t.uL=this,this.dR=t.uR=null,t.dL&&(t.dL.uL=t),t.dR&&(t.dR.uR=t),t}},e.QsNode=function(e){this.trap=e,e.sink=this},e.QsNode.prototype={constructor:e.QsNode},e.QueryStructure=function(t){var i=new e.Trapezoid(null,null,null,null);if(this.trapArray=[],this.appendTrapEntry(i),this.root=new e.QsNode(i),t)for(var r=t.getSegments(),n=0;n<r.length;n++)r[n].rootFrom=r[n].rootTo=this.root,r[n].is_inserted=!1},e.QueryStructure.prototype={constructor:e.QueryStructure,getRoot:function(){return this.root},appendTrapEntry:function(e){e.trapID=this.trapArray.length,this.trapArray.push(e)},cloneTrap:function(e){var t=e.clone();return this.appendTrapEntry(t),t},splitNodeAtPoint:function(t,i,r){var n=t.trap;if(n.vHigh==i)return t;if(n.vLow==i)return t;var o=n.splitOffLower(i);return this.appendTrapEntry(o),t.yval=i,t.trap=null,t.right=new e.QsNode(n),t.left=new e.QsNode(o),r?n.sink:o.sink},fpEqual:function(t,i){return Math.abs(t-i)<e.Math.EPSILON_P},is_left_of:function(t,i,r){var n,o=t.vFrom.x-i.x,s=t.vTo.x-i.x,a=this.fpEqual(t.vFrom.y,i.y);if(this.fpEqual(t.vTo.y,i.y)){if(a)return 0;n=s}else{if(!a)return t.upward?e.Math.ptsCrossProd(t.vFrom,t.vTo,i):e.Math.ptsCrossProd(t.vTo,t.vFrom,i);n=o}return Math.abs(n)<e.Math.EPSILON_P?0:n},segNodes:function(e){this.ptNode(e,!0),this.ptNode(e,!1)},ptNode:function(t,i){var r,n,o,s;for(i?(r=t.vFrom,n=t.vTo,o=t.rootFrom):(r=t.vTo,n=t.vFrom,o=t.rootTo);o;)if(o.yval)o=-1==e.Math.compare_pts_yx(r==o.yval?n:r,o.yval)?o.left:o.right;else{if(!o.seg)return o.trap||console.log("ptNode: unknown type",o),i?t.rootFrom=o:t.rootTo=o,o;if(r==o.seg.vFrom||r==o.seg.vTo){if(this.fpEqual(r.y,n.y)){o=this.fpEqual(o.seg.vFrom.y,o.seg.vTo.y)?r==o.seg.vFrom?((t.upward?n.x>=o.seg.vTo.x:n.x<o.seg.vTo.x)?t.sprev.upward:o.seg.snext.upward)?o.right:o.left:((t.upward?n.x<o.seg.vFrom.x:n.x>=o.seg.vFrom.x)?t.snext.upward:o.seg.sprev.upward)?o.left:o.right:n.x<r.x?o.left:o.right;continue}0===(s=this.is_left_of(o.seg,n,!1))&&(s=r==o.seg.vFrom?(t.upward?n.y>=o.seg.vTo.y:n.y<o.seg.vTo.y)?this.is_left_of(o.seg,t.sprev.vFrom,!1):-this.is_left_of(o.seg,o.seg.snext.vTo,!1):(t.upward?n.y<o.seg.vFrom.y:n.y>=o.seg.vFrom.y)?this.is_left_of(o.seg,t.snext.vTo,!1):-this.is_left_of(o.seg,o.seg.sprev.vFrom,!1))}else if(0===(s=this.is_left_of(o.seg,r,!0))&&0===(s=this.is_left_of(o.seg,n,!1))){var a=i?t.sprev.vFrom:t.snext.vTo;s=this.is_left_of(o.seg,a,!1)}if(s>0)o=o.left;else{if(!(s<0))return o;o=o.right}}},add_segment:function(t){var i,r,n,o,s,a,l=this;function u(){var e;if(x.vLow==b.vLow&&n)x.dL.uL=d,x.dR.uR=p,d.dL=x.dL,p.dR=x.dR,d.dR=p.dL=null,e=null;else{var i;x.dL.uL=d,x.dR.uR=p;var r=l.is_left_of(t,x.vLow,!0);if(r>0)i=!0;else if(r<0)i=!1;else{var o=x.dL.rseg,s=o.upward,a=s?o.vFrom:o.vTo;(r=l.is_left_of(t,a,!1))>0?i=!0:r<0?i=!1:(o=s?o.snext:o.sprev,a=s?o.vTo:o.vFrom,i=(r=l.is_left_of(t,a,!1))>0)}i?(e=x.dR,x.dR.uL=d,d.dL=x.dL,p.dR=null):(e=x.dL,x.dL.uR=p,p.dR=x.dR,d.dL=null),d.dR=p.dL=e}return e}if(this.segNodes(t),t.upward?(i=t.vFrom,o=t.vTo,r=t.rootFrom,s=t.rootTo,n=t.sprev.is_inserted,a=t.snext.is_inserted):(i=t.vTo,o=t.vFrom,r=t.rootTo,s=t.rootFrom,n=t.snext.is_inserted,a=t.sprev.is_inserted),!a){var c=this.splitNodeAtPoint(s,o,!1);s==r&&(r=c),s=c}var h=s.trap;if(h.uL||h.uR)if(h.vHigh==o){n||(r=this.splitNodeAtPoint(r,i,!0));for(var d,p,f,g,m,v,y,b=r.trap,x=h,w=this.trapArray.length+2;x;){if(--w<0)return void console.log("ERR add_segment: infinite loop",x,t,this);if(!x.dL&&!x.dR)return void console.log("ERR add_segment: missing successors",x,t,this);var T=x.sink;T.seg=t,T.trap=null,g&&g.rseg==x.rseg?(d=x,(p=g).vLow=x.vLow,T.left=new e.QsNode(d),T.right=g.sink):f&&f.lseg==x.lseg?(p=x,(d=f).vLow=x.vLow,T.left=f.sink,T.right=new e.QsNode(p)):(d=x,p=this.cloneTrap(x),T.left=new e.QsNode(d),T.right=new e.QsNode(p)),x.uL&&x.uR?x.usave?(x.uleft?(p.uL=x.uR,p.uR=x.usave,p.uL.dL=p,p.uR.dR=p):(d.uR=x.uL,d.uL=x.usave,d.uL.dL=d,d.uR.dR=d),d.usave=p.usave=null):x.vHigh==h.vHigh?(p.uR.dR=p,d.uR=p.uL=null):p==x?(p.uL=p.uR,p.uR=null,p.uL.dL=p):(d.uR=d.uL,d.uL=null):(y=void 0,(y=x.uL||x.uR).dL&&y.dR?x==y.dL?(p.uL=null,y.dL=d):(d.uR=null,y.dR=p):(p.uL=null,p.uR=y,y.dR=p)),x.dL&&x.dR?m=u():(m=x.dL?x.dL:x.dR,v=m,x.vLow==b.vLow?(n?x.dL?(v.uL=d,d.dL=v,p.dR=null):(v.uR=p,d.dL=null,p.dR=v):(v.uL=d,v.uR=p,d.dL=p.dR=v),d.dR=p.dL=null):(v.uL&&v.uR&&(v.uL==x?(v.usave=v.uR,v.uleft=!0):(v.usave=v.uL,v.uleft=!1)),v.uL=d,v.uR=p,d.dR=p.dL=v,d.dL=p.dR=null)),d.rseg&&(d.rseg.trLeft=p),p.lseg&&(p.lseg.trRight=d),d.rseg=p.lseg=t,t.trLeft=d,t.trRight=p,x.vLow!=b.vLow?(f=d,g=p,x=m):x=null}t.is_inserted=!0}else console.log("ERR add_segment: trFirstHigh != segHigh: ",h);else console.log("ERR add_segment: missing trFirst.uX: ",h)},assignDepths:function(e){var t,i,r=[this.trapArray[0]],n=[],o=0;do{for(var s=o%2==1;t=r.pop();)-1==t.depth&&(t.depth=o,t.uL&&r.push(t.uL),t.uR&&r.push(t.uR),t.dL&&r.push(t.dL),t.dR&&r.push(t.dR),(i=t.lseg)&&-1==i.trLeft.depth&&n.push(i.trLeft),(i=t.rseg)&&(-1==i.trRight.depth&&n.push(i.trRight),i.upward!=s&&e.set_PolyLeft_wrong(i.chainId)));r=n,n=[],o++}while(r.length>0)},create_visibility_map:function(e){var t,i,r=e.nbVertices(),n=new Array(r);for(t=0;t<r;t++)n[t]=new Array(8);var o,s,a,l,u,c=new Array(r);for(t=0,i=this.trapArray.length;t<i;t++){var h=this.trapArray[t],d=h.uL?h.uR?5:7:h.uR?4:6,p=h.dL?h.dR?1:0:h.dR?3:2;if(h.depth%2==1){if(5==d||1==p||7==d&&3==p||4==d&&0==p){var f=e.appendDiagonalsEntry({vFrom:h.vLow,vTo:h.vHigh,mprev:null,mnext:null,marked:!1}),g=e.appendDiagonalsEntry({vFrom:h.vHigh,vTo:h.vLow,revDiag:f,mprev:null,mnext:null,marked:!1});f.revDiag=g,n[h.vLow.id][p]=f,n[h.vHigh.id][d]=g}}else null!==h.vHigh.id&&(c[h.vHigh.id]=d),null!==h.vLow.id&&(c[h.vLow.id]=p)}for(t=0;t<r;t++)if(s=n[t],null!=(a=c[t])){i=a,u=null;do{i++>7&&(i=0),(o=s[i])&&(u?(o.mprev=u,u.mnext=o):(l=o.vFrom).firstOutDiag=o,u=o.revDiag)}while(i!=a);u&&(l.lastInDiag=u)}}},e.Trapezoider=function(t){this.polyData=t,this.queryStructure=new e.QueryStructure(this.polyData)},e.Trapezoider.prototype={constructor:e.Trapezoider,optimise_randomlist:function(e){var t=0,i=this.polyData.nbPolyChains();if(1!=i)for(var r=new Array(i),n=e.concat(),o=0;o<n.length;o++){var s=n[o].chainId;r[s]?e[i++]=n[o]:(e[t++]=n[o],r[s]=!0)}},trapezoide_polygon:function(){var t=this.polyData.getSegments().concat();e.Math.array_shuffle(t),this.optimise_randomlist(t);for(var i,r=t.length,n=this.queryStructure,o=0,s=r;o<r;){for(var a=(s=Math.log(s)/Math.LN2)>1?Math.floor(r/s):r;o<a;o++)n.add_segment(t[o]);for(i=o;i<r;i++)this.queryStructure.segNodes(t[i])}for(n.assignDepths(this.polyData),i=0;i<r;i++)t[i].trLeft=t[i].trRight=null},create_visibility_map:function(){return this.queryStructure.create_visibility_map(this.polyData)}},e.MonoSplitter=function(e){this.polyData=e,this.trapezoider=null},e.MonoSplitter.prototype={constructor:e.MonoSplitter,monotonate_trapezoids:function(){this.trapezoider=new e.Trapezoider(this.polyData),this.trapezoider.trapezoide_polygon(),this.trapezoider.create_visibility_map(),this.polyData.create_mono_chains(),this.polyData.unique_monotone_chains_max()}},e.MonoTriangulator=function(e){this.polyData=e},e.MonoTriangulator.prototype={constructor:e.MonoTriangulator,triangulate_all_polygons:function(){var e=this.polyData.getMonoSubPolys();this.polyData.clearTriangles();for(var t=0;t<e.length;t++){var i=e[t],r=i.mprev,n=i.mnext;n.mnext==r?this.polyData.addTriangle(i.vFrom,n.vFrom,r.vFrom):this.triangulate_monotone_polygon(i)}},triangulate_monotone_polygon:function(t){var i=this;function r(){for(console.log("ERR uni-y-monotone: only concave angles left",s);a>1;)a--,i.polyData.addTriangle(s[a-1],s[a],s[a+1])}var n=t.mnext,o=t.vFrom,s=[n.vFrom],a=0,l=(n=n.mnext).vFrom;if(l!=o){for(;l!=o||a>1;)if(a>0){var u=e.Math.ptsCrossProd(s[a],l,s[a-1]);Math.abs(u)<=e.Math.EPSILON_P&&(l!=o&&e.Math.compare_pts_yx(s[a],l)!=e.Math.compare_pts_yx(s[a],s[a-1])||(u=1)),u>0?(this.polyData.addTriangle(s[a-1],s[a],l),a--):(s[++a]=l,l==o?r():l=(n=n.mnext).vFrom)}else s[++a]=l,l=(n=n.mnext).vFrom;this.polyData.addTriangle(s[a-1],s[a],l)}}},e.Triangulator=function(){this.lastPolyData=null},e.Triangulator.prototype={constructor:e.Triangulator,clear_lastData:function(){this.lastPolyData=null},get_PolyLeftArr:function(){return this.lastPolyData?this.lastPolyData.get_PolyLeftArr():null},triangulate_polygon:function(t,i){if(this.clear_lastData(),!t||0===t.length)return[];var r=new e.PolygonData(t),n=!i&&1==r.nbPolyChains();(n&&(n=new e.EarClipTriangulator(r).triangulate_polygon_no_holes()),n)||(new e.MonoSplitter(r).monotonate_trapezoids(),new e.MonoTriangulator(r).triangulate_all_polygons());return this.lastPolyData=r,r.getTriangles()}},e}),r("gw/Renderer/PolygonRenderer",["../Utils/Constants","../Utils/Utils","./VectorRenderer","./RendererManager","./FeatureStyle","./Program","./BatchRenderable","./pnltri","./GeoBound"],function(e,t,i,r,n,o,s,a,l){var u=function(e){i.prototype.constructor.call(this,e),this.maxTilePerGeometry=2,this.renderContext=e.renderContext,this.defaultVertexShader="attribute vec3 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex, 1.0);\n",this.defaultVertexShader+="}\n",this.extrudeVertexShader="attribute vec3 vertex;\n",this.extrudeVertexShader+="attribute vec4 normal;\n",this.extrudeVertexShader+="uniform float extrusionScale; \n",this.extrudeVertexShader+="uniform mat4 mvp;\n",this.extrudeVertexShader+="void main(void) \n",this.extrudeVertexShader+="{\n",this.extrudeVertexShader+="\tvec3 extrudedVertex = vertex + normal.w * vec3(normal.x, normal.y, normal.z) * extrusionScale;",this.extrudeVertexShader+="\tgl_Position = mvp * vec4(extrudedVertex, 1.0);\n",this.extrudeVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor = u_color;\n",this.fragmentShader+="\t//if (u_color.a == 0.0) discard;\n",this.fragmentShader+="}\n",this.program=new o(e.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.extrudeProgram=new o(e.renderContext),this.extrudeProgram.createFromSource(this.extrudeVertexShader,this.fragmentShader)};t.inherits(i,u);var c=function(e){s.prototype.constructor.call(this,e),this.origin=null,this.vertexSize=e.style.extrude?7:3,this.matrix=mat4.create()};t.inherits(s,c);var h=function(e,t,i){return[t[0]+e*(i[0]-t[0]),t[1]+e*(i[1]-t[1])]},d=function(e,t,i,r){for(var n,o=[],s=0;s<r.length;s++){var a=r[s],l=r[(s+1)%r.length],u=a[e],c=l[e],d=(u-i)*t>=0,p=(c-i)*t>=0;!d&&p?(n=h((i-u)/(c-u),a,l),o.push(n),o.push(l)):d&&p?o.push(l):d&&!p&&(n=h((i-u)/(c-u),a,l),o.push(n))}return o},p=function(e){for(var t,i=!1,r=1;r<e.length&&!i;r++){var n=Math.abs(e[r][0]-e[r-1][0]);n>180&&n<360&&(i=!0)}if(i){var o=[];for(t=0;t<e.length;t++)e[t][0]>0?o[t]=[e[t][0]-360,e[t][1]]:o[t]=[e[t][0],e[t][1]];var s=[];for(t=0;t<e.length;t++)e[t][0]<0?s[t]=[e[t][0]+360,e[t][1]]:s[t]=[e[t][0],e[t][1]];return[s,o]}return[e]};c.prototype.build=function(t){var i=this.bucket.renderer,r=this.bucket.style,n=i.globe.getCoordinateSystem(),o=t.type===e.GEOMETRY.MultiPolygon?t.coordinates:[t.coordinates],s=new l,u=new l(n.getGeoBound().getWest(),n.getGeoBound().getSouth(),n.getGeoBound().getEast(),n.getGeoBound().getNorth()),c="CRS:84";void 0!==t.crs&&(c=t.crs.properties.name);var h=s.computeFromCoordinatesInCrsTo(o[0][0],c,n);if(s.intersects(u)){var f,g,m=vec3.create();this.origin||(this.origin=vec3.create(),n.get3DFromWorld(h[0],this.origin),mat4.identity(this.matrix),mat4.translate(this.matrix,this.origin));var v,y,b,x,w,T=this.vertices.length/this.vertexSize,_=this.vertices.length,C=[];for(g=0;g<o.length;g++)C=C.concat(p(o[g][0]));for(g=0;g<C.length;g++){var S=(b=C[g],w=void 0,w=d(0,1,(x=u).west,b),w=d(0,-1,x.east,w),w=d(1,1,x.south,w),w=d(1,-1,x.north,w));_=this.vertices.length;var E=0;for(f=0;f<S.length;f++){var A;if(n.get3DFromWorldInCrs([S[f][0],S[f][1],0],c,m),this.vertices[_]=m[0]-this.origin[0],this.vertices[_+1]=m[1]-this.origin[1],this.vertices[_+2]=m[2]-this.origin[2],f<S.length-1&&(E+=(S[f+1][0]-S[f][0])*(S[f+1][1]+S[f][1])),r.extrude)vec3.normalize(m),this.vertices[_+3]=m[0],this.vertices[_+4]=m[1],this.vertices[_+5]=m[2],A="boolean"==typeof r.extrude?S[f][2]:r.extrude,this.vertices[_+6]=A*n.geoide.heightScale;_+=this.vertexSize}if(r.extrude){var I=T*this.vertexSize;for(this.vertices=this.vertices.concat(this.vertices.slice(I,_)),f=_;f<this.vertices.length;f+=this.vertexSize)this.vertices[f+6]=0}var M=new a.Triangulator,k=S.map(function(e){return{x:e[0],y:e[1]}}),D=M.triangulate_polygon([k]);for(f=0;f<D.length;f++)this.triIndices.push(T+D[f][0],T+D[f][1],T+D[f][2]);if(r.extrude)for(v=T,y=T+S.length,f=0;f<S.length-1;f++)E>0?(this.triIndices.push(v,v+1,y),this.triIndices.push(v+1,y+1,y)):(this.triIndices.push(v,y,v+1),this.triIndices.push(v+1,y,y+1)),v+=1,y+=1;for(f=0;f<S.length-1;f++)this.lineIndices.push(T+f,T+f+1);if(r.extrude)for(v=T,y=T+S.length,f=0;f<S.length-1;f++)this.lineIndices.push(v+f,y+f);T=this.vertices.length/this.vertexSize}return!0}};var f=function(e,t){this.layer=e,this.style=t,this.renderer=null};f.prototype.createRenderable=function(){return new c(this)},f.prototype.isCompatible=function(e){return this.style===e},u.prototype.render=function(e,t,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var o=null,s=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,s);for(var a=mat4.create(),l=t;l<i;l++){var u=e[l],c=u.bucket.style,h=c.extrude?this.extrudeProgram:this.program;if(h!==o&&(h.apply(),o=h),mat4.multiply(s,u.matrix,a),n.uniformMatrix4fv(h.uniforms.mvp,!1,a),n.uniform4f(h.uniforms.u_color,c.fillColor[0],c.fillColor[1],c.fillColor[2],c.fillColor[3]*u.bucket.layer.getOpacity()),u.bindBuffers(r),n.lineWidth(c.strokeWidth),n.vertexAttribPointer(h.attributes.vertex,3,n.FLOAT,!1,4*u.vertexSize,0),c.extrude&&(n.vertexAttribPointer(h.attributes.normal,4,n.FLOAT,!1,4*u.vertexSize,12),n.uniform1f(h.uniforms.extrusionScale,c.extrusionScale)),n.drawElements(n.TRIANGLES,u.triIndices.length,u.indexType,0),u.lineIndices.length>0){n.uniform4f(h.uniforms.u_color,c.strokeColor[0],c.strokeColor[1],c.strokeColor[2],c.strokeColor[3]*u.bucket.layer.getOpacity());var d=u.indexType===n.UNSIGNED_INT?4:2;n.drawElements(n.LINES,u.lineIndices.length,u.indexType,u.triIndices.length*d)}}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},u.prototype.canApply=function(t,i){return(t===e.GEOMETRY.Polygon||t===e.GEOMETRY.MultiPolygon)&&i.fill},u.prototype.createBucket=function(e,t){return new f(e,t)},r.factory.push(function(e){return new u(e)})}),r("gw/Renderer/LineRenderer",["../Utils/Constants","../Utils/Utils","../Utils/Numeric","./VectorRenderer","./RendererManager","./Program","./BatchRenderable"],function(e,t,i,r,n,o,s){var a=function(e){r.prototype.constructor.call(this,e),this.maxTilePerGeometry=2,this.renderContext=e.getRenderContext(),this.defaultVertexShader="attribute vec4 vertex;\n",this.defaultVertexShader+="uniform mat4 mvp;\n",this.defaultVertexShader+="varying float s;\n",this.defaultVertexShader+="void main(void) \n",this.defaultVertexShader+="{\n",this.defaultVertexShader+="\ts = vertex.w;\n",this.defaultVertexShader+="\tgl_Position = mvp * vec4(vertex.xyz, 1.0);\n",this.defaultVertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="uniform vec4 u_color;\n",this.fragmentShader+="uniform float speed;\n",this.fragmentShader+="uniform float time;\n",this.fragmentShader+="uniform float gradientLength;\n",this.fragmentShader+="varying float s;\n",this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\t// 0.5 is a time scale parameter, parametrize it ?\n",this.fragmentShader+="\tfloat m = speed * time * 0.5;\n",this.fragmentShader+="\tfloat u = (-s+m)/gradientLength;\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, vec2(u,0.)).rgb;\n",this.fragmentShader+="\t// TODO: handle appereance of rivers\n",this.fragmentShader+="\tif ( s < m )\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 1.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="\telse\n",this.fragmentShader+="\t{\n",this.fragmentShader+="\t\tgl_FragColor.a = 0.0;\n",this.fragmentShader+="\t}\n",this.fragmentShader+="}\n",this.program=new o(e.renderContext),this.program.createFromSource(this.defaultVertexShader,this.fragmentShader),this.time=Date.now()/1e3,this.palette=null,this.colorTexture=this.generateTexture([[0,0,255],[0,200,255]])};t.inherits(r,a),a.prototype.generateTexture=function(e){var t,r,n,o,s=e[0],a=e[1],l=[],u=this.globe.renderContext.gl;for(this.colorTexture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.colorTexture),t=0;t<128;t++)r=i.coserp(t/128,s[0],a[0]),n=i.coserp(t/128,s[1],a[1]),o=i.coserp(t/128,s[2],a[2]),l.push(r),l.push(n),l.push(o),l.push(255);for(t=0;t<128;t++)r=i.coserp(t/128,a[0],s[0]),n=i.coserp(t/128,a[1],s[1]),o=i.coserp(t/128,a[2],s[2]),l.push(r),l.push(n),l.push(o),l.push(255);u.texImage2D(u.TEXTURE_2D,0,u.RGBA,l.length/4,1,0,u.RGBA,u.UNSIGNED_BYTE,new Uint8Array(l)),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),this.palette=e};var l=function(e){s.prototype.constructor.call(this,e),this.vertexSize=4,this.matrix=mat4.create(),mat4.identity(this.matrix)};t.inherits(s,l),l.prototype.build=function(t){var i,r,n=this.bucket.renderer,o=(this.bucket.style,t.type===e.GEOMETRY.MultiLineString?t.coordinates:[t.coordinates]),s=vec3.create(),a=vec3.create();for(r=0;r<o.length;r++){var l=o[r],u=this.vertices.length/4,c=n.globe.getCoordinateSystem(),h=4*u,d=0;for(i=0;i<l.length;i++){c.get3DFromWorldInCrs(l[i],t.crs.properties.name,s),this.vertices[h]=s[0],this.vertices[h+1]=s[1],this.vertices[h+2]=s[2],i>0&&(d+=vec3.dist(s,a));var p=a;a=s,s=p,this.vertices[h+3]=d,h+=4}for(i=0;i<l.length-1;i++)this.lineIndices.push(u+i,u+i+1)}return!0};var u=function(e,t){this.layer=e,this.style=t,this.renderer=null};u.prototype.createRenderable=function(){return new l(this)},u.prototype.isCompatible=function(e){return this.style===e},a.prototype.render=function(e,t,i){var r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var o=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,o);var s=mat4.create();this.program.apply(),n.activeTexture(n.TEXTURE0),n.uniform1i(this.program.uniforms.colorTexture,0),n.bindTexture(n.TEXTURE_2D,this.colorTexture);for(var a=t;a<i;a++){var l=e[a],u=l.bucket.style;mat4.multiply(o,l.matrix,s),n.uniformMatrix4fv(this.program.uniforms.mvp,!1,s),u.palette&&u.palette!==this.palette&&(n.deleteTexture(this.colorTexture),this.generateTexture(u.palette)),n.lineWidth(u.strokeWidth),n.uniform4f(this.program.uniforms.color,u.strokeColor[0],u.strokeColor[1],u.strokeColor[2],u.strokeColor[3]*l.bucket.layer.getOpacity()),n.uniform1f(this.program.uniforms.speed,u.hasOwnProperty("speed")?u.speed:1),n.uniform1f(this.program.uniforms.time,Date.now()/1e3-this.time),n.uniform1f(this.program.uniforms.gradientLength,u.hasOwnProperty("gradientLength")?u.gradientLength:10),l.bindBuffers(r),n.vertexAttribPointer(this.program.attributes.vertex,4,n.FLOAT,!1,0,0),n.drawElements(n.LINES,l.lineIndices.length,l.indexType,0)}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},a.prototype.canApply=function(t,i){return(t===e.GEOMETRY.LineString||t===e.GEOMETRY.MultiLineString)&&i.gradientLength},a.prototype.createBucket=function(e,t){return new u(e,t)},n.factory.push(function(e){return new a(e)})}),r("gw/Renderer/PointSpriteRenderer",["../Utils/Utils","./VectorRenderer","./Program","./FeatureStyle","./RendererManager","../Utils/Constants","../Utils/Proxy"],function(e,t,i,r,n,o,s){var a=function(e){t.prototype.constructor.call(this,e),this.numberOfRenderPoints=0;this.program=new i(e.renderContext),this.program.createFromSource("\n        attribute vec3 vertex;\n        uniform mat4 viewProjectionMatrix;\n        uniform float pointSize;\n        void main(void)\n        {\n            gl_Position = viewProjectionMatrix * vec4(vertex,1.0);\n            gl_PointSize = pointSize;\n        }","\n        precision lowp float;\n        uniform sampler2D texture;\n        uniform float alpha;\n        uniform vec3 color;\n\n        void main(void)\n        {\n            vec4 textureColor = texture2D(texture, gl_PointCoord);\n            gl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha);\n            if (gl_FragColor.a <= 0.0) discard;\n            //gl_FragColor = vec4(1.0);\n        }"),this.meterSizeProgram=new i(e.renderContext),this.meterSizeProgram.createFromSource("\n        attribute vec3 vertex;\n        uniform mat4 viewMatrix;\n        uniform mat4 viewProjectionMatrix;\n        uniform vec3 billboardPos;\n        uniform vec2 billboardSize;\n\n        varying vec2 texcoords;\n\n        void main() {\n            vec3 camRight = vec3(viewMatrix[0][0], viewMatrix[1][0], viewMatrix[2][0]);\n            vec3 camUp = vec3(viewMatrix[0][1], viewMatrix[1][1], viewMatrix[2][1]);\n            vec3 x = camRight * vertex.x * billboardSize.x;\n            vec3 y = camUp * vertex.y * billboardSize.y;\n            vec3 pos = billboardPos + x + y;\n\n            gl_Position = viewProjectionMatrix * vec4(pos, 1.0);\n            texcoords = vec2(vertex.x + 0.5, 1.0 - vertex.y);\n        }","\n        precision lowp float;\n\n        uniform sampler2D texture;\n        uniform float alpha;\n        uniform vec3 color;\n\n        varying vec2 texcoords;\n\n        void main(void)\n        {\n            vec4 textureColor = texture2D(texture, texcoords);\n            gl_FragColor = vec4(textureColor.rgb * color, textureColor.a * alpha);\n            if (gl_FragColor.a <= 0.0) discard;\n        }"),this.defaultTexture=null;const r=new Float32Array([-.5,0,0,.5,0,0,.5,1,0,-.5,1,0]);var n=e.tileManager.renderContext.gl;this.rectVertexBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.rectVertexBuffer),n.bufferData(n.ARRAY_BUFFER,r,n.STATIC_DRAW)};e.inherits(t,a);var l=function(e){this.bucket=e,this.geometry2vb={},this.vertices=[],this.geometries=[],this.vertexBuffer=null,this.vertexBufferDirty=!1};l.prototype.add=function(e,t){this.geometry2vb[e.gid]=this.vertices.length;var i=this.bucket.renderer.globe,r=i.getCoordinateSystem();if(this.bucket.style.useMeterSize){const t=r.getElevation(i,e)+200,n=r.get3DFromWorldInCrs([e.coordinates[0],e.coordinates[1],t],e.crs.properties.name);this.vertices.push(n[0],n[1],n[2])}else{var n=r.get3DFromWorldInCrs(e.coordinates,e.crs.properties.name),o=r.getGeoide().getRealPlanetRadius(),s=this.bucket.renderer.globe.isSky()?.95:1+(r.getElevation(i,e)+200)/o;this.vertices.push(s*n[0],s*n[1],s*n[2]),this.vertexBufferDirty=!0}return!1!==t&&this.geometries.push(e),!0},l.prototype.updateElevations=function(){this.vertices=[];for(var e=0;e<this.geometries.length;e++)this.add(this.geometries[e],!1)},l.prototype.remove=function(e){if(this.geometry2vb.hasOwnProperty(e.gid)){var t=this.geometry2vb[e.gid];for(var i in delete this.geometry2vb[e.gid],this.vertices.splice(t,3),this.vertexBufferDirty=!0,this.geometry2vb)i&&this.geometry2vb[i]>t&&(this.geometry2vb[i]-=3)}return this.vertices.length},l.prototype.dispose=function(e){this.vertexBuffer&&e.gl.deleteBuffer(this.vertexBuffer)},a.prototype._buildDefaultTexture=function(e){if(!this.defaultTexture){var t=this.globe.renderContext.gl;this.defaultTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.defaultTexture);var i=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i)}e.texture=this.defaultTexture,e.textureWidth=10,e.textureHeight=10},a.prototype._buildTextureFromImage=function(e,t){e.texture=this.globe.renderContext.createNonPowerOfTwoTextureFromImage(t),e.textureWidth=t.width,e.textureHeight=t.height},a.prototype.canApply=function(e,t){return e===o.GEOMETRY.Point&&!t.label};var u=function(e,t){this.layer=e,this.style=new r(t),this.texture=null,this.renderer=null};return u.prototype.createRenderable=function(){return new l(this)},u.prototype.isCompatible=function(e){return this.style.iconUrl===e.iconUrl&&this.style.icon===e.icon&&this.style.fillColor[0]===e.fillColor[0]&&this.style.fillColor[1]===e.fillColor[1]&&this.style.fillColor[2]===e.fillColor[2]},a.prototype.createBucket=function(e,t){this.globe.renderContext.gl.createBuffer();var i=new u(e,t);if(i.renderer=this,t.iconUrl){var r=new Image;r.crossOrigin="";var n=this;r.onload=function(){n._buildTextureFromImage(i,r),n.globe.renderContext.requestFrame()},r.onerror=function(){n._buildDefaultTexture(i)},r.src=s.proxify(t.iconUrl)}else t.icon?this._buildTextureFromImage(i,t.icon):this._buildDefaultTexture(i);return i},a.prototype.render=function(e,t,i){var r,n=this.globe.renderContext,o=n.gl;o.enable(o.BLEND),o.blendEquation(o.FUNC_ADD),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),mat4.multiply(n.projectionMatrix,n.viewMatrix,n.modelViewMatrix);for(var s=null,a=t;a<i;a++){var l=e[a];l.updateElevations();var u=l.bucket;if(s!==u){(r=u.style.useMeterSize?this.meterSizeProgram:this.program).apply(),o.uniformMatrix4fv(r.uniforms.viewProjectionMatrix,!1,n.modelViewMatrix),o.uniform1i(r.uniforms.texture,0),o.uniform1f(r.uniforms.alpha,u.layer.getOpacity());var c=u.style.getFillColor();if(o.uniform3f(r.uniforms.color,c[0],c[1],c[2]),u.style.useMeterSize){const e=this.globe.getCoordinateSystem().getGeoide().getRealPlanetRadius(),t=u.style.meterSize[0]/e,i=u.style.meterSize[1]/e;o.uniform2f(r.uniforms.billboardSize,t,i),o.uniformMatrix4fv(r.uniforms.viewMatrix,!1,n.viewMatrix)}else o.uniform1f(r.uniforms.pointSize,u.textureWidth);o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,u.texture),s=u}if(u.style.useMeterSize){o.bindBuffer(o.ARRAY_BUFFER,this.rectVertexBuffer),o.vertexAttribPointer(r.attributes.vertex,3,o.FLOAT,!1,0,0);for(var h=0;h<l.vertices.length;h+=3){const e=l.vertices[h],t=l.vertices[h+1],i=l.vertices[h+2];o.uniform3f(r.uniforms.billboardPos,e,t,i),o.drawArrays(o.TRIANGLE_FAN,0,4)}}else l.vertexBuffer||(l.vertexBuffer=o.createBuffer()),o.bindBuffer(o.ARRAY_BUFFER,l.vertexBuffer),o.vertexAttribPointer(r.attributes.vertex,3,o.FLOAT,!1,0,0),l.vertexBufferDirty&&(o.bufferData(o.ARRAY_BUFFER,new Float32Array(l.vertices),o.STATIC_DRAW),l.vertexBufferDirty=!1),o.drawArrays(o.POINTS,0,l.vertices.length/3)}o.disable(o.BLEND)},n.factory.push(function(e){return new a(e)}),a}),r("gw/Tiling/Triangulator",[],function(){var e=function(e,t,i,r,n,o,s,a){return(n-i)*(a-r)-(o-r)*(s-i)>=0&&(e-n)*(a-o)-(t-o)*(s-n)>=0&&(i-e)*(a-t)-(r-t)*(s-e)>=0},t=function(t,i,r,n,o,s){var a,l,u,c,h,d,p,f,g;if(l=t[s[i]][0],u=t[s[i]][1],c=t[s[r]][0],h=t[s[r]][1],d=t[s[n]][0],1e-10>(c-l)*((p=t[s[n]][1])-u)-(h-u)*(d-l))return!1;for(a=0;a<o;a++)if(a!==i&&a!==r&&a!==n&&(f=t[s[a]][0],g=t[s[a]][1],e(l,u,c,h,d,p,f,g)))return!1;return!0};return{process:function(e){var i=e.length;if(e[0][0]===e[i-1][0]&&e[0][1]===e[i-1][1]&&i--,i<3)return null;var r,n=new Array(i);if(0<function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r][0]*e[n][1]-e[n][0]*e[r][1];return.5*i}(e))for(r=0;r<i;r++)n[r]=r;else for(r=0;r<i;r++)n[r]=i-1-r;var o=i,s=[],a=2*o;for(r=o-1;o>2;){if(0>=a--)return null;var l=r;o<=l&&(l=0),o<=(r=l+1)&&(r=0);var u=r+1;if(o<=u&&(u=0),t(e,l,r,u,o,n)){var c,h,d,p,f;for(c=n[l],h=n[r],d=n[u],s.push(c),s.push(h),s.push(d),p=r,f=r+1;f<o;p++,f++)n[p]=n[f];a=2*--o}}return s}}}),r("gw/Renderer/ConvexPolygonRenderer",["../Utils/Utils","../Utils/Constants","../Gui/dialog/ErrorDialog","./VectorRenderer","./Program","./FeatureStyle","./RendererManager","../Tiling/Triangulator","../Utils/Proxy","./glMatrix"],function(e,t,i,r,n,o,s,a,l){var u=function(e,t){this.layer=e,this.style=new o(t),this.texture=null,this.polygonProgram=null,this.renderer=null,this.mainRenderable=null};u.prototype.isCompatible=function(e){return this.style.strokeColor[0]===e.strokeColor[0]&&this.style.strokeColor[1]===e.strokeColor[1]&&this.style.strokeColor[2]===e.strokeColor[2]&&this.style.fill===e.fill&&this.style.fillTexture===e.fillTexture&&this.style.fillTextureUrl===e.fillTextureUrl&&this.style.fillShader===e.fillShader};var c=function(e){this.bucket=e,this.geometry2vb={},this.vertices=[],this.lineIndices=[],this.triangleIndices=[],this.vertexBuffer=null,this.lineIndexBuffer=null,this.triangleIndexBuffer=null,this.bufferDirty=!1,this.triBufferDirty=!1,this.tcoords=[]};c.prototype.add=function(e){var i,r,n,o=[];if(e.type===t.GEOMETRY.MultiPolygon)for(i=0;i<e.coordinates.length;i++)o.push(e.coordinates[i][0]);else if(e.type===t.GEOMETRY.LineString)o.push(e.coordinates);else if(e.type===t.GEOMETRY.MultiLineString)for(i=0;i<e.coordinates.length;i++)o.push(e.coordinates[i]);else o.push(e.coordinates[0]);for(r=0;r<o.length;r++){var s=o[r],a=s.length,u={vertexStart:this.vertices.length,vertexCount:3*a,lineIndexStart:this.lineIndices.length,lineIndexCount:2*a,triIndexStart:0,triIndexCount:0},c=this.bucket.renderer.globe.getCoordinateSystem();if(e._imageCoordinates){u.tcoordsStart=this.tcoords.length,u.tcoordsCount=2*a;var h=c.get3DFromWorldInCrs(e._imageCoordinates[0][0],"Equatorial"),d=c.get3DFromWorldInCrs(e._imageCoordinates[0][1],"Equatorial"),p=c.get3DFromWorldInCrs(e._imageCoordinates[0][3],"Equatorial"),f=[];vec3.subtract(d,h,f);var g=[];vec3.subtract(p,h,g);var m=vec3.length(f)*vec3.length(f),v=vec3.length(g)*vec3.length(g);for(i=0;i<a;i++){n=c.get3DFromWorldInCrs(s[i],"Equatorial");var y=[];vec3.subtract(n,h,y);var b=vec3.dot(y,f)/m,x=vec3.dot(y,g)/v;this.tcoords.push(b),this.tcoords.push(x)}}var w=this.vertices.length/3;for(i=0;i<a&&(n=c.get3DFromWorldInCrs(s[i],"Equatorial"),this.vertices.push(n[0],n[1],n[2]),e.type!==t.GEOMETRY.MultiLineString&&e.type!==t.GEOMETRY.LineString||i!==a-1);i++)this.lineIndices.push(w+i,w+(i+1)%a);if(this.bucket.style.fill){u.triIndexStart=this.triangleIndices.length,u.triIndexCount=3*(a-2);var T=l.process(s);if(null!==T)this.triangleIndices=T;else for(i=0;i<a-2;i++)this.triangleIndices.push(w,w+i+1,w+i+2)}this.geometry2vb[e.gid]?(this.geometry2vb[e.gid].vertexCount+=u.vertexCount,this.geometry2vb[e.gid].lineIndexCount+=u.lineIndexCount,this.geometry2vb[e.gid].triIndexCount+=u.triIndexCount):this.geometry2vb[e.gid]=u,this.bufferDirty=!0,this.triBufferDirty=!0}return!0},c.prototype.remove=function(e){var t;if(this.geometry2vb.hasOwnProperty(e.gid)){var i=this.geometry2vb[e.gid];for(delete this.geometry2vb[e.gid],this.vertices.splice(i.vertexStart,i.vertexCount),t=i.lineIndexStart+i.lineIndexCount;t<this.lineIndices.length;t++)this.lineIndices[t]-=i.vertexCount/3;for(t=i.triIndexStart+i.triIndexCount;t<this.triangleIndices.length;t++)this.triangleIndices[t]-=i.vertexCount/3;for(var r in this.lineIndices.splice(i.lineIndexStart,i.lineIndexCount),this.triangleIndices.splice(i.triIndexStart,i.triIndexCount),i.tcoordsStart>=0&&this.tcoords.splice(i.tcoordsStart,i.tcoordsCount),this.geometry2vb)if(r){var n=this.geometry2vb[r];n.vertexStart>i.vertexStart&&(n.vertexStart-=i.vertexCount,n.lineIndexStart-=i.lineIndexCount,n.triIndexStart-=i.triIndexCount,n.tcoordsStart>=0&&(n.tcoordsStart-=i.tcoordsCount))}this.bufferDirty=!0,this.triBufferDirty=!0}return this.vertices.length},c.prototype.dispose=function(e){this.vertexBuffer&&e.gl.deleteBuffer(this.vertexBuffer),this.lineIndexBuffer&&e.gl.deleteBuffer(this.lineIndexBuffer),this.triangleIndexBuffer&&e.gl.deleteBuffer(this.triangleIndexBuffer),this.tcoordBuffer&&e.gl.deleteBuffer(this.tcoordBuffer)},u.prototype.createRenderable=function(){return new c(this)};var h=function(e){r.prototype.constructor.call(this,e),this.maxTilePerGeometry=2,this.renderContext=e.tileManager.renderContext,this.tileConfig=e.tileManager.tileConfig,this.programs=[],this.basicVertexShader="attribute vec3 vertex;\n",this.basicVertexShader+="uniform mat4 viewProjectionMatrix;\n",this.basicVertexShader+="    \n",this.basicVertexShader+="    void main(void)\n",this.basicVertexShader+="    {\n",this.basicVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.basicVertexShader+="    }\n",this.basicFragmentShader="precision lowp float; \n",this.basicFragmentShader+="    uniform vec4 color; \n",this.basicFragmentShader+="    \n",this.basicFragmentShader+="    void main(void) \n",this.basicFragmentShader+="    { \n",this.basicFragmentShader+="        gl_FragColor = color; \n",this.basicFragmentShader+="    } \n",this.texVertexShader="attribute vec3 vertex;\n",this.texVertexShader+="    attribute vec2 tcoord;\n",this.texVertexShader+="    uniform mat4 viewProjectionMatrix;\n",this.texVertexShader+="    \n",this.texVertexShader+="    varying vec2 vTextureCoord;\n",this.texVertexShader+="    \n",this.texVertexShader+="    void main(void) \n",this.texVertexShader+="    {\n",this.texVertexShader+="        vTextureCoord = tcoord;\n",this.texVertexShader+="        vTextureCoord.y = 1.0 - vTextureCoord.y; \n",this.texVertexShader+="        gl_Position = viewProjectionMatrix * vec4(vertex, 1.0);\n",this.texVertexShader+="    }\n",this.texFragmentShader="precision lowp float; \n",this.texFragmentShader+="    uniform vec4 color;\n",this.texFragmentShader+="    varying vec2 vTextureCoord;\n",this.texFragmentShader+="    uniform sampler2D texture; \n",this.texFragmentShader+="    void main(void)\n",this.texFragmentShader+="    {\n",this.texFragmentShader+="        gl_FragColor = texture2D(texture, vTextureCoord) * color;\n",this.texFragmentShader+="    }\n",this.basicFillShader={vertexCode:this.basicVertexShader,fragmentCode:this.basicFragmentShader,updateUniforms:null},this.texFillShader={vertexCode:this.texVertexShader,fragmentCode:this.texFragmentShader,updateUniforms:null},this.basicProgram=this.createProgram(this.basicFillShader),this.texProgram=this.createProgram(this.texFillShader);var t=this.renderContext.gl;this.whiteTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.whiteTexture);var i=new Uint8Array([255,255,255,255]);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,i),this.tcoordBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.tcoordBuffer);t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,0,1,0,1,1,0,1,0,0]),t.STATIC_DRAW),this.tcoordBuffer.itemSize=2,this.tcoordBuffer.numItems=5};return e.inherits(r,h),h.prototype.canApply=function(e,i){return!!this.globe.isSky()&&(e===t.GEOMETRY.Polygon||e===t.GEOMETRY.MultiPolygon||e===t.GEOMETRY.LineString||e===t.GEOMETRY.MultiLineString)},h.prototype.createProgram=function(e){var t=new n(this.renderContext);return t.createFromSource(e.vertexCode,e.fragmentCode),t.id=this.programs.length,this.programs.push({fillShader:e,program:t}),t},h.prototype.getProgram=function(e){for(var t,i=0;i<this.programs.length;i++)this.programs[i].fillShader===e&&(t=this.programs[i].program);return t||(t=this.createProgram(e)),t},h.prototype.createBucket=function(e,r){this.renderContext.gl.createBuffer();var n=new u(e,r),o=this;if(r.fill){var s=!1;if(r.fillTextureUrl){var l=new Image;l.crossOrigin="",l.onload=function(){n.texture=o.renderContext.createNonPowerOfTwoTextureFromImage(l,e.invertY)},l.onerror=function(e){i.open(t.LEVEL.WARNING,"Cannot load "+l.src)},l.src=a.proxify(r.fillTextureUrl),s=!0}else r.fillTexture&&(n.texture=r.fillTexture,s=!0);r.fillShader&&r.fillShader.fragmentCode?(r.fillShader.vertexCode||(r.fillShader.vertexCode=this.texVertexShader),r.fillShader.vertexCode||(r.fillShader.fragmentCode=this.texFragmentShader),n.polygonProgram=this.getProgram(r.fillShader)):n.polygonProgram=s?this.texProgram:this.basicProgram}return n},h.prototype.render=function(e,t,i){var r=this.renderContext,n=this.renderContext.gl;n.disable(n.DEPTH_TEST),n.depthMask(!1),n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),this.basicProgram.apply(),mat4.multiply(r.projectionMatrix,r.viewMatrix,r.modelViewMatrix),n.uniformMatrix4fv(this.basicProgram.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix);for(var o=t;o<i;o++){var s=e[o],a=s.bucket,l=a.style.getStrokeColor();if(n.uniform4f(this.basicProgram.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity()),s.vertexBuffer||(s.vertexBuffer=n.createBuffer(),s.lineIndexBuffer=n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,s.vertexBuffer),n.vertexAttribPointer(this.basicProgram.attributes.vertex,3,n.FLOAT,!1,0,0),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.lineIndexBuffer),s.bufferDirty&&(n.bufferData(n.ARRAY_BUFFER,new Float32Array(s.vertices),n.STATIC_DRAW),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.lineIndices),n.STATIC_DRAW),s.bufferDirty=!1),n.drawElements(n.LINES,s.lineIndices.length,n.UNSIGNED_SHORT,0),a.polygonProgram){var u=a.polygonProgram;u.apply(),n.uniformMatrix4fv(u.uniforms.viewProjectionMatrix,!1,r.modelViewMatrix),n.uniform1i(u.uniforms.texture,0),s.tcoords.length>0?(s.tcoordBuffer||(s.tcoordBuffer=n.createBuffer(),n.bindBuffer(n.ARRAY_BUFFER,s.tcoordBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(s.tcoords),n.STATIC_DRAW),s.tcoordBuffer.itemSize=2,s.tcoordBuffer.numItems=s.tcoords.length/2),n.bindBuffer(n.ARRAY_BUFFER,s.tcoordBuffer)):n.bindBuffer(n.ARRAY_BUFFER,this.tcoordBuffer),n.vertexAttribPointer(u.attributes.tcoord,2,n.FLOAT,!1,0,0),n.bindBuffer(n.ARRAY_BUFFER,s.vertexBuffer),n.vertexAttribPointer(u.attributes.vertex,3,n.FLOAT,!1,0,0),a.style.fillShader&&a.style.fillShader.updateUniforms&&a.style.fillShader.updateUniforms(n,s.bucket,u),s.triangleIndexBuffer||(s.triangleIndexBuffer=n.createBuffer()),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,s.triangleIndexBuffer),s.triBufferDirty&&(n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(s.triangleIndices),n.STATIC_DRAW),s.triBufferDirty=!1),n.activeTexture(n.TEXTURE0),s.bucket.texture?(n.bindTexture(n.TEXTURE_2D,s.bucket.texture),n.uniform4f(u.uniforms.color,1,1,1,l[3]*a.layer.getOpacity())):(n.bindTexture(n.TEXTURE_2D,this.whiteTexture),l=s.bucket.style.fillColor,n.uniform4f(u.uniforms.color,l[0],l[1],l[2],l[3]*a.layer.getOpacity())),n.drawElements(n.TRIANGLES,s.triangleIndices.length,n.UNSIGNED_SHORT,0),this.basicProgram.apply()}}n.enable(n.DEPTH_TEST),n.depthMask(!0),n.disable(n.BLEND)},s.factory.push(function(e){return new h(e)}),h}),r("gw/Renderer/PolyLineRenderer",["../Utils/Constants","../Utils/Utils","./VectorRenderer","./RendererManager","./FeatureStyle","./Program","./BatchRenderable","./GeoBound","../Crs/WGS84Crs"],function(e,t,i,r,n,o,s,a,l){var u=function(e){this.globe=e,this.buckets=[]};u.prototype.generateLevelZero=function(e){for(var t of this.buckets){const e=t.layer,i=t.geometry,r=t.style;this.removeGeometry(e),this.addGeometry(e,i,r)}};var c=function(e,t){this.bucket=e,this.renderable=new h(e),this.clippedRenderable=new h(e),this.vertexShader="\n        attribute vec3 vertex;\n        uniform mat4 uModelViewProjMatrix;\n        void main() {\n        \tgl_Position = uModelViewProjMatrix * vec4(vertex, 1.0);\n        }\n        ",this.fragmentShader="\n        precision lowp float;\n        uniform vec4 uColor;\n        void main() {\n        \tgl_FragColor = uColor;\n        }\n        ",this.clippedVertexShader="\n        attribute vec3 aVertex;\n        uniform mat4 uModelViewProjMatrix;\n        uniform mat4 uModelViewMatrix;\n\n        uniform vec3 uClipPlane;\n        uniform vec3 uClipNormal;\n\n        varying float vClipDistance;\n\n        void main() {\n            gl_Position = uModelViewProjMatrix * vec4(aVertex, 1.0);\n\n            vec2 a = normalize(aVertex.xy - uClipPlane.xy);\n            vec2 n = normalize(uClipNormal.xy);\n\n            vClipDistance = dot(a, n);\n        }",this.clippedFragmentShader="\n        precision lowp float;\n        uniform vec4 uColor;\n\n        varying float vClipDistance;\n\n        void main() {\n            if (vClipDistance < 0.0) discard;\n            gl_FragColor = uColor;\n        }\n        ",this.program=new o(t),this.program.createFromSource(this.vertexShader,this.fragmentShader),this.clippedProgram=new o(t),this.clippedProgram.createFromSource(this.clippedVertexShader,this.clippedFragmentShader),this.matrix=mat4.create(),this.leftClipPlane=vec3.create(),this.leftClipNormal=vec3.create(),this.rightClipPlane=vec3.create(),this.rightClipNormal=vec3.create()};c.prototype.dispose=function(e){this.renderable.dispose(e),this.clippedRenderable.dispose(e)},c.prototype.renderDefault=function(e,t,i){const r=e.gl;for(var n of(this.program.apply(),r.uniformMatrix4fv(this.program.uniforms.uModelViewProjMatrix,!1,t),r.uniform4f(this.program.uniforms.uColor,i[0],i[1],i[2],i[3]),this.renderable.bindBuffers(e),r.vertexAttribPointer(this.program.attributes.aVertex,3,r.FLOAT,!1,12,0),this.renderable.lines))r.drawElements(r.LINE_STRIP,n.indexCount,r.UNSIGNED_INT,4*n.startIndex)},c.prototype.renderClipped=function(e,t,i){const r=e.gl;this.clippedProgram.apply();const n=mat4.create();var o;for(o of(mat4.multiply(e.viewMatrix,this.matrix,n),r.uniformMatrix4fv(this.clippedProgram.uniforms.uModelViewProjMatrix,!1,t),r.uniform4f(this.clippedProgram.uniforms.uColor,i[0],i[1],i[2],i[3]),this.clippedRenderable.bindBuffers(e),r.vertexAttribPointer(this.clippedProgram.attributes.aVertex,3,r.FLOAT,!1,12,0),r.uniform3f(this.clippedProgram.uniforms.uClipPlane,this.rightClipPlane[0],this.rightClipPlane[1],this.rightClipPlane[2]),r.uniform3f(this.clippedProgram.uniforms.uClipNormal,this.rightClipNormal[0],this.rightClipNormal[1],this.rightClipNormal[2]),this.clippedRenderable.lines))r.drawElements(r.LINE_STRIP,o.indexCount,r.UNSIGNED_INT,4*o.startIndex);for(o of(r.uniform3f(this.clippedProgram.uniforms.uClipPlane,this.leftClipPlane[0],this.leftClipPlane[1],this.leftClipPlane[2]),r.uniform3f(this.clippedProgram.uniforms.uClipNormal,this.leftClipNormal[0],this.leftClipNormal[1],this.leftClipNormal[2]),this.clippedRenderable.clippedLines))r.drawElements(r.LINE_STRIP,o.indexCount,r.UNSIGNED_INT,4*o.startIndex)},c.prototype.render=function(e,t){const i=e.gl,r=this.bucket.layer,n=this.bucket.style,o=mat4.create();mat4.multiply(t,this.matrix,o);const s=n.strokeColor.slice(0);s[3]*=r.getOpacity(),i.lineWidth(n.strokeWidth),this.renderDefault(e,o,s),this.renderClipped(e,o,s)};var h=function(e){this.bucket=e,this.vertices=[],this.indices=[],this.dirty=!1,this.ibo=null,this.vbo=null,this.lines=[],this.clippedLines=[]};h.prototype._clamp=function(e,t,i){return Math.max(t,Math.min(e,i))},h.prototype._subdivideSegment=function(e,t){const i=this.bucket.renderer.globe,r=new l,n=r.getGeoide().getHeightScale(),o=i.getSubdivisionLength()*n,s=i.getMaxSubdivisionCount();var a=vec3.create();r.get3DFromWorldInCrs(e,"CRS:84",a);var u=vec3.create();r.get3DFromWorldInCrs(t,"CRS:84",u);const c=vec3.dist(a,u),h=this._clamp(Math.floor(c/o),1,s),d=e[2],p=t[2],f=[],g=1/h;for(var m=0;m<=h;++m){const e=m*g;var v=vec3.create();vec3.lerp(a,u,e,v);var y=vec3.create();r.getWorldFrom3D(v,y),y[2]=(1-e)*d+e*p,f.push(y)}return f},h.prototype._subdivideLine=function(e){for(var t=[],i=0;i<e.length-1;++i)t=t.concat(this._subdivideSegment(e[i],e[i+1]));for(i=t.length-1;i>=1;--i){const e=t[i],r=t[i-1];e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&t.splice(i,1)}return t};c.prototype.build=function(t){var i,r=this.bucket.renderer,n=(this.bucket.style,r.globe.getCoordinateSystem());i=t.type===e.GEOMETRY.MultiLineString||Array.isArray(t.coordinates[0][0])?t.coordinates:[t.coordinates],i=JSON.parse(JSON.stringify(i));var o=new a,s=(new a(n.getGeoBound().getWest(),n.getGeoBound().getSouth(),n.getGeoBound().getEast(),n.getGeoBound().getNorth()),"CRS:84");void 0!==t.crs&&(s=t.crs.properties.name);var l=i[0][0].slice(0);l[2]=0;var u=o.computeFromCoordinatesInCrsTo(l,s,n),c=vec3.create();n.get3DFromWorld(u,c),mat4.identity(this.matrix),mat4.translate(this.matrix,c);n.get3DFromWorldInCrs([-180,0,0],s,this.leftClipPlane),n.get3DFromWorldInCrs([1,0,0],s,this.leftClipNormal),vec3.normalize(this.leftClipNormal),vec3.subtract(this.leftClipPlane,c);n.get3DFromWorldInCrs([180,0,0],s,this.rightClipPlane),n.get3DFromWorldInCrs([-1,0,0],s,this.rightClipNormal),vec3.normalize(this.rightClipNormal),vec3.subtract(this.rightClipPlane,c),function(e){for(var t of e)for(var i=0;i<t.length;++i){const e=t[i];if(90===e[1]||-90===e[1])if(i>0&&i<t.length-1){const r=t[i-1],n=t[i+1];r[0]===e[0]?(t.splice(i+1,0,[n[0],e[1],e[2]]),++i):n[0]===e[0]?(t.splice(i,0,[r[0],e[1],e[2]]),++i):(t.splice(i,0,[r[0],e[1],e[2]]),++i,t.splice(i+1,0,[n[0],e[1],e[2]]),++i)}else if(i>0){const r=t[i-1];r[0]!==e[0]&&(t.splice(i,0,[r[0],e[1],e[2]]),++i)}else if(i<t.length-1){const r=t[i+1];r[0]!==e[0]&&(t.splice(i+1,0,[r[0],e[1],e[2]]),++i)}}}(i);var h=[],d=[],p=null;return n.projection&&n.projection.options&&n.projection.options.projectionName&&(p=n.projection.options.projectionName),!0===n.flat&&p!==e.PROJECTION.Azimuth?function(e,t,i){for(var r of e){for(var n=!0,o=0;n&&o<r.length-1;++o){const e=Math.min(r[o][0],r[o+1][0]),t=Math.max(r[o][0],r[o+1][0]);e<0&&t>0&&360+e-t<t-e&&(n=!1)}n?t.push(r):i.push(r)}}(i,h,d):h=i.slice(0),this.renderable.build(h,n,s,c),this.clippedRenderable.buildClipped(d,n,s,c),!0},h.prototype.build=function(e,t,i,r){var n=0,o=vec3.create();for(var s of e){var a={startIndex:n,indexCount:-1};const e=this._subdivideLine(s);for(var l of e){t.get3DFromWorldInCrs(l,i,o);for(var u=0;u<3;++u)this.vertices.push(o[u]-r[u]);this.indices.push(n++)}a.indexCount=n-a.startIndex,this.lines.push(a)}this.dirty=!0},h.prototype.buildClipped=function(e,t,i,r){var n,o=0,s=vec3.create();for(var a of e){var l={startIndex:o,indexCount:-1};const e=this._subdivideLine(a),h=[],d=[];for(n=0;n<e.length;++n){const t=e[n][0],i=t>=0?t:t+360,r=t<=0?t:t-360;h.push([i,e[n][1],e[n][2]]),d.push([r,e[n][1],e[n][2]])}var u;for(u=0;u<h.length;++u){const e=h[u];for(t.get3DFromWorldInCrs(e,i,s),n=0;n<3;++n)this.vertices.push(s[n]-r[n]);var c=!1;if(u>1){const e=h[u][0],t=h[u-1][0],i=e-t,r=t-h[u-2][0];if(r>0&&i<0&&t>180&&e<180){e+360-t<t-e&&(c=!0)}else if(r<0&&i>0&&t<180&&e>180){t+360-e<e-t&&(c=!0)}}c&&(l.indexCount=o-l.startIndex,this.lines.push(l),l={startIndex:o,indexCount:-1}),this.indices.push(o++)}for(l.indexCount=o-l.startIndex,this.lines.push(l),l={startIndex:o,indexCount:-1},u=0;u<d.length;++u){const e=d[u];for(t.get3DFromWorldInCrs(e,i,s),n=0;n<3;++n)this.vertices.push(s[n]-r[n]);if(c=!1,u>1){const e=d[u][0],t=d[u-1][0],i=e-t,r=t-d[u-2][0];if(r>0&&i<0&&t>-180&&e<-180){e-(t-360)<t-e&&(c=!0)}else if(r<0&&i>0&&t<-180&&e>-180){t-(e-360)<e-t&&(c=!0)}}c&&(l.indexCount=o-l.startIndex,this.clippedLines.push(l),l={startIndex:o,indexCount:-1}),this.indices.push(o++)}l.indexCount=o-l.startIndex,this.clippedLines.push(l)}this.dirty=!0},h.prototype.dispose=function(e){if(!e)return;const t=e.gl;this.ibo&&t.deleteBuffer(this.ibo),this.vbo&&t.deleteBuffer(this.vbo),this.ibo=null,this.vbo=null},h.prototype.bindBuffers=function(e){if(!e)return;const t=e.gl;this.dirty&&(this.dispose(e),this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.vertices),t.STATIC_DRAW),this.ibo=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ibo),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint32Array(this.indices),t.STATIC_DRAW),this.dirty=!1),t.bindBuffer(t.ARRAY_BUFFER,this.vbo),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.ibo)};var d=function(e,t,i,r){this.layer=e,this.renderer=null,this.style=new n(t),this.geometry=i,this.mainRenderable=new c(this,r),this.id=-1};u.prototype.addGeometry=function(e,t,i){var r=new d(e,i,t,this.globe.renderContext);r.renderer=this,r.id=this.globe.getRendererManager().bucketId++,r.mainRenderable.build(t),t._bucket=r,e._bucket=r,this.buckets.push(r)},u.prototype.removeGeometry=function(e,t){var i=e._bucket;i.mainRenderable&&(i.mainRenderable.dispose(this.globe.renderContext),i.mainRenderable=null);const r=this.buckets.indexOf(i);-1!==r&&this.buckets.splice(r,1)},u.prototype.render=function(e,t,i){const r=this.globe.renderContext,n=r.gl;n.enable(n.BLEND),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.depthFunc(n.LEQUAL);var o=mat4.create();mat4.multiply(r.projectionMatrix,r.viewMatrix,o);for(var s=t;s<i;s++){e[s].render(r,o)}n.lineWidth(1),n.depthFunc(n.LESS),n.disable(n.BLEND)},u.prototype.canApply=function(t,i){return void 0!==i.onTerrain&&!0!==i.onTerrain&&(t===e.GEOMETRY.LineString||t===e.GEOMETRY.MultiLineString)},u.prototype.createBucket=function(e,t){return new d(e,t)},r.factory.push(function(e){return new u(e)})}),r("gw/Context/AbstractContext",["jquery","underscore-min","../Utils/Event","moment","../Utils/Utils","../Time/Time","../Utils/UtilsIntersection","../Services/ServiceFactory","../Utils/Constants","../Registry/WMSServerRegistryHandler","../Registry/WMTSServerRegistryHandler","../Registry/WCSServerRegistryHandler","../Registry/OpenSearchRegistryHandler","../Registry/PendingLayersRegistryHandler","../Registry/LayerRegistryHandler","../Gui/Compass","../Gui/Tracker/PositionTracker","../Gui/Tracker/ElevationTracker","../Utils/AttributionHandler","../Gui/dialog/ErrorDialog","../Renderer/PointRenderer","../Renderer/LineStringRenderable","../Renderer/PolygonRenderer","../Renderer/LineRenderer","../Renderer/PointSpriteRenderer","../Renderer/ConvexPolygonRenderer","../Renderer/PolyLineRenderer"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y,b){const x="posTracker",w="bottom",T="elevTracker",_="bottom",C="compassDiv",S={RA:"initialRa",DEC:"initialDec"},E=3e3;var A=function(e,t,n){i.prototype.constructor.call(this);var s=this;this.time=o.parse(r().toISOString()),this.globe=null,this.navigation=null,this.attributionHandler=null,this.components={},this.dataProviders={},this.canvas=e.canvas,this.isMobile=n.isMobile,this.isEnableCtx=!0,this.timeTravelService=n.timeTravelService,this.subscribe(l.EVENT_MSG.BASE_LAYERS_READY,function(e){"undefined"!==s.getNavigation().getRenderContext().viewMatrix[0]&&s.getNavigation().computeViewMatrix()}),this.mizarConfiguration=e.hasOwnProperty("configuration")?e.configuration:{},this.ctxOptions=n,this.mode=t,this.layers=[],this.pendingLayers=[],this.initCanvas(this.canvas);try{this.positionTracker=function(e){return new m({element:e.positionTracker&&e.positionTracker.element?e.positionTracker.element:x,isMobile:e.isMobile,position:e.positionTracker&&e.positionTracker.position?e.positionTracker.position:w})}.call(this,this.mizarConfiguration)}catch(e){b.open(l.LEVEL.DEBUG,"Cannot create position tracker",e)}try{this.elevationTracker=function(e,t){return new v({element:e.elevationTracker&&e.elevationTracker.element?e.elevationTracker.element:T,isMobile:e.isMobile,position:e.elevationTracker&&e.elevationTracker.elevation?e.elevationTracker.position:_,elevationLayer:void 0!==t.planetLayer?t.planetLayer.elevationLayer:void 0})}.call(this,this.mizarConfiguration,n)}catch(e){b.open(l.LEVEL.DEBUG,"Cannot create elevation tracker",e)}try{this.compass=function(e){return new g({element:e.compass?e.compass:C,ctx:this,isMobile:this.isMobile})}.call(this,this.mizarConfiguration)}catch(e){b.open(l.LEVEL.DEBUG,"Cannot create compass tracker",e)}};function I(t){return e("#"+t).length}function M(e){if(e.isVisible()&&e.getProperties()&&!e.isBackground()&&e.getProperties().hasOwnProperty(S.RA)&&e.getProperties().hasOwnProperty(S.DEC)){var t=e.getProperties().initialFov?e.getProperties().initialFov:e.getGlobe().getRenderContext().getFov(),i=e.callbackContext.getNavigation(),r=i.getCenter(),o=e.globe.getType();switch(o){case l.GLOBE.Sky:i.zoomTo([e.getProperties().initialRa,e.getProperties().initialDec],{fov:t,duration:E});break;case l.GLOBE.Planet:var a=e.getProperties().bbox;if(s.isValueBetween(r[0],a[0],a[2])&&s.isValueBetween(r[1],a[1],a[3]));else{var u=e.globe.getCoordinateSystem(),c=u.getGeoide().getRealPlanetRadius(),h=n.computeDistanceCameraFromBbox(a,t,c,u.isFlat());i.zoomTo([e.getProperties().initialRa,e.getProperties().initialDec],{distance:h,duration:3e3})}break;default:throw new Error("type "+o+" is not implemented","AbstractContext.js")}}}function k(e){!this._getGlobe().hasDefinedBackground()&&e.isBackground()?this._getGlobe().setBaseImagery(e):this._getGlobe().addLayer(e)}function D(e){e.getInformationType()!==l.INFORMATION_TYPE.RASTER||e.isBackground()||(this._getGlobe().rasterOverlayRenderer.removeOverlay(e),e.background=!0)}return n.inherits(i,A),A.prototype.getTime=function(){return this.time},A.prototype.setTime=function(e){this.time=o.parse(e);for(var t=0;t<this.layers.length;t++){this.layers[t].setTime(this.time)}},A.prototype._showUpError=function(e){document.getElementById("MizarCanvas")&&(document.getElementById("MizarCanvas").style.display="none"),document.getElementById("loading")&&(document.getElementById("loading").style.display="none"),document.getElementById("webGLNotAvailable")&&(document.getElementById("webGLNotAvailable").style.display="block")},A.prototype._fillDataProvider=function(e,t){t.data&&this.dataProviders[t.data.type]&&(0,this.dataProviders[t.data.type])(e,t.data)},A.prototype.getDataProviderLayers=function(){for(var e=[],t=this.getLayers(),i=t.length,r=t[i];r;)r.hasOwnProperty("options")&&r.options.hasOwnProperty("type")&&r.options.type===l.LAYER.GeoJSON&&e.push(r),r=t[++i];return e},A.prototype.getTileManager=function(){return this._getGlobe().getTileManager()},A.prototype.registerNoStandardDataProvider=function(e,t){this.dataProviders[e.toString()]=t},A.prototype.getContextConfiguration=function(){return this.ctxOptions},A.prototype.getMizarConfiguration=function(){return this.mizarConfiguration},A.prototype._getGlobe=function(){return this.globe},A.prototype.getLonLatFromPixel=function(e,t){return this._getGlobe().getLonLatFromPixel(e,t)},A.prototype.getPixelFromLonLat=function(e,t){return this._getGlobe().getPixelFromLonLat(e,t)},A.prototype.getElevation=function(e,t){return this._getGlobe().getElevation(e,t)},A.prototype.getPositionTracker=function(){return this.positionTracker},A.prototype.getElevationTracker=function(){return this.elevationTracker},A.prototype.getLayers=function(){return this.layers},A.prototype.getLayerByID=function(e){return t.find(t.union(this.getLayers()),function(t){return t.getID()===e})},A.prototype.getLayerByName=function(e){return t.findWhere(this.getLayers(),{name:e})},A.prototype.addLayer=function(e,t,i){var r=new p(this.pendingLayers,this.layers),n=new u(this.pendingLayers),o=new c(this.pendingLayers),s=new h(this.layers,this.pendingLayers),g=new d(this.pendingLayers),m=new f(this.pendingLayers);r.setNext(n),n.setNext(o),o.setNext(s),s.setNext(g),g.setNext(m);var v=this;r.handleRequest(e,function(i){for(var r=0;r<i.length;r++){var n=i[r];n.callbackContext=v,v.layers.push(n),!0===n.autoFillTimeTravel&&!0===n.visible&&v.timeTravelService&&void 0!==v.timeTravelService&&v.timeTravelService.update(n.timeTravelValues),k.call(v,n),v._fillDataProvider(n,e),n.isVisible()&&n.setTime(v.getTime()),n.isPickable()&&a.create(l.SERVICE.PickingManager).addPickableLayer(n),n.subscribe(l.EVENT_MSG.LAYER_VISIBILITY_CHANGED,M),t&&t(n.ID)}},function(e){i?i(e):b.open(l.LEVEL.ERROR,"Cannot create the layer(s)",e)})},A.prototype.getLinkedLayers=function(t){for(var i=e.map(this.layers,function(e,i){if(e.linkedTo===t)return i}),r=[],n=0;n<i.length;n++)r.push(this.layers[i[n]]);return r},A.prototype.removeLayer=function(t){var i=null,r=e.map(this.layers,function(e,i){if(e.ID===t)return i});r.length>0&&(!0===(i=this.layers.splice(r[0],1)[0]).autoFillTimeTravel&&this.timeTravelService.update({remove:{ID:t}}),this.getTileManager().abortLayerRequests(i),i.unsubscribe(l.EVENT_MSG.LAYER_VISIBILITY_CHANGED,M),a.create(l.SERVICE.PickingManager).removePickableLayer(i),this._getGlobe().removeLayer(i),this.getRenderContext().requestFrame());return i},A.prototype.removeAllLayers=function(){for(var e=this.layers.length;0!=e;){var t=e-1,i=this.layers[t].ID;null!=this.attributionHandler&&this.attributionHandler.removeAttribution(this.layers[t]),this.removeLayer(i),e--}},A.prototype.addDraw=function(e){n.assert(e.type===l.LAYER.Vector,"layer must be a vector layer in addDraw","AbstractContext.js"),e.setDraw(!0),this._getGlobe().addLayer(e)},A.prototype.removeDraw=function(e){this._getGlobe().removeLayer(e)},A.prototype.refresh=function(){this._getGlobe()&&this._getGlobe().refresh()},A.prototype.initCanvas=function(t){var i,r,n=e(t.parentElement);e(t.parentElement).find("#loading").show(),i=e(t).attr("width")?e(t).attr("width"):n.attr("width")?n.attr("width"):window.innerWidth,r=e(t).attr("height")?e(t).attr("height"):n.attr("height")?n.attr("height"):window.innerHeight,t.width=i,t.height=r,n&&n.css({position:"relative",overflow:"hidden"});var o,s=this,a=function(){n&&n.attr("height")&&n.attr("width")?(t.width=n.width(),t.height=n.height()):(t.width=window.innerWidth,t.height=window.innerHeight),s.refresh()};e(window).resize(function(){o&&clearTimeout(o),o=setTimeout(a,500)}),t.addEventListener("webglcontextlost",function(e){e.preventDefault(),document.getElementById("loading").style.display="none",document.getElementById("webGLContextLost").style.display="block"},!1)},A.prototype.initGlobeEvents=function(t){t?(this.globe=t,this.attributionHandler=new y(this.globe,{element:this.mizarConfiguration.attributionHandler&&this.mizarConfiguration.attributionHandler.element?this.mizarConfiguration.attributionHandler.element:"globeAttributions"}),null!=this.positionTracker&&(this.positionTracker.attachTo(this),this.setComponentVisibility("posTrackerInfo",!1)),null!=this.elevationTracker&&this.elevationTracker.attachTo(this),null!=this.compass&&this.compass.attachTo(this)):b.open(l.LEVEL.DEBUG,"AbstractContext.js","Globe is null in initGlobeEvents"),function(t){for(var i in t)I(i)&&(t[i]?e("#"+i).fadeIn(1e3):e("#"+i).fadeOut())}(this.components);var i=this;this.subscribe(l.EVENT_MSG.BASE_LAYERS_ERROR,function(t){e(i.canvas.parentElement).find("#loading").hide(),b.open(l.LEVEL.ERROR,(t.name,t.name),t.message)})},A.prototype.isEnabled=function(){return this.isEnableCtx},A.prototype.isDisabled=function(){return!this.isEnabled()},A.prototype.show=function(){this.navigation.start(),this.showComponents()},A.prototype.showComponents=function(){for(var t in this.components)I(t)&&this.components[t]&&e("#"+t).fadeIn(1e3)},A.prototype.hideComponents=function(t){for(var i in this.components)I(i)&&-1===e.inArray(i,t)&&e("#"+i).fadeOut()},A.prototype.hide=function(){for(var t in this.navigation.stopAnimations(),this.navigation.stop(),this.components)I(t)&&e("#"+t).fadeOut()},A.prototype.setComponentVisibility=function(t,i){var r=e("#"+t);i?r.show():r.hide(),this.components[t]=i},A.prototype.getComponentVisibility=function(e){return this.components[e]},A.prototype.showAdditionalLayers=function(){t.each(this.visibleLayers,function(e){e.setVisible(!0),e.isPickable()&&a.create(l.SERVICE.PickingManager).addPickableLayer(e)})},A.prototype.hideAdditionalLayers=function(){var e=this;this.visibleLayers=[];var i=this.getAdditionalLayers();t.each(i,function(t){t.isVisible()&&(t.setVisible(!1),e.visibleLayers.push(t))})},A.prototype.setBackgroundLayer=function(e){var t=this.getLayerByName(e);return t?(D.call(this,t),this._getGlobe().setBaseImagery(t)):this.publish(l.EVENT_MSG.LAYER_BACKGROUND_ERROR,e+" hasn't been found"),t},A.prototype.setBackgroundLayerByID=function(e){var t=this.getLayerByID(e);return t?(D.call(this,t),this._getGlobe().setBaseImagery(t)):this.publish(l.EVENT_MSG.LAYER_BACKGROUND_ERROR,e+" hasn't been found"),t},A.prototype.getAdditionalLayers=function(){return t.filter(this.layers,function(e){return"background"!==e.category})},A.prototype.getRenderContext=function(){return this._getGlobe().getRenderContext()},A.prototype.disable=function(){this.positionTracker&&this.positionTracker.detach(),this.elevationTracker&&this.elevationTracker.detach(),this.compass&&this.compass.detach();for(var e=0,t=this.layers[e];t;)null!=this.attributionHandler&&this.attributionHandler.disable(t),t=this.layers[++e];for(var i=this.getRenderContext().renderers,r=0;r<i.length;r++)i[r].getType()===this.getMode()&&i[r].disable();this.isEnableCtx=!1},A.prototype.enable=function(){null!=this.positionTracker&&this.positionTracker.attachTo(this),null!=this.elevationTracker&&this.elevationTracker.attachTo(this),null!=this.compass&&this.compass.attachTo(this);for(var e=0,t=this.layers[e];t;)t.isPickable()&&a.create(l.SERVICE.PickingManager).addPickableLayer(t),null!=this.AttributionHandler&&this.attributionHandler.enable(t),t=this.layers[++e];var i=this.getRenderContext().renderers;for(e=0;e<i.length;e++)i[e].getType()===this.getMode()&&i[e].enable();this.isEnableCtx=!0},A.prototype.setCompassVisible=function(e,t){throw new SyntaxError("compass visible not implemented","AbstractContext.js")},A.prototype.setTimeTravelVisible=function(e,t){throw new SyntaxError("time travel visible not implemented","AbstractContext.js")},A.prototype.getMode=function(){return this.mode},A.prototype.setCoordinateSystem=function(e){throw new SyntaxError("CRS not implemented","AbstractContext.js")},A.prototype.getNavigation=function(){return this.navigation},A.prototype.getCoordinateSystem=function(){return this._getGlobe().getCoordinateSystem()},A.prototype.addAnimation=function(e){this._getGlobe().addAnimation(e)},A.prototype.removeAnimation=function(e){this._getGlobe().removeAnimation(e)},A.prototype.render=function(){this._getGlobe().render()},A.prototype.dispose=function(){this._getGlobe().dispose()},A.prototype.trackerDestroy=function(){this.elevationTracker&&(this.elevationTracker.destroy(),this.elevationTracker=null),this.positionTracker&&(this.positionTracker.destroy(),this.positionTracker=null)},A.prototype.destroy=function(){this.hide(),this.trackerDestroy(),this.compass&&(this.compass.destroy(),this.compass=null),this.removeAllLayers(),this.components=null,this.attributionHandler=null,this.layers=null,this.visibleLayers=null,this.dataProviders=null,this.mizarConfiguration=null,this.ctxOptions=null,this.mode=null,this.unsubscribe(l.EVENT_MSG.BASE_LAYERS_READY,function(e){"undefined"!==self.getNavigation().getRenderContext().viewMatrix[0]&&self.getNavigation().computeViewMatrix()}),this.navigation&&(this.navigation.destroy(),this.navigation=null),this._getGlobe()&&(this._getGlobe().destroy(),this.globe=null),this.canvas=null},A}),r("gw/Tiling/TilePool",[],function(){return function(e){var t=e.gl,i={},r=[],n=this,o=t.getExtension("OES_texture_float_linear")?t.LINEAR:t.NEAREST;this.numCreatedTextures=0,this.numReusedTextures=0;this.createGLTexture=function(e){var r=function(e){var t=e.dataType+e.width;return i[t]||(i[t]=[]),i[t]}(e);return r.length>0?function(e,i){var r=i.pop();return t.bindTexture(t.TEXTURE_2D,r),"byte"===e.dataType?(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.generateMipmap(t.TEXTURE_2D)):t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,e.width,e.height,0,t.LUMINANCE,t.FLOAT,e.typedArray),n.numReusedTextures++,r}(e,r):function(e,i){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),"byte"===e.dataType?(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.generateMipmap(t.TEXTURE_2D)):(t.texImage2D(t.TEXTURE_2D,0,t.LUMINANCE,e.width,e.height,0,t.LUMINANCE,t.FLOAT,e.typedArray),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,o)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),r.pool=i,n.numCreatedTextures++,r}(e,r)},this.createGLBuffer=function(e){var i;return i=r.length>0?r.pop():t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),i},this.disposeGLTexture=function(e){e.pool.push(e)},this.disposeGLBuffer=function(e){r.push(e)},this.disposeAll=function(){var e;for(var n in i)if(i.hasOwnProperty(n)){var o=i[n];for(e=0;e<o.length;e++)t.deleteTexture(o[e])}for(i={},e=0;e<r.length;e++)t.deleteBuffer(r[e]);r.length=0}}}),r("gw/Tiling/TileRequest",["./Tile","../Utils/ImageRequest"],function(e,t){return function(i){var r,n=!1,o=!0,s=new XMLHttpRequest;this.tile=null,this.elevations=null,this.image=null;var a=this;s.onreadystatechange=function(e){4===s.readyState&&(200===s.status?(a.elevations=i.elevationProvider.parseElevations(s.responseText),o=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())):(a.elevations=null,o=!0,n&&(i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame())))};var l=function(){n||(n=!0,o&&(i.imageryProvider&&i.imageryProvider.handleImage&&i.imageryProvider.handleImage(r),i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.completedRequests.push(a),i.renderContext.requestFrame()),a.image=r.image)},u=function(){a.tile.state=e.State.ERROR,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)},c=function(){a.tile.state=e.State.NONE,i.pendingRequests.splice(i.pendingRequests.indexOf(a),1),i.availableRequests.push(a)};this.launch=function(h){if(h.state=e.State.LOADING,this.tile=h,i.pendingRequests.push(this),this.image=null,this.elevations=null,i.elevationProvider&&null!=i.elevationProvider.getUrl(h)){o=!1,s.open("GET",i.elevationProvider.getUrl(h));var d="use-credentials"===i.elevationProvider.crossOrigin;s.withCredentials=d,s.send()}else o=!0;var p;i.imageryProvider&&i.imageryProvider.getUrl(h)?(r||(r=new t({successCallback:function(){l(),i.imageryProvider.cache&&i.imageryProvider.cache.storeInCache(a)},failCallback:u,abortCallback:c})),i.imageryProvider.cache&&(p=p=i.imageryProvider.cache.getFromCache(h)),n=!1,p?(r.image=p.image,l()):r.send(i.imageryProvider.getUrl(h),i.imageryProvider.crossOrigin)):n=!0,i.imageryProvider||i.elevationProvider||(i.pendingRequests.splice(i.pendingRequests.indexOf(this),1),i.completedRequests.push(this))},this.abort=function(){r&&r.abort()}}}),r("gw/Tiling/TileIndexBuffer",[],function(){var e=function(e,t){this.renderContext=e,this.config=t,this.solidIndexBuffer=null,this.indices=null,this.subSolidIndexBuffer=[null,null,null,null],this.subIndices=[null,null,null,null]};return e.prototype.reset=function(){for(var e=this.renderContext.gl,t=0;t<4;t++)this.subSolidIndexBuffer[t]&&(e.deleteBuffer(this.subSolidIndexBuffer[t]),this.subSolidIndexBuffer[t]=null);this.solidIndexBuffer&&(e.deleteBuffer(this.solidIndexBuffer),this.solidIndexBuffer=null)},e.prototype.getSubSolid=function(e){if(null===this.subSolidIndexBuffer[e]){var t,i,r=e%2,n=Math.floor(e/2),o=this.config.tesselation,s=(o-1)/2,a=[];for(t=s*n;t<s*(n+1);t++)for(i=s*r;i<s*(r+1);i++)a.push(t*o+i),a.push((t+1)*o+i),a.push(t*o+i+1),a.push(t*o+i+1),a.push((t+1)*o+i),a.push((t+1)*o+i+1);if(this.subIndices[e]=a,this.config.skirt){var l=0===n?o*o:o*o+4*o,u=0===n?0:s*o;for(t=s*r;t<s*(r+1);t++)a.push(l+t),a.push(u+t),a.push(l+t+1),a.push(l+t+1),a.push(u+t),a.push(u+t+1);for(l=0===n?o*o+4*o:o*o+o,u=0===n?s*o:(o-1)*o,t=s*r;t<s*(r+1);t++)a.push(u+t),a.push(l+t),a.push(u+t+1),a.push(u+t+1),a.push(l+t),a.push(l+t+1);for(l=0===r?o*o+2*o:o*o+5*o,u=0===r?0:s,i=s*n;i<s*(n+1);i++)a.push(l+i),a.push(l+i+1),a.push(u+i*o),a.push(u+i*o),a.push(l+i+1),a.push(u+(i+1)*o);for(l=0===r?o*o+5*o:o*o+3*o,u=0===r?s:o-1,i=s*n;i<s*(n+1);i++)a.push(i*o+u),a.push((i+1)*o+u),a.push(l+i),a.push(l+i),a.push((i+1)*o+u),a.push(l+i+1)}var c=this.renderContext.gl,h=c.createBuffer();c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,h),c.bufferData(c.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),c.STATIC_DRAW),h.numIndices=a.length,this.subSolidIndexBuffer[e]=h}return this.subSolidIndexBuffer[e]},e.prototype.getSolid=function(){if(null===this.solidIndexBuffer){var e,t,i=this.config.tesselation;for(this.indices=[],t=0;t<i-1;t++)for(e=0;e<i-1;e++)this.indices.push(t*i+e),this.indices.push((t+1)*i+e),this.indices.push(t*i+e+1),this.indices.push(t*i+e+1),this.indices.push((t+1)*i+e),this.indices.push((t+1)*i+e+1);if(this.config.skirt){var r=i*i;for(e=0;e<i-1;e++)this.indices.push(r+e),this.indices.push(e),this.indices.push(r+e+1),this.indices.push(r+e+1),this.indices.push(e),this.indices.push(e+1);for(r+=i,e=0;e<i-1;e++)this.indices.push((i-1)*i+e),this.indices.push(r+e),this.indices.push((i-1)*i+e+1),this.indices.push((i-1)*i+e+1),this.indices.push(r+e),this.indices.push(r+e+1);for(r+=i,t=0;t<i-1;t++)this.indices.push(r+t),this.indices.push(r+t+1),this.indices.push(t*i),this.indices.push(t*i),this.indices.push(r+t+1),this.indices.push((t+1)*i);for(r+=i,t=0;t<i-1;t++)this.indices.push(t*i+i-1),this.indices.push((t+1)*i+i-1),this.indices.push(r+t),this.indices.push(r+t),this.indices.push((t+1)*i+i-1),this.indices.push(r+t+1)}var n=this.renderContext.gl,o=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),n.STATIC_DRAW),this.numIndices=this.indices.length,this.solidIndexBuffer=o,this.solidIndexBuffer.numIndices=this.indices.length}return this.solidIndexBuffer},e}),r("gw/Tiling/TileManager",["./Tile","./GeoTiling","./TilePool","./TileRequest","./TileIndexBuffer","../Renderer/Program","../Utils/Constants"],function(e,t,i,r,n,o,s){var a=function(e,s){this.parent=e,this.publishEvent=s.publishEvent,this.renderContext=this.parent.renderContext,this.tilePool=e.tilePool||new i(this.renderContext),this.tiling=new t(4,2),this.imageryProvider=null,this.elevationProvider=null,this.tilesToRender=[],this.visibleTiles=[],this.tilesToRequest=[],this.postRenderers=[];var a=this.renderContext.gl;this.defaultTexture=a.createTexture(),a.bindTexture(a.TEXTURE_2D,this.defaultTexture);var l=s.defaultColor?s.defaultColor:[200,200,200,255],u=new Uint8Array(l);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,u),this.maxRequests=4,this.availableRequests=[];for(var c=this.maxRequests;c--;)this.availableRequests[c]=new r(this);this.pendingRequests=[],this.completedRequests=[],this.level0TilesLoaded=!1,this.tileConfig={tesselation:9,skirt:!0,cullSign:1,imageSize:256,vertexSize:this.renderContext.lighting?6:3,normals:this.renderContext.lighting,coordinateSystem:this.parent.coordinateSystem},this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),this.tcoordBuffer=null,this.tileIndexBuffer=new n(this.renderContext,this.tileConfig),this.renderTileWithoutTexture=!s.hasOwnProperty("renderTileWithoutTexture")||s.renderTileWithoutTexture,this.freeze=!1,this.numTilesGenerated=0,this.frameNumber=0,this.vertexShader="attribute vec3 vertex;\n",this.vertexShader+="attribute vec2 tcoord;\n",this.vertexShader+="uniform mat4 modelViewMatrix;\n",this.vertexShader+="uniform mat4 projectionMatrix;\n",this.vertexShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.vertexShader+="attribute vec3 normal;\nvarying vec3 color;\n"),this.vertexShader+="void main(void) \n",this.vertexShader+="{\n",this.vertexShader+="gl_Position = projectionMatrix * modelViewMatrix * vec4(vertex, 1.0);\n",this.renderContext.lighting&&(this.vertexShader+="vec4 vn = modelViewMatrix * vec4(normal,0);\ncolor = max( vec3(-vn[2],-vn[2],-vn[2]), 0.0 );\n"),this.vertexShader+="texCoord = tcoord;\n",this.vertexShader+="}\n",this.fragmentShader="precision lowp float; \n",this.fragmentShader+="varying vec2 texCoord;\n",this.renderContext.lighting&&(this.fragmentShader+="varying vec3 color;\n"),this.fragmentShader+="uniform sampler2D colorTexture;\n",this.fragmentShader+="void main(void)\n",this.fragmentShader+="{\n",this.fragmentShader+="\tgl_FragColor.rgb = texture2D(colorTexture, texCoord).rgb;\n",this.renderContext.lighting&&(this.fragmentShader+="  gl_FragColor.rgb *= color;\n"),this.fragmentShader+="  gl_FragColor.a = 1.0;\n",this.fragmentShader+="}\n",this.program=new o(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader)};function l(e){var t=e.renderer.imageRequests;if(t)for(var i=t.length;i--;){var r=t[i];r.renderable&&r.abort()}}a.prototype.addPostRenderer=function(e){this.postRenderers.push(e),this.postRenderers.sort(function(e,t){return(e.zIndex|s.DISPLAY.DEFAULT_RASTER)-(t.zIndex|s.DISPLAY.DEFAULT_RASTER)}),e.generate&&this.visitTiles(function(t){e.generate(t)})},a.prototype.removePostRenderer=function(e){var t=this.postRenderers.indexOf(e);-1!==t&&(e.cleanupTile&&this.visitTiles(function(t){e.cleanupTile(t)}),this.postRenderers.splice(t,1))},a.prototype.setImageryProvider=function(e){this.reset(),this.imageryProvider=e,e&&(this.tilePool.disposeAll(),this.tiling=e.tiling,this.tileConfig.imageSize=e.tilePixelSize,this.level0Tiles=this.tiling.generateLevelZeroTiles(this.tileConfig,this.tilePool),e.customShader?(this.program.dispose(),this.program=new o(this.renderContext),this.currentFragmentShader=e.customShader.fragmentCode?e.customShader.fragmentCode:this.fragmentShader,this.program.createFromSource(e.customShader.vertexCode?e.customShader.vertexCode:this.vertexShader,this.currentFragmentShader)):null!==this.currentFragmentShader&&(this.program.dispose(),this.program=new o(this.renderContext),this.program.createFromSource(this.vertexShader,this.fragmentShader),this.currentFragmentShader=null))},a.prototype.setElevationProvider=function(e){this.reset(),this.elevationProvider=e;var t=e?e.tilePixelSize:9;if(t!==this.tileConfig.tesselation){this.tileConfig.tesselation=t;var i=this.renderContext.gl;this.tileIndexBuffer.reset(),this.tcoordBuffer&&(i.deleteBuffer(this.tcoordBuffer),this.tcoordBuffer=null)}},a.prototype.reset=function(){this.abortRequests();for(var e=this.level0Tiles.length;e--;)this.level0Tiles[e].deleteChildren(this.renderContext,this.tilePool),this.level0Tiles[e].dispose(this.renderContext,this.tilePool);this.tileIndexBuffer.reset(),this.level0TilesLoaded=!1},a.prototype.abortRequests=function(){for(var e=this.pendingRequests.length;e--;)this.pendingRequests[e].abort()},a.prototype.abortLayerRequests=function(e,t){this.abortRequests(),function(e,t,i){for(var r=e.length;r--;){var n=e[r].extension;if(n&&n.renderer)for(var o=n.renderer.renderables,s=o.length;s--;){var a=o[s];if(a.bucket.layer.ID===t.getID()){l.call(this,a.bucket),i&&i(a,t);break}}}}.call(this,this.visibleTiles,e,t)},a.prototype.updateVisibleTiles=function(e){this.abortLayerRequests(e),function(e,t){var i;if(e)i=e.bucket;else{if(!t)return;i=t._bucket}if(i){var r=i.renderer;r&&(r.updateOverlay?r.updateOverlay(i.layer):(r.removeOverlay(i.layer),r.addOverlay(i.layer)))}}(null,e)},a.prototype.visitTiles=function(e){for(var t=this.level0Tiles.concat([]);t.length>0;){var i=t.shift();e(i),i.children&&(t.push(i.children[0]),t.push(i.children[1]),t.push(i.children[2]),t.push(i.children[3]))}},a.prototype.traverseTiles=function(){var t,i;if(this.tilesToRender.length=0,this.visibleTiles.length=0,this.tilesToRequest.length=0,this.numTraversedTiles=0,!this.level0TilesLoaded){for(this.level0TilesLoaded=!0,t=this.level0Tiles.length;t--;){var r=(i=this.level0Tiles[t]).state===e.State.LOADED;i.frameNumber=this.frameNumber,this.level0TilesLoaded=this.level0TilesLoaded&&r,r||(i.state===e.State.NONE?(i.state=e.State.REQUESTED,this.tilesToRequest.push(i)):i.state===e.State.ERROR&&this.imageryProvider&&this.publishEvent(s.EVENT_MSG.BASE_LAYERS_ERROR,this.imageryProvider))}this.level0TilesLoaded&&this.imageryProvider&&this.publishEvent(s.EVENT_MSG.BASE_LAYERS_READY,this.imageryProvider)}if(this.level0TilesLoaded)for(t=this.level0Tiles.length;t--;)(i=this.level0Tiles[t]).isCulled(this.renderContext)?i.deleteChildren(this.renderContext,this.tilePool):this.processTile(i,0)},a.prototype.processTile=function(t,i){this.numTraversedTiles++,t.frameNumber=this.frameNumber;var r=!0;if(t.state===e.State.NONE&&(t.state=e.State.REQUESTED,this.tilesToRequest.push(t)),t.state===e.State.LOADED&&(r=!!this.imageryProvider&&i>=this.imageryProvider.numberOfLevels,r|=!t.needsToBeRefined(this.renderContext)),r)(t.texture||this.renderTileWithoutTexture)&&this.tilesToRender.push(t),this.visibleTiles.push(t);else{null===t.children&&t.createChildren();for(var n=0;n<4;n++)t.children[n].isCulled(this.renderContext)?t.children[n].deleteChildren(this.renderContext,this.tilePool):this.processTile(t.children[n],i+1)}for(var o in t.extension)if(t.extension.hasOwnProperty(o)){var s=t.extension[o];s.traverse&&s.traverse(t,r)}},a.prototype.generateTile=function(e,t){e.generate(this.tilePool,t.image,t.elevations);for(var i=this.postRenderers.length;i--;)this.postRenderers[i].generate&&this.postRenderers[i].generate(e);this.numTilesGenerated++,this.renderContext.requestFrame()},a.prototype.generateReceivedTiles=function(){for(;this.completedRequests.length>0;){var t=this.completedRequests.pop(),i=t.tile;i.frameNumber===this.frameNumber?this.generateTile(i,t):i.state=e.State.NONE,this.availableRequests.push(t)}this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent(s.EVENT_MSG.LAYER_END_BACKGROUND_LOAD)},a.prototype.renderTiles=function(){var t,i,r=this.renderContext,n=r.gl;if(this.tileConfig.cullSign<0&&(r.far=Math.max(r.minFar,1.1*this.tileConfig.coordinateSystem.geoide.radius)),0!==this.tilesToRender.length){this.tileConfig.cullSign<0?(n.depthMask(!1),n.disable(n.DEPTH_TEST),n.disable(n.CULL_FACE)):(n.enable(n.POLYGON_OFFSET_FILL),n.polygonOffset(0,4)),this.currentFragmentShader&&this.currentFragmentShader!==this.imageryProvider.customShader.fragmentCode&&(this.program.dispose(),this.program=new o(this.renderContext),this.imageryProvider&&this.imageryProvider.customShader&&(this.currentFragmentShader=this.imageryProvider.customShader.fragmentCode?this.imageryProvider.customShader.fragmentCode:this.fragmentShader,this.program.createFromSource(this.imageryProvider.customShader.vertexShader?this.imageryProvider.customShader.vertexShader:this.vertexShader,this.currentFragmentShader))),this.program.apply();var s=this.program.attributes;mat4.perspective(r.fov,r.canvas.width/r.canvas.height,r.near,r.far,r.projectionMatrix),this.imageryProvider&&this.imageryProvider.customShader&&this.imageryProvider.customShader.updateUniforms(n,this.program),n.activeTexture(n.TEXTURE0),n.uniformMatrix4fv(this.program.uniforms.projectionMatrix,!1,r.projectionMatrix),n.uniform1i(this.program.uniforms.colorTexture,0),this.tcoordBuffer||this.buildSharedTexCoordBuffer(),n.bindBuffer(n.ARRAY_BUFFER,this.tcoordBuffer),n.vertexAttribPointer(s.tcoord,2,n.FLOAT,!1,0,0);var a=null;for(t=this.tilesToRender.length;t--;){var l=(i=this.tilesToRender[t]).state===e.State.LOADED,u=-1===i.parentIndex;i.texture?n.bindTexture(n.TEXTURE_2D,i.texture):n.bindTexture(n.TEXTURE_2D,this.defaultTexture),mat4.multiply(r.viewMatrix,i.matrix,r.modelViewMatrix),n.uniformMatrix4fv(this.program.uniforms.modelViewMatrix,!1,r.modelViewMatrix),n.bindBuffer(n.ARRAY_BUFFER,i.vertexBuffer),n.vertexAttribPointer(s.vertex,3,n.FLOAT,!1,4*this.tileConfig.vertexSize,0),this.tileConfig.normals&&n.vertexAttribPointer(s.normal,3,n.FLOAT,!1,4*this.tileConfig.vertexSize,12);var c=l||u?this.tileIndexBuffer.getSolid():this.tileIndexBuffer.getSubSolid(i.parentIndex);a!==c&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,c),a=c),n.drawElements(n.TRIANGLES,a.numIndices,n.UNSIGNED_SHORT,0)}this.tileConfig.cullSign<0?(n.depthMask(!0),n.enable(n.DEPTH_TEST)):n.disable(n.POLYGON_OFFSET_FILL)}for(t=this.postRenderers.length;t--;)this.postRenderers[t].render(this.visibleTiles)};var u=function(e,t){return e.distance-t.distance};return a.prototype.launchRequests=function(){this.tilesToRequest.sort(u);for(var t=this.tilesToRequest.length;t--;){var i=this.tilesToRequest[t];if(this.availableRequests.length>0)this.availableRequests.length===this.maxRequests&&this.imageryProvider&&this.publishEvent(s.EVENT_MSG.LAYER_START_BACKGROUND_LOAD),this.availableRequests.pop().launch(i);else i.state=e.State.NONE}},a.prototype.render=function(){if(!this.imageryProvider||this.imageryProvider._ready){if(!this.level0TilesLoaded&&this.imageryProvider&&this.imageryProvider.levelZeroImage){this.imageryProvider.generateLevel0Textures(this.level0Tiles,this.tilePool);for(var e=this.level0Tiles.length;e--;){var t=this.level0Tiles[e];this.generateTile(t,{})}this.level0TilesLoaded=!0,this.publishEvent(s.EVENT_MSG.BASE_LAYERS_READY,this.imageryProvider)}var i=this.renderContext.stats;this.freeze||(i&&i.start("traverseTime"),this.traverseTiles(),i&&i.end("traverseTime")),!this.level0TilesLoaded&&this.imageryProvider||(i&&i.start("renderTime"),this.renderTiles(),i&&i.end("renderTime")),i&&i.start("generateTime"),this.generateReceivedTiles(),i&&i.end("generateTime"),i&&i.start("requestTime"),this.launchRequests(),i&&i.end("requestTime"),this.frameNumber++}},a.prototype.getVisibleTile=function(e,t){return this.tiling.findInsideTile(e,t,this.visibleTiles)},a.prototype.buildSharedTexCoordBuffer=function(){var e=this.tileConfig.tesselation,t=this.tileConfig.skirt,i=2*e*e;t&&(i+=2*e*6);var r,n,o,s,a=new Float32Array(i),l=1/(e-1),u=0;for(n=0,s=0;s<e;s++){for(r=0,o=0;o<e;o++)a[u]=r,a[u+1]=n,u+=2,r+=l;n+=l}if(t){for(r=0,n=0,o=0;o<e;o++)a[u]=r,a[u+1]=n,r+=l,u+=2;for(r=0,n=1,o=0;o<e;o++)a[u]=r,a[u+1]=n,r+=l,u+=2;for(r=0,n=0,o=0;o<e;o++)a[u]=r,a[u+1]=n,n+=l,u+=2;for(r=1,n=0,o=0;o<e;o++)a[u]=r,a[u+1]=n,n+=l,u+=2;for(r=0,n=.5,o=0;o<e;o++)a[u]=r,a[u+1]=n,r+=l,u+=2;for(r=.5,n=0,o=0;o<e;o++)a[u]=r,a[u+1]=n,n+=l,u+=2}var c=this.renderContext.gl,h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,a,c.STATIC_DRAW),this.tcoordBuffer=h},a.prototype.setFreeze=function(e){this.freeze=e},a.prototype.getFreeze=function(){return this.freeze},a}),r("gw/Renderer/Frustum",["./glMatrix"],function(){var e=function(){this.normal=vec3.create([0,0,0]),this.d=0};e.prototype.init=function(e,t,i){var r=[],n=[];vec3.subtract(t,e,r),vec3.subtract(i,e,n),vec3.cross(r,n,this.normal),vec3.normalize(this.normal),this.d=-vec3.dot(e,this.normal)},e.prototype.transform=function(e){var t=[this.normal[0],this.normal[1],this.normal[2],this.d];mat4.multiplyVec4(e,t),this.normal[0]=t[0],this.normal[1]=t[1],this.normal[2]=t[2],this.d=t[3]},e.prototype.intersectSphere=function(e,t){var i=vec3.dot(e,this.normal)+this.d;return i>t?1:i<-t?-1:0},e.prototype.distance=function(e){return e[0]*this.normal[0]+e[1]*this.normal[1]+e[2]*this.normal[2]+this.d},e.prototype.intersectBoundingBox=function(e){var t=(this.normal[0]>=0?1:0)|(this.normal[1]>=0?2:0)|(this.normal[2]>=0?4:0),i=7&~t;return this.distance(e.getCorner(i))>0?1:this.distance(e.getCorner(t))<0?-1:0};var t=function(){this.planes=[new e,new e,new e,new e,new e]};return t.prototype.compute=function(e){var t=mat4.create();mat4.inverse(e,t);var i=mat4.project(t,[-1,-1,-1,1]),r=mat4.project(t,[-1,1,-1,1]),n=mat4.project(t,[1,1,-1,1]),o=mat4.project(t,[1,-1,-1,1]);this.planes[0].init([0,0,0],i,r),this.planes[1].init([0,0,0],r,n),this.planes[2].init([0,0,0],n,o),this.planes[3].init([0,0,0],o,i),this.planes[4].init(i,r,n)},t.prototype.transform=function(e,t){var i=mat4.create();mat4.inverse(t,i),this.inverseTransform(e,i)},t.prototype.inverseTransform=function(e,t){for(var i=0;i<e.planes.length;i++){var r=e.planes[i],n=r.normal[0],o=r.normal[1],s=r.normal[2],a=r.d;(r=this.planes[i]).normal[0]=t[0]*n+t[1]*o+t[2]*s+t[3]*a,r.normal[1]=t[4]*n+t[5]*o+t[6]*s+t[7]*a,r.normal[2]=t[8]*n+t[9]*o+t[10]*s+t[11]*a,r.d=t[12]*n+t[13]*o+t[14]*s+t[15]*a}},t.prototype.containsSphere=function(e,t){for(var i=1,r=0;r<this.planes.length;r++){var n=this.planes[r].normal,o=e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+this.planes[r].d;if(o<=t){if(o<-t)return-1;i=0}}return i},t.prototype.containsBoundingBox=function(e){for(var t=0;t<this.planes.length;t++){var i=this.planes[t],r=i.normal[0]>=0?e.max[0]:e.min[0],n=i.normal[1]>=0?e.max[1]:e.min[1],o=i.normal[2]>=0?e.max[2]:e.min[2];if(r*i.normal[0]+n*i.normal[1]+o*i.normal[2]+i.d<0)return!1}return!0},t.Plane=e,t}),r("gw/Renderer/RenderContext",["jquery","./Frustum","./glMatrix"],function(e,t){var i=function(r){this.activeAnimations=[],this.shadersPath=r.shadersPath||"../shaders/",this.tileErrorTreshold=r.tileErrorTreshold||4,this.lighting=r.lighting||!1,this.continuousRendering=r.continuousRendering||!1,this.stats=null,this.isActive=!0;var n=null;if(!r.canvas)throw new ReferenceError("Mizar : no canvas in options");if(!((n="string"==typeof r.canvas?e(r.canvas):r.canvas)instanceof HTMLCanvasElement))throw new TypeError("Mizar : invalid canvas");for(var o=["webgl","experimental-webgl","webkit-3d","moz-webgl"],s=null,a=0;a<o.length&&null===s;++a)try{s=n.getContext(o[a],i.contextAttributes)}catch(e){}if(null===s)throw new ReferenceError("Mizar : WebGL context cannot be initialized");if(r.backgroundColor){var l=r.backgroundColor;s.clearColor(l[0],l[1],l[2],l[3])}else s.clearColor(0,0,0,1);s.getExtension("OES_element_index_uint"),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.enable(s.DEPTH_TEST),s.enable(s.CULL_FACE),this.viewMatrix=mat4.create(),this.modelViewMatrix=mat4.create(),this.projectionMatrix=mat4.create(),this.viewProjectionMatrix=mat4.create(),this.gl=s,this.canvas=n,this.frustum=new t,this.worldFrustum=new t,this.localFrustum=new t,this.eyePosition=vec3.create(),this.eyeDirection=vec3.create(),this.minNear=r.minNear||1e-10,this.minFar=r.minFar||0,this.near=1,this.far=6,this.numActiveAttribArray=0,this.frameRequested=!1,this.fov=45,this.renderers=[],this.cameraUpdateFunction=null,this.lastFrameTime=null,this.currentFrameTime=null,this.totalElapsedTime=0,this.deltaTime=0,window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e,t){window.setTimeout(e,1e3/60)});var u=this;this.frameCallback=function(){u.frame()}};return i.contextAttributes={},i.prototype.requestFrame=function(){this.frameRequested||(window.requestAnimationFrame(this.frameCallback),this.frameRequested=!0)},i.prototype.deactivate=function(){this.isActive=!1,this.frameRequested=!1},i.prototype.activate=function(){this.isActive=!0},i.prototype.frame=function(){if(this.isActive){this.frameRequested=!1;this.stats;var e,t=this.gl;this.stats&&this.stats.start("globalRenderTime"),this.lastFrameTime=this.currentFrameTime,this.currentFrameTime=Date.now(),this.lastFrameTime||(this.lastFrameTime=this.currentFrameTime);const r=this.currentFrameTime-this.lastFrameTime;if(this.totalElapsedTime+=r,this.deltaTime=r,this.activeAnimations.length>0)for(e=0;e<this.activeAnimations.length;e++)this.activeAnimations[e].update(this.currentFrameTime);if(i.contextAttributes.stencil?t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT):t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),0===this.canvas.width||0===this.canvas.height)return;for(t.viewport(0,0,this.canvas.width,this.canvas.height),this.cameraUpdateFunction&&this.cameraUpdateFunction(),this.updateViewDependentProperties(),e=0;e<this.renderers.length;e++)this.renderers[e].render();this.stats&&this.stats.end("globalRenderTime"),this.continuousRendering?this.requestFrame():this.activeAnimations.length>0&&this.requestFrame()}},i.prototype.updateViewDependentProperties=function(){var e=mat4.create();mat4.inverse(this.viewMatrix,e),vec3.set([0,0,0],this.eyePosition),mat4.multiplyVec3(e,this.eyePosition),vec3.set([0,0,-1],this.eyeDirection),mat4.rotateVec3(e,this.eyeDirection),mat4.perspective(this.fov,this.canvas.width/this.canvas.height,this.near,this.far,this.projectionMatrix),mat4.multiply(this.projectionMatrix,this.viewMatrix,this.viewProjectionMatrix),this.frustum.compute(this.projectionMatrix),this.worldFrustum.inverseTransform(this.frustum,this.viewMatrix),this.pixelSizeVector=this.computePixelSizeVector()},i.prototype.getXYRelativeToCanvas=function(e){var t=[];e.pageX||e.pageY?(t[0]=e.pageX,t[1]=e.pageY):(t[0]=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t[1]=e.clientY+document.body.scrollTop+document.documentElement.scrollTop);for(var i=this.canvas;i;)t[0]-=i.offsetLeft,t[1]-=i.offsetTop,i=i.offsetParent;return t},i.prototype.computePixelSizeVector=function(e){var t=this.canvas.width,i=this.canvas.height,r=this.projectionMatrix,n=e||this.viewMatrix,o=r[0]*t*.5,s=r[8]*t*.5+r[11]*t*.5,a=[n[0]*o+n[2]*s,n[4]*o+n[6]*s,n[8]*o+n[10]*s],l=r[5]*i*.5,u=r[9]*i*.5+r[11]*i*.5,c=[n[1]*l+n[2]*u,n[5]*l+n[6]*u,n[9]*l+n[10]*u],h=r[11],d=r[15],p=[n[2]*h,n[6]*h,n[10]*h,n[14]*h+n[15]*d],f=.7071067811/Math.sqrt(vec3.dot(a,a)+vec3.dot(c,c));return p[0]*=f,p[1]*=f,p[2]*=f,p[3]*=f,p},i.prototype.getPixelFrom3D=function(e,t,i){var r=mat4.create();mat4.multiply(this.projectionMatrix,this.viewMatrix,r);var n=[e,t,i,1];return mat4.project(r,n),[Math.round(.5*(1+n[0])*this.canvas.width),Math.round(.5*(1-n[1])*this.canvas.height)]},i.prototype.createNonPowerOfTwoTextureFromImage=function(e,t){var i=this.gl,r=i.createTexture();return i.bindTexture(i.TEXTURE_2D,r),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,t),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!1),r},i.prototype.getCanvas=function(){return this.canvas},i.prototype.getFov=function(){return this.fov},i.prototype.setFov=function(e){this.fov=e},i.prototype.getWorldFrustum=function(){return this.worldFrustum},i.prototype.getViewMatrix=function(){return this.viewMatrix},i.prototype.setViewMatrix=function(e){this.viewMatrix=e},i}),r("gw/Globe/AbstractGlobe",["../Utils/Event","../Utils/Utils","../Tiling/TileManager","../Renderer/RendererManager","../Renderer/Ray","../Renderer/GeoBound","../Crs/CoordinateSystemFactory","../Renderer/RenderContext","../Utils/Constants","../Gui/dialog/ErrorDialog","../Renderer/glMatrix"],function(e,t,i,r,n,o,s,a,l,u){var c=function(e,n){t.assert(e===l.GLOBE.Sky||e===l.GLOBE.Planet||e===l.GLOBE.Ground,"Type must be a value of Contants.GLOBE for "+this.constructor.name,"AbstractGlobe.js"),t.assert(null!=n,"Options is required "+this.constructor.name,"AbastractGlobe.js"),t.assert(null!=n.coordinateSystem&&"object"==typeof n.coordinateSystem&&null!=n.coordinateSystem.geoideName,"coordinate system is required in options parameters for "+this.constructor.name,"AbastractGlobe.js"),this.type=e,this.coordinateSystem=s.create(n.coordinateSystem),n.renderContext?this.renderContext=n.renderContext:this.renderContext=new a(n),this.publishEvent=n.publishEvent,this.isEnable=!0,this.continuousRendering=n.continuousRendering||!1,this.tileManager=new i(this,n),this.rendererManager=new r(this),this.attributionHandler=null,this.baseImagery=null,this.preRenderers=[],this.nbCreatedLayers=0,this.definedBackgound=!1,this.subdivisionLength=n.subdivisionLength||1e4,this.maxSubdivisionCount=n.maxSubdivisionCount||128,this.cachedPickingValue=null,this.tileManager.addPostRenderer(this.rendererManager),this.renderContext.renderers.push(this),this.refresh()};return c.prototype.getType=function(){return this.type},c.prototype.isSky=function(){return this.getType()===l.GLOBE.Sky},c.prototype.isPlanet=function(){return this.getType()===l.GLOBE.Planet},c.prototype.hasDefinedBackground=function(){return this.definedBackgound},c.prototype.setBaseImagery=function(e){throw new SyntaxError("setBaseImagery Not implemented","AbstractGlobe.js")},c.prototype.getBaseImagery=function(){return this.baseImagery},c.prototype.setBaseElevation=function(e){throw new SyntaxError("setBaseElevation Not implemented","AbstractGlobe.js")},c.prototype.getBaseElevation=function(){return this.tileManager.elevationProvider},c.prototype.addLayer=function(e){t.assert(null!=e,"layer must be an AbstractLayer object in addLayer for "+this.constructor.name,"AbstractGlobe.js");var i=this;e.isVectorLayer()?e.isForDataProvider()||e.isDraw()?(e.id=i.nbCreatedLayers,e._attach(i),i.refresh(),i.nbCreatedLayers++):t.requestUrl(e.getUrl(),"json","application/json",null,function(t){e.addFeatureCollection(t),e.id=i.nbCreatedLayers,e._attach(i),i.refresh(),i.nbCreatedLayers++,e.callback&&e.callback(t)},function(t){u.open(l.LEVEL.ERROR,"Failed to request "+e.getUrl(),t)}):(e.id||(e.id=this.nbCreatedLayers,this.nbCreatedLayers++),e._attach(i),this.refresh()),e.isBackground()?this.publishEvent(l.EVENT_MSG.LAYER_BACKGROUND_ADDED,e):this.publishEvent(l.EVENT_MSG.LAYER_ADDED,e)},c.prototype.removeLayer=function(e){t.assert(null!=e,"layer must be an AbstractLayer object in removeLayer for "+this.constructor.name,"AbstractGlobe.js"),e.background=!1,e._detach(),this.publishEvent(l.EVENT_MSG.LAYER_REMOVED,e)},c.prototype.addAnimation=function(e){t.assert(null!=e,"anim must be an AbstractAnimation object in addAnimation for "+this.constructor.name,"AbstractGlobe.js"),e.renderContext=this.renderContext},c.prototype.removeAnimation=function(e){t.assert(null!=e,"anim must be an AbstractAnimation object in removeAnimation for "+this.constructor.name,"AbstractGlobe.js"),e.renderContext=null},c.prototype.getElevation=function(e,t){throw new SyntaxError("getElevation Not implemented","AbstractGlobe.js")},c.prototype.getViewportGeoBound=function(e){var t=this.renderContext,i=mat4.create();mat4.inverse(t.viewMatrix,i);var r=[i[12],i[13],i[14]];mat4.multiply(t.projectionMatrix,t.viewMatrix,i),mat4.inverse(i);for(var s=[[-1,-1,1,1],[1,-1,1,1],[-1,1,1,1],[1,1,1,1]],a=[0,0,0],l=0;l<4;l++){mat4.multiplyVec4(i,s[l]),vec3.scale(s[l],1/s[l][3]),vec3.subtract(s[l],r,s[l]),vec3.normalize(s[l]);var u=new n(r,s[l]),c=u.sphereIntersect(a,this.coordinateSystem.getGeoide().getRadius());if(c<0)return null;var h=u.computePoint(c);s[l]=this.coordinateSystem.from3DToGeo(h),e&&(s[l]=e(s[l]))}var d=new o;return d.computeFromCoordinates(s),d},c.prototype.getLonLatFromPixel=function(e,i){if(t.assert("number"==typeof e&&"number"==typeof i,"(x,y) from getLonLatFromPixel must be numbers for "+this.constructor.name,"AbstractGlobe.js"),this.isPlanet()&&this.cachedPickingValue&&this.cachedPickingValue.x===e&&this.cachedPickingValue.y===i)return this.cachedPickingValue.lonLat;var r=n.createFromPixel(this.renderContext,e,i);const o=this.computeIntersection(r);return this.cachedPickingValue={x:e,y:i,lonLat:o},o},c.prototype.getPixelFromLonLat=function(e,i){t.assert("number"==typeof e&&"number"==typeof i,"(lon,lat) from getPixelFromLonLat must be numbers for "+this.constructor.name,"AbstractGlobe.js");var r=vec3.create();return this.coordinateSystem.get3DFromWorld([e,i],r),this.renderContext.getPixelFrom3D(r[0],r[1],r[2])},c.prototype.setCoordinateSystem=function(e){t.assert(null!=e,"coordinateSystem must be a Crs object in setCoordinateSystem for "+this.constructor.name,"AbstractGlobe.js");var i=this.coordinateSystem;this.coordinateSystem=e,this.dispose(),this.tileManager.tileConfig.coordinateSystem=e,(this.coordinateSystem.isFlat()&&this.coordinateSystem.getProjection().getName()===l.PROJECTION.Azimuth||i.isFlat()&&i.getProjection().getName()===l.PROJECTION.Azimuth)&&(this.tileManager.level0Tiles=this.tileManager.tiling.generateLevelZeroTiles(this.tileManager.tileConfig,this.tileManager.tilePool)),function(e){for(var t=e.postRenderers,i=t.length;i--;)if(t[i]instanceof r)for(var n=t[i].renderers,o=n.length;o--;){var s=n[o];if(s.levelZeroTiledGeometries&&s.levelZeroTiledGeometries.length>0)for(var a=s.levelZeroTiledGeometries,l=a.length;l--;){var u=a[l],c=s.maxTilePerGeometry>0?e.tiling.getOverlappedLevelZeroTiles(u):null;u._tileIndices=c}}}.call(this,this.getTileManager())},c.prototype.getCoordinateSystem=function(){return this.coordinateSystem},c.prototype.computeIntersection=function(e){var t;if(this.hasMesh()){t=Number.MAX_VALUE;for(var i=0;i<this.tileManager.level0Tiles.length;++i){const r=this.tileManager.level0Tiles[i].intersect(e,this.tileManager.tileIndexBuffer.indices,this.renderContext);r<t&&r>=0&&(t=r)}t===Number.MAX_VALUE&&(t=-1)}else t=function(e,t){return t.isFlat()?e.planeIntersect([0,0,0],[0,0,1]):e.sphereIntersect([0,0,0],t.getGeoide().getRadius())}.call(this,e,this.coordinateSystem);return function(e,t,i){if(t>=0){var r=i.getWorldFrom3D(e.computePoint(t)),n=i.getGeoBound();return!r||r[0]<n[0]||r[0]>n[2]||r[1]<n[1]||r[1]>n[3]||isNaN(r[0])||isNaN(r[1])?null:r}return null}.call(this,e,t,this.coordinateSystem)},c.prototype.getRenderStats=function(){return"# rendered tiles : "+this.tileManager.tilesToRender.length},c.prototype.getRenderContext=function(){return this.renderContext},c.prototype.setRenderContext=function(e){t.assert(null!=e,"context must be a Context object in setRenderContext for "+this.constructor.name,"AbstractGlobe.js"),this.renderContext=e},c.prototype.getTileManager=function(){return this.tileManager},c.prototype.getRendererManager=function(){return this.rendererManager},c.prototype.render=function(){throw new SyntaxError("render Not implemented","AbstractGlobe.js")},c.prototype.dispose=function(){this.tileManager.reset(),this.tileManager.tilePool.disposeAll()},c.prototype.destroy=function(){this.tileManager&&(this.dispose(),this.tileManager.removePostRenderer(this.rendererManager),this.tileManager=null,this.rendererManager=null),this.renderContext.renderers.splice(this.renderContext.renderers.indexOf(this),1),this.coordinateSystem&&(this.coordinateSystem.destroy(),this.coordinateSystem=null),this.refresh(),this.definedBackgound=null,this.type=null,this.publishEvent=null,this.isEnable=null,this.globe=null,this.continuousRendering=null,this.attributionHandler=null,this.baseImagery=null,this.preRenderers=null,this.nbCreatedLayers=null},c.prototype.refresh=function(){this.renderContext.requestFrame()},c.prototype.isEnabled=function(){return this.isEnable},c.prototype.enable=function(){this.isEnable=!0},c.prototype.disable=function(){this.isEnable=!1},c.prototype.hasMesh=function(){return!1},c.prototype.getSubdivisionLength=function(){return this.subdivisionLength},c.prototype.setSubdivisionLength=function(e){this.subdivisionLength=e},c.prototype.getMaxSubdivisionCount=function(){return this.maxSubdivisionCount},c.prototype.setMaxSubdivisionCount=function(e){this.maxSubdivisionCount=e},c}),r("gw/Globe/Planet",["../Tiling/Tile","../Utils/Event","../Utils/Utils","./AbstractGlobe","../Utils/Constants"],function(e,t,i,r,n){var o=function(e){r.prototype.constructor.call(this,n.GLOBE.Planet,e),this.manualRendererlayers=[]};return i.inherits(r,o),o.prototype.setBaseImagery=function(e){if(null==e)throw new RangeError("layer must be exist.","Planet.js");e!==this.baseImagery&&(this.baseImagery&&(this.tileManager.setImageryProvider(null),this.baseImagery=null),this.definedBackgound=!0,e.background=!0,e.visible=!0,e.isDetached()&&this.addLayer(e),this.tileManager.setImageryProvider(e),this.baseImagery=e,this.publishEvent(n.EVENT_MSG.LAYER_BACKGROUND_CHANGED,e))},o.prototype.setBaseElevation=function(e){this.tileManager.elevationProvider&&this.removeLayer(this.tileManager.elevationProvider),this.tileManager.setElevationProvider(e),e&&this.addLayer(e)},o.prototype.getElevation=function(t,i){var r=this.tileManager.tiling;this.baseImagery&&(r=this.baseImagery.tiling);var n=this.tileManager.level0Tiles[r.lonlat2LevelZeroIndex(t,i)];return e.State&&n&&n.state===e.State.LOADED?n.getElevation(t,i):0},o.prototype.render=function(){if(this.isEnabled()){if(!this.coordinateSystem.isFlat())for(var e=0;e<this.preRenderers.length;e++)this.preRenderers[e].preRender();this.tileManager.render()}this.cachedPickingValue=null},o.prototype.hasMesh=function(){return!0},o}),r("gw/Globe/Sky",["../Tiling/TileManager","../Tiling/TilePool","../Utils/Utils","./AbstractGlobe","../Utils/Constants"],function(e,t,i,r,n){var o=function(i){r.prototype.constructor.call(this,n.GLOBE.Sky,i),this.tilePool=new t(this.renderContext),this.tileManagers={Equatorial:this.tileManager,Galactic:new e(this,i)},this.renderContext.requestFrame()};return i.inherits(r,o),o.prototype.dispose=function(){for(var e in this.tileManagers)this.tileManagers.hasOwnProperty(e)&&(this.tileManagers[e].reset(),this.tileManagers[e].tilePool.disposeAll())},o.prototype.setBaseImagery=function(e){if(null==e)throw new RangeError("layer must be exist.","Sky.js");this.baseImagery!==e&&(this.baseImagery&&(this.tileManagers[this.baseImagery.tiling.coordinateSystem.getGeoideName()].setImageryProvider(null),this.baseImagery=null),e.loadOverview(),this.definedBackgound=!0,e.visible=!0,e.isDetached()&&this.addLayer(e),this.tileManagers[e.tiling.coordinateSystem.getGeoideName()].setImageryProvider(e),this.baseImagery=e,this.publishEvent(n.EVENT_MSG.LAYER_BACKGROUND_CHANGED,e))},o.prototype.render=function(){this.isEnabled()&&(this.tileManagers[n.CRS.Galactic].render(),this.tileManagers[n.CRS.Equatorial].render())},o.prototype.destroy=function(){r.prototype.destroy.call(this),this.tileManagers.Galactic.reset(),this.tileManagers.Galactic.tilePool.disposeAll(),this.tileManagers=null},o}),r("gw/Globe/GlobeFactory",["./Planet","./Sky","../Utils/Constants"],function(e,t,i){return{create:function(r,n){var o;switch(r){case i.GLOBE.Planet:o=new e(n);break;case i.GLOBE.Sky:o=new t(n);break;default:throw RangeError("The type "+r+" is not allowed, A valid type is included in the list GLOBE","GlobeFactory.js")}return o}}}),r("gw/Navigation/GoogleMouseNavigationHandler",["../Utils/Constants"],function(e){return function(t){var i=null,r=-1,n=-1,o=-1,s=!1,a=!1,l=0,u=0,c=null,h=null,d=0,p=function(t){var r,n,o;if(i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),r=void 0===t.wheelDelta?t.detail:-t.wheelDelta/120,i.inertia||(o=i.ctx.getRenderContext().getXYRelativeToCanvas(t),n=i.ctx.getLonLatFromPixel(o[0],o[1])),i.zoom(r),i.stopAnimations(),i.inertia)i.inertia.launch("zoom",r<0?-1:1);else if(n){var s=i.ctx.getPixelFromLonLat(n[0],n[1]),a=o[0]-s[0],l=Math.round(i.ctx.getRenderContext().getCanvas().width/i.ctx.getRenderContext().getCanvas().height);a*=l=l<1?1:l;var u=o[1]-s[1];i.pan(a,u)}return t.preventDefault&&t.preventDefault(),t.returnValue=!1,i.ctx.publish(e.EVENT_MSG.NAVIGATION_ENDED),i.ctx.getRenderContext().requestFrame(),!1},f=function(e){if(r=e.button,i.stopAnimations(),n=e.clientX,o=e.clientY,l=0,u=0,1===e.button)i.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto";else{var t=i.ctx.getRenderContext().getXYRelativeToCanvas(e);c=i.ctx.getLonLatFromPixel(t[0],t[1]),0===e.button?i.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAZUlEQVR42sSTQQrAMAgEHcn/v7w9tYgNNsGW7kkI2TgbRZJ15NbU+waAAFV11MiXz0yq2sxMEiVCDDcHLeky8nQAUDJnM88IuyGOGf/n3wjcQ1zhf+xgxSS+PkXY7aQ9yvy+jccAMs9AI/bwo38AAAAASUVORK5CYII=), auto":i.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABeUlEQVR42u2XS07DMBCGbaCCQstzy4YDcAGWCAE3YI3omsN0XcSaGxSEWHIBDsCGLY9SykM80m/CFLkhIBycVpVi6ZetUez/S2x5JtYMudkCYJQBbGJ+pBoIgMybQKUoijrW2hnGr+jNFyILQM+8jHkLc0Nv6OeIPflC+AJ8M++1rBA+AD+a/wfCB2Bczdtp5gmIqkK8hwSQt69gcNu3gJ6BRGyB7kG/QlAAOe3rSD5zFeO6cwj3ibVRC52hTmgA2YJJVUUgML5wAFbVXN78RRV0C+TZMVUZLWJ86QCsELsxn3v/oQp6CN02hZYwvnIAloldo2efhQqAAqAAGKl7IL4JpQDpWyA9F8iVHfwmjHMBZnd/yIbzJodcEGdDtInJ0S/1wA7DE5NDNozrATSLtjE7SKmI9hg20b3JoR74qogUYgvThnMIa8SOHfPgFVEaxAbmh5jvMj71Nc8CkISYRmvoHD36mmcFcCFKOhbDgf0XuHOH9mcUrHUBoVXvIfh2krcAAAAASUVORK5CYII=), auto"}return s=!0,!1},g=function(t){return r=-1,!i.inertia||0===l&&0===u||(0===t.button?h?i.inertia.launch("rotate",h,0):i.inertia.launch("pan",l,u):1===t.button&&i.inertia.launch("rotate",-l,-u)),i.ctx.getRenderContext().getCanvas().style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",c=null,d=0,a&&i.ctx.publish(e.EVENT_MSG.NAVIGATION_ENDED),s=!1,a=!1,!1},m=function(t){if(!(r<0)&&(l=t.clientX-n,u=t.clientY-o,0!==l||0!==u)){var p,f,g,m=!1;if(0===r)s&&(i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),s=!1,a=!0),f=i.ctx.getRenderContext().getXYRelativeToCanvas(t),c&&(h=null,(p=i.ctx.getLonLatFromPixel(f[0],f[1]))&&(g=i.ctx.getPixelFromLonLat(c[0],c[1]),l=f[0]-g[0],u=f[1]-g[1],i.pan(l,u))),c&&p||(h=Math.abs(l)>Math.abs(u)?f[1]>i.ctx.getRenderContext().getCanvas().height/2?-l:l:f[0]>i.ctx.getRenderContext().getCanvas().width/2?u:-u,i.rotate(h,0),f=i.ctx.getRenderContext().getXYRelativeToCanvas(t),(c=i.ctx.getLonLatFromPixel(f[0],f[1]))&&(h=null)),i.ctx.getRenderContext().requestFrame(),m=!0;else if(1===r)i.rotate(-l,-u),i.ctx.getRenderContext().requestFrame(),m=!0;else{if(++d%3==0&&d>1){if(i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),i.zoom(-u/10),u>0&&u>l&&c){f=[i.ctx.getRenderContext().getCanvas().clientLeft+i.ctx.getRenderContext().getCanvas().clientWidth/2,i.ctx.getRenderContext().getCanvas().clientTop+i.ctx.getRenderContext().getCanvas().clientHeight/2],g=i.ctx.getPixelFromLonLat(c[0],c[1]);var v=f[0]-g[0];v=10*v/100;var y=f[1]-g[1];y=10*y/100,i.pan(v,y)}i.stopAnimations(),i.ctx.publish(e.EVENT_MSG.NAVIGATION_ENDED),i.ctx.getRenderContext().requestFrame()}m=!0}return n=t.clientX,o=t.clientY,m}},v=function(e){if(0===e.button){var t=i.ctx.getRenderContext().getXYRelativeToCanvas(e),r=i.ctx.getLonLatFromPixel(t[0],t[1]);r&&i.zoomTo(r)}},y=function(e){return e.preventDefault(),!1};this.install=function(e){var t=(i=e).getRenderContext.getCanvas;t.style.cursor="url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKTWlDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVN3WJP3Fj7f92UPVkLY8LGXbIEAIiOsCMgQWaIQkgBhhBASQMWFiApWFBURnEhVxILVCkidiOKgKLhnQYqIWotVXDjuH9yntX167+3t+9f7vOec5/zOec8PgBESJpHmomoAOVKFPDrYH49PSMTJvYACFUjgBCAQ5svCZwXFAADwA3l4fnSwP/wBr28AAgBw1S4kEsfh/4O6UCZXACCRAOAiEucLAZBSAMguVMgUAMgYALBTs2QKAJQAAGx5fEIiAKoNAOz0ST4FANipk9wXANiiHKkIAI0BAJkoRyQCQLsAYFWBUiwCwMIAoKxAIi4EwK4BgFm2MkcCgL0FAHaOWJAPQGAAgJlCLMwAIDgCAEMeE80DIEwDoDDSv+CpX3CFuEgBAMDLlc2XS9IzFLiV0Bp38vDg4iHiwmyxQmEXKRBmCeQinJebIxNI5wNMzgwAABr50cH+OD+Q5+bk4eZm52zv9MWi/mvwbyI+IfHf/ryMAgQAEE7P79pf5eXWA3DHAbB1v2upWwDaVgBo3/ldM9sJoFoK0Hr5i3k4/EAenqFQyDwdHAoLC+0lYqG9MOOLPv8z4W/gi372/EAe/tt68ABxmkCZrcCjg/1xYW52rlKO58sEQjFu9+cj/seFf/2OKdHiNLFcLBWK8ViJuFAiTcd5uVKRRCHJleIS6X8y8R+W/QmTdw0ArIZPwE62B7XLbMB+7gECiw5Y0nYAQH7zLYwaC5EAEGc0Mnn3AACTv/mPQCsBAM2XpOMAALzoGFyolBdMxggAAESggSqwQQcMwRSswA6cwR28wBcCYQZEQAwkwDwQQgbkgBwKoRiWQRlUwDrYBLWwAxqgEZrhELTBMTgN5+ASXIHrcBcGYBiewhi8hgkEQcgIE2EhOogRYo7YIs4IF5mOBCJhSDSSgKQg6YgUUSLFyHKkAqlCapFdSCPyLXIUOY1cQPqQ28ggMor8irxHMZSBslED1AJ1QLmoHxqKxqBz0XQ0D12AlqJr0Rq0Hj2AtqKn0UvodXQAfYqOY4DRMQ5mjNlhXIyHRWCJWBomxxZj5Vg1Vo81Yx1YN3YVG8CeYe8IJAKLgBPsCF6EEMJsgpCQR1hMWEOoJewjtBK6CFcJg4Qxwicik6hPtCV6EvnEeGI6sZBYRqwm7iEeIZ4lXicOE1+TSCQOyZLkTgohJZAySQtJa0jbSC2kU6Q+0hBpnEwm65Btyd7kCLKArCCXkbeQD5BPkvvJw+S3FDrFiOJMCaIkUqSUEko1ZT/lBKWfMkKZoKpRzame1AiqiDqfWkltoHZQL1OHqRM0dZolzZsWQ8ukLaPV0JppZ2n3aC/pdLoJ3YMeRZfQl9Jr6Afp5+mD9HcMDYYNg8dIYigZaxl7GacYtxkvmUymBdOXmchUMNcyG5lnmA+Yb1VYKvYqfBWRyhKVOpVWlX6V56pUVXNVP9V5qgtUq1UPq15WfaZGVbNQ46kJ1Bar1akdVbupNq7OUndSj1DPUV+jvl/9gvpjDbKGhUaghkijVGO3xhmNIRbGMmXxWELWclYD6yxrmE1iW7L57Ex2Bfsbdi97TFNDc6pmrGaRZp3mcc0BDsax4PA52ZxKziHODc57LQMtPy2x1mqtZq1+rTfaetq+2mLtcu0W7eva73VwnUCdLJ31Om0693UJuja6UbqFutt1z+o+02PreekJ9cr1Dund0Uf1bfSj9Rfq79bv0R83MDQINpAZbDE4Y/DMkGPoa5hpuNHwhOGoEctoupHEaKPRSaMnuCbuh2fjNXgXPmasbxxirDTeZdxrPGFiaTLbpMSkxeS+Kc2Ua5pmutG003TMzMgs3KzYrMnsjjnVnGueYb7ZvNv8jYWlRZzFSos2i8eW2pZ8ywWWTZb3rJhWPlZ5VvVW16xJ1lzrLOtt1ldsUBtXmwybOpvLtqitm63Edptt3xTiFI8p0in1U27aMez87ArsmuwG7Tn2YfYl9m32zx3MHBId1jt0O3xydHXMdmxwvOuk4TTDqcSpw+lXZxtnoXOd8zUXpkuQyxKXdpcXU22niqdun3rLleUa7rrStdP1o5u7m9yt2W3U3cw9xX2r+00umxvJXcM970H08PdY4nHM452nm6fC85DnL152Xlle+70eT7OcJp7WMG3I28Rb4L3Le2A6Pj1l+s7pAz7GPgKfep+Hvqa+It89viN+1n6Zfgf8nvs7+sv9j/i/4XnyFvFOBWABwQHlAb2BGoGzA2sDHwSZBKUHNQWNBbsGLww+FUIMCQ1ZH3KTb8AX8hv5YzPcZyya0RXKCJ0VWhv6MMwmTB7WEY6GzwjfEH5vpvlM6cy2CIjgR2yIuB9pGZkX+X0UKSoyqi7qUbRTdHF09yzWrORZ+2e9jvGPqYy5O9tqtnJ2Z6xqbFJsY+ybuIC4qriBeIf4RfGXEnQTJAntieTE2MQ9ieNzAudsmjOc5JpUlnRjruXcorkX5unOy553PFk1WZB8OIWYEpeyP+WDIEJQLxhP5aduTR0T8oSbhU9FvqKNolGxt7hKPJLmnVaV9jjdO31D+miGT0Z1xjMJT1IreZEZkrkj801WRNberM/ZcdktOZSclJyjUg1plrQr1zC3KLdPZisrkw3keeZtyhuTh8r35CP5c/PbFWyFTNGjtFKuUA4WTC+oK3hbGFt4uEi9SFrUM99m/ur5IwuCFny9kLBQuLCz2Lh4WfHgIr9FuxYji1MXdy4xXVK6ZHhp8NJ9y2jLspb9UOJYUlXyannc8o5Sg9KlpUMrglc0lamUycturvRauWMVYZVkVe9ql9VbVn8qF5VfrHCsqK74sEa45uJXTl/VfPV5bdra3kq3yu3rSOuk626s91m/r0q9akHV0IbwDa0b8Y3lG19tSt50oXpq9Y7NtM3KzQM1YTXtW8y2rNvyoTaj9nqdf13LVv2tq7e+2Sba1r/dd3vzDoMdFTve75TsvLUreFdrvUV99W7S7oLdjxpiG7q/5n7duEd3T8Wej3ulewf2Re/ranRvbNyvv7+yCW1SNo0eSDpw5ZuAb9qb7Zp3tXBaKg7CQeXBJ9+mfHvjUOihzsPcw83fmX+39QjrSHkr0jq/dawto22gPaG97+iMo50dXh1Hvrf/fu8x42N1xzWPV56gnSg98fnkgpPjp2Snnp1OPz3Umdx590z8mWtdUV29Z0PPnj8XdO5Mt1/3yfPe549d8Lxw9CL3Ytslt0utPa49R35w/eFIr1tv62X3y+1XPK509E3rO9Hv03/6asDVc9f41y5dn3m978bsG7duJt0cuCW69fh29u0XdwruTNxdeo94r/y+2v3qB/oP6n+0/rFlwG3g+GDAYM/DWQ/vDgmHnv6U/9OH4dJHzEfVI0YjjY+dHx8bDRq98mTOk+GnsqcTz8p+Vv9563Or59/94vtLz1j82PAL+YvPv655qfNy76uprzrHI8cfvM55PfGm/K3O233vuO+638e9H5ko/ED+UPPR+mPHp9BP9z7nfP78L/eE8/sl0p8zAAAABGdBTUEAALGOfPtRkwAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAjElEQVR42pyRQRLAIAwCoePD8vT8jB7aONHRVuWagBuku2MmMxMAuDtnO2VmMDNJAgCQVOz0YSWbR4ZQnuWQC4cK2pLRSEoSJIHkp/nd0RFBnFMJUnkgiaAYGXrxmdeCfg2NmWxLXDWG2d15veUdhdRv7EO2A3YV+E3AKUVDsBKSXx+esEvC3dZ73QMAeuphLLn/cTIAAAAASUVORK5CYII=), auto",t.addEventListener("mousedown",f),t.addEventListener("mouseup",g),t.addEventListener("mousemove",m),t.addEventListener("contextmenu",y),t.addEventListener("dblclick",v),t.addEventListener("DOMMouseScroll",p),t.addEventListener("mousewheel",p)},this.uninstall=function(){var e=i.getRenderContext().getCanvas();e.style.cursor="auto",e.removeEventListener("mousedown",f),e.removeEventListener("mouseup",g),e.removeEventListener("mousemove",m),e.removeEventListener("contextmenu",y),e.removeEventListener("dblclick",v),e.removeEventListener("DOMMouseScroll",p),e.removeEventListener("mousewheel",p)}}}),r("gw/Navigation/KeyboardNavigationHandler",["../Utils/Constants"],function(e){return function(t){var i=null,r=this;this.panFactor=10,this.zoomFactor=1,t&&(t.panFactor&&"number"==typeof t.panFactor&&(this.panFactor=t.panFactor),t.zoomFactor&&"number"==typeof t.zoomFactor&&(this.zoomFactor=t.zoomFactor));var n=function(e){return this.focus(),!1},o=function(t){switch(t.keyCode){case 32:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),i.stopAnimations();break;case 187:case 61:case 107:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),i.zoom(-r.zoomFactor);break;case 189:case 54:case 109:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),i.zoom(r.zoomFactor);break;case 81:case 37:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),t.shiftKey?i.rotate(r.panFactor,0):i.pan(r.panFactor,0);break;case 90:case 38:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),t.shiftKey?i.rotate(0,r.panFactor):i.pan(0,r.panFactor);break;case 68:case 39:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),t.shiftKey?i.rotate(-r.panFactor,0):i.pan(-r.panFactor,0);break;case 83:case 40:i.ctx.publish(e.EVENT_MSG.NAVIGATION_STARTED),t.shiftKey?i.rotate(0,-r.panFactor):i.pan(0,-r.panFactor)}},s=function(e){i.donePanning(),i.doneRotating()};this.install=function(e){if(i=e,t&&t.installOnDocument)document.addEventListener("keydown",o),document.addEventListener("keyup",s);else{var r=i.renderContext.canvas;r.addEventListener("keydown",o),r.addEventListener("keyup",s),r.tabIndex="0",r.addEventListener("mousedown",n)}},this.uninstall=function(){if(t&&t.installOnDocument)document.removeEventListener("keydown",o),document.removeEventListener("keyup",s);else{var e=i.renderContext.canvas;e.removeEventListener("keydown",o),e.removeEventListener("keyup",s),e.removeEventListener("mousedown",n)}}}}),r("gw/Navigation/MouseNavigationHandler",["../Utils/Utils","../Utils/Constants"],function(e,t){return function(i){var r=null,n=-1,o=-1,s=-1,a=0,l=0,u=i&&i.panButton||0,c=i&&i.rotateButton||1,h=i&&i.zoomOptions?i.zoomOptions:{},d=function(e){var i;return i=void 0===e.wheelDelta?e.detail:-e.wheelDelta/120,r.ctx.publish(t.EVENT_MSG.NAVIGATION_STARTED),r.zoom(i,null,e.clientX,e.clientY),r.stopAnimations(),r.inertia&&r.inertia.launch("zoom",i<0?-1:1),e.returnValue=!1,!1},p=function(e){return document.addEventListener("mouseup",f),n=e.button,r.stopAnimations(),e.button!==u&&e.button!==c||(o=e.clientX,s=e.clientY,a=0,l=0,r.ctx.publish(t.EVENT_MSG.NAVIGATION_STARTED),r.startInteraction(o,s),!1)},f=function(e){return n=-1,document.removeEventListener("mouseup",f),!r.inertia||0===a&&0===l||(e.button===u&&r.inertia.launch("pan",a,l),e.button===c&&r.inertia.launch("rotate",a,l)),e.button===u&&r.donePanning(),e.button===c&&r.doneRotating(),r.ctx.publish(t.EVENT_MSG.NAVIGATION_ENDED),e.button!==u&&e.button!==c||(e.preventDefault(),!1)},g=function(e){if(!(n<0)&&(a=e.clientX-o,l=e.clientY-s,0!==a||0!==l)){var t=!1;return n===u?(r.pan(a,l,e.clientX,e.clientY),t=!0):n===c&&(r.rotate(a,l),t=!0),o=e.clientX,s=e.clientY,t}},m=function(e){var t,i;0===e.button&&(t=r.ctx.getRenderContext().getXYRelativeToCanvas(e),(i=r.ctx.getLonLatFromPixel(t[0],t[1]))&&r.zoomTo(i,h))};this.install=function(t){var n=(r=t).renderContext.canvas,o=e.isPassiveSupported();n.addEventListener("mousedown",p),n.addEventListener("mousemove",g),i&&i.zoomOnDblClick&&n.addEventListener("dblclick",m),n.addEventListener("DOMMouseScroll",d,!!o&&{passive:!0}),n.addEventListener("mousewheel",d,!!o&&{passive:!0}),n.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),2===c&&n.addEventListener("contextmenu",function(e){return e.preventDefault(),!1},!1)},this.uninstall=function(){var e=r.renderContext.canvas;e.removeEventListener("mousedown",p),e.removeEventListener("mousemove",g),i&&i.zoomOnDblClick&&e.removeEventListener("dblclick",m),e.removeEventListener("DOMMouseScroll",d),e.removeEventListener("mousewheel",d)}}}),r("gw/Navigation/TouchNavigationHandler",["../Utils/Utils","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i){var r=0,n=1,o=2,s=3;return function(a){var l,u,c,h,d,p,f,g=null,m=[],v=[0,0,0,0],y=!(!a||!a.hasOwnProperty("inversed"))&&a.inversed,b=function(e,t){var i=t.clientY-e.clientY,r=t.clientX-e.clientX;return 180*Math.atan2(i,r)/Math.PI},x=function(e,t){return e.length>=2&&t.length>=2?b(t[1],t[0])-b(e[1],e[0]):0},w=function(e){if(u=e.touches,m=e.touches,v=[0,0,0,0],g.ctx.publish(t.EVENT_MSG.NAVIGATION_STARTED),g.startInteraction(e.touches[0].clientX,e.touches[0].clientY),g.stopAnimations(),h=0,d=0,2===e.touches.length){var r=e.touches[0].clientX-e.touches[1].clientX,n=e.touches[0].clientY-e.touches[1].clientY;l=Math.sqrt(r*r+n*n),i.open(t.LEVEL.DEBUG,"TouchNavigationHandler.js","Finger distance : "+l),c=x(m,e.touches)}return e.returnValue=!1,!1},T=function(e){var t,i,a,p,b,w;return h=e.touches[0].clientX-u[0].clientX,d=e.touches[0].clientY-u[0].clientY,1===e.touches.length?(g.pan(h,d),v[r]++):((e.touches[0].clientY-u[0].clientY)*(e.touches[1].clientY-u[1].clientY)>0?(g.rotate(0,-d),v[o]++):(t=(a=x(m,e.touches))-c,c=a,y&&(t*=-1),f=10*t,g.rotate(f,0),v[n]++),t=e.touches[0].clientX-e.touches[1].clientX,i=e.touches[0].clientY-e.touches[1].clientY,b=(p=Math.sqrt(t*t+i*i))-l,w=y?p/l:l/p,0!==l&&(g.zoom(.025*b,w),v[s]++),g.getRenderContext().requestFrame(),l=p),u=e.touches,e.returnValue=!1,!1},_=function(e){if(a&&a.zoomOnDblClick&&0===e.touches.length&&0===h&&0===d){var s=Date.now();if(s-p<300){var l=g.ctx.getLonLatFromPixel(u[0].clientX,u[0].clientY);l&&g.zoomTo(l)}p=s}if(u=e.touches,g.inertia&&(0!==h||0!==d)){var c=v.indexOf(Math.max.apply(this,v));c===r?g.inertia.launch("pan",h,d):c===n?i.open(t.LEVEL.DEBUG,"TouchNavigationHandler.js","Rotate not implemented in navigation"):c===o&&i.open(t.LEVEL.DEBUG,"TouchNavigationHandler.js","Tilt not implemented in navigation")}return e.preventDefault&&e.preventDefault(),e.returnValue=!1,g.ctx.publish(t.EVENT_MSG.NAVIGATION_ENDED),!1};this.install=function(t){var i=(g=t).renderContext.canvas,r=e.isPassiveSupported();i.addEventListener("touchstart",w,!!r&&{passive:!0}),i.addEventListener("touchend",_,!1),i.addEventListener("touchmove",T,!!r&&{passive:!0})},this.uninstall=function(){var e=g.renderContext.canvas;e.removeEventListener("touchstart",w,!1),e.removeEventListener("touchend",_,!1),e.removeEventListener("touchmove",T,!1)}}}),r("gw/Navigation/NavigationHandlerFactory",["../Utils/Constants","./GoogleMouseNavigationHandler","./KeyboardNavigationHandler","./MouseNavigationHandler","./TouchNavigationHandler"],function(e,t,i,r,n){return{create:function(o,s){var a;switch(o){case e.HANDLER.GoogleMouse:a=new t(s);break;case e.HANDLER.Keyboard:a=new i(s);break;case e.HANDLER.Mouse:a=new r(s);break;case e.HANDLER.Touch:a=new n(s);break;default:throw RangeError("The type "+o+" is not allowed, A valid type is included in the list Constants.HANDLER","NavigationHandlerFactory.js")}return a}}}),r("gw/Animation/AbstractAnimation",[],function(){var e=function(){this.startTime=-1,this.pauseTime=-1,this.renderContext=null};return e.prototype.getRenderContext=function(){return this.renderContext},e.prototype._unregisterActive=function(){var e=this.renderContext.activeAnimations.indexOf(this);e>=0&&this.renderContext.activeAnimations.splice(e,1)},e.prototype.getStatus=function(){return-1===this.startTime?"STOPPED":-1===this.pauseTime?"RUNNING":"PAUSED"},e.prototype.start=function(){if(this.renderContext&&(-1===this.startTime||-1!==this.pauseTime)){var e=Date.now();-1===this.startTime?this.startTime=e:(this.startTime+=e-this.pauseTime,this.pauseTime=-1),this.renderContext.activeAnimations.push(this),this.renderContext.requestFrame()}},e.prototype.pause=function(){this.renderContext&&-1!==this.startTime&&-1===this.pauseTime&&(this.pauseTime=Date.now(),this._unregisterActive(this))},e.prototype.stop=function(){this.startTime=-1,this.pauseTime=-1,this.onstop&&this.onstop(),this._unregisterActive(this)},e}),r("gw/Animation/SegmentedAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric"],function(e,t,i){var r=function(i){e.assert("number"==typeof i.duration&&"function"==typeof i.valueSetter,"Missing required parameters in constructor","SegmentedAnimation.js"),t.prototype.constructor.call(this),this.segments=[],this.duration=i.duration,this.valueSetter=i.valueSetter};e.inherits(t,r);return r.prototype.addSegment=function(e,t,i,r,n){for(var o=this.segments.length,s=0;s<o&&this.segments[s].end<=e;)s++;this.segments.splice(s,0,new function(e,t,i,r,n){this.start=e,this.startValue=t,this.end=i,this.endValue=r,this.interpolator=n}(e,t,i,r,n))},r.prototype.update=function(e){var t=i.map01(e,this.startTime,this.startTime+this.duration);if(t>=1){var r=this.segments.length-1;this.valueSetter(this.segments[r].endValue),this.stop()}else{for(var n=this.segments.length,o=0;o<n&&this.segments[o].end<t;)o++;o=Math.min(o,n-1),t=i.map01(t,this.segments[o].start,this.segments[o].end);var s=this.segments[o].interpolator(t,this.segments[o].startValue,this.segments[o].endValue);this.valueSetter(s)}},r}),r("gw/Animation/PathAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric","../Renderer/glMatrix"],function(e,t,i){var r=function(i){var r,n,o,s,a,l,u,c;for(e.assert(Array.isArray(i.coords)&&"number"==typeof i.speed&&"function"==typeof i.setter&&null!=i.globe,"Missing required arguments in constructor","PathAnimation.js"),t.prototype.constructor.call(this),this.globe=i.globe,this.speed=i.speed*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3,this.nodes=[],r=0;r<i.coords.length;r++)u={position:this.globe.getCoordinateSystem().get3DFromWorld(i.coords[r]),velocity:null,distance:0},this.nodes.push(u),r>0&&(s=this.nodes[r].position[0]-this.nodes[r-1].position[0],a=this.nodes[r].position[1]-this.nodes[r-1].position[1],l=this.nodes[r].position[2]-this.nodes[r-1].position[2],this.nodes[r-1].distance=Math.sqrt(s*s+a*a+l*l));for(r=1;r<i.coords.length-1;r++)n=vec3.subtract(this.nodes[r+1].position,this.nodes[r].position,vec3.create()),o=vec3.subtract(this.nodes[r-1].position,this.nodes[r].position,vec3.create()),vec3.normalize(n),vec3.normalize(o),this.nodes[r].velocity=vec3.subtract(n,o,vec3.create()),vec3.normalize(this.nodes[r].velocity);c=vec3.subtract(this.nodes[1].position,this.nodes[0].position,vec3.create()),vec3.scale(c,3/this.nodes[0].distance),this.nodes[0].velocity=vec3.subtract(c,this.nodes[1].velocity,vec3.create()),vec3.scale(this.nodes[0].velocity,.5),r=i.coords.length-1,c=vec3.subtract(this.nodes[r].position,this.nodes[r-1].position,vec3.create()),vec3.scale(c,3/this.nodes[r-1].distance),this.nodes[r].velocity=vec3.subtract(c,this.nodes[r-1].velocity,vec3.create()),vec3.scale(this.nodes[r].velocity,.5),this.index=0,this.currentDistance=0,this.previousTime=-1,this.centerOffset=-.2,this.altitudeOffset=1e3;var h=this;i.setter?this.valueSetter=i.setter:this.valueSetter=function(e,t){var r,n=vec3.normalize(e,vec3.create());if(i.globe){var o=i.globe.getCoordinateSystem().getWorldFrom3D(e);o[2]=i.globe.getElevation(o[0],o[1])+h.altitudeOffset,r=i.globe.getCoordinateSystem().get3DFromWorld(o)}else(r=e)[2]+=h.altitudeOffset;var s=vec3.normalize(t,vec3.create()),a=vec3.add(r,s,vec3.create());vec3.add(a,vec3.scale(n,h.centerOffset,vec3.create())),mat4.lookAt(r,a,n,h.renderContext.getViewMatrix())}};return e.inherits(t,r),r.prototype.setSpeed=function(e){this.speed=parseFloat(e)*this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3},r.prototype.getSpeed=function(){return this.speed/(this.globe.getCoordinateSystem().getGeoide().getHeightScale()/1e3)},r.prototype.setAltitudeOffset=function(e){this.altitudeOffset=parseFloat(e)},r.prototype.getAltitudeOffset=function(){return this.altitudeOffset},r.prototype.setDirectionAngle=function(e){this.centerOffset=Math.tan(parseFloat(e)*Math.PI/180)},r.prototype.start=function(){var e=-1;-1!==this.pauseTime&&(e=this.startTime),Animation.prototype.start.call(this),-1!==e?this.previousTime+=this.startTime-e:this.previousTime=-1},r.prototype.update=function(e){for(-1===this.previousTime?(this.index=0,this.currentDistance=0):this.currentDistance+=(e-this.previousTime)*this.speed,this.previousTime=e;this.currentDistance>=this.nodes[this.index].distance&&this.index<this.nodes.length-1;)this.currentDistance-=this.nodes[this.index].distance,this.index=this.index+1;if(this.index<this.nodes.length-1){var t=this.currentDistance/this.nodes[this.index].distance,r=this.nodes[this.index].position,n=this.nodes[this.index+1].position,o=vec3.scale(this.nodes[this.index].velocity,this.nodes[this.index].distance,vec3.create()),s=vec3.scale(this.nodes[this.index+1].velocity,this.nodes[this.index].distance,vec3.create()),a=i.cubicInterpolation(t,r,o,n,s),l=i.cubicInterpolationDerivative(t,r,o,n,s);this.valueSetter(a,l)}else this.index===this.nodes.length-1?this.valueSetter(this.nodes[this.index].position,this.nodes[this.index].velocity):this.stop()},r}),r("gw/Animation/InertiaAnimation",["../Utils/Utils","./AbstractAnimation"],function(e,t){var i=function(i){e.assert(null!=i.nav,"nav is required in constructor","InertiaAnimation.js"),t.prototype.constructor.call(this),i&&(this.panFactor=i.hasOwnProperty("panFactor")?i.panFactor:.95,this.rotateFactor=i.hasOwnProperty("rotateFactor")?i.rotateFactor:.95,this.zoomFactor=i.hasOwnProperty("zoomFactor")?i.zoomFactor:.5),this.type=null,this.dx=0,this.dy=0,this.navigation=i.nav,this.renderContext=i.nav.getRenderContext()};return e.inherits(t,i),i.prototype.update=function(e){var t=!1;switch(this.type){case"pan":this.navigation.pan(this.dx,this.dy),this.dx*=this.panFactor,this.dy*=this.panFactor,t=Math.abs(this.dx)<.1&&Math.abs(this.dy)<.1;break;case"rotate":this.navigation.rotate(this.dx,this.dy),this.dx*=this.rotateFactor,this.dy*=this.rotateFactor,t=Math.abs(this.dx)<.1&&Math.abs(this.dy)<.1;break;case"zoom":this.navigation.zoom(this.dx),this.dx*=this.zoomFactor,t=Math.abs(this.dx)<.1}this.navigation.getRenderContext().requestFrame(),t&&this.stop()},i.prototype.launch=function(e,t,i){this.type=e,this.dx=t,this.dy=i,this.start()},i}),r("gw/Animation/InterpolatedAnimation",["../Utils/Utils","./AbstractAnimation","../Utils/Numeric"],function(e,t,i){var r=function(i){e.assert("number"==typeof i.startValue&&"number"==typeof i.endValue&&"number"==typeof i.duration&&"function"==typeof i.interpolationFunction&&"function"==typeof i.setFunction,"Missing required arguments in constructor","InterpolatedAnimation.js"),t.prototype.constructor.call(this),this.values=[[0,i.startValue],[1,i.endValue]],this.duration=i.duration,this.interpolationFunction=i.interpolationFunction,this.setFunction=i.setFunction};return e.inherits(t,r),r.prototype.addValue=function(t,i){e.assert(t>=0&&t<=1,"t must be in [0,1] when using addValue method","InterpolatedAnimation.js"),e.assert("number"==typeof i,"value must be a number when using addValue method","InterpolatedAnimation.js");for(var r=this.values.length,n=0;n<r&&this.values[n][0]<t;)n++;this.values.splice(n,0,[t,i])},r.prototype.start=function(){Animation.prototype.start.call(this),this.setFunction(this.startValue)},r.prototype.stop=function(){Animation.prototype.stop.call(this),this.setFunction(this.endValue)},r.prototype.update=function(e){var t=i.map01(e,this.startTime,this.startTime+this.duration);if(t>=1)this.stop();else{for(var r=this.values.length,n=0;n<r&&this.values[n][0]<t;)n++;n=Math.min(n,r-1);var o=Math.max(0,n-1);t=i.map01(t,this.values[o][0],this.values[n][0]);var s=this.interpolationFunction(t,this.values[o][1],this.values[n][1]);this.setFunction(s)}},r}),r("gw/Animation/AnimationFactory",["../Utils/Constants","./SegmentedAnimation","./PathAnimation","./InertiaAnimation","./InterpolatedAnimation"],function(e,t,i,r,n){return{create:function(o,s){var a;switch(o){case e.ANIMATION.Inertia:a=new r(s);break;case e.ANIMATION.Interpolated:a=new n(s);break;case e.ANIMATION.Path:a=new i(s);break;case e.ANIMATION.Segmented:a=new t(s);break;default:throw RangeError("The type "+o+" is not allowed, A valid type is included in the list Constants.ANIMATION","AnimationFactory.js")}return a}}}),r("gw/Navigation/AbstractNavigation",["../Utils/Utils","../Utils/Event","../Navigation/NavigationHandlerFactory","../Animation/AnimationFactory","../Utils/Numeric","../Utils/Constants","../Renderer/glMatrix"],function(e,t,i,r,n,o){var s=function(e,n,s){t.prototype.constructor.call(this),this.type=e,this.ctx=n,this.renderContext=this.ctx.getRenderContext(),this.renderContext.cameraUpdateFunction=this.update.bind(this),this.options=s||{},this.options.isMobile=n.getMizarConfiguration().isMobile,!0===this.options.isMobile&&this.initTouchNavigation(),this.handlers=function(e){var t;t=e.handlers?e.handlers:function(e){var t=[i.create(o.HANDLER.Mouse,e?e.mouse:null),i.create(o.HANDLER.Keyboard,e?e.keyboard:null)];e.isMobile&&t.push(i.create(o.HANDLER.Touch,e?e.touch:null));return t}.call(this,e);return t}.call(this,this.options),this.inertia=function(e){var t;if(e.inertia){var i=e.inertiaAnimation||{};i.nav=this,t=r.create(o.ANIMATION.Inertia,i);const n=this;t.onstop=function(){n.doneMoving()}}else t=null;return t}.call(this,this.options),this.zoomToAnimation=null,this.start()};return e.inherits(t,s),s.prototype.initTouchNavigation=function(){this.options.touch={inversed:this.ctx.globe.isSky(),zoomOnDblClick:!0};var e=this;window.addEventListener("orientationchange",function(){e.ctx.refresh()},!1)},s.prototype.getType=function(){return this.type},s.prototype.getOptions=function(){return this.options},s.prototype.start=function(){for(var e=0;e<this.handlers.length;e++)this.handlers[e].install(this)},s.prototype.stop=function(){for(var e=0;e<this.handlers.length;e++)this.handlers[e].uninstall()},s.prototype.stopAnimations=function(){this.inertia&&this.inertia.stop(),this.zoomToAnimation&&(this.zoomToAnimation.stop(),this.zoomToAnimation=null)},s.prototype.getFov=function(){return[this.renderContext.getFov(),this.renderContext.getFov()]},s.prototype.moveUpTo=function(e,t){throw new SyntaxError("moveUpTo not implemented","AbstractNavigation.js")},s.prototype.getCenter=function(){return this.ctx.getLonLatFromPixel(.5*this.renderContext.getCanvas().width,.5*this.renderContext.getCanvas().height)},s.prototype.rotate=function(e,t){throw new SyntaxError("rotate is not implemented","AbstractNavigation.js")},s.prototype.pan=function(e,t){throw new SyntaxError("pan is not implemented","AbstractNavigation.js")},s.prototype.zoom=function(e,t){throw new SyntaxError("zoom is not implemented","AbstractNavigation.js")},s.prototype.zoomTo=function(e,t){throw new SyntaxError("zoomTo is not implemented","AbstractNavigation.js")},s.prototype.computeViewMatrix=function(){throw new SyntaxError("computeViewMatrix not implemented","AbstractNavigation.js")},s.prototype.toViewMatrix=function(e,t,i,s){var a=this,l=this.renderContext.getViewMatrix(),u=mat4.toMat3(l),c=quat4.fromRotationMatrix(u),h=mat4.toMat3(e),d=quat4.fromRotationMatrix(h),p=t||45;i=i||1e3;var f=[c,[l[12],l[13],l[14]],a.getRenderContext().getFov()],g=[d,[e[12],e[13],e[14]],p],m=r.create(o.ANIMATION.Segmented,{duration:i,valueSetter:function(e){var t=quat4.toMat4(e[0]),i=mat4.transpose(t);i[12]=e[1][0],i[13]=e[1][1],i[14]=e[1][2],a.renderContext.setViewMatrix(i),a.renderContext.setFov(e[2]),a.renderContext.requestFrame()}});m.addSegment(0,f,1,g,function(e,t,i){var r=n.easeOutQuad(e),o=quat4.create();quat4.slerp(t[0],i[0],r,o);var s=vec3.create();return vec3.lerp(t[1],i[1],r,s),[o,s,n.lerp(r,t[2],i[2])]}),m.onstop=function(){s&&s()},this.ctx.addAnimation(m),m.start()},s.prototype.getRenderContext=function(){return this.renderContext},s.prototype.setRenderContext=function(e){this.renderContext=e},s.prototype.destroy=function(){this.renderContext.cameraUpdateFunction=null,this.type=null,this.options=null,this.zoomToAnimation=null,this.stop(),this.ctx=null,this.renderContext=null},s.prototype.update=function(){},s.prototype.doneMoving=function(){this.donePanning(),this.doneRotating()},s.prototype.donePanning=function(){},s.prototype.doneRotating=function(){},s.prototype.startInteraction=function(e,t){},s}),r("gw/Navigation/PlanetNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Gui/dialog/ErrorDialog","../Renderer/glMatrix"],function(e,t,i,r,n,o,s){var a=function(e,r){i.prototype.constructor.call(this,t.NAVIGATION.PlanetNavigation,e,r),Object.defineProperties(this,{scale:{get:function(){return this.ctx.getCoordinateSystem().getGeoide().getHeightScale()}},distance:{get:function(){return this._distance*this.scale},set:function(e){const t=e/this.scale;this._distance=t}},targetHeight:{get:function(){return this.ctx.getElevation(this.geoCenter[0],this.geoCenter[1])}},cameraHeight:{get:function(){const e=(90-this.tilt)*Math.PI/180;return Math.cos(e)*this._distance+this.targetHeight}},eye:{get:function(){return[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]]}},geoEye:{get:function(){return this.ctx.getCoordinateSystem().from3DToGeo(this.eye)}}});const n=this.ctx.getCoordinateSystem().getGeoide(),o=this.options.minDistance||50,s=this.options.maxDistance||3*n.getRealPlanetRadius();this.minDistance=o*n.getHeightScale(),this.maxDistance=s*n.getHeightScale(),this.geoCenter=[0,0,0],this.heading=0,this.tilt=90,this._distance=Number.NaN,this.offset=0,this.up=[0,0,1],this.inverseViewMatrix=mat4.create(),this.lastMousePosition=null;var a=!this.options.hasOwnProperty("updateViewMatrix")||this.options.updateViewMatrix;(function(e){e&&(this.geoCenter[0]=e[0],this.geoCenter[1]=e[1],this.distance=3===e.length?e[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance))}).call(this,this.options.initTarget),a&&this.computeViewMatrix()};return e.inherits(i,a),a.prototype.getCenter=function(){var e=i.prototype.getCenter.call(this);return null==e&&(e=this.geoCenter),e},a.prototype.save=function(){return{geoCenter:this.geoCenter,heading:this.heading,tilt:this.tilt,distance:this.distance}},a.prototype.restore=function(e){this.geoCenter=e.geoCenter,this.heading=e.heading,this.tilt=e.tilt,this.distance=e.distance,this.computeViewMatrix()},a.prototype.zoomTo=function(e,i){var o=this,s=i&&i.hasOwnProperty("distance")?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),a=i&&i.hasOwnProperty("duration")?i.duration:5e3,l=i&&i.hasOwnProperty("tilt")?i.tilt:this.tilt,u=i&&i.hasOwnProperty("heading")?i.heading:this.heading,c=n.shortestPath180(this.geoCenter[0],e[0]),h=n.shortestPath180(this.heading,u),d=[c[0],this.geoCenter[1],this.distance,this.tilt,h[0]],p=[c[1],e[1],s*this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),l,h[1]];this.zoomToAnimation=new r.create(t.ANIMATION.Segmented,{duration:a,valueSetter:function(e){o.geoCenter[0]=e[0]>180?e[0]-360:e[0],o.geoCenter[1]=e[1],o.distance=e[2],o.tilt=e[3],o.heading=e[4]>180?e[4]-360:e[4],o.computeViewMatrix()}});var f=this.ctx.getCoordinateSystem().get3DFromWorld(this.geoCenter),g=this.ctx.getCoordinateSystem().get3DFromWorld(e),m=vec3.subtract(f,g),v=vec3.length(m),y=this.ctx.getRenderContext().canvas,b=Math.min(n.toRadian(45),n.toRadian(45*y.width/y.height)),x=.5*v/Math.tan(.5*b);if(x>this.distance){var w=[.5*(d[0]+p[0]),.5*(d[1]+p[1]),x,.5*(d[3]+d[3]),.5*(d[4]+d[4])];this.zoomToAnimation.addSegment(0,d,.5,w,function(e,t,i){var r=n.easeInQuad(e),o=n.easeOutQuad(e),s=n.easeOutQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2]),n.lerp(e,t[3],i[3]),n.lerp(s,t[4],i[4])]}),this.zoomToAnimation.addSegment(.5,w,1,p,function(e,t,i){var r=n.easeOutQuad(e),o=n.easeInQuad(e),s=n.easeInQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2]),n.lerp(e,t[3],i[3]),n.lerp(s,t[4],i[4])]})}else this.zoomToAnimation.addSegment(0,d,1,p,function(e,t,i){var r=n.easeOutQuad(e),o=n.easeInQuad(e),s=n.easeInQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2]),n.lerp(e,t[3],i[3]),n.lerp(s,t[4],i[4])]});var T=this;this.zoomToAnimation.onstop=function(){i&&i.callback&&i.callback(),T.zoomToAnimation=null,T.ctx.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,s),T.updateGeoCenter()},this.ctx.addAnimation(this.zoomToAnimation),this.zoomToAnimation.start()},a.prototype.applyLocalRotation=function(e){mat4.rotate(e,n.toRadian(this.heading),[0,0,1]),mat4.rotate(e,n.toRadian(90-this.tilt),[1,0,0])},a.prototype.computeViewMatrix=function(){Array.from(this.renderContext.getViewMatrix());this.computeInverseViewMatrix(),mat4.inverse(this.inverseViewMatrix,this.renderContext.getViewMatrix()),this.ctx.publish(t.EVENT_MSG.NAVIGATION_MODIFIED),this.renderContext.requestFrame()},a.prototype.computeInverseViewMatrix=function(){this.ctx.getCoordinateSystem().getLHVTransform(this.geoCenter,this.inverseViewMatrix),this.applyLocalRotation(this.inverseViewMatrix),mat4.translate(this.inverseViewMatrix,[0,0,this.distance])},a.prototype.zoom=function(e,t,i,r){const n=this.distance;if(t?this.distance*=t:this._distance*=1+.1*e,this.distance=Math.max(Math.min(this.distance,this.maxDistance),this.minDistance),i&&r){this.computeInverseViewMatrix();const e=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],t=vec3.create();this.ctx.getCoordinateSystem().fromGeoTo3D(this.geoCenter,t);const a=vec3.create();vec3.subtract(t,e,a),vec3.normalize(a);const l=vec3.create(),u=this.ctx.globe.getLonLatFromPixel(i,r);this.ctx.getCoordinateSystem().fromGeoTo3D(u,l);const c=vec3.create();vec3.subtract(l,e,c),vec3.normalize(c),vec3.scale(c,n-this.distance);const h=vec3.create();vec3.add(e,c,h);var s=new o(h,a);const d=this.ctx.globe.computeIntersection(s);null!=d&&null!=d&&(this.geoCenter=d)}this.computeViewMatrix()},a.prototype.pan=function(e,t,i,r){if(this.lastMousePosition&&i&&r){const s=this.ctx.getCoordinateSystem(),a=this.ctx.globe,l=this.renderContext,u=.5*l.getFov()*Math.PI/180;this.computeInverseViewMatrix();const c=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],h=mat4.create(this.inverseViewMatrix),d=vec3.create();this.ctx.getCoordinateSystem().fromGeoTo3D(this.geoCenter,d);const p=vec3.create();vec3.subtract(d,c,p),vec3.normalize(p);const f=a.getLonLatFromPixel(this.lastMousePosition[0],this.lastMousePosition[1]);if(this.lastMousePosition=[i,r],!f)return;const g=vec3.create();s.fromGeoTo3D(f,g);const m=vec3.create();vec3.subtract(c,g,m);const v=vec3.length(m)*Math.tan(u);e=2*e/l.getCanvas().width,t=2*t/l.getCanvas().height;const y=vec3.createFrom(-e*v,t*v,0);mat4.rotateVec3(h,y);const b=vec3.create();vec3.add(c,y,b);var n=new o(b,p);const x=this.ctx.globe.computeIntersection(n);null!=x&&null!=x&&(this.geoCenter=x,this.geoCenter[1]=Math.min(88,Math.max(this.geoCenter[1],-88)))}else{var s=mat4.create(),a=this.ctx.getCoordinateSystem();a.getLocalTransform(this.geoCenter,s);var l=vec3.create(),u=vec3.create([0,1,0]);a.getUpVector(s,l),mat4.multiplyVec3(s,u,u),this.applyLocalRotation(s);var c=vec3.create(),h=vec3.create();a.getSideVector(s,c),a.getFrontVector(s,h),vec3.cross(l,c,h),vec3.cross(h,l,c),vec3.normalize(c,c),vec3.normalize(h,h),e/=this.renderContext.getCanvas().width,t/=this.renderContext.getCanvas().height;var d=vec3.create();a.get3DFromWorld(this.geoCenter,d),vec3.scale(c,e*Math.max(this.distance,1e3*this.scale),c),vec3.scale(h,t*Math.max(this.distance,1e3*this.scale),h),vec3.subtract(d,c,d),vec3.add(d,h,d),vec3.normalize(d),vec3.scale(d,a.getGeoide().getRadius()),a.getWorldFrom3D(d,this.geoCenter),this.geoCenter[2]=this.targetHeight;var p=vec3.create([0,1,0]);a.getLocalTransform(this.geoCenter,s),mat4.multiplyVec3(s,p,p),vec3.dot(u,p)<0&&(this.heading=(this.heading+180)%360),this.computeViewMatrix()}},a.prototype.rotate=function(e,t){this.heading,this.tilt;this.heading+=.05*e,this.tilt+=.05*t,this.clampTilt(),this.computeViewMatrix()},a.prototype.hasCollision=function(){const e=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],t=vec3.create();this.ctx.getCoordinateSystem().from3DToGeo(e,t);const i=this.ctx.getElevation(t[0],t[1]),r=(this.ctx.getRenderContext().near,t[2]-i-25),n=r<0;return n&&(this.offset=25-r),n},a.prototype.updateGeoCenter=function(){const e=this.renderContext.canvas;e.width,e.height;this.computeInverseViewMatrix();const t=[this.inverseViewMatrix[12],this.inverseViewMatrix[13],this.inverseViewMatrix[14]],i=vec3.create();this.ctx.getCoordinateSystem().fromGeoTo3D(this.geoCenter,i);const r=vec3.create();vec3.subtract(i,t,r),vec3.normalize(r);var n=new o(t,r);const s=this.ctx.globe.computeIntersection(n);if(null!=s&&null!=s){this.geoCenter=s;const e=vec3.create();this.ctx.getCoordinateSystem().fromGeoTo3D(this.geoCenter,e),this.distance=vec3.dist(e,t)}},a.prototype.getDistance=function(){return this._distance},a.prototype.getHeading=function(){return(this.heading%360+360)%360},a.prototype.destroy=function(){i.prototype.destroy.call(this),this.minDistance=null,this.maxDistance=null,this.geoCenter=null,this._distance=null,this.heading=null,this.tilt=null,this.inverseViewMatrix=null},a.prototype.update=function(){if(!this.ctx.globe.tileManager.level0TilesLoaded)return;if(Number.isNaN(this.distance)&&(this.distance=this.maxDistance,this._distance=this.cameraHeight),this.ctx.getRenderContext().near=.25*this.distance,this.computeViewMatrix(),this.hasCollision()){const e=this.cameraHeight,i=this.targetHeight,r=(e+this.offset-i)/this._distance,n=Math.asin(r);Number.isNaN(n)?(s.open(t.LEVEL.DEBUG,"PlanetNavigation.js",`NaN ! ${e}, ${i}, ${this.offset}, ${this._distance}, ${r}`),this._distance+=this.offset):(this.tilt=180*n/Math.PI,this.clampTilt()),this.computeViewMatrix()}this.ctx.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,this.cameraHeight)},a.prototype.clampTilt=function(){this.tilt=Math.min(Math.max(this.tilt,10),90)},a.prototype.doneMoving=function(){this.updateGeoCenter(),this.lastMousePosition=null},a.prototype.donePanning=function(){this.updateGeoCenter(),this.lastMousePosition=null},a.prototype.doneRotating=function(){this.updateGeoCenter()},a.prototype.startInteraction=function(e,t){this.lastMousePosition=[e,t]},a.prototype.moveUpTo=function(e,i){this.ctx.getCoordinateSystem().getWorldFrom3D(this.up,[]),this.ctx.getCoordinateSystem().getWorldFrom3D(e,[]),this.startHeading=this.getHeading(),this.startHeading>180?this.endHeading=360:this.endHeading=0;var o=i||1e3,s=this,a=r.create(t.ANIMATION.Segmented,{duration:o,valueSetter:function(e){s.heading=e,s.computeViewMatrix()}});a.addSegment(0,this.startHeading,1,this.endHeading,function(e,t,i){return n.lerp(e,t,i)}),this.ctx.addAnimation(a),this.ctx.publish(t.EVENT_MSG.NAVIGATION_STARTED),a.start()},a}),r("gw/Navigation/AstroNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(e,t,i,r,n,o){var s=function(e,r){i.prototype.constructor.call(this,t.NAVIGATION.AstroNavigation,e,r),this.minFov=this.options.minFov||.001,this.maxFov=this.options.maxFov||100,this.center3d=[1,0,0],this.up=[0,0,1],function(e){e&&this.ctx.getCoordinateSystem().get3DFromWorld(e,this.center3d)}.call(this,this.options.initTarget),function(e){e&&(this.minFov>e?this.minFov=e:this.maxFov<e&&(this.maxFov=e),this.renderContext.setFov(e),this._clampFov())}.call(this,this.options.initFov),function(e){e&&(this.up=e)}.call(this,this.options.up),this.computeViewMatrix()};function a(e,t,i,r){var o=r||0;e.addSegment(o,t,1,i,function(e,t,i){var r=n.easeOutQuad(e),o=n.easeInQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2])]})}return e.inherits(i,s),s.prototype.getCenter=function(){var e=i.prototype.getCenter.call(this);return null==e&&(e=[],this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,e)),e},s.prototype.zoomTo=function(e,i){var o=i&&i.fov?i.fov:2,s=i&&i.duration?i.duration:5e3,l=function(e,t,i,r,o){var s=[];e.getCoordinateSystem().getWorldFrom3D(t,s);var a=n.shortestPath360(s[0],i[0]);return[[a[0],s[1],r],[a[1],i[1],o]]}.call(this,this.ctx,this.center3d,e,this.renderContext.getFov(),o),u=l[0],c=l[1],h=function(e,i){return r.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var i=e.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);e.center3d[0]=i[0],e.center3d[1]=i[1],e.center3d[2]=i[2],e.ctx.getRenderContext().setFov(t[2]),e.computeViewMatrix()}})}.call(this,this,s),d=this.ctx.getCoordinateSystem().get3DFromWorld(e);25>this.renderContext.getFov()&&this.renderContext.getWorldFrustum().containsSphere(d,.005)<0?function(e,t,i,r){var o=[.5*t[0]+.5*i[0],.5*t[1]+.5*i[1],r];e.addSegment(0,t,.5,o,function(e,t,i){var r=n.easeInQuad(e),o=n.easeOutQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2])]}),a.call(this,e,o,i,.5)}.call(this,h,u,c,25):a.call(this,h,u,c),function(e,i,r,n){e.onstop=function(){n&&n.callback&&n.callback(),e=null,i.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,r)}}.call(this,h,this.ctx,o,i),this.ctx.addAnimation(h),h.start()},s.prototype.moveUpTo=function(e,i){var n=[],o=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.up,n),this.ctx.getCoordinateSystem().getWorldFrom3D(e,o);var s=function(e,i){return r.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var i=e.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);e.up[0]=i[0],e.up[1]=i[1],e.up[2]=i[2],e.computeViewMatrix()}})}.call(this,this,i||1e3);a.call(this,s,n,o),this.ctx.addAnimation(s),s.start()},s.prototype.computeViewMatrix=function(){vec3.normalize(this.center3d);var e=this.renderContext.getViewMatrix();mat4.lookAt([0,0,0],this.center3d,this.up,e),this.up=[e[1],e[5],e[9]],this.ctx.publish(t.EVENT_MSG.NAVIGATION_MODIFIED),this.renderContext.requestFrame()},s.prototype.zoom=function(e,t){t?this.renderContext.setFov(1*this.renderContext.getFov()/t):this.renderContext.setFov(this.renderContext.getFov()*(1+.1*e)),this._clampFov(),this.computeViewMatrix()},s.prototype.pan=function(e,t){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2,n=o.createFromPixel(this.renderContext,i-e,r-t);this.center3d=n.computePoint(n.sphereIntersect([0,0,0],this.ctx.getCoordinateSystem().getGeoide().getRadius())),this.computeViewMatrix()},s.prototype.rotate=function(e){var t=n.toRadian(.05*e),i=quat4.fromAngleAxis(t,this.center3d);quat4.multiplyVec3(i,this.up),this.computeViewMatrix()},s.prototype._clampFov=function(){this.renderContext.getFov()>this.maxFov&&this.renderContext.setFov(this.maxFov),this.renderContext.getFov()<this.minFov&&this.renderContext.setFov(this.minFov)},s.prototype.destroy=function(){i.prototype.destroy.call(this),this.minFov=null,this.maxFov=null,this.center3d=null,this.up=null},s}),r("gw/Navigation/FlatNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(e,t,i,r,n,o){const s=0,a=360,l=[0,0,1],u=[0,0,0];var c=function(e,r){i.prototype.constructor.call(this,t.NAVIGATION.FlatNavigation,e,r),this.minDistance=this.options.minDistance||6e4,this.maxDistance=this.options.maxDistance||5*this.ctx.getCoordinateSystem().getGeoide().getRadius()/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.minDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.maxDistance*=this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),this.center=u,this.distance=this.maxDistance,this.heading=0,this.up=[0,1,0],function(e){if(e){var t=this.ctx.getCoordinateSystem().get3DFromWorld(e);this.center[0]=t[0],this.center[1]=t[1],this.distance=3===e.length?e[2]*this.ctx.getCoordinateSystem().getGeoide().getHeightScale():this.distance,this.distance<this.minDistance&&(this.minDistance=this.distance),this.distance>this.maxDistance&&(this.maxDistance=this.distance)}}.call(this,this.options.initTarget);const n=this.ctx.getRenderContext();n&&(n.near=.001),this.computeViewMatrix()};function h(e,t,i,r){var o=r||0;e.addSegment(o,t,1,i,function(e,t,i){var r=n.easeOutQuad(e),o=n.easeInQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2])]})}return e.inherits(i,c),c.prototype.getCenter=function(){var e=i.prototype.getCenter.call(this);return null==e&&(e=this.center),e},c.prototype.save=function(){return{center:this.center,distance:this.distance,up:this.up}},c.prototype.restore=function(e){this.center=e.center,this.distance=e.distance,this.up=e.up,this.computeViewMatrix()},c.prototype.computeViewMatrix=function(){var e=this.renderContext.getViewMatrix(),i=[this.center[0],this.center[1],this.distance];mat4.lookAt(i,this.center,this.up,e),this.up=[e[1],e[5],e[9]],this.ctx.publish(t.EVENT_MSG.NAVIGATION_MODIFIED),this.renderContext.requestFrame()},c.prototype.zoomTo=function(e,i){this.ctx.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE);var o=i&&i.duration?i.duration:5e3,s=function(e,i){return r.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){e.center[0]=t[0],e.center[1]=t[1],e.distance=t[2],e.computeViewMatrix()}})}.call(this,this,o),a=i&&i.distance?i.distance:this.distance/this.ctx.getCoordinateSystem().getGeoide().getHeightScale(),l=this.ctx.getCoordinateSystem().get3DFromWorld(e),u=[this.center[0],this.center[1],this.distance],c=[l[0],l[1],a*this.ctx.getCoordinateSystem().getGeoide().getHeightScale()],d=function(e,t,i){var r=vec3.subtract(t,i),o=vec3.length(r),s=e.getRenderContext().getCanvas(),a=e.getRenderContext().getFov(),l=Math.min(n.toRadian(a),n.toRadian(a*s.width/s.height));return o/2/Math.tan(l/2)}.call(this,this.ctx,this.center,l);d>this.distance?function(e,t,i,r){var o=[.5*t[0]+.5*i[0],.5*t[1]+.5*i[1],r];e.addSegment(0,t,.5,o,function(e,t,i){var r=n.easeInQuad(e),o=n.easeOutQuad(e);return[n.lerp(r,t[0],i[0]),n.lerp(r,t[1],i[1]),n.lerp(o,t[2],i[2])]}),h.call(this,e,o,i,.5)}.call(this,s,u,c,d):h.call(this,s,u,c),function(e,i,r,n){e.onstop=function(){n&&n.callback&&n.callback(),e=null,i.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,r)}}.call(this,s,this.ctx,a,i),this.ctx.addAnimation(s),s.start()},c.prototype.zoom=function(e,i){var r=this.distance;this.distance*=i||1+.1*e,this.distance>this.maxDistance&&(this.distance=r),this.distance<this.minDistance&&(this.distance=r),this.computeViewMatrix(),this.ctx.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,this.getDistance())},c.prototype.pan=function(e,t){var i=this.renderContext.getCanvas().width/2,r=this.renderContext.getCanvas().height/2;if(null===this.ctx.getLonLatFromPixel(0,r)&&e>0&&(e=0),null===this.ctx.getLonLatFromPixel(this.renderContext.getCanvas().width,r)&&e<0&&(e=0),null===this.ctx.getLonLatFromPixel(i,0)&&t>0&&(t=0),null===this.ctx.getLonLatFromPixel(i,this.renderContext.getCanvas().height)&&t<0&&(t=0),0!==e||0!==t){var n=o.createFromPixel(this.renderContext,i-e,r-t);this.center=n.computePoint(n.planeIntersect(u,l)),this.computeViewMatrix()}},c.prototype.rotate=function(e){var t=.05*e;this.heading+=t;var i=quat4.fromAngleAxis(n.toRadian(t),l);quat4.multiplyVec3(i,this.up),this.computeViewMatrix()},c.prototype.getDistance=function(){return this.distance*this.ctx.getCoordinateSystem().getGeoide().getRealPlanetRadius()},c.prototype.getHeading=function(){return(this.heading%a+a)%a},c.prototype.moveUpTo=function(e,i){var o=this.up;o[0]=n.toDegree(o[0]),o[1]=n.toDegree(o[1]),this.ctx.getCoordinateSystem().getWorldFrom3D(e,[]);var u=function(e,i){return r.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var i=t-e.heading;e.heading=t;var r=quat4.fromAngleAxis(n.toRadian(i),l);quat4.multiplyVec3(r,e.up),e.computeViewMatrix()}})}.call(this,this,i||1e3);(function(e,t){var i;i=t>180?a:s,e.addSegment(0,t,1,i,function(e,t,i){return n.lerp(e,t,i)})}).call(this,u,this.getHeading()),this.ctx.addAnimation(u),u.start()},c.prototype.destroy=function(){i.prototype.destroy.call(this),this.up=null,this.minDistance=null,this.maxDistance=null,this.heading=null,this.center=null,this.distance=null},c}),r("gw/Navigation/GroundNavigation",["../Utils/Utils","../Utils/Constants","./AbstractNavigation","../Animation/SegmentedAnimation","../Animation/AnimationFactory","../Utils/Numeric","../Renderer/Ray","../Renderer/glMatrix"],function(e,t,i,r,n,o,s){const a=[1,0,0];var l=function(e,r){i.prototype.constructor.call(this,t.NAVIGATION.GroundNavigation,e,r),this.minFov=this.options.minFov||.5,this.maxFov=this.options.maxFov||70,this.center3d=a,this.up=[0,0,1],this.heading=this.options.initTarget?this.options.initTarget[0]:0,function(e){e&&this.ctx.getCoordinateSystem().get3DFromWorld(e,this.center3d)}.call(this,this.options.initTarget),function(e){e&&(this.minFov>e?this.minFov=e:this.maxFov<e&&(this.maxFov=e),this.renderContext.setFov(e),this._clampFov())}.call(this,this.options.initFov),function(e){e&&(this.up=e)}.call(this,this.options.up),this.computeViewMatrix()};function u(e,t,i,r){var n=r||0;e.addSegment(n,t,1,i,function(e,t,i){var r=o.easeOutQuad(e),n=o.easeInQuad(e);return[o.lerp(r,t[0],i[0]),o.lerp(r,t[1],i[1]),o.lerp(n,t[2],i[2])]})}return e.inherits(i,l),l.prototype.getCenter=function(){var e=i.prototype.getCenter.call(this);return null==e&&(e=[],this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,e)),e},l.prototype.zoomTo=function(e,i){var r=i&&i.fov?i.fov:2,s=i&&i.duration?i.duration:5e3,a=function(e,t,i,r,n){var s=[];e.getCoordinateSystem().getWorldFrom3D(t,s);var a=o.shortestPath360(s[0],i[0]);return[[a[0],s[1],r],[a[1],i[1],n]]}.call(this,this.ctx,this.center3d,e,this.renderContext.getFov(),r),l=a[0],c=a[1],h=function(e,i){return n.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var i=e.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);e.center3d[0]=i[0],e.center3d[1]=i[1],e.center3d[2]=i[2],e.ctx.getRenderContext().setFov(t[2]),e.computeViewMatrix()}})}.call(this,this,s),d=this.ctx.getCoordinateSystem().get3DFromWorld(e);25>this.renderContext.getFov()&&this.renderContext.getWorldFrustum().containsSphere(d,.005)<0?function(e,t,i,r){var n=[.5*t[0]+.5*i[0],.5*t[1]+.5*i[1],r];e.addSegment(0,t,.5,n,function(e,t,i){var r=o.easeInQuad(e),n=o.easeOutQuad(e);return[o.lerp(r,t[0],i[0]),o.lerp(r,t[1],i[1]),o.lerp(n,t[2],i[2])]}),u.call(this,e,n,i,.5)}.call(this,h,l,c,25):u.call(this,h,l,c),function(e,i,r,n){e.onstop=function(){n&&n.callback&&n.callback(),e=null,i.publish(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,r)}}.call(this,h,this.ctx,r,i),this.ctx.addAnimation(h),h.start()},l.prototype.moveUpTo=function(e,i){var r=this.center3d,o=a,s=function(e,i){return n.create(t.ANIMATION.Segmented,{duration:i,valueSetter:function(t){var i=e.ctx.getCoordinateSystem().get3DFromWorld([t[0],t[1]]);e.center3d[0]=i[0],e.center3d[1]=i[1],e.center3d[2]=i[2],e.computeViewMatrix()}})}.call(this,this,i||1e3);u.call(this,s,r,o),this.ctx.addAnimation(s),s.start()},l.prototype.computeViewMatrix=function(){vec3.normalize(this.center3d);var e=this.renderContext.viewMatrix;mat4.lookAt([0,0,0],this.center3d,this.up,e);var i=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,i),this.heading=i[0],this.up=[0,0,e[9]],this.ctx.publish(t.EVENT_MSG.NAVIGATION_MODIFIED),this.renderContext.requestFrame()},l.prototype.zoom=function(e,t){t?this.renderContext.setFov(1*this.renderContext.getFov()/t):this.renderContext.setFov(this.renderContext.getFov()*(1+.1*e)),this._clampFov(),this.computeViewMatrix()},l.prototype.pan=function(e,t){var i=this.renderContext.canvas.width/2,r=this.renderContext.canvas.height/2,n=s.createFromPixel(this.renderContext,i-e,r-t);this.center3d=n.computePoint(n.sphereIntersect([0,0,0],this.ctx.getCoordinateSystem().getGeoide().getRadius())),this.computeViewMatrix()},l.prototype.rotate=function(e,t){var i=.05*e,r=[];this.ctx.getCoordinateSystem().getWorldFrom3D(this.center3d,r),this.heading+=i,r[0]=this.heading,this.ctx.getCoordinateSystem().get3DFromWorld(r,this.center3d),this.computeViewMatrix()},l.prototype.getHeading=function(){return this.heading},l.prototype._clampFov=function(){this.renderContext.getFov()>this.maxFov&&this.renderContext.setFov(this.maxFov),this.renderContext.getFov()<this.minFov&&this.renderContext.setFov(this.minFov)},l}),r("gw/Navigation/NavigationFactory",["./PlanetNavigation","./AstroNavigation","./FlatNavigation","./GroundNavigation","../Utils/Constants"],function(e,t,i,r,n){return{create:function(o,s,a){var l;switch(o){case n.NAVIGATION.AstroNavigation:l=new t(s,a);break;case n.NAVIGATION.PlanetNavigation:l=new e(s,a);break;case n.NAVIGATION.FlatNavigation:l=new i(s,a);break;case n.NAVIGATION.GroundNavigation:l=new r(s,a);break;default:throw new RangeError("The type "+o+" is not allowed, A valid type is included in the list NAVIGATION","NavigationFactory.js")}return l}}}),r("gw/Gui/TimeTravel",["jquery","../Utils/Constants","../Services/TimeTravelCore"],function(e,t,i){var r=null,n=null;var o=function(o){if(r=o.element,n=o.ctx,null==r)throw new ReferenceError("Can't get the element name from the options parameters");if(null==document.getElementById(o.element))throw new ReferenceError("Can' get the div "+r+" in the web page to insert "+this.constructor.name);var s=null,a=null,l=null;document.getElementById(r).innerHTML='<div id="objectForward"></div><div id="objectHourGlass"></div><div id="objectRewind"></div>';var u=function(e){n.publish(e,n)},c=function(e){u(t.EVENT_MSG.GLOBAL_TIME_SET)},h=function(e){u(t.EVENT_MSG.GLOBAL_TIME_FORWARD)},d=function(e){u(t.EVENT_MSG.GLOBAL_TIME_REWIND)};n.subscribe(t.EVENT_MSG.GLOBAL_TIME_CHANGED,this.updateDisplayDate),i.init(o),e.get("data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTYgMnY2aC4wMUw2IDguMDEgMTAgMTJsLTQgNCAuMDEuMDFINlYyMmgxMnYtNS45OWgtLjAxTDE4IDE2bC00LTQgNC0zLjk5LS4wMS0uMDFIMThWMkg2em0xMCAxNC41VjIwSDh2LTMuNWw0LTQgNCA0em0tNC01bC00LTRWNGg4djMuNWwtNCA0eiIvPiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDBWMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=",function(t){(l=document.importNode(t.documentElement,!0)).height.baseVal.value=32,l.width.baseVal.value=32,e("#objectHourGlass").append(l),o.svgHourGlassDoc=l,e("#objectHourGlass svg").css({float:"right",fill:i.isCurrentDateTheFirst()&&i.isCurrentDateTheLast()?"#333333":"white"}),l.addEventListener("mouseup",c),s&&a&&l&&e("#"+r).css("display","block")},"xml"),e.get("data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTExIDE4VjZsLTguNSA2IDguNSA2em0uNS02bDguNSA2VjZsLTguNSA2eiIvPiAgICA8cGF0aCBkPSJNMCAwaDI0djI0SDB6IiBmaWxsPSJub25lIi8+PC9zdmc+",function(t){(s=document.importNode(t.documentElement,!0)).height.baseVal.value=32,s.width.baseVal.value=32,e("#objectRewind").append(s),e("#objectRewind svg").css({float:"right",fill:i.isCurrentDateTheFirst()?"#333333":"white"}),o.svgRewindDoc=s,s.addEventListener("mouseup",d),s&&a&&l&&e("#"+r).css("display","block")},"xml"),e.get("data:image/svg+xml;base64,PHN2ZyBmaWxsPSIjMDAwMDAwIiBoZWlnaHQ9IjI0IiB2aWV3Qm94PSIwIDAgMjQgMjQiIHdpZHRoPSIyNCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4gICAgPHBhdGggZD0iTTQgMThsOC41LTZMNCA2djEyem05LTEydjEybDguNS02TDEzIDZ6Ii8+ICAgIDxwYXRoIGQ9Ik0wIDBoMjR2MjRIMHoiIGZpbGw9Im5vbmUiLz48L3N2Zz4=",function(t){(a=document.importNode(t.documentElement,!0)).height.baseVal.value=32,a.width.baseVal.value=32,e("#objectForward").append(a),e("#objectForward svg").css({float:"right",fill:i.isCurrentDateTheLast()?"#333333":"white"}),o.svgForwardDoc=a,a.addEventListener("mouseup",h),s&&a&&l&&e("#"+r).css("display","block")},"xml")};return o.prototype.updateDisplayDate=function(t){null!==document.getElementById("textTimeTravelDiv")&&(i.isCurrentDateTheFirst()&&i.isCurrentDateTheLast()?document.getElementById("textTimeTravelDiv").innerHTML="":document.getElementById("textTimeTravelDiv").innerHTML=t.display),n.setTime(t);var r="rgb(255, 0, 0)"===e("#objectRewind:hover svg").css("fill")?"red":"white",o="rgb(255, 0, 0)"===e("#objectForward:hover svg").css("fill")?"red":"white";e("#objectRewind svg").css({float:"right",fill:i.isCurrentDateTheFirst()?"#333333":r}),e("#objectForward svg").css({float:"right",fill:i.isCurrentDateTheLast()?"#333333":o}),e("#objectHourGlass svg").css({float:"right",fill:i.isCurrentDateTheFirst()&&i.isCurrentDateTheLast()?"#333333":"white"}),e("#objectRewind svg").mouseover(function(){i.isCurrentDateTheFirst()?e(this).css("fill","#333333"):e(this).css("fill","red")}).mouseout(function(){i.isCurrentDateTheFirst()?e(this).css("fill","#333333"):e(this).css("fill","white")}),e("#objectForward svg").mouseover(function(){i.isCurrentDateTheLast()?e(this).css("fill","#333333"):e(this).css("fill","red")}).mouseout(function(){i.isCurrentDateTheLast()?e(this).css("fill","#333333"):e(this).css("fill","white")}),e("#objectHourGlass svg").mouseover(function(){i.isCurrentDateTheFirst()&&i.isCurrentDateTheLast()?e(this).css("fill","#333333"):e(this).css("fill","red")}).mouseout(function(){i.isCurrentDateTheFirst()&&i.isCurrentDateTheLast()?e(this).css("fill","#333333"):e(this).css("fill","white")})},o.prototype.remove=i.remove,o.prototype.goRewind=i.goRewind,o.prototype.goForward=i.goForward,o.prototype.chooseTime=i.chooseTime,o}),r("gw/Context/PlanetContext",["jquery","underscore-min","../Utils/Utils","./AbstractContext","../Utils/Constants","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory","../Gui/Compass","../Gui/TimeTravel","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l,u,c){var h=function(e,t){r.prototype.constructor.call(this,e,n.CONTEXT.Planet,t);this.components={posTrackerInfo:!0,posTracker:!0,elevTracker:!0,compassDiv:!0,timeTravelDiv:!0};var i=function(e){var t=this;return{tileErrorTreshold:e.tileErrorTreshold||3,continuousRendering:e.continuousRendering||!1,renderContext:e.renderContext,canvas:this.canvas,isMobile:e.isMobile||!1,coordinateSystem:e.coordinateSystem,shadersPath:this.mizarConfiguration.mizarAPIUrl+"shaders/",lighting:!1,backgroundColor:[0,0,0,1],minFar:0,defaultColor:[200,200,200,255],renderTileWithoutTexture:!0,publishEvent:function(e,i){t.publish(e,i)}}}.call(this,t);try{this.globe=o.create(n.GLOBE.Planet,i),this.navigation=function(e,t){var i;i=e?n.NAVIGATION.FlatNavigation:n.NAVIGATION.PlanetNavigation;return s.create(i,this,t)}.call(this,this.getCoordinateSystem().isFlat(),t.navigation),this.initGlobeEvents(this.globe),a.create(n.SERVICE.PickingManager).init(this);try{this.setTimeTravelVisible(e.timeTravel&&e.timeTravel.element?e.timeTravel.element:"timeTravelDiv",!0)}catch(e){c.open(n.LEVEL.DEBUG,"Cannot create the Time travel",e)}}catch(e){this._showUpError(e)}};return i.inherits(r,h),h.prototype.setTimeTravelVisible=function(e,t){t?this.timeTravel=new u({element:e,ctx:this,crs:this.getCoordinateSystem().getGeoideName()}):this.timeTravel&&this.timeTravel.remove(),this.setComponentVisibility(e,t)},h.prototype.setBaseElevation=function(e){if(e.getType()!==n.LAYER.WCSElevation&&e.getType()!==n.LAYER.WMSElevation)throw new TypeError("The provided layer ID="+e.getID()+" has a type +"+e.getType()+" instead of WCSElevation or WMSElevation","PlanetContext.js");this.globe.setBaseElevation(e),null!=this.elevationTracker&&this.elevationTracker.setScaleLayer(e)},h.prototype.setBaseElevationByID=function(e){var t=this.getLayerByID(e);return t&&this.setBaseElevation(t),t},h.prototype.getBaseElevation=function(){return this.globe.getBaseElevation()},h.prototype.setCoordinateSystem=function(t){if(t.getType()!==this.getMode())throw new RangeError("incompatible coordinate reference system with Planet context","PlanetContext.js");var i,r;e(this.canvas.parentElement).find("#loading").show(),i=function(e){return e.isFlat()?e.getWorldFrom3D(this.navigation.center):this.navigation.geoCenter}.call(this,this.globe.getCoordinateSystem()),r=this.navigation.distance/this.globe.getCoordinateSystem().getGeoide().getHeightScale(),this.globe.setCoordinateSystem(t),this.navigation.stop();var o=function(e){var t={};return t.inertia=!!e.hasOwnProperty("inertia")&&e.inertia,e.hasOwnProperty("mouse")&&(t.mouse=e.mouse),t}.call(this,this.navigation.getOptions());try{(function(e,t,i,r){e.isFlat()?(this.navigation=s.create(n.NAVIGATION.FlatNavigation,this,r),this.navigation.center=e.get3DFromWorld(t)):(this.navigation=s.create(n.NAVIGATION.PlanetNavigation,this,r),this.navigation.geoCenter=t),this.navigation.distance=i*e.getGeoide().getHeightScale()}).call(this,t,i,r,o)}catch(e){this._showUpError(e)}this.positionTracker&&(this.positionTracker.detach(),this.positionTracker.attachTo(this)),this.elevationTracker&&(this.elevationTracker.detach(),this.elevationTracker.attachTo(this)),this.navigation.computeViewMatrix(),this.publish(n.EVENT_MSG.CRS_MODIFIED,this)},h.prototype.destroy=function(){r.prototype.destroy.call(this)},h}),r("gw/Context/SkyContext",["underscore-min","../Utils/Utils","./AbstractContext","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory","../Gui/TimeTravel","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l){var u=function(e,t){i.prototype.constructor.call(this,e,a.CONTEXT.Sky,t);this.components={posTrackerInfo:!0,posTracker:!0,elevTracker:!1,compassDiv:!0,timeTravelDiv:!0};var s=function(e){var t=this,i={canvas:this.canvas,tileErrorTreshold:e.tileErrorTreshold||1.5,continuousRendering:e.continuousRendering||!0,renderTileWithoutTexture:!1,radius:e.radius||10,minFar:e.minFar||15,coordinateSystem:e.coordinateSystem,lighting:!1,backgroundColor:[0,0,0,1],defaultColor:[200,200,200,255],shadersPath:this.mizarConfiguration.mizarAPIUrl+"shaders/",publishEvent:function(e,i){t.publish(e,i)}};e.renderContext&&(i.renderContext=e.renderContext);return i}.call(this,t);try{this.globe=r.create(a.GLOBE.Sky,s),this.navigation=n.create(a.NAVIGATION.AstroNavigation,this,t.navigation?t.navigation:t),this.initGlobeEvents(this.globe),o.create(a.SERVICE.PickingManager).init(this);try{this.setTimeTravelVisible(e.timeTravel&&e.timeTravel.element?e.timeTravel.element:"timeTravelDiv",!0)}catch(e){l.open(a.LEVEL.DEBUG,"Cannot create the Time travel",e)}}catch(e){this._showUpError(e)}};return t.inherits(i,u),u.prototype.setTimeTravelVisible=function(e,t){t?this.timeTravel=new s({element:e,ctx:this,crs:a.CRS.Equatorial}):this.timeTravel&&this.timeTravel.remove(),this.setComponentVisibility(e,t)},u.prototype.setCoordinateSystem=function(e){if(e.getType()!==this.getMode())throw new ReferenceError("incompatible coordinate reference system with Sky context","SkyContex.js");this.globe.setCoordinateSystem(e),this.publish(a.EVENT_MSG.CRS_MODIFIED,this)},u.prototype.destroy=function(){this.timeTravel&&this.timeTravel.remove(),i.prototype.destroy.call(this)},u}),r("gw/Context/GroundContext",["jquery","underscore-min","../Utils/Utils","./AbstractContext","../Utils/Constants","../Globe/GlobeFactory","../Navigation/NavigationFactory","../Services/ServiceFactory","../Gui/TimeTravel","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s,a,l,u){var c=function(e,t){r.prototype.constructor.call(this,e,n.CONTEXT.Ground,t);this.components={posTrackerInfo:!1,posTracker:!1,elevTracker:!1,compassDiv:!1,timeTravelDiv:!1};var i=function(e){var t=this;return{tileErrorTreshold:e.tileErrorTreshold||3,continuousRendering:e.continuousRendering||!1,renderContext:e.renderContext,canvas:this.canvas,coordinateSystem:e.coordinateSystem,shadersPath:this.mizarConfiguration.mizarAPIUrl+"shaders/",lighting:!1,backgroundColor:[0,0,0,1],minFar:0,defaultColor:[200,200,200,255],renderTileWithoutTexture:!0,publishEvent:function(e,i){t.publish(e,i)}}}.call(this,t);try{this.globe=o.create(n.GLOBE.Sky,i),this.navigation=s.create(n.NAVIGATION.GroundNavigation,this,t.navigation?t.navigation:t),this.initGlobeEvents(this.globe),a.create(n.SERVICE.PickingManager).init(this);try{this.setTimeTravelVisible(e.timeTravel&&e.timeTravel.element?e.timeTravel.element:"timeTravelDiv",!0)}catch(e){u.open(n.LEVEL.DEBUG,"Cannot create the Time travel",e)}}catch(e){this._showUpError(e)}};return i.inherits(r,c),c.prototype.setTimeTravelVisible=function(e,t){t?this.timeTravel=new l({element:e,ctx:this,crs:this.getCoordinateSystem().getGeoideName()}):this.timeTravel&&this.timeTravel.remove(),this.setComponentVisibility(e,t)},c.prototype.setCoordinateSystem=function(e){if(e.getType()!==this.getMode())throw new RangeError("incompatible coordinate reference system with Sky context","GroundContext.js");this.globe.setCoordinateSystem(e),this.publish(n.EVENT_MSG.CRS_MODIFIED,this)},c.prototype.destroy=function(){this.timeTravel&&this.timeTravel.remove(),r.prototype.destroy.call(this)},c}),r("gw/Context/ContextFactory",["../Utils/Constants","./PlanetContext","./SkyContext","./GroundContext"],function(e,t,i,r){return{create:function(n,o,s){var a;switch(n){case e.CONTEXT.Planet:a=new t(o,s);break;case e.CONTEXT.Sky:a=new i(o,s);break;case e.CONTEXT.Ground:a=new r(o,s);break;default:throw new RangeError("The type "+n+" is not allowed, A valid type is included in the list Constants.CONTEXT","ContextFactory.js")}return a}}}),r("gw/Provider/ConstellationProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s,a,l,u={};function c(){o.open(n.LEVEL.ERROR,"Failed to load files")}var h=function(e){t.prototype.constructor.call(this,e),l=this};return r.inherits(t,h),h.prototype.loadFiles=function(t,i){var r=t;if(!i.nameUrl||!i.catalogueUrl)return o.open(n.LEVEL.DEBUG,"Not valid options for ContellationProvider","nameUrl and catalogueUrl attributes must be passed"),!1;var h={type:"GET",url:i.nameUrl,success:function(e){s=e},error:function(e,t,r){o.open(n.LEVEL.ERROR,"Failed to request "+i.nameUrl,e.responseText)}},d={type:"GET",url:i.catalogueUrl,success:function(e){a=e},error:function(e,t,r){o.open(n.LEVEL.ERROR,"Failed to request "+i.catalogueUr,e.responseText)}};e.when(e.ajax(h),e.ajax(d)).then(function(){!function(e){for(var t=s.split("\n"),i=a.split("\n"),r=0;r<i.length;r++){var o=i[r].replace("  "," ");o=o.split(" ");var l=parseFloat(o[0]),c=parseFloat(o[1]),h=o[2];if(o[3],l*=15,!u[h])for(var d=0;d<t.length;d++)if((o=t[d].split(";"))[0]===h){var p=o[1];u[h]={coord:[],name:p,x:0,y:0,z:0,nbStars:0};break}var f=[l,c],g=[];e.globe.getCoordinateSystem().get3DFromWorldInCrs(f,n.CRS.Equatorial,g),u[h].x+=g[0],u[h].y+=g[1],u[h].z+=g[2],u[h].nbStars++,u[h].coord.push(f)}}(r),l.handleFeatures(r)},c)},h.prototype.handleFeatures=function(e){var t=[],r=[];for(var o in u)if(u.hasOwnProperty(o)){var s=u[o];s.coord.push(s.coord[0]);var a={geometry:{type:n.GEOMETRY.Polygon,gid:"constellationShape_"+s.name,coordinates:[s.coord],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:s.name}};r.push(a);var l=[];e.globe.getCoordinateSystem().getWorldFrom3D([s.x/s.nbStars,s.y/s.nbStars,s.z/s.nbStars],l);var c={geometry:{type:n.GEOMETRY.Point,gid:"constellationName_"+s.name,coordinates:[l[0],l[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:s.name,style:new i({textColor:"#083BA8",fillColor:[1,1,1,1],label:s.name})}};t.push(c)}var h={type:"FeatureCollection",features:r},d={type:"FeatureCollection",features:t};e.addFeatureCollection(h),e.addFeatureCollection(d)},h}),r("gw/Provider/StarProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){var s,a,l;function u(){o.open(n.LEVEL.ERROR,"Failed ot load files in StarProvider")}var c=function(e){t.prototype.constructor.call(this,e),l=this};return r.inherits(t,c),c.prototype.loadFiles=function(t,i){if(!i.nameUrl||!i.catalogueUrl)return o.open(n.LEVEL.DEBUG,"Not valid options for StarProvider","nameUrl and catalogueUrl attributes must be passed"),!1;var r={type:"GET",url:i.nameUrl,success:function(e){s=e},error:function(e,t,r){o.open(n.LEVEL.ERROR,"Failed ot request "+i.nameUrl,e.responseText)}},c={type:"GET",url:i.catalogueUrl,success:function(e){a=e},error:function(e,t,r){o.open(n.LEVEL.ERROR,"Failed ot request "+i.catalogueUrl,e.responseText)}};e.proxy(e.when(e.ajax(r),e.ajax(c)).then(function(){l.handleFeatures(t)},u))},c.prototype.handleFeatures=function(e){for(var t=s.slice(s.indexOf("897;Acamar"),s.indexOf("1231;Zaurak")+11),r=t.split("\n"),o=(t=a.slice(a.indexOf("001."),a.indexOf("4.98;K3Ibv")+10)).split("\n"),l=[],u=0;u<r.length;u++)for(var c=r[u].split(";"),h=parseInt(c[0],10),d=c[1],p=0;p<o.length;p++)if(c=o[p].split(";"),parseInt(c[2],10)===h){var f=c[6],g=c[7],m=[];e.globe.getCoordinateSystem().getDecimalDegFromSexagesimal([f,g],m);var v={geometry:{type:n.GEOMETRY.Point,gid:"star_"+d,coordinates:[m[0],m[1]],crs:{type:"name",properties:{name:n.CRS.Equatorial}}},properties:{name:d,style:new i({label:d,fillColor:[1,1,1,1]})}};l.push(v)}var y={type:"FeatureCollection",features:l};e.addFeatureCollection(y)},c}),r("gw/Provider/CraterProvider",["jquery","./AbstractProvider","../Utils/Utils","../Renderer/FeatureStyle","../Utils/Constants","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o){const s=[1,1,1,1];var a,l,u=function(e){t.prototype.constructor.call(this,e),a=this};return i.inherits(t,u),u.prototype.loadFiles=function(e,t){i.requestUrl(t.url,"text","text/plain",null,function(t){l="string"==typeof t?JSON.parse(t):t,a.handleFeatures(e)},function(e){o.open(n.LEVEL.ERROR,"Failed ot request "+t.url,e)})},u.prototype.handleFeatures=function(e){for(var t=l.crs,i=l.features,n=e.options.pointMaxSize?e.options.pointMaxSize:20,o=e.getStyle().getStrokeColor()?e.getStyle().getStrokeColor():s,a=0;a<i.length;a++){var u=i[a];u.geometry.crs=t;var c=u.properties.name;u.properties.style=new r({label:c,strokeColor:o,pointMaxSize:n})}e.addFeatureCollection(l)},u}),r("gw/Provider/TrajectoryProvider",["jquery","./AbstractProvider","../Renderer/FeatureStyle","../Utils/Utils","../Utils/Constants","../Services/MeasureToolPlanetCore","../Gui/dialog/ErrorDialog"],function(e,t,i,r,n,o,s){var a,l,u,c,h;var d=function(e){r.requestUrl(c,"text","plain/text",null,function(t){var r=function(e){for(var t=[],i=e.split("\n"),r=0;r<i.length;r++){var n=i[r];if(!n.startsWith("#")){var o=n.split(",");if(o.length>1){var s=parseFloat(o[0]),a=parseFloat(o[1]),l=o[2];t.push([s,a,l])}}}return t}(t),s=function(e){for(var t=[],i=1;i<e.length;i++){var r=[];r.push(e[i-1]),r.push(e[i]),t.push(r)}return t}(r),a=function(e){return[e[0][2],e[e.length-1][2]]}(r),l=new i({iconUrl:"css/images/lander.png",strokeColor:i.fromStringToColor("white"),fillColor:i.fromStringToColor("white")}),c=function(e,t,i,r){return{type:"Feature",geometry:{type:n.GEOMETRY.MultiLineString,gid:"trajectory"+t+"_"+i,coordinates:r.trajectory},properties:{title:i,thumbnail:h.thumbnailPath,abstract:h.abstractPath,startDate:r.dates[0],endDate:r.dates[1],distance:function(e){for(var t=0,i=e[0],r=1;r<e.length;r++){var n=e[r];t+=o.calculateDistanceElevation(i[0],n[0]),i=n}return 1e3*t}(r.trajectory).toFixed()+" meters"}}}(0,n.GEOMETRY.MultiLineString,e.name,{trajectory:s,color:"white",dates:a});u={type:"FeatureCollection",crs:{type:"name",properties:{name:"IAU2000:30101"}},features:[c,{type:"Feature",properties:{title:"Landing site",style:l,thumbnail:"http://space.skyrocket.de/img_sat/team-indus__1.jpg",abstract:'The <a href="http://www.teamindus.in/mission/" class="selectValue">Team Indus Lunar Lander</a> is a lunar lander developed by the Indian nonprofit organisation Team Indus. It is an entry to win the Google Lunar XPRIZE (GLXP).<p>The Team Indus Lunar Lander is a lunar lander, which has a propulsion system to enable itself to leave earth orbit and to enter a trajectory to the moon. After landing it will deploy the Indian ECA (Ek Choti si Asha) rover, which will move to a distance of at least 500 m to satisfy the rules of the GLXP. <p>The propulsion system is bipropellant, consisting of a single 440 N prime thruster and sixteen 22 N thrusters. <p>Once deployed from the rocket, the spacecraft will orbit the earth twice. In a manoeuvre called the trans-lunar injection by which it will successfully leave Earth’s orbit, the rocket engines will be fired to set course to the Moon. At this point, the craft will be traveling at the maximum speed of 10.5 km/s—almost 39600 km/h for the distance of 384400 km within 10 days. When roughly 100 km from the Moon, it will perform another manoeuvre called the Lunar Orbit Capture to eventually settle into a parking orbit. By now, the craft will have decelerated to 800 m/s. These extreme variations in speed will consume most of the spacecraft’s fuel.The landing phase of the mission will be initiated at a 100 km × 100 km orbit around the Moon. The entire process will be controlled by software onboard the spacecraft using data collected from laser sensors. These sensors will detect and analysis the surface, orienting the craft accordingly. Considering that manual control of the craft at this point is impossible, automation and preprogramming is the only way to go. At a time optimised to coincide with the lunar dawn on Mare Imbrium, the spacecraft thrusters will be fired again to decrease the orbit for a soft touchdown.The Team Indus Lunar Lander is a lunar lander developed by the Indian nonprofit organisation Team Indus. It is an entry to win the Google Lunar XPRIZE (GLXP).The Team Indus Lunar Lander is a lunar lander, which has a propulsion system to enable itself to leave earth orbit and to enter a trajectory to the moon. After landing it will deploy the Indian ECA (Ek Choti si Asha) rover, which will move to a distance of at least 500 m to satisfy the rules of the GLXP.The propulsion system is bipropellant, consisting of a single 440 N prime thruster and sixteen 22 N thrusters.Once deployed from the rocket, the spacecraft will orbit the earth twice. In a manoeuvre called the trans-lunar injection by which it will successfully leave Earth’s orbit, the rocket engines will be fired to set course to the Moon. At this point, the craft will be traveling at the maximum speed of 10.5 km/s—almost 39600 km/h for the distance of 384400 km within 10 days. When roughly 100 km from the Moon, it will perform another manoeuvre called the Lunar Orbit Capture to eventually settle into a parking orbit. By now, the craft will have decelerated to 800 m/s. These extreme variations in speed will consume most of the spacecraft’s fuel.The landing phase of the mission will be initiated at a 100 km × 100 km orbit around the Moon. The entire process will be controlled by software onboard the spacecraft using data collected from laser sensors. These sensors will detect and analysis the surface, orienting the craft accordingly. Considering that manual control of the craft at this point is impossible, automation and preprogramming is the only way to go. At a time optimised to coincide with the lunar dawn on <a href="https://en.wikipedia.org/wiki/Mare_Imbrium" class="selectValue">Mare Imbrium</a>, the spacecraft thrusters will be fired again to decrease the orbit for a soft touchdown.'},geometry:{type:"Point",coordinates:[-25.680079147,29.5212266285]}}]},e.addFeatureCollection(u)},function(e){s.open(n.LEVEL.ERROR,"Failed ot request "+c,e)})};var p=function(e){t.prototype.constructor.call(this,e),a=this};return r.inherits(t,p),p.prototype.loadFiles=function(e,t){h=t,l=t.interval?t.interval:6e4,c=t.url,a.handleFeatures(e)},p.prototype.handleFeatures=function(e){d(e),setInterval(function(){e.removeFeatureCollection(u),d(e)},l)},p}),r("gw/Provider/ProviderFactory",["./ConstellationProvider","./PlanetProvider","./StarProvider","./CraterProvider","./TrajectoryProvider","../Utils/Constants"],function(e,t,i,r,n,o){return{create:function(s,a){var l;switch(s){case o.PROVIDER.Constellation:l=new e(a);break;case o.PROVIDER.Crater:l=new r(a);break;case o.PROVIDER.Planet:l=new t(a);break;case o.PROVIDER.Star:l=new i(a);break;case o.PROVIDER.Trajectory:l=new n(a);break;default:throw new RangeError("unable to create the provider "+s,"ProviderFactory.js")}return l}}}),r("gw/Utils/Stats",[],function(){var e=function(e,t){this.type=null,e.getRenderContext().stats=this,this.context=e;var i=t?t.element:void 0;i&&("string"==typeof i?(this.element=document.getElementById(i),this.type="dom"):(this.element=i,this.type="jquery")),this.showFPS=this.context.globe.continuousRendering,this.verbose=!(!t||!t.verbose)&&t.verbose,this.numFrames=0;var r=this;window.setInterval(function(){r.print()},1e3)};return e.prototype.start=function(e){this[e]=Date.now()},e.prototype.end=function(e){var t=Date.now()-this[e],i=this["max_"+e]||-1;i<t&&(i=t);var r=this["sum_"+e]||0;r+=t,this[e]=t,this["max_"+e]=i,this["sum_"+e]=r,"globalRenderTime"===e&&this.numFrames++},e.prototype.print=function(){if(this.numFrames>0){var e="";this.showFPS&&(e+="FPS : "+this.numFrames+"<br>"),e+="Average render time : "+(this.sum_globalRenderTime/this.numFrames).toFixed(2)+" ms",this.verbose&&(e+="<br>Average traverse tiles time : "+(this.sum_traverseTime/this.numFrames).toFixed(2)+" ms",e+="<br>Average render tiles time : "+(this.sum_renderTime/this.numFrames).toFixed(2)+" ms",e+="<br>Average generate tiles time : "+(this.sum_generateTime/this.numFrames).toFixed(2)+" ms",e+="<br>Average request tiles time : "+(this.sum_requestTime/this.numFrames).toFixed(2)+" ms",e+="<br>Max render time : "+this.max_globalRenderTime+" ms",e+="<br>Max traverse tiles time : "+this.max_traverseTime+" ms",e+="<br>Max render tiles time : "+this.max_renderTime+" ms",e+="<br>Max generate tiles time : "+this.max_generateTime+" ms",e+="<br>Max request tiles time : "+this.max_requestTime+" ms"),this.element&&("dom"===this.type?this.element.innerHTML=e:"jquery"===this.type&&this.element.html(e)),this.sum_globalRenderTime=0,this.sum_traverseTime=0,this.sum_renderTime=0,this.sum_generateTime=0,this.sum_requestTime=0,this.max_globalRenderTime=0,this.max_traverseTime=0,this.max_renderTime=0,this.max_generateTime=0,this.max_requestTime=0,this.numFrames=0}},e}),r("gw/Mizar",["jquery","underscore-min","./Context/ContextFactory","./Navigation/NavigationFactory","./Layer/LayerFactory","./Crs/CoordinateSystemFactory","./Animation/AnimationFactory","./Utils/UtilityFactory","./Services/ServiceFactory","./Provider/ProviderFactory","./Utils/Utils","./Utils/Event","./Utils/Stats","./Utils/Constants","./Gui/dialog/ErrorDialog","./Layer/HipsMetadata","./Time/Time","./Utils/Proxy"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v){const y=p.API.version,b=30,x="Mizar.min",w="Mizar.";var T=function(e){h.prototype.constructor.call(this),function(e){if(void 0===e)throw new ReferenceError("No option found","Mizar.js");if(void 0===e.canvas)throw new TypeError("Canvas not defined","Mizar.js")}(e),this.options=function(e){var t=function(){var e=document.getElementsByTagName("script");return _.call(this,e,x,-1)||_.call(this,e,w,-2)||""}(),i={canvas:"string"==typeof e.canvas?document.getElementById(e.canvas):e.canvas};e.hasOwnProperty("configuration")?i.configuration=e.configuration:i.configuration={};i.configuration.mizarAPIUrl=t,e.hasOwnProperty("skyContext")&&(i.skyContext=e.skyContext);e.hasOwnProperty("planetContext")&&(i.planetContext=e.planetContext);e.hasOwnProperty("groundContext")&&(i.groundContext=e.groundContext);return i}(e),f.setDebug(!!this.options.configuration.debug&&this.options.configuration.debug),this.ContextFactory=i,this.LayerFactory=n;const t=this.options.configuration.proxyUse||!1;v.setProxyUse(t),t&&v.setProxyUrl(this.options.configuration.proxyUrl),this.AnimationFactory=s,this.ServiceFactory=l,this.UtilityFactory=a,this.ProviderFactory=u,this.TimeUtility=m,this.skyContext=null,this.planetContext=null,this.groundContext=null,this.activatedContext=null,this.renderContext=null,this.dataProviders={},e.skyContext&&(e.skyContext.isMobile=e.isMobile,this.createContext(T.CONTEXT.Sky,e.skyContext),this.setActivatedContext(T.CONTEXT.Sky)),e.planetContext&&(e.planetContext.isMobile=e.isMobile,this.createContext(T.CONTEXT.Planet,e.planetContext),this.setActivatedContext(T.CONTEXT.Planet)),e.groundContext&&(e.groundContext.isMobile=e.isMobile,this.createContext(T.CONTEXT.Ground,e.groundContext),this.setActivatedContext(T.CONTEXT.Ground))};function _(e,i,r){var n=t.find(e,function(e){return-1!==e.src.indexOf(i)});return n&&(n=n.src.split("/").slice(0,r).join("/")+"/"),n}function C(){(function(){void 0!==this.getActivatedContext()._atmosphereLayer&&null!==this.getActivatedContext()._atmosphereLayer.globe&&(this.getActivatedContext()._saveAtmosphereVisible=this.getActivatedContext()._atmosphereLayer.visible,this.getActivatedContext()._atmosphereLayer.setVisible(!1),this.render())}).call(this),this.skyContext&&this.skyContext.disable(),function(e){null!==e&&90-Math.abs(e[1])<=b?this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:T.PROJECTION.Azimuth,pole:Math.sign(e[1])>0?"north":"south"}):this.setCrs({geoideName:this.getCrs().getGeoideName(),projectionName:T.PROJECTION.Plate})}.call(this,this.getActivatedContext().navigation.getCenter())}function S(i,r){void 0!==r&&r.hasOwnProperty("registry")&&r.registry.hasOwnProperty("hips")&&c.requestUrl(r.registry.hips,"json","application/json",null,function(r){t.each(r,function(t){(function e(t,i){if(0===t.length)return i(void 0);var r=t.shift();c.requestUrl(r+"/properties","text","text/plain",null,function(e){i(r)},function(r){e(t,i)})})(function(e){var t=[];return e.hips_service_url&&t.push(e.hips_service_url),e.hips_service_url_1&&t.push(e.hips_service_url_1),e.hips_service_url_2&&t.push(e.hips_service_url_2),t}(t),function(r){if(void 0===r){var n="";return n=void 0===t.obs_title?"with ID <b>"+t.ID+"</b>":"with title <b>"+t.obs_title+"</b>",void f.open(p.LEVEL.ERROR," Cannot add layer "+n,"no mirror available")}e.proxy(E,i)(t,r)})},i)},function(e){f.open(p.LEVEL.WARNING,"Cannot connect to "+r.registry.hips,e.message)})}function E(e,t){try{if(e.hasOwnProperty("hips_status")&&null===e.hips_status.match("public"))return;e.hips_service_url=t,this.addLayer({type:T.LAYER.Hips,hipsMetadata:new g(e)})}catch(t){var i=e.obs_title?e.obs_title:e.obs_collection;f.open(p.LEVEL.ERROR,"Hips layer "+i+" not valid for "+e.hips_service_url,t.message)}}function A(e){var t;switch(e){case void 0:t=this.getActivatedContext();break;case T.CONTEXT.Sky:t=this.getSkyContext();break;case T.CONTEXT.Planet:t=this.getPlanetContext();break;case T.CONTEXT.Ground:t=this.getGroundContext();break;default:throw new RangeError("The mode "+e+" is not allowed, A valid mode is included in the list CONTEXT","Mizar.js")}return t}return T.VERSION=y,T.ANIMATION=p.ANIMATION,T.LAYER=p.LAYER,T.INFORMATION_TYPE=p.INFORMATION_TYPE,T.GEOMETRY=p.GEOMETRY,T.NAVIGATION=p.NAVIGATION,T.CONTEXT=p.CONTEXT,T.PROJECTION=p.PROJECTION,T.CRS=p.CRS,T.CRS_TO_CONTEXT=p.CRS_TO_CONTEXT,T.DISPLAY=p.DISPLAY,T.SERVICE=p.SERVICE,T.UTILITY=p.UTILITY,T.PROVIDER=p.PROVIDER,T.EVENT_MSG=p.EVENT_MSG,T.TIME_STEP=p.TIME_STEP,c.inherits(h,T),T.prototype.getSkyContext=function(){return this.skyContext},T.prototype.getPlanetContext=function(){return this.planetContext},T.prototype.getGroundContext=function(){return this.groundContext},T.prototype.getActivatedContext=function(){try{if(null==this.activatedContext)if(null!=this.skyContext)this.activatedContext=this.skyContext;else if(null!=this.planetContext)this.activatedContext=this.planetContext;else{if(null==this.groundContext)throw new ReferenceError("No created context","Mizar.js");this.activatedContext=this.groundContext}}catch(e){f.open(p.LEVEL.ERROR,"Cannot get the context",e.message)}return this.activatedContext},T.prototype.setActivatedContext=function(e){switch(e){case T.CONTEXT.Planet:this.activatedContext=this.planetContext,!0;break;case T.CONTEXT.Sky:this.activatedContext=this.skyContext,!0;break;case T.CONTEXT.Ground:this.activatedContext=this.groundContext,!0;break;default:!1,f.open(p.LEVEL.ERROR,"Cannot set the context to "+e)}},T.prototype.getMode=function(){var e=this.getActivatedContext();return e?e.getMode():null},T.prototype.getRenderContext=function(){var e=this.getActivatedContext();return e?e.getRenderContext():null},T.prototype.getOptions=function(){return this.options},T.prototype.getCrs=function(){var e=this.getActivatedContext();return e?e.getCoordinateSystem():null},T.prototype.setCrs=function(e){var t,i=this.getActivatedContext();if(i){var r=o.create(e);i.setCoordinateSystem(r),t=!0}else t=!1;return t},T.prototype.updateTimeTravel=function(e){this.getServiceByName(T.SERVICE.TimeTravel).update(e)},T.prototype.setTime=function(e){this.activatedContext.setTime(e)},T.prototype.getTime=function(){return this.activatedContext.getTime()},T.prototype.createContext=function(e,t){var i;try{t.renderContext=this.renderContext,t.timeTravelService=this.getServiceByName(T.SERVICE.TimeTravel),t.isMobile=this.getOptions().configuration.isMobile;var r=this.ContextFactory.create(e,this.getOptions(),t);switch(e){case T.CONTEXT.Sky:this.skyContext=r,S(this,this.getOptions().configuration);break;case T.CONTEXT.Planet:this.planetContext=r;break;case T.CONTEXT.Ground:this.groundContext=r;break;default:throw new RangeError("Unknown contextMode '"+e+"'","Mizar.js")}this.renderContext=r.getRenderContext(),i=!0}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot create the context",e.message)}return i},T.prototype.toggleDimension=function(){var e;try{(function(){if(this.getActivatedContext().getMode()===T.CONTEXT.Sky)throw new RangeError("Toggle Dimension is not implemented for Sky","Mizar.js")}).call(this),this.getCrs().isFlat()?function(){(function(){void 0!==this.getActivatedContext()._atmosphereLayer&&null!==this.getActivatedContext()._atmosphereLayer.globe&&(this.getActivatedContext()._atmosphereLayer.setVisible(this.getActivatedContext()._saveAtmosphereVisible),this.render())}).call(this),this.skyContext&&this.skyContext.enable(),this.setCrs({geoideName:this.getCrs().getGeoideName()}),this.planetContext.navigation.zoom(0)}.call(this):C.call(this),this.render(),e=!0}catch(t){e=!1,f.open(p.LEVEL.ERROR,"Cannot toggle the dimension",t.message)}return e},T.prototype.toggleToContext=function(e,t){var i;try{this.getActivatedContext().getMode()===T.CONTEXT.Sky?T.CONTEXT.Planet:T.CONTEXT.Sky;(function(e,t){e&&e.globe&&(e.globe.isEnable=!1);var i,r,n=this,o=!!t.hasOwnProperty("mustBeDestroyed")&&t.mustBeDestroyed,s=!!t.hasOwnProperty("mustBeHidden")&&t.mustBeHidden;this.getActivatedContext().hide(),this.getActivatedContext().hideAdditionalLayers(),e.hasOwnProperty("_oldVM")&&e.hasOwnProperty("_oldFov")?(i=e._oldVM,r=e._oldFov):void 0===e.getNavigation().inverseViewMatrix?(this.getActivatedContext()._oldVM=this.renderContext.getViewMatrix(),this.getActivatedContext()._oldFov=this.renderContext.getFov(),i=e.getNavigation().getRenderContext().getViewMatrix(),r=90):(this.getActivatedContext()._oldVM=this.renderContext.getViewMatrix(),this.getActivatedContext()._oldFov=this.renderContext.getFov(),i=mat4.create(),e.getNavigation().computeInverseViewMatrix(),mat4.inverse(e.getNavigation().inverseViewMatrix,i),r=90),o?this.getActivatedContext().destroy():s&&this.getActivatedContext().disable(),this.activatedContext=e,e.getNavigation().getRenderContext().cameraUpdateFunction||(e.getNavigation().getRenderContext().cameraUpdateFunction=e.getNavigation().update.bind(e.getNavigation())),e.getNavigation().toViewMatrix(i,r,2e3,function(){e&&(e.enable(),e&&e.globe&&(e.globe.isEnable=!0)),t&&t.callback&&t.callback.call(n),e.showAdditionalLayers(),n.getActivatedContext().show(),n.publish(p.EVENT_MSG.MIZAR_MODE_TOGGLE,e),n.getActivatedContext().refresh(),"undefined"!==n.getRenderContext().viewMatrix[0]&&n.getActivatedContext().getNavigation().computeViewMatrix()})}).call(this,e,t||{}),i=!0}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot toggle the context",e.message)}return i},T.prototype.getSkyLayers=function(){var e=this.getSkyContext();return e?e.getLayers():null},T.prototype.getPlanetLayers=function(){var e=this.getPlanetContext();return e?e.getLayers():null},T.prototype.getGroundLayers=function(){var e=this.getGroundContext();return e?e.getLayers():null},T.prototype.getLayers=function(e){var t;try{t=A.call(this,e).getLayers()}catch(e){t=null,f.open(p.LEVEL.ERROR,"Cannot get the layers",e.message)}return t},T.prototype.setLayerOnTheTop=function(e){var t,i=this.getLayerByID(e);return null!=i?(i.setOnTheTop(),t=!0):(t=!1,f.open(p.LEVEL.ERROR,"Cannot set the layer on the top",e+" does not exist")),t},T.prototype.getAllLayers=function(){return t.union(this.getSkyLayers(),this.getPlanetLayers())},T.prototype.getLayerByID=function(e,t){var i;try{i=A.call(this,t).getLayerByID(e)}catch(e){i=null,f.open(p.LEVEL.ERROR,"Cannot get the layer by ID",e.message)}return i},T.prototype.getLayerByName=function(e,t){var i;try{i=A.call(this,t).getLayerByName(e)}catch(e){i=null,f.open(p.LEVEL.ERROR,"Cannot get the layer by name",e.message)}return i},T.prototype.addLayer=function(e,t,i){this.getActivatedContext().addLayer(e,t,i)},T.prototype.removeLayer=function(e,t){var i;try{i=void 0!==A.call(this,t).removeLayer(e)}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot remove the layer",e.message)}return i},T.prototype.setBackgroundLayer=function(e,t){var i;try{i=void 0!==A.call(this,t).setBackgroundLayer(e)}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot set the background",e.message)}return i},T.prototype.setBackgroundLayerByID=function(e,t){var i;try{i=void 0!==A.call(this,t).setBackgroundLayerByID(e)}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot set the backgorund by ID",e.message)}return i},T.prototype.setBaseElevation=function(e,t){var i;try{var r=this.getLayerByName(e,t);i=void 0!==A.call(this,t).setBaseElevation(r)}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot set the base elevation",e.message)}return i},T.prototype.getBaseElevation=function(e){return A.call(this,e).getBaseElevation()},T.prototype.setBaseElevationByID=function(e,t){var i;try{i=void 0!==A.call(this,t).setBaseElevationByID(e)}catch(e){i=!1,f.open(p.LEVEL.ERROR,"Cannot set the base elevation by ID",e.message)}return i},T.prototype.searchOnLayerDescription=function(e,i){var r=this.getLayers(i);return t.filter(r,function(t){return String(t.getName()).indexOf(e)>=0||String(t.getDescription()||"").indexOf(e)>=0})},T.prototype.searchSkyLayer=function(e){var i=this.getSkyLayers();return t.filter(i,function(t){return String(t.getName()).indexOf(e)>=0||String(t.getDescription()||"").indexOf(e)>=0})},T.prototype.searchPlanetLayer=function(e){var i=this.getPlanetLayers();return t.filter(i,function(t){return String(t.getName()).indexOf(e)>=0||String(t.getDescription()||"").indexOf(e)>=0})},T.prototype.registerNoStandardDataProvider=function(e,t,i){var r;try{A.call(this,i).registerNoStandardDataProvider(e,t),r=!0}catch(e){r=!1,f.open(p.LEVEL.ERROR,"Cannot register the data provider",e.message)}return r},T.prototype.getServiceByName=function(e,t){var i;try{i=l.create(e,t)}catch(e){i=null,f.open(p.LEVEL.ERROR,"Cannot get the service by name",e.message)}return i},T.prototype.createStats=function(e){var t;return this.skyContext?(this.Stats=new d(this.skyContext,e),t=!0):this.planetContext?(this.Stats=new d(this.planetContext,e),t=!0):this.groundContext?(this.Stats=new d(this.groundContext,e),t=!0):(t=!1,f.open("Cannot create the stats",!0)),t},T.prototype.render=function(){var e;return this.getRenderContext()?(this.getRenderContext().frame(),e=!0):e=!1,e},T.prototype.dispose=function(){this.planetContext&&this.planetContext.dispose(),this.skyContext&&this.skyContext.dispose(),this.groundContext&&this.groundContext.dispose()},T.prototype.reloadLayer=function(e){var t=this.getActivatedContext();t?(t.getTileManager().abortLayerRequests(e),e._detach(t.globe),e._attach(t.globe)):f.open(p.LEVEL.WARNING,"Context not yet available")},T.prototype.destroy=function(){this.planetContext&&this.planetContext.destroy(),this.skyContext&&this.skyContext.destroy(),this.groundContext&&this.groundContext.destroy(),this.activatedContext=null,this.renderContext=null,this.ContextFactory=null,this.LayerFactory=null,this.AnimationFactory=null,this.ServiceFactory=null,this.UtilityFactory=null},window.Mizar=T,T}),r("utils/UtilsCore",["wcs","gw/Mizar"],function(t,i){var r,n;function o(e,i){var r=t.pixelToCoordinate([e,i]);return r.ra>180&&(r.ra-=360),[r.ra,r.dec]}var s=function(e){var t=e[0]*Math.PI/180,i=e[1]*Math.PI/180;return[Math.cos(i)*Math.cos(t),Math.cos(i)*Math.sin(t),Math.sin(i)]},a=function(e){return e<0?-1:e>0?1:0};return{init:function(e,t){r=e,n="TODO must be implemented in JS"},inherits:function(e,t){function i(){}i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t},generateColor:function(){var e=Math.random();return e+=.618033988749895,function(e,t,i){var r,n,o,s=Math.floor(6*e),a=6*e-s,l=i*(1-t),u=i*(1-a*t),c=i*(1-(1-a)*t);switch(s){case 0:r=i,n=c,o=l;break;case 1:r=u,n=i,o=l;break;case 2:r=l,n=i,o=c;break;case 3:r=l,n=u,o=i;break;case 4:r=c,n=l,o=i;break;case 5:r=i,n=l,o=u;break;default:r=1,n=1,o=1}return[r,n,o]}(e%=1,.5,.95)},formatId:function(e){return"string"==typeof e?e.replace(/\s{1,}|\.{1,}|\[{1,}|\]{1,}|\({1,}|\){1,}|\~{1,}|\+{1,}|\°{1,}|\-{1,}|\'{1,}|\"{1,}/g,""):e},getPolygonCoordinatesFromFits:function(e){var i=e.getHDU(),r=i.data;t=new WCS.Mapper(i.header);var n=[];return n.push(o(0,r.height)),n.push(o(r.width,r.height)),n.push(o(r.width,0)),n.push(o(0,0)),n.push(n[0]),n},computeGeometryBarycenter:function(e){var t,i,n=0,o=0,s=0;switch(e.type){case r.GEOMETRY.MultiLineString:t=e.coordinates[0][0][0],i=e.coordinates[0][0][1];break;case r.GEOMETRY.LineString:t=e.coordinates[0][0],i=e.coordinates[0][1];break;case r.GEOMETRY.Point:t=e.coordinates[0],i=e.coordinates[1];break;case r.GEOMETRY.Polygon:for(var a=0;a<e.coordinates[0].length-1;a++)n+=e.coordinates[0][a][0],o+=e.coordinates[0][a][1],s++;t=n/s,i=o/s;break;case r.GEOMETRY.MultiPolygon:for(a=0;a<e.coordinates.length;a++)for(var l=e.coordinates[a][0],u=0;u<l.length-1;u++)n+=l[u][0],o+=l[u][1],s++;t=n/s,i=o/s;break;case r.GEOMETRY.LineString:t=n/s,i=o/s;break;default:return}return[t,i]},pointInRing:function(e,t){for(var i,r,n,o,l,u,c,h,d,p,f,g,m=t.length,v=0,y=s(e),b=s([e[0],e[1]+90]),x=0;x<m-1;x++)i=s(t[x]),r=s(t[x+1]),n=y,o=b,l=vec3.cross(i,r,[]),u=vec3.cross(n,o,[]),c=vec3.normalize(vec3.cross(l,u,[])),h=vec3.dot(vec3.cross(i,l,[]),c),d=vec3.dot(vec3.cross(r,l,[]),c),p=vec3.dot(vec3.cross(n,u,[]),c),f=vec3.dot(vec3.cross(o,u,[]),c),g=a(-h)+a(d)+a(-p)+a(f),4==Math.abs(g)&&v++;return v%2==1},pointInSphere:function(e,t,i){var n=[],o=[],s=r.getRenderContext().computePixelSizeVector();r.getCrs().get3DFromWorld(e,n),r.getCrs().get3DFromWorld(t,o);var a=i*(s[0]*o[0]+s[1]*o[1]+s[2]*o[2]+s[3]),l=[];return vec3.subtract(n,o,l),(l=vec3.dot(l,l))<a*a},pointInLine:function(e,t,i){var r,n,o=i[0]-t[0];return!!(0==o?e[0]==t[0]:(n=(e[0]-t[0])/o)>=0&&n<=1)&&(r=i[1]-t[1],0==o?e[1]==t[1]:(n=(e[1]-t[1])/r)>=0&&n<=1)},getAstroCoordinatesFromCursorLocation:function(e,t,i){var r=[];return e.getCoordinateSystem().getWorldFrom3D(t.center3d,r),_.isEmpty(i)&&(i=[]),e.getCoordinateSystem().getLHVTransform(r,i),e.getCoordinateSystem().formatCoordinates([r[0],r[1]])},getHEALPixCutCoordinates:function(t,i,r){for(var n=[[0,0],[i.getRenderContext().canvas.width,0],[i.getRenderContext().canvas.width,i.getRenderContext().canvas.height],[0,i.getRenderContext().canvas.height]],o=0;o<n.length;o++){var s=i.getLonLatFromPixel(n[o][0],n[o][1]);n[o]=s}var a=[];this.getAstroCoordinatesFromCursorLocation(i,r,a);var l=[a[4],a[5],a[6]],u=vec3.dot(r.up,l),c=Math.acos(u);if(isNaN(c))console.error("North is NaN'ed...");else{var h=180*c/Math.PI;globe.renderContext.viewMatrix[8]<0&&(h*=-1);var d=parseFloat(e("#cdelt1").val()),p=parseFloat(e("#cdelt2").val());i.globe.baseImagery;if(context.fileName||ErrorDialog.open("FITS fileName isn't defined for HealpixCut service<br/>"),!isNaN(d)&&!isNaN(p))return{long1:n[0][0],lat1:n[0][1],long2:n[1][0],lat2:n[1][1],long3:n[2][0],lat3:n[2][1],long4:n[3][0],lat4:n[3][1],rotation:h,coordinateSystem:"Equatorial",cdelt1:d,cdelt2:p,filename:context.fileName,PHASE:"RUN"};e("#HEALPixCut").find("input").each(function(){e(this).val()||e(this).addClass("inputError")})}},isHipsFitsLayer:function(e){return e.type==i.LAYER.Hips&&1==e.fitsSupported},isHipsLayer:function(e){return e.type==i.LAYER.Hips&&0==e.fitsSupported},isOpenSearchLayer:function(e){return e.type==i.LAYER.OpenSearch},isVectorLayer:function(e){return e.type==i.LAYER.Vector},isGeoJsonLayer:function(e){return e.type==i.LAYER.GeoJSON},isMocLayer:function(e){return e.type==i.LAYER.Moc},isHipsCatLayer:function(e){return e.type==i.LAYER.HipsCat},convertVotable2JsonFromURL:function(e,t){var i=new XMLHttpRequest;i.open("GET",e),i.onload=function(){i.responseXML?this.convertVotable2JsonFromXML(i.responseText,t):console.log("No XML response")},i.onerror=function(t){console.log("Error getting table "+e+"\n("+t+")")},i.send(null)},convertVotable2JsonFromXML:function(t,i){try{e.ajax({type:"POST",url:n,data:{votable:t,coordinateSystem:"EQUATORIAL"},success:function(e){i(e)},error:function(e){console.error(e)}})}catch(e){console.log("Error displaying table:\n"+e.toString())}}}}),r("gui/dialog/ErrorDialog",["jquery","jquery.ui"],function(e){var t=e('<div id="errorDiv" style="text-align: justify" title="Error"></div>').appendTo("body").dialog({autoOpen:!1,resizable:!0,draggable:!0,width:"300px",minHeight:"auto",maxHeight:"300px",dialogClass:"errorBox"});return{open:function(e){console.log("htlml",e),t.html(e).dialog("open")}}}),r("text",["module"],function(e){"use strict";var i,r,n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,a="undefined"!=typeof location&&location.href,l=a&&location.protocol&&location.protocol.replace(/\:/,""),u=a&&location.hostname,c=a&&(location.port||void 0),h=[],d=e.config&&e.config()||{};return i={version:"2.0.5",strip:function(e){if(e){var t=(e=e.replace(o,"")).match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){i=n[t];try{e=new ActiveXObject(i)}catch(e){}if(e){n=[i];break}}return e},parseName:function(e){var t,i,r,n=!1,o=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==o&&(!s||o>1)?(t=e.substring(0,o),i=e.substring(o+1,e.length)):t=e,-1!==(o=(r=i||t).indexOf("!"))&&(n="strip"===r.substring(o+1),r=r.substring(0,o),i?i=r:t=r),{moduleName:t,ext:i,strip:n}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,t,r,n){var o,s,a,l=i.xdRegExp.exec(e);return!l||(o=l[2],a=(s=(s=l[3]).split(":"))[1],s=s[0],!(o&&o!==t||s&&s.toLowerCase()!==r.toLowerCase()||(a||s)&&a!==n))},finishLoad:function(e,t,r,n){r=t?i.strip(r):r,d.isBuild&&(h[e]=r),n(r)},load:function(e,t,r,n){if(!n.isBuild||n.inlineText){d.isBuild=n.isBuild;var o=i.parseName(e),s=o.moduleName+(o.ext?"."+o.ext:""),h=t.toUrl(s),p=d.useXhr||i.useXhr;!a||p(h,l,u,c)?i.get(h,function(t){i.finishLoad(e,o.strip,t,r)},function(e){r.error&&r.error(e)}):t([s],function(e){i.finishLoad(o.moduleName+"."+o.ext,o.strip,e,r)})}else r()},write:function(e,t,r,n){if(h.hasOwnProperty(t)){var o=i.jsEscape(h[t]);r.asModule(e+"!"+t,"define(function () { return '"+o+"';});\n")}},writeFile:function(e,t,r,n,o){var s=i.parseName(t),a=s.ext?"."+s.ext:"",l=s.moduleName+a,u=r.toUrl(s.moduleName+a)+".js";i.load(l,r,function(t){var r=function(e){return n(u,e)};r.asModule=function(e,t){return n.asModule(e,u,t)},i.write(e,l,r,o)},o)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(r=t.nodeRequire("fs"),i.get=function(e,t){var i=r.readFileSync(e,"utf8");0===i.indexOf("\ufeff")&&(i=i.substring(1)),t(i)}):"xhr"===d.env||!d.env&&i.createXhr()?i.get=function(e,t,r,n){var o,s=i.createXhr();if(s.open("GET",e,!0),n)for(o in n)n.hasOwnProperty(o)&&s.setRequestHeader(o.toLowerCase(),n[o]);d.onXhr&&d.onXhr(s,e),s.onreadystatechange=function(i){var n,o;4===s.readyState&&((n=s.status)>399&&n<600?((o=new Error(e+" HTTP status: "+n)).xhr=s,r(o)):t(s.responseText))},s.send(null)}:("rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(i.get=function(e,t){var i,r,n=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(n),"utf-8")),a="";try{for(i=new java.lang.StringBuffer,(r=s.readLine())&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),i.append(r);null!==(r=s.readLine());)i.append(o),i.append(r);a=String(i.toString())}finally{s.close()}t(a)}),i}),r("text!templates/openSearchService.html",[],function(){return'<div id="openSearchTabs">\n    <ul>\n    </ul>\n</div>'}),r("text!templates/openSearchForm.html",[],function(){return'<form class="osForm" id="openSearchForm_<%= layer.id %>">\n    <table>\n    <tr>\n    <%\n    cpt = -1;\n    for(var i=0; i<layer.getServices().queryForm.parameters.length; i++)\n    {\n    var parameter = layer.getServices().queryForm.parameters[i];\n    if (parameter.isDisplayed === true) {\n      cpt++;\n    %>\n    <td><label <%= parameter.titleAttribute %> for="<%= parameter.name %>"><%= parameter.name %></label></td>\n    <td>\n    <%\n    // Options parameter\n    // ==================\n    if (parameter.type === "options")\n    {\n    %>\n      <select name="p_<%= parameter.name %>" id="p_<%= parameter.name %>">\n        <option value="">None</option>\n        <%\n        for(var j=0; j<parameter.options.length; j++)\n        {\n        %>\n        <option <% if ( parameter.options[j] === parameter.currentValue ){ %>selected <%}%> value="<%= parameter.options[j] %>"><%= parameter.options[j] %></option>\n        <%\n        }\n        %>\n        </select>\n        <%\n      } else if (parameter.type === "datetime") {\n        %>\n        <input type="text" id="p_<%= parameter.name %>" <%= parameter.titleAttribute %> <%= parameter.patternAttribute %> class="datetimepicker" value="<%= parameter.currentValue %>" autocomplete="off"></input>\n        <%\n      } else if (parameter.type === "number") {\n        %>\n        <input size="8" type="text" id="p_<%= parameter.name %>" <%= parameter.titleAttribute %> <%= parameter.patternAttribute %> name="<%= parameter.name %>" value="<%= parameter.currentValue %>">\n        <%\n      } else {\n    %>\n      <input size="16" type="text" id="p_<%= parameter.name %>" <%= parameter.titleAttribute %> <%= parameter.patternAttribute %> name="<%= parameter.name %>" value="<%= parameter.currentValue %>">\n    <%\n      } \n      %>\n      </td>\n      <% if (cpt % 2 ===0) {\n      %>\n      </tr><tr>\n      <%\n      }\n     } else {\n      %>\n      <input size="16" type="hidden" id="p_<%= parameter.name %>" value="<%= parameter.currentValue %>">\n      <%\n      }\n    }\n    %>\n      </tr>\n    </table>\n    <button class="submitFormParams" id="submitFormParams">Save parameters</button>\n  </form>\n'}),c=function(e){var t,i,r=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],n="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],o=Array.prototype.slice;if(e.event.fixHooks)for(var s=r.length;s;)e.event.fixHooks[r[--s]]=e.event.mouseHooks;var a=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=n.length;t;)this.addEventListener(n[--t],l,!1);else this.onmousewheel=l;e.data(this,"mousewheel-line-height",a.getLineHeight(this)),e.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=n.length;t;)this.removeEventListener(n[--t],l,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),r=i["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(r){var n,s=r||window.event,l=o.call(arguments,1),h=0,d=0,p=0,f=0,g=0;if((r=e.event.fix(s)).type="mousewheel","detail"in s&&(p=-1*s.detail),"wheelDelta"in s&&(p=s.wheelDelta),"wheelDeltaY"in s&&(p=s.wheelDeltaY),"wheelDeltaX"in s&&(d=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(d=-1*p,p=0),h=0===p?d:p,"deltaY"in s&&(h=p=-1*s.deltaY),"deltaX"in s&&(d=s.deltaX,0===p&&(h=-1*d)),0!==p||0!==d){if(1===s.deltaMode){var m=e.data(this,"mousewheel-line-height");h*=m,p*=m,d*=m}else if(2===s.deltaMode){var v=e.data(this,"mousewheel-page-height");h*=v,p*=v,d*=v}if(n=Math.max(Math.abs(p),Math.abs(d)),(!i||n<i)&&(i=n,c(s,n)&&(i/=40)),c(s,n)&&(h/=40,d/=40,p/=40),h=Math[h>=1?"floor":"ceil"](h/i),d=Math[d>=1?"floor":"ceil"](d/i),p=Math[p>=1?"floor":"ceil"](p/i),a.settings.normalizeOffset&&this.getBoundingClientRect){var y=this.getBoundingClientRect();f=r.clientX-y.left,g=r.clientY-y.top}return r.deltaX=d,r.deltaY=p,r.deltaFactor=i,r.offsetX=f,r.offsetY=g,r.deltaMode=0,l.unshift(r,h,d,p),t&&clearTimeout(t),t=setTimeout(u,200),(e.event.dispatch||e.event.handle).apply(this,l)}}function u(){i=null}function c(e,t){return a.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})},"function"==typeof r&&r.amd?r("jquery-mousewheel",["jquery"],c):"object"==typeof exports?module.exports=c:c(jQuery);var d;return function(e){"function"==typeof r&&r.amd?r("jquery.datetimepicker",["jquery","jquery-mousewheel"],e):"object"==typeof exports?module.exports=e(t("jquery")):e(jQuery)}(function(e){"use strict";var t={i18n:{ar:{months:["كانون الثاني","شباط","آذار","نيسان","مايو","حزيران","تموز","آب","أيلول","تشرين الأول","تشرين الثاني","كانون الأول"],dayOfWeekShort:["ن","ث","ع","خ","ج","س","ح"],dayOfWeek:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت","الأحد"]},ro:{months:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],dayOfWeekShort:["Du","Lu","Ma","Mi","Jo","Vi","Sâ"],dayOfWeek:["Duminică","Luni","Marţi","Miercuri","Joi","Vineri","Sâmbătă"]},id:{months:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],dayOfWeekShort:["Min","Sen","Sel","Rab","Kam","Jum","Sab"],dayOfWeek:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"]},is:{months:["Janúar","Febrúar","Mars","Apríl","Maí","Júní","Júlí","Ágúst","September","Október","Nóvember","Desember"],dayOfWeekShort:["Sun","Mán","Þrið","Mið","Fim","Fös","Lau"],dayOfWeek:["Sunnudagur","Mánudagur","Þriðjudagur","Miðvikudagur","Fimmtudagur","Föstudagur","Laugardagur"]},bg:{months:["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],dayOfWeekShort:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],dayOfWeek:["Неделя","Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота"]},fa:{months:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],dayOfWeekShort:["یکشنبه","دوشنبه","سه شنبه","چهارشنبه","پنجشنبه","جمعه","شنبه"],dayOfWeek:["یک‌شنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه","یک‌شنبه"]},ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeekShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayOfWeek:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},uk:{months:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],dayOfWeekShort:["Ндл","Пнд","Втр","Срд","Чтв","Птн","Сбт"],dayOfWeek:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},el:{months:["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],dayOfWeekShort:["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],dayOfWeek:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeekShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayOfWeek:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeekShort:["zo","ma","di","wo","do","vr","za"],dayOfWeek:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeekShort:["Paz","Pts","Sal","Çar","Per","Cum","Cts"],dayOfWeek:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeekShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayOfWeek:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeekShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayOfWeek:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeekShort:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],dayOfWeek:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัส","ศุกร์","เสาร์","อาทิตย์"]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeekShort:["nd","pn","wt","śr","cz","pt","sb"],dayOfWeek:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeekShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],dayOfWeek:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeekShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},km:{months:["មករា​","កុម្ភៈ","មិនា​","មេសា​","ឧសភា​","មិថុនា​","កក្កដា​","សីហា​","កញ្ញា​","តុលា​","វិច្ឆិកា","ធ្នូ​"],dayOfWeekShort:["អាទិ​","ច័ន្ទ​","អង្គារ​","ពុធ​","ព្រហ​​","សុក្រ​","សៅរ៍"],dayOfWeek:["អាទិត្យ​","ច័ន្ទ​","អង្គារ​","ពុធ​","ព្រហស្បតិ៍​","សុក្រ​","សៅរ៍"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeekShort:["일","월","화","수","목","금","토"],dayOfWeek:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeekShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayOfWeek:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"]},da:{months:["Januar","Februar","Marts","April","Maj","Juni","Juli","August","September","Oktober","November","December"],dayOfWeekShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayOfWeek:["søndag","mandag","tirsdag","onsdag","torsdag","fredag","lørdag"]},no:{months:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],dayOfWeekShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayOfWeek:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"]},ja:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeekShort:["日","月","火","水","木","金","土"],dayOfWeek:["日曜","月曜","火曜","水曜","木曜","金曜","土曜"]},vi:{months:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayOfWeekShort:["CN","T2","T3","T4","T5","T6","T7"],dayOfWeek:["Chủ nhật","Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy"]},sl:{months:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],dayOfWeekShort:["Ned","Pon","Tor","Sre","Čet","Pet","Sob"],dayOfWeek:["Nedelja","Ponedeljek","Torek","Sreda","Četrtek","Petek","Sobota"]},cs:{months:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],dayOfWeekShort:["Ne","Po","Út","St","Čt","Pá","So"]},hu:{months:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],dayOfWeekShort:["Va","Hé","Ke","Sze","Cs","Pé","Szo"],dayOfWeek:["vasárnap","hétfő","kedd","szerda","csütörtök","péntek","szombat"]},az:{months:["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"],dayOfWeekShort:["B","Be","Ça","Ç","Ca","C","Ş"],dayOfWeek:["Bazar","Bazar ertəsi","Çərşənbə axşamı","Çərşənbə","Cümə axşamı","Cümə","Şənbə"]},bs:{months:["Januar","Februar","Mart","April","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],dayOfWeekShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayOfWeek:["Nedjelja","Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"]},ca:{months:["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"],dayOfWeekShort:["Dg","Dl","Dt","Dc","Dj","Dv","Ds"],dayOfWeek:["Diumenge","Dilluns","Dimarts","Dimecres","Dijous","Divendres","Dissabte"]},"en-GB":{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},et:{months:["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],dayOfWeekShort:["P","E","T","K","N","R","L"],dayOfWeek:["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"]},eu:{months:["Urtarrila","Otsaila","Martxoa","Apirila","Maiatza","Ekaina","Uztaila","Abuztua","Iraila","Urria","Azaroa","Abendua"],dayOfWeekShort:["Ig.","Al.","Ar.","Az.","Og.","Or.","La."],dayOfWeek:["Igandea","Astelehena","Asteartea","Asteazkena","Osteguna","Ostirala","Larunbata"]},fi:{months:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],dayOfWeekShort:["Su","Ma","Ti","Ke","To","Pe","La"],dayOfWeek:["sunnuntai","maanantai","tiistai","keskiviikko","torstai","perjantai","lauantai"]},gl:{months:["Xan","Feb","Maz","Abr","Mai","Xun","Xul","Ago","Set","Out","Nov","Dec"],dayOfWeekShort:["Dom","Lun","Mar","Mer","Xov","Ven","Sab"],dayOfWeek:["Domingo","Luns","Martes","Mércores","Xoves","Venres","Sábado"]},hr:{months:["Siječanj","Veljača","Ožujak","Travanj","Svibanj","Lipanj","Srpanj","Kolovoz","Rujan","Listopad","Studeni","Prosinac"],dayOfWeekShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayOfWeek:["Nedjelja","Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"]},ko:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeekShort:["일","월","화","수","목","금","토"],dayOfWeek:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},lt:{months:["Sausio","Vasario","Kovo","Balandžio","Gegužės","Birželio","Liepos","Rugpjūčio","Rugsėjo","Spalio","Lapkričio","Gruodžio"],dayOfWeekShort:["Sek","Pir","Ant","Tre","Ket","Pen","Šeš"],dayOfWeek:["Sekmadienis","Pirmadienis","Antradienis","Trečiadienis","Ketvirtadienis","Penktadienis","Šeštadienis"]},lv:{months:["Janvāris","Februāris","Marts","Aprīlis ","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],dayOfWeekShort:["Sv","Pr","Ot","Tr","Ct","Pk","St"],dayOfWeek:["Svētdiena","Pirmdiena","Otrdiena","Trešdiena","Ceturtdiena","Piektdiena","Sestdiena"]},mk:{months:["јануари","февруари","март","април","мај","јуни","јули","август","септември","октомври","ноември","декември"],dayOfWeekShort:["нед","пон","вто","сре","чет","пет","саб"],dayOfWeek:["Недела","Понеделник","Вторник","Среда","Четврток","Петок","Сабота"]},mn:{months:["1-р сар","2-р сар","3-р сар","4-р сар","5-р сар","6-р сар","7-р сар","8-р сар","9-р сар","10-р сар","11-р сар","12-р сар"],dayOfWeekShort:["Дав","Мяг","Лха","Пүр","Бсн","Бям","Ням"],dayOfWeek:["Даваа","Мягмар","Лхагва","Пүрэв","Баасан","Бямба","Ням"]},"pt-BR":{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeekShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayOfWeek:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"]},sk:{months:["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],dayOfWeekShort:["Ne","Po","Ut","St","Št","Pi","So"],dayOfWeek:["Nedeľa","Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota"]},sq:{months:["Janar","Shkurt","Mars","Prill","Maj","Qershor","Korrik","Gusht","Shtator","Tetor","Nëntor","Dhjetor"],dayOfWeekShort:["Die","Hën","Mar","Mër","Enj","Pre","Shtu"],dayOfWeek:["E Diel","E Hënë","E Martē","E Mërkurë","E Enjte","E Premte","E Shtunë"]},"sr-YU":{months:["Januar","Februar","Mart","April","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],dayOfWeekShort:["Ned","Pon","Uto","Sre","čet","Pet","Sub"],dayOfWeek:["Nedelja","Ponedeljak","Utorak","Sreda","Četvrtak","Petak","Subota"]},sr:{months:["јануар","фебруар","март","април","мај","јун","јул","август","септембар","октобар","новембар","децембар"],dayOfWeekShort:["нед","пон","уто","сре","чет","пет","суб"],dayOfWeek:["Недеља","Понедељак","Уторак","Среда","Четвртак","Петак","Субота"]},sv:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeekShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],dayOfWeek:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"]},"zh-TW":{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},zh:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},ug:{months:["1-ئاي","2-ئاي","3-ئاي","4-ئاي","5-ئاي","6-ئاي","7-ئاي","8-ئاي","9-ئاي","10-ئاي","11-ئاي","12-ئاي"],dayOfWeek:["يەكشەنبە","دۈشەنبە","سەيشەنبە","چارشەنبە","پەيشەنبە","جۈمە","شەنبە"]},he:{months:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],dayOfWeekShort:["א'","ב'","ג'","ד'","ה'","ו'","שבת"],dayOfWeek:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת","ראשון"]},hy:{months:["Հունվար","Փետրվար","Մարտ","Ապրիլ","Մայիս","Հունիս","Հուլիս","Օգոստոս","Սեպտեմբեր","Հոկտեմբեր","Նոյեմբեր","Դեկտեմբեր"],dayOfWeekShort:["Կի","Երկ","Երք","Չոր","Հնգ","Ուրբ","Շբթ"],dayOfWeek:["Կիրակի","Երկուշաբթի","Երեքշաբթի","Չորեքշաբթի","Հինգշաբթի","Ուրբաթ","Շաբաթ"]},kg:{months:["Үчтүн айы","Бирдин айы","Жалган Куран","Чын Куран","Бугу","Кулжа","Теке","Баш Оона","Аяк Оона","Тогуздун айы","Жетинин айы","Бештин айы"],dayOfWeekShort:["Жек","Дүй","Шей","Шар","Бей","Жум","Ише"],dayOfWeek:["Жекшемб","Дүйшөмб","Шейшемб","Шаршемб","Бейшемби","Жума","Ишенб"]},rm:{months:["Schaner","Favrer","Mars","Avrigl","Matg","Zercladur","Fanadur","Avust","Settember","October","November","December"],dayOfWeekShort:["Du","Gli","Ma","Me","Gie","Ve","So"],dayOfWeek:["Dumengia","Glindesdi","Mardi","Mesemna","Gievgia","Venderdi","Sonda"]},ka:{months:["იანვარი","თებერვალი","მარტი","აპრილი","მაისი","ივნისი","ივლისი","აგვისტო","სექტემბერი","ოქტომბერი","ნოემბერი","დეკემბერი"],dayOfWeekShort:["კვ","ორშ","სამშ","ოთხ","ხუთ","პარ","შაბ"],dayOfWeek:["კვირა","ორშაბათი","სამშაბათი","ოთხშაბათი","ხუთშაბათი","პარასკევი","შაბათი"]}},ownerDocument:document,contentWindow:window,value:"",rtl:!1,format:"Y/m/d H:i",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnTimeSelect:!0,closeOnWithoutClick:!0,closeOnInputClick:!0,openOnFocus:!0,timepicker:!0,datepicker:!0,weeks:!1,defaultTime:!1,defaultDate:!1,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,minDateTime:!1,maxDateTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,theme:"",touchMovedThreshold:5,onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onGetWeekOfYear:function(){},onChangeYear:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,parentID:"body",timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,prevButton:!0,nextButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,monthStart:0,monthEnd:11,style:"",id:"",fixed:!1,roundTime:"round",className:"",weekends:[],highlightedDates:[],highlightedPeriods:[],allowDates:[],allowDateRe:null,disabledDates:[],disabledWeekDays:[],yearOffset:0,beforeShowDay:null,enterLikeTab:!0,showApplyButton:!1},i=null,r=null,n="en",o={meridiem:["AM","PM"]},s=function(){var s=t.i18n[n],a={days:s.dayOfWeek,daysShort:s.dayOfWeekShort,months:s.months,monthsShort:e.map(s.months,function(e){return e.substring(0,3)})};"function"==typeof d&&(i=r=new d({dateSettings:e.extend({},o,a)}))},a={moment:{default_options:{format:"YYYY/MM/DD HH:mm",formatDate:"YYYY/MM/DD",formatTime:"HH:mm"},formatter:{parseDate:function(e,t){if(u(t))return r.parseDate(e,t);var i=moment(e,t);return!!i.isValid()&&i.toDate()},formatDate:function(e,t){return u(t)?r.formatDate(e,t):moment(e).format(t)},formatMask:function(e){return e.replace(/Y{4}/g,"9999").replace(/Y{2}/g,"99").replace(/M{2}/g,"19").replace(/D{2}/g,"39").replace(/H{2}/g,"29").replace(/m{2}/g,"59").replace(/s{2}/g,"59")}}}};e.datetimepicker={setLocale:function(e){var i=t.i18n[e]?e:"en";n!==i&&(n=i,s())},setDateFormatter:function(r){if("string"==typeof r&&a.hasOwnProperty(r)){var n=a[r];e.extend(t,n.default_options),i=n.formatter}else i=r}};var l={RFC_2822:"D, d M Y H:i:s O",ATOM:"Y-m-dTH:i:sP",ISO_8601:"Y-m-dTH:i:sO",RFC_822:"D, d M y H:i:s O",RFC_850:"l, d-M-y H:i:s T",RFC_1036:"D, d M y H:i:s O",RFC_1123:"D, d M Y H:i:s O",RSS:"D, d M Y H:i:s O",W3C:"Y-m-dTH:i:sP"},u=function(e){return-1!==Object.values(l).indexOf(e)};function c(e,t,i){this.date=e,this.desc=t,this.style=i}e.extend(e.datetimepicker,l),s(),window.getComputedStyle||(window.getComputedStyle=function(e){return this.el=e,this.getPropertyValue=function(t){var i=/(-([a-z]))/g;return"float"===t&&(t="styleFloat"),i.test(t)&&(t=t.replace(i,function(e,t,i){return i.toUpperCase()})),e.currentStyle[t]||null},this}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var i,r;for(i=t||0,r=this.length;i<r;i+=1)if(this[i]===e)return i;return-1}),Date.prototype.countDaysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()},e.fn.xdsoftScroller=function(t,i){return this.each(function(){var r,n,o,s,a,l=e(this),u=function(e){var t,i={x:0,y:0};return"touchstart"===e.type||"touchmove"===e.type||"touchend"===e.type||"touchcancel"===e.type?(t=e.originalEvent.touches[0]||e.originalEvent.changedTouches[0],i.x=t.clientX,i.y=t.clientY):"mousedown"!==e.type&&"mouseup"!==e.type&&"mousemove"!==e.type&&"mouseover"!==e.type&&"mouseout"!==e.type&&"mouseenter"!==e.type&&"mouseleave"!==e.type||(i.x=e.clientX,i.y=e.clientY),i},c=100,h=!1,d=0,p=0,f=0,g=!1,m=0,v=function(){};"hide"!==i?(e(this).hasClass("xdsoft_scroller_box")||(r=l.children().eq(0),n=l[0].clientHeight,o=r[0].offsetHeight,s=e('<div class="xdsoft_scrollbar"></div>'),a=e('<div class="xdsoft_scroller"></div>'),s.append(a),l.addClass("xdsoft_scroller_box").append(s),v=function(e){var t=u(e).y-d+m;t<0&&(t=0),t+a[0].offsetHeight>f&&(t=f-a[0].offsetHeight),l.trigger("scroll_element.xdsoft_scroller",[c?t/c:0])},a.on("touchstart.xdsoft_scroller mousedown.xdsoft_scroller",function(r){n||l.trigger("resize_scroll.xdsoft_scroller",[i]),d=u(r).y,m=parseInt(a.css("margin-top"),10),f=s[0].offsetHeight,"mousedown"===r.type||"touchstart"===r.type?(t.ownerDocument&&e(t.ownerDocument.body).addClass("xdsoft_noselect"),e([t.ownerDocument.body,t.contentWindow]).on("touchend mouseup.xdsoft_scroller",function i(){e([t.ownerDocument.body,t.contentWindow]).off("touchend mouseup.xdsoft_scroller",i).off("mousemove.xdsoft_scroller",v).removeClass("xdsoft_noselect")}),e(t.ownerDocument.body).on("mousemove.xdsoft_scroller",v)):(g=!0,r.stopPropagation(),r.preventDefault())}).on("touchmove",function(e){g&&(e.preventDefault(),v(e))}).on("touchend touchcancel",function(){g=!1,m=0}),l.on("scroll_element.xdsoft_scroller",function(e,t){n||l.trigger("resize_scroll.xdsoft_scroller",[t,!0]),t=t>1?1:t<0||isNaN(t)?0:t,a.css("margin-top",c*t),setTimeout(function(){r.css("marginTop",-parseInt((r[0].offsetHeight-n)*t,10))},10)}).on("resize_scroll.xdsoft_scroller",function(e,t,i){var u,h;n=l[0].clientHeight,o=r[0].offsetHeight,h=(u=n/o)*s[0].offsetHeight,u>1?a.hide():(a.show(),a.css("height",parseInt(h>10?h:10,10)),c=s[0].offsetHeight-a[0].offsetHeight,!0!==i&&l.trigger("scroll_element.xdsoft_scroller",[t||Math.abs(parseInt(r.css("marginTop"),10))/(o-n)]))}),l.on("mousewheel",function(e){var t=Math.abs(parseInt(r.css("marginTop"),10));return(t-=20*e.deltaY)<0&&(t=0),l.trigger("scroll_element.xdsoft_scroller",[t/(o-n)]),e.stopPropagation(),!1}),l.on("touchstart",function(e){h=u(e),p=Math.abs(parseInt(r.css("marginTop"),10))}),l.on("touchmove",function(e){if(h){e.preventDefault();var t=u(e);l.trigger("scroll_element.xdsoft_scroller",[(p-(t.y-h.y))/(o-n)])}}),l.on("touchend touchcancel",function(){h=!1,p=0})),l.trigger("resize_scroll.xdsoft_scroller",[i])):l.find(".xdsoft_scrollbar").hide()})},e.fn.datetimepicker=function(r,o){var s,a,l=this,u=48,h=57,d=96,p=105,f=17,g=46,m=13,v=27,y=8,b=37,x=38,w=39,T=40,_=9,C=116,S=65,E=67,A=86,I=90,M=89,k=!1,D=e.isPlainObject(r)||!r?e.extend(!0,{},t,r):e.extend(!0,{},t),R=0;return s=function(t){var o,s,a,l,R,P,L=e('<div class="xdsoft_datetimepicker xdsoft_noselect"></div>'),N=e('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net</a></div>'),O=e('<div class="xdsoft_datepicker active"></div>'),F=e('<div class="xdsoft_monthpicker"><button type="button" class="xdsoft_prev"></button><button type="button" class="xdsoft_today_button"></button><div class="xdsoft_label xdsoft_month"><span></span><i></i></div><div class="xdsoft_label xdsoft_year"><span></span><i></i></div><button type="button" class="xdsoft_next"></button></div>'),B=e('<div class="xdsoft_calendar"></div>'),G=e('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"></button><div class="xdsoft_time_box"></div><button type="button" class="xdsoft_next"></button></div>'),U=G.find(".xdsoft_time_box").eq(0),z=e('<div class="xdsoft_time_variant"></div>'),V=e('<button type="button" class="xdsoft_save_selected blue-gradient-button">Save Selected</button>'),j=e('<div class="xdsoft_select xdsoft_monthselect"><div></div></div>'),W=e('<div class="xdsoft_select xdsoft_yearselect"><div></div></div>'),Y=!1,H=0;D.id&&L.attr("id",D.id),D.style&&L.attr("style",D.style),D.weeks&&L.addClass("xdsoft_showweeks"),D.rtl&&L.addClass("xdsoft_rtl"),L.addClass("xdsoft_"+D.theme),L.addClass(D.className),F.find(".xdsoft_month span").after(j),F.find(".xdsoft_year span").after(W),F.find(".xdsoft_month,.xdsoft_year").on("touchstart mousedown.xdsoft",function(t){var i,r,n=e(this).find(".xdsoft_select").eq(0),o=0,s=0,a=n.is(":visible");for(F.find(".xdsoft_select").hide(),R.currentTime&&(o=R.currentTime[e(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),n[a?"hide":"show"](),i=n.find("div.xdsoft_option"),r=0;r<i.length&&i.eq(r).data("value")!==o;r+=1)s+=i[0].offsetHeight;return n.xdsoftScroller(D,s/(n.children()[0].offsetHeight-n[0].clientHeight)),t.stopPropagation(),!1});var q=function(e){var t=e.originalEvent,i=t.touches?t.touches[0]:t;this.touchStartPosition=this.touchStartPosition||i;var r=Math.abs(this.touchStartPosition.clientX-i.clientX),n=Math.abs(this.touchStartPosition.clientY-i.clientY);Math.sqrt(r*r+n*n)>D.touchMovedThreshold&&(this.touchMoved=!0)};function X(){var e,i=!1;return D.startDate?i=R.strToDate(D.startDate):(i=D.value||(t&&t.val&&t.val()?t.val():""))?(i=R.strToDateTime(i),D.yearOffset&&(i=new Date(i.getFullYear()-D.yearOffset,i.getMonth(),i.getDate(),i.getHours(),i.getMinutes(),i.getSeconds(),i.getMilliseconds()))):D.defaultDate&&(i=R.strToDateTime(D.defaultDate),D.defaultTime&&(e=R.strtotime(D.defaultTime),i.setHours(e.getHours()),i.setMinutes(e.getMinutes()))),i&&R.isValidDate(i)?L.data("changed",!0):i="",i||0}function Z(r){var n=function(e,t){var i=e.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return new RegExp(i).test(t)},o=function(e,t){if(!(e="string"==typeof e||e instanceof String?r.ownerDocument.getElementById(e):e))return!1;if(e.createTextRange){var i=e.createTextRange();return i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select(),!0}return!!e.setSelectionRange&&(e.setSelectionRange(t,t),!0)};r.mask&&t.off("keydown.xdsoft"),!0===r.mask&&(i.formatMask?r.mask=i.formatMask(r.format):r.mask=r.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59")),"string"===e.type(r.mask)&&(n(r.mask,t.val())||(t.val(r.mask.replace(/[0-9]/g,"_")),o(t[0],0)),t.on("paste.xdsoft",function(i){var s=(i.clipboardData||i.originalEvent.clipboardData||window.clipboardData).getData("text"),a=this.value,l=this.selectionStart;return a=a.substr(0,l)+s+a.substr(l+s.length),l+=s.length,n(r.mask,a)?(this.value=a,o(this,l)):""===e.trim(a)?this.value=r.mask.replace(/[0-9]/g,"_"):t.trigger("error_input.xdsoft"),i.preventDefault(),!1}),t.on("keydown.xdsoft",function(i){var s,a=this.value,l=i.which,c=this.selectionStart,D=this.selectionEnd,R=c!==D;if(l>=u&&l<=h||l>=d&&l<=p||l===y||l===g){for(s=l===y||l===g?"_":String.fromCharCode(d<=l&&l<=p?l-u:l),l===y&&c&&!R&&(c-=1);;){var P=r.mask.substr(c,1),L=c<r.mask.length,N=c>0;if(!(/[^0-9_]/.test(P)&&L&&N))break;c+=l!==y||R?1:-1}if(R){var O=D-c,F=r.mask.replace(/[0-9]/g,"_"),B=F.substr(c,O).substr(1);a=a.substr(0,c)+(s+B)+a.substr(c+O)}else a=a.substr(0,c)+s+a.substr(c+1);if(""===e.trim(a))a=F;else if(c===r.mask.length)return i.preventDefault(),!1;for(c+=l===y?0:1;/[^0-9_]/.test(r.mask.substr(c,1))&&c<r.mask.length&&c>0;)c+=l===y?0:1;n(r.mask,a)?(this.value=a,o(this,c)):""===e.trim(a)?this.value=r.mask.replace(/[0-9]/g,"_"):t.trigger("error_input.xdsoft")}else if(-1!==[S,E,A,I,M].indexOf(l)&&k||-1!==[v,x,T,b,w,C,f,_,m].indexOf(l))return!0;return i.preventDefault(),!1}))}F.find(".xdsoft_select").xdsoftScroller(D).on("touchstart mousedown.xdsoft",function(e){var t=e.originalEvent;this.touchMoved=!1,this.touchStartPosition=t.touches?t.touches[0]:t,e.stopPropagation(),e.preventDefault()}).on("touchmove",".xdsoft_option",q).on("touchend mousedown.xdsoft",".xdsoft_option",function(){if(!this.touchMoved){void 0!==R.currentTime&&null!==R.currentTime||(R.currentTime=R.now());var t=R.currentTime.getFullYear();R&&R.currentTime&&R.currentTime[e(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"](e(this).data("value")),e(this).parent().parent().hide(),L.trigger("xchange.xdsoft"),D.onChangeMonth&&e.isFunction(D.onChangeMonth)&&D.onChangeMonth.call(L,R.currentTime,L.data("input")),t!==R.currentTime.getFullYear()&&e.isFunction(D.onChangeYear)&&D.onChangeYear.call(L,R.currentTime,L.data("input"))}}),L.getValue=function(){return R.getCurrentTime()},L.setOptions=function(r){var n={};D=e.extend(!0,{},D,r),r.allowTimes&&e.isArray(r.allowTimes)&&r.allowTimes.length&&(D.allowTimes=e.extend(!0,[],r.allowTimes)),r.weekends&&e.isArray(r.weekends)&&r.weekends.length&&(D.weekends=e.extend(!0,[],r.weekends)),r.allowDates&&e.isArray(r.allowDates)&&r.allowDates.length&&(D.allowDates=e.extend(!0,[],r.allowDates)),r.allowDateRe&&"[object String]"===Object.prototype.toString.call(r.allowDateRe)&&(D.allowDateRe=new RegExp(r.allowDateRe)),r.highlightedDates&&e.isArray(r.highlightedDates)&&r.highlightedDates.length&&(e.each(r.highlightedDates,function(t,r){var o,s=e.map(r.split(","),e.trim),a=new c(i.parseDate(s[0],D.formatDate),s[1],s[2]),l=i.formatDate(a.date,D.formatDate);void 0!==n[l]?(o=n[l].desc)&&o.length&&a.desc&&a.desc.length&&(n[l].desc=o+"\n"+a.desc):n[l]=a}),D.highlightedDates=e.extend(!0,[],n)),r.highlightedPeriods&&e.isArray(r.highlightedPeriods)&&r.highlightedPeriods.length&&(n=e.extend(!0,[],D.highlightedDates),e.each(r.highlightedPeriods,function(t,r){var o,s,a,l,u,h,d;if(e.isArray(r))o=r[0],s=r[1],a=r[2],d=r[3];else{var p=e.map(r.split(","),e.trim);o=i.parseDate(p[0],D.formatDate),s=i.parseDate(p[1],D.formatDate),a=p[2],d=p[3]}for(;o<=s;)l=new c(o,a,d),u=i.formatDate(o,D.formatDate),o.setDate(o.getDate()+1),void 0!==n[u]?(h=n[u].desc)&&h.length&&l.desc&&l.desc.length&&(n[u].desc=h+"\n"+l.desc):n[u]=l}),D.highlightedDates=e.extend(!0,[],n)),r.disabledDates&&e.isArray(r.disabledDates)&&r.disabledDates.length&&(D.disabledDates=e.extend(!0,[],r.disabledDates)),r.disabledWeekDays&&e.isArray(r.disabledWeekDays)&&r.disabledWeekDays.length&&(D.disabledWeekDays=e.extend(!0,[],r.disabledWeekDays)),!D.open&&!D.opened||D.inline||t.trigger("open.xdsoft"),D.inline&&(Y=!0,L.addClass("xdsoft_inline"),t.after(L).hide()),D.inverseButton&&(D.next="xdsoft_prev",D.prev="xdsoft_next"),D.datepicker?O.addClass("active"):O.removeClass("active"),D.timepicker?G.addClass("active"):G.removeClass("active"),D.value&&(R.setCurrentTime(D.value),t&&t.val&&t.val(R.str)),isNaN(D.dayOfWeekStart)?D.dayOfWeekStart=0:D.dayOfWeekStart=parseInt(D.dayOfWeekStart,10)%7,D.timepickerScrollbar||U.xdsoftScroller(D,"hide"),D.minDate&&/^[\+\-](.*)$/.test(D.minDate)&&(D.minDate=i.formatDate(R.strToDateTime(D.minDate),D.formatDate)),D.maxDate&&/^[\+\-](.*)$/.test(D.maxDate)&&(D.maxDate=i.formatDate(R.strToDateTime(D.maxDate),D.formatDate)),D.minDateTime&&/^\+(.*)$/.test(D.minDateTime)&&(D.minDateTime=R.strToDateTime(D.minDateTime).dateFormat(D.formatDate)),D.maxDateTime&&/^\+(.*)$/.test(D.maxDateTime)&&(D.maxDateTime=R.strToDateTime(D.maxDateTime).dateFormat(D.formatDate)),V.toggle(D.showApplyButton),F.find(".xdsoft_today_button").css("visibility",D.todayButton?"visible":"hidden"),F.find("."+D.prev).css("visibility",D.prevButton?"visible":"hidden"),F.find("."+D.next).css("visibility",D.nextButton?"visible":"hidden"),Z(D),D.validateOnBlur&&t.off("blur.xdsoft").on("blur.xdsoft",function(){if(D.allowBlank&&(!e.trim(e(this).val()).length||"string"==typeof D.mask&&e.trim(e(this).val())===D.mask.replace(/[0-9]/g,"_")))e(this).val(null),L.data("xdsoft_datetime").empty();else{var t=i.parseDate(e(this).val(),D.format);if(t)e(this).val(i.formatDate(t,D.format));else{var r=+[e(this).val()[0],e(this).val()[1]].join(""),n=+[e(this).val()[2],e(this).val()[3]].join("");!D.datepicker&&D.timepicker&&r>=0&&r<24&&n>=0&&n<60?e(this).val([r,n].map(function(e){return e>9?e:"0"+e}).join(":")):e(this).val(i.formatDate(R.now(),D.format))}L.data("xdsoft_datetime").setCurrentTime(e(this).val())}L.trigger("changedatetime.xdsoft"),L.trigger("close.xdsoft")}),D.dayOfWeekStartPrev=0===D.dayOfWeekStart?6:D.dayOfWeekStart-1,L.trigger("xchange.xdsoft").trigger("afterOpen.xdsoft")},L.data("options",D).on("touchstart mousedown.xdsoft",function(e){return e.stopPropagation(),e.preventDefault(),W.hide(),j.hide(),!1}),U.append(z),U.xdsoftScroller(D),L.on("afterOpen.xdsoft",function(){U.xdsoftScroller(D)}),L.append(O).append(G),!0!==D.withoutCopyright&&L.append(N),O.append(F).append(B).append(V),e(D.parentID).append(L),R=new function(){var t=this;t.now=function(e){var i,r,n=new Date;return!e&&D.defaultDate&&(i=t.strToDateTime(D.defaultDate),n.setFullYear(i.getFullYear()),n.setMonth(i.getMonth()),n.setDate(i.getDate())),n.setFullYear(n.getFullYear()),!e&&D.defaultTime&&(r=t.strtotime(D.defaultTime),n.setHours(r.getHours()),n.setMinutes(r.getMinutes()),n.setSeconds(r.getSeconds()),n.setMilliseconds(r.getMilliseconds())),n},t.isValidDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},t.setCurrentTime=function(e,i){"string"==typeof e?t.currentTime=t.strToDateTime(e):t.isValidDate(e)?t.currentTime=e:e||i||!D.allowBlank||D.inline?t.currentTime=t.now():t.currentTime=null,L.trigger("xchange.xdsoft")},t.empty=function(){t.currentTime=null},t.getCurrentTime=function(){return t.currentTime},t.nextMonth=function(){void 0!==t.currentTime&&null!==t.currentTime||(t.currentTime=t.now());var i,r=t.currentTime.getMonth()+1;return 12===r&&(t.currentTime.setFullYear(t.currentTime.getFullYear()+1),r=0),i=t.currentTime.getFullYear(),t.currentTime.setDate(Math.min(new Date(t.currentTime.getFullYear(),r+1,0).getDate(),t.currentTime.getDate())),t.currentTime.setMonth(r),D.onChangeMonth&&e.isFunction(D.onChangeMonth)&&D.onChangeMonth.call(L,R.currentTime,L.data("input")),i!==t.currentTime.getFullYear()&&e.isFunction(D.onChangeYear)&&D.onChangeYear.call(L,R.currentTime,L.data("input")),L.trigger("xchange.xdsoft"),r},t.prevMonth=function(){void 0!==t.currentTime&&null!==t.currentTime||(t.currentTime=t.now());var i=t.currentTime.getMonth()-1;return-1===i&&(t.currentTime.setFullYear(t.currentTime.getFullYear()-1),i=11),t.currentTime.setDate(Math.min(new Date(t.currentTime.getFullYear(),i+1,0).getDate(),t.currentTime.getDate())),t.currentTime.setMonth(i),D.onChangeMonth&&e.isFunction(D.onChangeMonth)&&D.onChangeMonth.call(L,R.currentTime,L.data("input")),L.trigger("xchange.xdsoft"),i},t.getWeekOfYear=function(t){if(D.onGetWeekOfYear&&e.isFunction(D.onGetWeekOfYear)){var i=D.onGetWeekOfYear.call(L,t);if(void 0!==i)return i}var r=new Date(t.getFullYear(),0,1);return 4!==r.getDay()&&r.setMonth(0,1+(4-r.getDay()+7)%7),Math.ceil(((t-r)/864e5+r.getDay()+1)/7)},t.strToDateTime=function(e){var r,n,o=[];return e&&e instanceof Date&&t.isValidDate(e)?e:((o=/^([+-]{1})(.*)$/.exec(e))&&(o[2]=i.parseDate(o[2],D.formatDate)),o&&o[2]?(r=o[2].getTime()-6e4*o[2].getTimezoneOffset(),n=new Date(t.now(!0).getTime()+parseInt(o[1]+"1",10)*r)):n=e?i.parseDate(e,D.format):t.now(),t.isValidDate(n)||(n=t.now()),n)},t.strToDate=function(e){if(e&&e instanceof Date&&t.isValidDate(e))return e;var r=e?i.parseDate(e,D.formatDate):t.now(!0);return t.isValidDate(r)||(r=t.now(!0)),r},t.strtotime=function(e){if(e&&e instanceof Date&&t.isValidDate(e))return e;var r=e?i.parseDate(e,D.formatTime):t.now(!0);return t.isValidDate(r)||(r=t.now(!0)),r},t.str=function(){var e=D.format;return D.yearOffset&&(e=(e=e.replace("Y",t.currentTime.getFullYear()+D.yearOffset)).replace("y",String(t.currentTime.getFullYear()+D.yearOffset).substring(2,4))),i.formatDate(t.currentTime,e)},t.currentTime=this.now()},V.on("touchend click",function(e){e.preventDefault(),L.data("changed",!0),R.setCurrentTime(X()),t.val(R.str()),L.trigger("close.xdsoft")}),F.find(".xdsoft_today_button").on("touchend mousedown.xdsoft",function(){L.data("changed",!0),R.setCurrentTime(0,!0),L.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){var e,i,r=R.getCurrentTime();r=new Date(r.getFullYear(),r.getMonth(),r.getDate()),e=R.strToDate(D.minDate),r<(e=new Date(e.getFullYear(),e.getMonth(),e.getDate()))||(i=R.strToDate(D.maxDate),r>(i=new Date(i.getFullYear(),i.getMonth(),i.getDate()))||(t.val(R.str()),t.trigger("change"),L.trigger("close.xdsoft")))}),F.find(".xdsoft_prev,.xdsoft_next").on("touchend mousedown.xdsoft",function(){var t=e(this),i=0,r=!1;!function e(n){t.hasClass(D.next)?R.nextMonth():t.hasClass(D.prev)&&R.prevMonth(),D.monthChangeSpinner&&(r||(i=setTimeout(e,n||100)))}(500),e([D.ownerDocument.body,D.contentWindow]).on("touchend mouseup.xdsoft",function t(){clearTimeout(i),r=!0,e([D.ownerDocument.body,D.contentWindow]).off("touchend mouseup.xdsoft",t)})}),G.find(".xdsoft_prev,.xdsoft_next").on("touchend mousedown.xdsoft",function(){var t=e(this),i=0,r=!1,n=110;!function e(o){var s=U[0].clientHeight,a=z[0].offsetHeight,l=Math.abs(parseInt(z.css("marginTop"),10));t.hasClass(D.next)&&a-s-D.timeHeightInTimePicker>=l?z.css("marginTop","-"+(l+D.timeHeightInTimePicker)+"px"):t.hasClass(D.prev)&&l-D.timeHeightInTimePicker>=0&&z.css("marginTop","-"+(l-D.timeHeightInTimePicker)+"px"),U.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(z[0].style.marginTop,10)/(a-s))]),n=n>10?10:n-10,r||(i=setTimeout(e,o||n))}(500),e([D.ownerDocument.body,D.contentWindow]).on("touchend mouseup.xdsoft",function t(){clearTimeout(i),r=!0,e([D.ownerDocument.body,D.contentWindow]).off("touchend mouseup.xdsoft",t)})}),o=0,L.on("xchange.xdsoft",function(s){clearTimeout(o),o=setTimeout(function(){void 0!==R.currentTime&&null!==R.currentTime||(R.currentTime=R.now());for(var o,s,a,l,u,c,h,d,p,f,g="",m=new Date(R.currentTime.getFullYear(),R.currentTime.getMonth(),1,12,0,0),v=0,y=R.now(),b=!1,x=!1,w=!1,T=!1,_=[],C=!0,S="";m.getDay()!==D.dayOfWeekStart;)m.setDate(m.getDate()-1);for(g+="<table><thead><tr>",D.weeks&&(g+="<th></th>"),o=0;o<7;o+=1)g+="<th>"+D.i18n[n].dayOfWeekShort[(o+D.dayOfWeekStart)%7]+"</th>";for(g+="</tr></thead>",g+="<tbody>",!1!==D.maxDate&&(b=R.strToDate(D.maxDate),b=new Date(b.getFullYear(),b.getMonth(),b.getDate(),23,59,59,999)),!1!==D.minDate&&(x=R.strToDate(D.minDate),x=new Date(x.getFullYear(),x.getMonth(),x.getDate())),!1!==D.minDateTime&&(w=R.strToDate(D.minDateTime),w=new Date(w.getFullYear(),w.getMonth(),w.getDate(),w.getHours(),w.getMinutes(),w.getSeconds())),!1!==D.maxDateTime&&(T=R.strToDate(D.maxDateTime),T=new Date(T.getFullYear(),T.getMonth(),T.getDate(),T.getHours(),T.getMinutes(),T.getSeconds())),!1!==T&&(f=31*(12*T.getFullYear()+T.getMonth())+T.getDate());v<R.currentTime.countDaysInMonth()||m.getDay()!==D.dayOfWeekStart||R.currentTime.getMonth()===m.getMonth();){_=[],v+=1,a=m.getDay(),l=m.getDate(),u=m.getFullYear(),M=m.getMonth(),c=R.getWeekOfYear(m),p="",_.push("xdsoft_date"),h=D.beforeShowDay&&e.isFunction(D.beforeShowDay.call)?D.beforeShowDay.call(L,m):null,D.allowDateRe&&"[object RegExp]"===Object.prototype.toString.call(D.allowDateRe)&&(D.allowDateRe.test(i.formatDate(m,D.formatDate))||_.push("xdsoft_disabled")),D.allowDates&&D.allowDates.length>0&&-1===D.allowDates.indexOf(i.formatDate(m,D.formatDate))&&_.push("xdsoft_disabled");var E=31*(12*m.getFullYear()+m.getMonth())+m.getDate();(!1!==b&&m>b||!1!==w&&m<w||!1!==x&&m<x||!1!==T&&E>f||h&&!1===h[0])&&_.push("xdsoft_disabled"),-1!==D.disabledDates.indexOf(i.formatDate(m,D.formatDate))&&_.push("xdsoft_disabled"),-1!==D.disabledWeekDays.indexOf(a)&&_.push("xdsoft_disabled"),t.is("[disabled]")&&_.push("xdsoft_disabled"),h&&""!==h[1]&&_.push(h[1]),R.currentTime.getMonth()!==M&&_.push("xdsoft_other_month"),(D.defaultSelect||L.data("changed"))&&i.formatDate(R.currentTime,D.formatDate)===i.formatDate(m,D.formatDate)&&_.push("xdsoft_current"),i.formatDate(y,D.formatDate)===i.formatDate(m,D.formatDate)&&_.push("xdsoft_today"),0!==m.getDay()&&6!==m.getDay()&&-1===D.weekends.indexOf(i.formatDate(m,D.formatDate))||_.push("xdsoft_weekend"),void 0!==D.highlightedDates[i.formatDate(m,D.formatDate)]&&(s=D.highlightedDates[i.formatDate(m,D.formatDate)],_.push(void 0===s.style?"xdsoft_highlighted_default":s.style),p=void 0===s.desc?"":s.desc),D.beforeShowDay&&e.isFunction(D.beforeShowDay)&&_.push(D.beforeShowDay(m)),C&&(g+="<tr>",C=!1,D.weeks&&(g+="<th>"+c+"</th>")),g+='<td data-date="'+l+'" data-month="'+M+'" data-year="'+u+'" class="xdsoft_date xdsoft_day_of_week'+m.getDay()+" "+_.join(" ")+'" title="'+p+'"><div>'+l+"</div></td>",m.getDay()===D.dayOfWeekStartPrev&&(g+="</tr>",C=!0),m.setDate(l+1)}g+="</tbody></table>",B.html(g),F.find(".xdsoft_label span").eq(0).text(D.i18n[n].months[R.currentTime.getMonth()]),F.find(".xdsoft_label span").eq(1).text(R.currentTime.getFullYear()+D.yearOffset),S="",M="";var A=0;if(!1!==D.minTime){var I=R.strtotime(D.minTime);A=60*I.getHours()+I.getMinutes()}var M,k=1440;(!1!==D.maxTime&&(I=R.strtotime(D.maxTime),k=60*I.getHours()+I.getMinutes()),!1!==D.minDateTime&&(I=R.strToDateTime(D.minDateTime),i.formatDate(R.currentTime,D.formatDate)===i.formatDate(I,D.formatDate)&&(M=60*I.getHours()+I.getMinutes())>A&&(A=M)),!1!==D.maxDateTime)&&(I=R.strToDateTime(D.maxDateTime),i.formatDate(R.currentTime,D.formatDate)===i.formatDate(I,D.formatDate)&&(M=60*I.getHours()+I.getMinutes())<k&&(k=M));if(d=function(r,n){var o,s=R.now(),a=D.allowTimes&&e.isArray(D.allowTimes)&&D.allowTimes.length;s.setHours(r),r=parseInt(s.getHours(),10),s.setMinutes(n),n=parseInt(s.getMinutes(),10),_=[];var l=60*r+n;(t.is("[disabled]")||l>=k||l<A)&&_.push("xdsoft_disabled"),(o=new Date(R.currentTime)).setHours(parseInt(R.currentTime.getHours(),10)),a||o.setMinutes(Math[D.roundTime](R.currentTime.getMinutes()/D.step)*D.step),(D.initTime||D.defaultSelect||L.data("changed"))&&o.getHours()===parseInt(r,10)&&(!a&&D.step>59||o.getMinutes()===parseInt(n,10))&&(D.defaultSelect||L.data("changed")?_.push("xdsoft_current"):D.initTime&&_.push("xdsoft_init_time")),parseInt(y.getHours(),10)===parseInt(r,10)&&parseInt(y.getMinutes(),10)===parseInt(n,10)&&_.push("xdsoft_today"),S+='<div class="xdsoft_time '+_.join(" ")+'" data-hour="'+r+'" data-minute="'+n+'">'+i.formatDate(s,D.formatTime)+"</div>"},D.allowTimes&&e.isArray(D.allowTimes)&&D.allowTimes.length)for(v=0;v<D.allowTimes.length;v+=1)d(R.strtotime(D.allowTimes[v]).getHours(),M=R.strtotime(D.allowTimes[v]).getMinutes());else for(v=0,o=0;v<(D.hours12?12:24);v+=1)for(o=0;o<60;o+=D.step){var P=60*v+o;P<A||P>=k||d((v<10?"0":"")+v,M=(o<10?"0":"")+o)}for(z.html(S),r="",v=parseInt(D.yearStart,10);v<=parseInt(D.yearEnd,10);v+=1)r+='<div class="xdsoft_option '+(R.currentTime.getFullYear()===v?"xdsoft_current":"")+'" data-value="'+v+'">'+(v+D.yearOffset)+"</div>";for(W.children().eq(0).html(r),v=parseInt(D.monthStart,10),r="";v<=parseInt(D.monthEnd,10);v+=1)r+='<div class="xdsoft_option '+(R.currentTime.getMonth()===v?"xdsoft_current":"")+'" data-value="'+v+'">'+D.i18n[n].months[v]+"</div>";j.children().eq(0).html(r),e(L).trigger("generate.xdsoft")},10),s.stopPropagation()}).on("afterOpen.xdsoft",function(){var e,t,i,r;D.timepicker&&(z.find(".xdsoft_current").length?e=".xdsoft_current":z.find(".xdsoft_init_time").length&&(e=".xdsoft_init_time"),e?(t=U[0].clientHeight,(i=z[0].offsetHeight)-t<(r=z.find(e).index()*D.timeHeightInTimePicker+1)&&(r=i-t),U.trigger("scroll_element.xdsoft_scroller",[parseInt(r,10)/(i-t)])):U.trigger("scroll_element.xdsoft_scroller",[0]))}),s=0,B.on("touchend click.xdsoft","td",function(i){i.stopPropagation(),s+=1;var r=e(this),n=R.currentTime;if(null==n&&(R.currentTime=R.now(),n=R.currentTime),r.hasClass("xdsoft_disabled"))return!1;n.setDate(1),n.setFullYear(r.data("year")),n.setMonth(r.data("month")),n.setDate(r.data("date")),L.trigger("select.xdsoft",[n]),t.val(R.str()),D.onSelectDate&&e.isFunction(D.onSelectDate)&&D.onSelectDate.call(L,R.currentTime,L.data("input"),i),L.data("changed",!0),L.trigger("xchange.xdsoft"),L.trigger("changedatetime.xdsoft"),(s>1||!0===D.closeOnDateSelect||!1===D.closeOnDateSelect&&!D.timepicker)&&!D.inline&&L.trigger("close.xdsoft"),setTimeout(function(){s=0},200)}),z.on("touchstart","div",function(e){this.touchMoved=!1}).on("touchmove","div",q).on("touchend click.xdsoft","div",function(t){if(!this.touchMoved){t.stopPropagation();var i=e(this),r=R.currentTime;if(null==r&&(R.currentTime=R.now(),r=R.currentTime),i.hasClass("xdsoft_disabled"))return!1;r.setHours(i.data("hour")),r.setMinutes(i.data("minute")),L.trigger("select.xdsoft",[r]),L.data("input").val(R.str()),D.onSelectTime&&e.isFunction(D.onSelectTime)&&D.onSelectTime.call(L,R.currentTime,L.data("input"),t),L.data("changed",!0),L.trigger("xchange.xdsoft"),L.trigger("changedatetime.xdsoft"),!0!==D.inline&&!0===D.closeOnTimeSelect&&L.trigger("close.xdsoft")}}),O.on("mousewheel.xdsoft",function(e){return!D.scrollMonth||(e.deltaY<0?R.nextMonth():R.prevMonth(),!1)}),t.on("mousewheel.xdsoft",function(e){return!D.scrollInput||(!D.datepicker&&D.timepicker?((a=z.find(".xdsoft_current").length?z.find(".xdsoft_current").eq(0).index():0)+e.deltaY>=0&&a+e.deltaY<z.children().length&&(a+=e.deltaY),z.children().eq(a).length&&z.children().eq(a).trigger("mousedown"),!1):D.datepicker&&!D.timepicker?(O.trigger(e,[e.deltaY,e.deltaX,e.deltaY]),t.val&&t.val(R.str()),L.trigger("changedatetime.xdsoft"),!1):void 0)}),L.on("changedatetime.xdsoft",function(t){if(D.onChangeDateTime&&e.isFunction(D.onChangeDateTime)){var i=L.data("input");D.onChangeDateTime.call(L,R.currentTime,i,t),delete D.value,i.trigger("change")}}).on("generate.xdsoft",function(){D.onGenerate&&e.isFunction(D.onGenerate)&&D.onGenerate.call(L,R.currentTime,L.data("input")),Y&&(L.trigger("afterOpen.xdsoft"),Y=!1)}).on("click.xdsoft",function(e){e.stopPropagation()}),a=0,P=function(e,t){do{if(!(e=e.parentNode)||!1===t(e))break}while("HTML"!==e.nodeName)},l=function(){var t,i,r,n,o,s,a,l,u,c,h,d,p;if(t=(l=L.data("input")).offset(),i=l[0],c="top",r=t.top+i.offsetHeight-1,n=t.left,o="absolute",u=e(D.contentWindow).width(),d=e(D.contentWindow).height(),p=e(D.contentWindow).scrollTop(),D.ownerDocument.documentElement.clientWidth-t.left<O.parent().outerWidth(!0)){var f=O.parent().outerWidth(!0)-i.offsetWidth;n-=f}"rtl"===l.parent().css("direction")&&(n-=L.outerWidth()-l.outerWidth()),D.fixed?(r-=p,n-=e(D.contentWindow).scrollLeft(),o="fixed"):(a=!1,P(i,function(e){return null!==e&&("fixed"===D.contentWindow.getComputedStyle(e).getPropertyValue("position")?(a=!0,!1):void 0)}),a?(o="fixed",r+L.outerHeight()>d+p?(c="bottom",r=d+p-t.top):r-=p):r+L[0].offsetHeight>d+p&&(r=t.top-L[0].offsetHeight+1),r<0&&(r=0),n+i.offsetWidth>u&&(n=u-i.offsetWidth)),s=L[0],P(s,function(e){if("relative"===D.contentWindow.getComputedStyle(e).getPropertyValue("position")&&u>=e.offsetWidth)return n-=(u-e.offsetWidth)/2,!1}),(h={position:o,left:n,top:"",bottom:""})[c]=r,L.css(h)},L.on("open.xdsoft",function(t){var i=!0;D.onShow&&e.isFunction(D.onShow)&&(i=D.onShow.call(L,R.currentTime,L.data("input"),t)),!1!==i&&(L.show(),l(),e(D.contentWindow).off("resize.xdsoft",l).on("resize.xdsoft",l),D.closeOnWithoutClick&&e([D.ownerDocument.body,D.contentWindow]).on("touchstart mousedown.xdsoft",function t(){L.trigger("close.xdsoft"),e([D.ownerDocument.body,D.contentWindow]).off("touchstart mousedown.xdsoft",t)}))}).on("close.xdsoft",function(t){var i=!0;F.find(".xdsoft_month,.xdsoft_year").find(".xdsoft_select").hide(),D.onClose&&e.isFunction(D.onClose)&&(i=D.onClose.call(L,R.currentTime,L.data("input"),t)),!1===i||D.opened||D.inline||L.hide(),t.stopPropagation()}).on("toggle.xdsoft",function(){L.is(":visible")?L.trigger("close.xdsoft"):L.trigger("open.xdsoft")}).data("input",t),H=0,L.data("xdsoft_datetime",R),L.setOptions(D),R.setCurrentTime(X()),t.data("xdsoft_datetimepicker",L).on("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",function(){t.is(":disabled")||t.data("xdsoft_datetimepicker").is(":visible")&&D.closeOnInputClick||D.openOnFocus&&(clearTimeout(H),H=setTimeout(function(){t.is(":disabled")||(Y=!0,R.setCurrentTime(X(),!0),D.mask&&Z(D),L.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(t){var i,r=t.which;return-1!==[m].indexOf(r)&&D.enterLikeTab?(i=e("input:visible,textarea:visible,button:visible,a:visible"),L.trigger("close.xdsoft"),i.eq(i.index(this)+1).focus(),!1):-1!==[_].indexOf(r)?(L.trigger("close.xdsoft"),!0):void 0}).on("blur.xdsoft",function(){L.trigger("close.xdsoft")})},a=function(t){var i=t.data("xdsoft_datetimepicker");i&&(i.data("xdsoft_datetime",null),i.remove(),t.data("xdsoft_datetimepicker",null).off(".xdsoft"),e(D.contentWindow).off("resize.xdsoft"),e([D.contentWindow,D.ownerDocument.body]).off("mousedown.xdsoft touchstart"),t.unmousewheel&&t.unmousewheel())},e(D.ownerDocument).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(e){e.keyCode===f&&(k=!0)}).on("keyup.xdsoftctrl",function(e){e.keyCode===f&&(k=!1)}),this.each(function(){var t,n=e(this).data("xdsoft_datetimepicker");if(n){if("string"===e.type(r))switch(r){case"show":e(this).select().focus(),n.trigger("open.xdsoft");break;case"hide":n.trigger("close.xdsoft");break;case"toggle":n.trigger("toggle.xdsoft");break;case"destroy":a(e(this));break;case"reset":this.value=this.defaultValue,this.value&&n.data("xdsoft_datetime").isValidDate(i.parseDate(this.value,D.format))||n.data("changed",!1),n.data("xdsoft_datetime").setCurrentTime(this.value);break;case"validate":n.data("input").trigger("blur.xdsoft");break;default:n[r]&&e.isFunction(n[r])&&(l=n[r](o))}else n.setOptions(r);return 0}"string"!==e.type(r)&&(!D.lazyInit||D.open||D.inline?s(e(this)):(t=e(this)).on("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",function e(){t.is(":disabled")||t.data("xdsoft_datetimepicker")||(clearTimeout(R),R=setTimeout(function(){t.data("xdsoft_datetimepicker")||s(t),t.off("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",e).trigger("open.xdsoft")},100))}))}),l},e.fn.datetimepicker.defaults=t}),function(){"use strict";var e,t,i,r,n;e=function(e,t){return"string"==typeof e&&"string"==typeof t&&e.toLowerCase()===t.toLowerCase()},t=function(e,i,r){var n=r||"0",o=e.toString();return o.length<i?t(n+o,i):o},i=function(e){var t,r;for(e=e||{},t=1;t<arguments.length;t++)if(r=arguments[t])for(var n in r)r.hasOwnProperty(n)&&("object"==typeof r[n]?i(e[n],r[n]):e[n]=r[n]);return e},r=function(e,t){for(var i=0;i<t.length;i++)if(t[i].toLowerCase()===e.toLowerCase())return i;return-1},n={dateSettings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["AM","PM"],ordinal:function(e){var t=e%10,i={1:"st",2:"nd",3:"rd"};return 1!==Math.floor(e%100/10)&&i[t]?i[t]:"th"}},separators:/[ \-+\/\.T:@]/g,validParts:/[dDjlNSwzWFmMntLoYyaABgGhHisueTIOPZcrU]/g,intParts:/[djwNzmnyYhHgGis]/g,tzParts:/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,tzClip:/[^-+\dA-Z]/g},(d=function(e){var t=this,r=i(n,e);t.dateSettings=r.dateSettings,t.separators=r.separators,t.validParts=r.validParts,t.intParts=r.intParts,t.tzParts=r.tzParts,t.tzClip=r.tzClip}).prototype={constructor:d,getMonth:function(e){var t;return 0===(t=r(e,this.dateSettings.monthsShort)+1)&&(t=r(e,this.dateSettings.months)+1),t},parseDate:function(t,i){var r,n,o,s,a,l,u,c,h,d,p=this,f=!1,g=!1,m=p.dateSettings,v={date:null,year:null,month:null,day:null,hour:0,min:0,sec:0};if(!t)return null;if(t instanceof Date)return t;if("U"===i)return(o=parseInt(t))?new Date(1e3*o):t;switch(typeof t){case"number":return new Date(t);case"string":break;default:return null}if(!(r=i.match(p.validParts))||0===r.length)throw new Error("Invalid date format definition.");for(n=t.replace(p.separators,"\0").split("\0"),o=0;o<n.length;o++)switch(s=n[o],a=parseInt(s),r[o]){case"y":case"Y":if(!a)return null;h=s.length,v.year=2===h?parseInt((70>a?"20":"19")+s):a,f=!0;break;case"m":case"n":case"M":case"F":if(isNaN(a)){if(!((l=p.getMonth(s))>0))return null;v.month=l}else{if(!(a>=1&&12>=a))return null;v.month=a}f=!0;break;case"d":case"j":if(!(a>=1&&31>=a))return null;v.day=a,f=!0;break;case"g":case"h":if(d=n[u=r.indexOf("a")>-1?r.indexOf("a"):r.indexOf("A")>-1?r.indexOf("A"):-1],u>-1)c=e(d,m.meridiem[0])?0:e(d,m.meridiem[1])?12:-1,a>=1&&12>=a&&c>-1?v.hour=a+c-1:a>=0&&23>=a&&(v.hour=a);else{if(!(a>=0&&23>=a))return null;v.hour=a}g=!0;break;case"G":case"H":if(!(a>=0&&23>=a))return null;v.hour=a,g=!0;break;case"i":if(!(a>=0&&59>=a))return null;v.min=a,g=!0;break;case"s":if(!(a>=0&&59>=a))return null;v.sec=a,g=!0}if(!0===f&&v.year&&v.month&&v.day)v.date=new Date(v.year,v.month-1,v.day,v.hour,v.min,v.sec,0);else{if(!0!==g)return null;v.date=new Date(0,0,0,v.hour,v.min,v.sec,0)}return v.date},guessDate:function(e,t){if("string"!=typeof e)return e;var i,r,n,o,s,a,l=e.replace(this.separators,"\0").split("\0"),u=t.match(this.validParts),c=new Date,h=0;if(!/^[djmn]/g.test(u[0]))return e;for(n=0;n<l.length;n++){if(h=2,s=l[n],a=parseInt(s.substr(0,2)),isNaN(a))return null;switch(n){case 0:"m"===u[0]||"n"===u[0]?c.setMonth(a-1):c.setDate(a);break;case 1:"m"===u[0]||"n"===u[0]?c.setDate(a):c.setMonth(a-1);break;case 2:if(r=c.getFullYear(),h=4>(i=s.length)?i:4,!(r=parseInt(4>i?r.toString().substr(0,4-i)+s:s.substr(0,4))))return null;c.setFullYear(r);break;case 3:c.setHours(a);break;case 4:c.setMinutes(a);break;case 5:c.setSeconds(a)}(o=s.substr(h)).length>0&&l.splice(n+1,0,o)}return c},parseFormat:function(e,i){var r,n=this,o=n.dateSettings,s=/\\?(.?)/gi,a=function(e,t){return r[e]?r[e]():t};return r={d:function(){return t(r.j(),2)},D:function(){return o.daysShort[r.w()]},j:function(){return i.getDate()},l:function(){return o.days[r.w()]},N:function(){return r.w()||7},w:function(){return i.getDay()},z:function(){var e=new Date(r.Y(),r.n()-1,r.j()),t=new Date(r.Y(),0,1);return Math.round((e-t)/864e5)},W:function(){var e=new Date(r.Y(),r.n()-1,r.j()-r.N()+3),i=new Date(e.getFullYear(),0,4);return t(1+Math.round((e-i)/864e5/7),2)},F:function(){return o.months[i.getMonth()]},m:function(){return t(r.n(),2)},M:function(){return o.monthsShort[i.getMonth()]},n:function(){return i.getMonth()+1},t:function(){return new Date(r.Y(),r.n(),0).getDate()},L:function(){var e=r.Y();return e%4==0&&e%100!=0||e%400==0?1:0},o:function(){var e=r.n(),t=r.W();return r.Y()+(12===e&&9>t?1:1===e&&t>9?-1:0)},Y:function(){return i.getFullYear()},y:function(){return r.Y().toString().slice(-2)},a:function(){return r.A().toLowerCase()},A:function(){var e=r.G()<12?0:1;return o.meridiem[e]},B:function(){var e=3600*i.getUTCHours(),r=60*i.getUTCMinutes(),n=i.getUTCSeconds();return t(Math.floor((e+r+n+3600)/86.4)%1e3,3)},g:function(){return r.G()%12||12},G:function(){return i.getHours()},h:function(){return t(r.g(),2)},H:function(){return t(r.G(),2)},i:function(){return t(i.getMinutes(),2)},s:function(){return t(i.getSeconds(),2)},u:function(){return t(1e3*i.getMilliseconds(),6)},e:function(){return/\((.*)\)/.exec(String(i))[1]||"Coordinated Universal Time"},I:function(){return new Date(r.Y(),0)-Date.UTC(r.Y(),0)!=new Date(r.Y(),6)-Date.UTC(r.Y(),6)?1:0},O:function(){var e=i.getTimezoneOffset(),r=Math.abs(e);return(e>0?"-":"+")+t(100*Math.floor(r/60)+r%60,4)},P:function(){var e=r.O();return e.substr(0,3)+":"+e.substr(3,2)},T:function(){return(String(i).match(n.tzParts)||[""]).pop().replace(n.tzClip,"")||"UTC"},Z:function(){return 60*-i.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(s,a)},r:function(){return"D, d M Y H:i:s O".replace(s,a)},U:function(){return i.getTime()/1e3||0}},a(e,e)},formatDate:function(e,t){var i,r,n,o,s,a=this,l="";if("string"==typeof e&&!(e=a.parseDate(e,t)))return null;if(e instanceof Date){for(n=t.length,i=0;n>i;i++)"S"!==(s=t.charAt(i))&&"\\"!==s&&(i>0&&"\\"===t.charAt(i-1)?l+=s:(o=a.parseFormat(s,e),i!==n-1&&a.intParts.test(s)&&"S"===t.charAt(i+1)&&(r=parseInt(o)||0,o+=a.dateSettings.ordinal(r)),l+=o));return l}return""}}}(),r("php-date-formatter",function(){}),r("service/gui/OpenSearchService",["jquery","underscore-min","moment","text!templates/openSearchService.html","text!templates/openSearchForm.html","jquery.ui","jquery.datetimepicker","php-date-formatter"],function(e,t,i,r,n){var o=t.template(r),s=t.template(n),a=[];function l(t){t.stopPropagation(),t.preventDefault();for(var i=e(this).closest(".osForm").data("layer"),r=e(this).find(':input[value!=""]').serializeArray(),n={},o=0;o<r.length;o++)n[r[o].name.toString()]=r[o].value.toString();e(this).find("select").each(function(t){e(this).val()&&(n[e(this).attr("name")]=e(this).val())}),i.setRequestProperties(n)}return{init:function(e){mizarWidgetAPI=e},initTab:function(t){!function(t){if("number"==typeof e("#OpenSearchService").length&&0===e("#OpenSearchService").length){e('<li style="display: none;"><a href="#OpenSearchService">OpenSearch</a></li>').appendTo(t.children(".ui-tabs-nav")).fadeIn(300),t.append('<div id="OpenSearchService"></div>');var i=o();e(i).appendTo("#OpenSearchService").tabs({collapsible:!0,hide:{effect:"fadeOut",duration:300},show:{effect:"fadeIn",duration:300}})}}(t)},destroyTab:function(e){},addService:function(r,n){void 0===t.find(a,function(e){return e.ID===n.ID})&&(a.push(n),function(e){e.openSearchForm=s({layer:e})}(n),function(t){var r=e("#openSearchTabs").tabs({collapsible:!0,hide:{effect:"slideUp",duration:300},show:{effect:"slideDown",duration:300}});e('<li><a href="#osForm_'+t.id+'">'+t.name+"</a></li>").appendTo(r.children(".ui-tabs-nav")),r.append('<div id="osForm_'+t.id+'">'+t.openSearchForm+"</div>"),e.datetimepicker.setDateFormatter({parseDate:function(e,t){var r=i.utc(e,"YYYY-MM-DDTHH:mm:ss");return!!r.isValid()&&r.toDate()},formatDate:function(e,t){var r;return"Y-m-d"===t?r=i.utc(e).format(t):"H:m"===t?r=String(e.getHours()).padStart(2,"0")+":"+String(e.getMinutes()).padStart(2,"0"):(r=i(e,"Y-m-d H:m").format("YYYY-MM-DDTHH:mm"),r+=":00"),r}}),e("#openSearchTabs").find("#openSearchForm_"+t.id).data("layer",t).submit(l).end().find(".datetimepicker").datetimepicker({lang:"en",timepicker:!0,format:"Y-m-d H:m",formatDate:"Y-m-d",formatTime:"H:m"}),e("#openSearchTabs").tabs("refresh");var n=e("#openSearchTabs").find('.ui-tabs-nav li[aria-controls="osForm_'+t.id+'"]').index();r.tabs("option","active",n)}(n))},removeService:function(t,i){for(var r=0;r<a.length;r++)if(a[r].id===i.id){var n=e("#openSearchTabs").find('.ui-tabs-nav li[aria-controls="osForm_'+i.id+'"]').index();e("#openSearchTabs").find(".ui-tabs-nav li:eq("+n+")").remove(),e("#openSearchTabs").find("#osForm_"+i.id).remove(),a.splice(r,1),e("#openSearchTabs").tabs("refresh");break}}}}),r("text!templates/mocServiceItem.html",[],function(){return'<div class="mocLayer" id="mocLayer_<%=layer.ID%>">\n    <% if( display )\n    {\n    %>\n    <input class="display" id="display_<%=layer.ID%>" type="checkbox"/><label\n        for="display_<%=layer.ID%>">Display</label>\n    <%\n    }\n    else\n    {\n    %>\n    <input id="mocCheck_<%=layer.ID%>" type="checkbox"/><label for="mocCheck_<%=layer.ID%>">Check</label>\n    <%\n    }\n    %>\n    <span class="mocName"><%=layer.name%></span>\n    <span class="mocStatus"><% if ( layer.coverage == "Not available" ) print("(Not found)");%> </span>\n    <span class="mocCoverage">Sky coverage: <%=layer.coverage%></span>\n    <br/>\n</div>\n'}),r("service/gui/MocService",["jquery","underscore-min","text!templates/mocServiceItem.html"],function(e,t,i){var r,n=t.template(i),o=[];function s(){var t=e(this).parent().data("layer");t&&(this.checked?t.setVisible(!0):t.setVisible(!1))}function a(e){return e.replace(/\:/g,"_")}function l(t){var i=n({layer:t,display:!0});e(i).appendTo("#MocService .mocLayers").data("layer",t).find('input[type="checkbox"]').attr("checked",!(!t||!t.visible)).attr("disabled",!t).button().click(s)}return{init:function(e){r=e},initTab:function(e){},addLayer:function(i){var n=i.getServices().Moc;if(n&&!t.find(o,function(e){var t=i.ID;return e.startsWith(t)})){var s=r.getServiceByName(r.SERVICE.MocBase).createMocSublayer(n,function(t){e("#MocService #mocLayer_"+a(t.ID)).find('input[type="checkbox"]').removeAttr("disabled").button("refresh"),e("#MocService #mocLayer_"+a(t.ID)).find(".mocCoverage").html("Sky coverage: "+t.coverage)},function(t){e("#MocService #mocLayer_"+a(t.ID)).find(".mocCoverage").html("Sky coverage: Not available").end().find(".mocStatus").html("(Not found)")});o.push(i.ID+"#"+s);var u=r.getLayerByID(s);u.name=i.name+" MOC",l(u)}},removeLayer:function(t){for(var i="",r=0;r<o.length;r++){var n=o[r].split("#",2);if(n[0]===t.ID){o.splice(r,1),i=n[1];break}}e("#MocService #mocLayer_"+a(i)).remove()},addService:function(t){e('<li style="display: none;"><a href="#MocService">Moc</a></li>').appendTo(t.children(".ui-tabs-nav")).fadeIn(300),t.append('<div id="MocService">\t\t\t\t\t\t<div class="mocLayers"></div>\t\t\t\t\t</div>');for(var i=0;i<o.length;i++){var n=o[i].split("#",2);l(r.getLayerByID(n[1]))}},removeService:function(t){e('li[aria-controls="MocService"]').remove(),e("#MocService").remove(),t.tabs("refresh")}}}),r("service/gui/XMatchService",["jquery","underscore-min","gui/dialog/ErrorDialog","../../utils/UtilsCore","text!templates/mocServiceItem.html","jquery.ui"],function(e,t,i,r,n){var o,s,a,l=t.template(n);function u(){var t,i=e(this).parent().data("layer");(t=r.isMocLayer(i)?i:a.getServiceByName(a.SERVICE.MocBase).findMocSublayer(i))&&(this.checked?t.setVisible(!0):t.setVisible(!1))}function c(t){var i=l({layer:t,display:!1});e(i).appendTo("#xMatchService .mocLayers").data("layer",t).find('input[type="checkbox"]').attr("disabled",!t.coverage||"Not available"==t.coverage).button({text:!1,icons:{primary:"ui-icon-empty"}}).click(function(){e(this).button("option",{icons:{primary:e(this).is(":checked")?"ui-icon-check":"ui-icon-empty"}})})}function h(t){var r;o?(s&&a.getScene().removeLayer(s),s=a.getServiceByName(a.SERVICE.MocBase).intersectLayers(t),a.getServiceByName(a.SERVICE.MocBase).requestSkyCoverage(s,s.describeUrl+"&media=txt",function(t){e("#xMatchService #mocLayer_"+t.id).find(".mocCoverage").html("Sky coverage: "+t.coverage)}),r=l({layer:s,display:!0}),e(r).appendTo("#intersectResult").data("layer",s).find(".display").button().click(u),e("#intersectResult").slideDown(),e("#intersectMocBtn").removeAttr("disabled").button("refresh")):(i.open("Coverage service URL isn't defined in configuration file"),e("#intersectMocBtn").removeAttr("disabled").button("refresh"))}return{init:function(e,t){a=e,t.coverageService&&(o=t.coverageService.baseUrl)},addLayer:function(t){"Not available"!=t.coverage&&e("#xMatchService #mocCheck_"+t.id).attr("checked","checked").button("option",{icons:{primary:"ui-icon-check"}}).button("refresh"),e("#xMatchService #mocLayer_"+t.id).append("<br/>").prependTo("#xMatchService .mocLayers")},removeLayer:function(t){e("#xMatchService #mocCheck_"+t.id).removeAttr("checked")},addService:function(i){e('<li style="display: none;"><a href="#xMatchService">xMatch</a></li>').appendTo(i.children(".ui-tabs-nav")).fadeIn(300),i.append('<div id="xMatchService">\t\t\t\t<div class="mocLayers"></div>\t\t\t\t\t<button id="intersectMocBtn">Intersect</button>\t\t\t\t<div id="intersectResult"></div>\t\t\t</div>');for(var n=a.getLayers(a.CONTEXT.Sky),o=t.filter(n,function(e){return r.isOpenSearchLayer(e)}),s=0;s<o.length;s++){var l=o[s];a.getServiceByName(a.SERVICE.MocBase).findMocSublayer(l)||a.getServiceByName(a.SERVICE.MocBase).getSkyCoverage(l,function(t){e("#xMatchService #mocLayer_"+t.id).find(".mocCoverage").html("Sky coverage: "+t.coverage),e("#xMatchService #mocLayer_"+t.id).find('input[type="checkbox"]').removeAttr("disabled").button("refresh")},function(t){e("#xMatchService #mocLayer_"+t.id).find(".mocCoverage").html("Sky coverage: Not available").end().find(".mocStatus").html("(Not found)"),e("#xMatchService #mocLayer_"+t.id).find('input[type="checkbox"]').removeAttr("checked").button("option",{icons:{primary:"ui-icon-empty"}}).button("refresh")}),c(l)}e("#intersectMocBtn").button().click(function(){e(this).attr("disabled","disabled").button("refresh"),e("#intersectResult").clearQueue().stop().slideUp(function(){var t=e(this).parent().find(".mocLayers .mocLayer input:checked");if(t.length<2)e("#intersectResult").html("Check at least two layers").slideDown().delay(700).slideUp(function(){e("#intersectMocBtn").removeAttr("disabled").button("refresh")});else{e("#intersectResult").html("");var i=[];t.each(function(r){i.push(e.data(t[r].parentElement,"layer"))}),h(i)}})})},removeService:function(i){i.find('.ui-tabs-nav li[aria-controls="xMatchService"]').remove(),e("#xMatchService").remove(),i.tabs("refresh");for(var n=a.getLayers(a.CONTEXT.Sky),o=t.filter(n,function(e){return r.isOpenSearchLayer(e)}),l=0;l<o.length;l++){var u=o[l];e("#xMatchService #mocLayer_"+u.id).remove()}s&&(sky.removeLayer(s),s=null)}}}),r("uws/UWSBase",["jquery"],function(e){var t=function(e,t,i){this.name=e,this.baseUrl=t,this.successCallback=null,this.failCallback=null,this.onloadCallback=null,this.checkFn=null,this.checkDelay=i&&i.hasOwnProperty("checkDelay")?i.checkDelay:2e3,this.currentJob};return t.prototype.getJobResults=function(){var t=this;e.ajax({type:"GET",url:this.baseUrl+"/"+this.currentJob+"/results?media=json",success:function(e,i,r){t.successCallback&&t.successCallback(e,t.currentJob)},error:function(e,i,r){t.failCallback&&t.failCallback("Internal server error")}})},t.prototype.checkPhase=function(){var t=this;e.ajax({type:"GET",url:this.baseUrl+"/"+this.currentJob+"/phase",success:function(e,i,r){t.onloadCallback&&t.onloadCallback(e),"COMPLETED"===e?(window.clearInterval(t.checkFn),t.getJobResults()):"ERROR"===e&&(window.clearInterval(t.checkFn),t.failCallback&&t.failCallback("Internal server error"))},error:function(e,i,r){window.clearInterval(t.checkFn),t.failCallback&&t.failCallback(t.name+" service: "+r),console.error(e.responseText)}})},t.prototype.post=function(t,i){if(this.successCallback=i.successCallback,this.onloadCallback=i.onloadCallback,this.failCallback=i.failCallback,this.baseUrl){window.clearInterval(this.checkFn);var r=this;e.ajax({type:"POST",url:this.baseUrl,dataType:"xml",data:t,success:function(t,i,n){var o=e.parseXML(n.responseText);r.currentJob=e(o).find("uws\\:jobId, jobId").text(),r.checkFn=window.setInterval(function(){r.checkPhase.call(r)},r.checkDelay)},error:function(e,t,i){window.clearInterval(r.checkFn),r.failCallback&&r.failCallback(r.name+" service: "+i),console.error(e.responseText)}})}else this.failCallback&&this.failCallback(this.name+" service: baseUrl is undefined"),console.error(this.name+" service baseUrl is undefined")},t.prototype.delete=function(t,i){var r=i.successCallback,n=i.failCallback;if(this.baseUrl){var o=this;e.ajax({type:"DELETE",url:this.baseUrl+"/"+t,success:function(e,t,i){r&&r()},error:function(e,t,i){n&&n(o.name+" service: "+i),console.error(e.responseText)}})}else this.failCallback&&this.failCallback(this.name+" service: baseUrl is undefined"),console.error(this.name+" service baseUrl is undefined")},t}),r("uws/UWSManager",["./UWSBase"],function(e){var t,i,r;return{init:function(n){n.cutOut&&(t=new e("CutOut",n.cutOut.baseUrl)),n.healpixcut&&(r=new e("HealpixCut",n.healpixcut.baseUrl)),n.zScale&&(i=new e("ZScale",n.zScale.baseUrl))},post:function(e,n,o){switch(e){case"cutout":t.post(n,o);break;case"healpixcut":r.post(n,o);break;case"zscale":i.post(n,o);break;default:console.error("Not supported")}},delete:function(e,n,o){switch(e){case"cutout":t.delete(n,o);break;case"healpixcut":r.delete(n,o);break;case"zscale":i.delete(n,o);break;default:console.error("Not supported")}}}}),r("service/Samp",["jquery","underscore-min","samp","jquery.ui"],function(e,t){var i,r,n,o,s=!1;return{init:function(t,a,l){var c;r=(i=t).getServiceByName(i.SERVICE.Samp),a,l.votable2geojson&&(o=l.sitoolsBaseUrl,l.votable2geojson.baseUrl),(c=e('<div id="sampContent"><button id="registerSamp">Register</button>\t\t\t\t\t<button id="unregisterSamp" disabled>Unregister</button>\t\t\t\t\t<button id="sendVOTable">Send VO table</button>\t\t\t\t\t<span><strong>Registered: </strong><span id="sampResult">No</span></span>\t\t\t\t\t<br/>\t\t\t\t\t<div style="display: none;" id="sampStatus"></div>\t\t\t\t\t</div>').appendTo("body").dialog({title:"Samp",autoOpen:!1,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},open:function(){e(this).find("button:first-child").blur()},resizable:!1,width:"auto",minHeight:"auto",close:function(t,i){e(this).dialog("close")}})).find("#registerSamp").button().click(function(){n.register()}).end().find("#unregisterSamp").button().click(function(){n.unregister(),e("#registerSamp").removeAttr("disabled").button("refresh"),e(this).attr("disabled","disabled").button("refresh"),e("#sampInvoker").toggleClass("selected")}).end().find("#sendVOTable").button().click(function(){var e=o+"/sia/search?order=3&healpix=293&coordSystem=EQUATORIAL&media=votable",t=new u.Message("table.load.votable",{url:e});n.connection.notifyAll([t])}),e("#sampInvoker").on("click",function(){c.dialog("open")}).hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)}),n=r.initSamp(i.getMizarAPI()),i.subscribeCtx(i.EVENT_MSG.NAVIGATION_MODIFIED,function(){if(n.connection)if(s)s=!1;else{var e=i.getCrs().getWorldFrom3D(i.getNavigation().center3d),t=new u.Message("coord.pointAt.sky",{ra:e[0].toString(),dec:e[1].toString()});n.connection.notifyAll([t])}});var h={type:i.LAYER.Vector,name:"SAMP",pickable:!0,dataType:"line"};i.addLayer(h),window.onbeforeunload=function(){n.unregister()}},sendImage:function(){r.sendImage},sendVOTable:function(){r.sendVOTable},highlightFeature:function(){r.highlightFeature},isConnected:function(){r.isConnected}}}),r("text!templates/healpixCutService.html",[],function(){return'<div id="HEALPixCut">\n    Arcsec per pixel of result:\n    <div style="margin-left: 20px; margin-bottom: 10px;" class="imageProperties">\n        <label for="cdelt1">X axis: </label><input type="text" id="cdelt1"/><br/>\n        <label for="cdelt2">Y axis: </label><input type="text" id="cdelt2"/>\n    </div>\n    <button style="margin-left: auto; margin-right: auto; display: block;" id="HEALPixCutBtn">Cut viewport</button>\n    <div style="display: inline-block; width: auto; height: 1em;" class="status"></div>\n    <div style="margin-top: 15px;">\n        <em style="font-size: 14px;">Results</em>\n\n        <div class="HEALPixCutResults">\n            <ul style="list-style-type: none;">\n                <%\n                for ( var i=0; i\n                <results.length\n                ; i++ )\n                {\n                print( itemTemplate( { result: results[i] } ) );\n                }\n                %>\n            </ul>\n        </div>\n    </div>\n</div>'}),r("text!templates/cutResultItem.html",[],function(){return'<li data-jobid="<%= result.jobId %>" class="cutResult" style="display: none;"><%= result.name %>:\n    <img data-url="<%= result.url %>" title="Export image by SAMP" class="sampExport" src="css/images/exportSamp.png"/>\n    <a href="<%= result.url %>"\n       download="<% (result.downloadName) ? print(result.downloadName) : print(result.name) %>"><img\n            style="vertical-align: middle; width: 20px; height: 20px;" title="Download" src="css/images/download1.png"></a>\n    <img title="Delete result" class="deleteResult" src="css/images/delete.png"/>\n</li>'}),r("uws/HEALPixCutService",["jquery","./UWSManager","service/Samp","gui/dialog/ErrorDialog","../utils/UtilsCore","underscore-min","text!templates/healpixCutService.html","text!templates/cutResultItem.html","jquery.ui"],function(e,t,i,r,n,o,s,a){var l,u=[],c=o.template(s),h=o.template(a);return{init:function(e){l=e},addService:function(o,s){e('<li style="display: none;"><a href="#HEALPixCut">HEALPixCut</a></li>').appendTo(o.children(".ui-tabs-nav")).fadeIn(300);var a=c({itemTemplate:h,results:u});o.append(a).find("li").fadeIn(),o.find("input").on("focus",function(){e(this).removeClass("inputError")}),e("#HEALPixCut").on("click",".sampExport",function(t){i.isConnected()?i.sendImage(e(this).data("url")):r.open("You must be connected to SAMP Hub")}),e("#HEALPixCut").on("click",".deleteResult",function(i){var r=e(this).parent(),n=r.data("jobid");t.delete("healpixcut",n,{successCallback:function(){r.fadeOut(function(){e(this).remove()})},failCallback:function(t){console.error(t),r.fadeOut(function(){e(this).remove()})}})}),e("#HEALPixCutBtn").button().click(function(i){var o=n.getAstroCoordinatesFromCursorLocation(l.getContext(),l.getNavigation()),s=n.getHEALPixCutCoordinates(i,l.getScene(),l.getNavigation());e("#HEALPixCut").find(".status").html("Healpix cut is in progress, be patient, it may take some time.").fadeIn().css("display: inline-block"),t.post("healpixcut",s,{successCallback:function(t,i){var r="Viewport ( "+o[0]+" x "+o[1]+" )",n={name:r,url:t.results.result[0]["@xlink:href"],downloadName:r.replace('"',"&quot;")+".fits",jobId:i};u.push(n),e("#HEALPixCut").find(".status").hide();var s=h({result:n});e(s).appendTo(e("#HEALPixCut").find(".HEALPixCutResults ul")).fadeIn()},failCallback:function(t){e("#HEALPixCut").find(".status").hide(),r.open(t)},onloadCallback:function(){e("#HEALPixCut").find(".status").animate({opacity:0},400,function(){e(this).animate({opacity:1},400)})}})})},removeService:function(t){t.find('.ui-tabs-nav li[aria-controls="HEALPixCut"]').css("opacity",0);var i=e(this).index();t.tabs("remove",i)}}}),r("gui/LayerServiceView",["jquery","service/gui/OpenSearchService","../service/gui/MocService","../service/gui/XMatchService","uws/HEALPixCutService","jquery.ui"],function(e,t,i,r,n){var o,s,a,l='<div id="layerServiceView" title="Available services">\t\t\t\t\t\t\t        <div id="layerServices">\t\t\t\t\t\t\t\t        <ul>\t\t\t\t\t\t\t\t        </ul>\t\t\t\t\t\t\t        </div>\t\t\t\t\t\t        </div>',u={queryForm:t,Moc:i,XMatch:r,HEALPixCut:n};function c(e){return"string"==typeof e?u[e]:e.name?u[e.name]:(console.error("Service must have name property in configuration"),null)}function h(e,t){Object.keys(e.getServices()).forEach(function(i){!function(e,t,i){var r,n=c(i);null==n?r=!1:(n.removeService(t,e),n.destroyTab(),r=!0)}(e,t,i)})}function d(e,t){Object.keys(e.getServices()).forEach(function(i){!function(e,t,i){var r,n=c(i);null==n?r=!1:(n.initTab(t),n.addService(t,e),r=!0)}(e,t,i)})}return{init:function(a,u){o=e(l).appendTo("body").dialog({autoOpen:!1,resizable:!1,width:"600px",show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},minHeight:"auto",position:["middle",20],open:function(){e(this).find("li:first-child").blur()}}),s=o.find("#layerServices").tabs({collapsible:!0,hide:{effect:"slideUp",duration:300},show:{effect:"slideDown",duration:300}}),t.init(a),i.init(a),r.init(a,u),n.init(a),document.layerServiceView=this},remove:function(){o.find("#layerServices").tabs("destroy"),o.dialog("destroy").remove()},show:function(e){a&&h(a,s),d(e,s),a=e,s.tabs("refresh"),s.tabs("option","active",0),o.dialog("open")},hide:function(){e(l).end()}}}),r("gui/Histogram",[],function(){var e,t,i=function(i){e=i.mizar,t=e.getServiceByName(e.SERVICE.Histogram),this.image=i.image,this.onUpdate=i.onUpdate,this.accuracy=i.accuracy||6,t.init(i)};return i.prototype.getHistValue=function(e){t.getHistValue(e)},i.prototype.drawThresholdControls=function(){t.drawThresholdControls()},i.prototype.drawHistogram=function(e){t.drawHistogram(e)},i.prototype.drawAxes=function(){t.drawAxes()},i.prototype.drawTransferFunction=function(e){t.drawTransferFunction(e)},i.prototype.draw=function(){t.draw()},i.prototype.compute=function(){t.compute()},i.prototype.setImage=function(e){t.setImage(e)},i}),r("uws/AnimatedButton",["jquery","jquery.ui"],function(e){var t=function(t,i){this.$element=e(t).button(),this.stopped=!0,i&&this.$element.on("click",e.proxy(i.onclick,this))};return t.prototype.startAnimation=function(){this.stopped=!1,this.iterateAnimation()},t.prototype.stopAnimation=function(){this.stopped=!0},t.prototype.iterateAnimation=function(){var t=this;this.$element.children("span").animate({backgroundColor:"rgb(255, 165, 0);"},300,function(){e(this).animate({backgroundColor:"transparent"},300,function(){t.stopped||t.iterateAnimation()})})},t}),r("text!templates/dynamicImageView.html",[],function(){return'<div id="imageProcessing">\n    <div>\n        <span class="processOption">Contrast : </span>\n\n        <div class="contrast" style="display: inline-block;">\n            <input name="fitsScale_<%= id %>" type="radio" value="raw" id="raw_<%= id %>" checked="checked"/><label\n                for="raw_<%= id %>">Raw</label>\n            <input name="fitsScale_<%= id %>" type="radio" value="linear" id="linear_<%= id %>"/><label\n                for="linear_<%= id %>">Linear</label>\n            <input name="fitsScale_<%= id %>" type="radio" value="log" id="log_<%= id %>"/><label for="log_<%= id %>">Log</label>\n            <input name="fitsScale_<%= id %>" type="radio" value="sqrt" id="sqrt_<%= id %>"/><label\n                for="sqrt_<%= id %>">Sqrt</label>\n            <input name="fitsScale_<%= id %>" type="radio" value="sqr" id="sqr_<%= id %>"/><label for="sqr_<%= id %>">Pow2</label>\n            <input name="fitsScale_<%= id %>" type="radio" value="asin" id="asin_<%= id %>"/><label\n                for="asin_<%= id %>">AsinH</label>\n        </div>\n    </div>\n\n    <div>\n        <span class="processOption">Colormap : </span>\n        <select class="colormap" style="width:100px;" disabled>\n            <option value="grey">Grey</option>\n            <option value="rainbow">Rainbow</option>\n            <option value="stern">Stern</option>\n            <option value="fire">Fire</option>\n            <option value="eosb">EOSB</option>\n        </select>\n    </div>\n\n    <div>\n        <span class="processOption"> Threshold : </span>\n\n        <div class="thresholdSlider"></div>\n    </div>\n\n    <div>\n\t  \t<span class="thresholdInputs">\n\t  \t\t<label for="min">Min : </label><input type="text" id="min" disabled/>\n\t  \t\t<label for="max">Max : </label><input type="text" id="max" disabled/>\n\t  \t</span>\n    </div>\n\n    <div>\n        <button disabled class="zScale">ZScale</button>\n    </div>\n\n    <div>\n        <span style="width: auto" class="processOption"> Inverse : </span>\n        <input id="inverse_<%= id %>" class="inverse" type="checkbox" disabled/><label for="inverse_<%= id %>"></label>\n    </div>\n\n    <div>\n        <div class="processOption">Histogram :</div>\n        <canvas class="noSelect" id="histogram_<%= id %>" width="275" height="160"></canvas>\n    </div>\n</div>'}),r("gui/DynamicImageView",["jquery","underscore-min","./Histogram","uws/UWSManager","uws/AnimatedButton","./dialog/ErrorDialog","text!templates/dynamicImageView.html","jquery.ui"],function(e,t,i,r,n,o,s){var a=function(a,l){this.id=l.id,this.mizarWidget=l.mizar,this.changeShaderCallback=l.changeShaderCallback;var u="grey",c="raw",h=!1,d=this,p=t.template(s);this.$element=e("#"+a),this.$element.html(p({id:this.id})),this.$element.find(".contrast").buttonset().find("input").each(function(t){e(this).click(function(){switch(c=e(this).val()){case"linear":case"log":case"sqrt":case"sqr":case"asin":d.enableUI();break;case"raw":d.disableUI()}d.image.updateColormap(c,u,h),d.changeShaderCallback&&d.changeShaderCallback(c),d.render()})});this.$element.find(".thresholdSlider").slider({range:!0,slide:function(e,t){d.$element.find("#min").val(t.values[0]),d.$element.find("#max").val(t.values[1])},stop:function(e,t){d.updateThreshold(t.values[0],t.values[1])}}).slider("disable");this.$element.find(".thresholdInputs").change(function(){var t=parseFloat(e(this).children("#min").val());(isNaN(t)||t<d.image.min)&&(e(this).children("#min").val(d.image.min),t=d.image.min);var i=parseFloat(e(this).children("#max").val());(isNaN(i)||i>d.image.max)&&(e(this).children("#max").val(d.image.max),i=d.image.max),d.updateThreshold(t,i)});this.$element.find(".colormap").selectmenu({select:function(t){u=e(this).children("option:selected").val(),d.image.colormap=u,d.image.updateColormap(c,u,h),d.image.renderContext.requestFrame()}});this.$element.find(".inverse").button({text:!1,icons:{primary:""}}),this.$element.find(".inverse").click(function(){e(this).button("option",{icons:{primary:e(this)[0].checked?"ui-icon-check":""}}),h=e(this).is(":checked"),d.image.updateColormap(c,u,h),d.render()});var f=new n(this.$element.find(".zScale")[0],{onclick:function(){var t={PHASE:"RUN",uri:d.image.url};d.image.url||o.open("ZScale can't find image url"),f.startAnimation(),r.post("zscale",t,{successCallback:function(t){f.stopAnimation();var i=parseFloat(t.results.result[0]["@xlink:href"]),r=parseFloat(t.results.result[1]["@xlink:href"]);d.$element.find("#min").val(i).animate({color:"#6BCAFF","border-color":"#6BCAFF"},300,function(){e(this).animate({color:"#F8A102","border-color":"transparent"})}),d.$element.find("#max").val(r).animate({color:"#6BCAFF","border-color":"#6BCAFF"},300,function(){e(this).animate({color:"#F8A102","border-color":"transparent"})}),d.updateThreshold(i,r)},failCallback:function(){f.stopAnimation(),o.open("ZScale internal server error<br/>")}})}});this.histogram=new i({mizar:this.mizarWidget,canvas:"histogram_"+this.id,nbBeans:256,onUpdate:e.proxy(this.updateThreshold,this)}),l.image&&(l.image.colormap="grey",this.setImage(l.image))};return a.prototype.enableUI=function(){this.$element.find(".colormap").selectmenu("enable"),this.$element.find(".thresholdSlider").slider("enable"),this.$element.find(".inverse").removeAttr("disabled").button("refresh"),this.$element.find(".zScale").removeAttr("disabled").button("refresh"),this.$element.find(".thresholdInputs input").each(function(t){e(this).removeAttr("disabled")})},a.prototype.disableUI=function(){this.$element.find(".colormap").selectmenu("disable"),this.$element.find(".thresholdSlider").slider("disable"),this.$element.find(".inverse").attr("disabled","disabled").button("refresh"),this.$element.find(".zScale").attr("disabled","disabled").button("refresh"),this.$element.find(".thresholdInputs input").each(function(t){e(this).attr("disabled","disabled")})},a.prototype.updateThreshold=function(e,t){this.image.tmin=e,this.image.tmax=t,this.$element.find("#min").val(e),this.$element.find("#max").val(t),this.$element.find(".thresholdSlider").slider({values:[e,t]}),this.histogram.compute(),this.render()},a.prototype.setImage=function(e){var t=(e.max-e.min)/1e3;this.$element.find(".thresholdSlider").slider("option",{values:[e.min,e.max],min:e.min,max:e.max,step:t}),this.histogram.setImage(e),this.$element.find("#min").attr("placeholder",e.min).end().find("#max").attr("placeholder",e.max),this.$element.find(".inverse").attr("checked",!!e.inverse&&"checked").button("refresh").end().find(".contrast").find("input[value="+e.transferFn+"]").attr("checked","checked").end().buttonset("refresh").end().find(".colormap").val(e.colormap).selectmenu(),"raw"===e.transferFn?this.disableUI():this.enableUI(),this.image=e,this.updateThreshold(e.tmin,e.tmax),this.render()},a.prototype.remove=function(){this.image.dispose()},a.prototype.render=function(){this.histogram.draw(),this.image.renderContext.requestFrame()},a}),r("text!templates/featureList.html",[],function(){return'<div id="overlappedObjects">\n    <% if ( selection.length > 1 ) {%>\n    <u><%= selection.length %> Overlapped observations:</u><br/>\n    <% } else { %>\n    <u>Object:</u><br/>\n    <% } %>\n    <div id="scroll-arrow-up" style="display: none" class="scroll-arrow-up"></div>\n    <div id="featureListDiv">\n        <div id="featureList">\n            <%\n            var title = "";\n            for ( var i=0; i < selection.length; i++ ) {\n                var properties = selection[i].feature.properties;\n                title = ( selection[i].feature.id ) ? selection[i].feature.id : ( properties.identifier ) ?\n                properties.identifier : ( properties.name ) ? properties.name : properties.title;\n            %>\n            <div title=<%= title %> class="featureTitle"> <%= title %> <br/></div>\n            <%\n                if (selection[i].layer.name === "Planets" && selection[i].feature.properties.name === "Mars") {\n                    %>\n                    <button id="goToMarsBtn" style="margin-top: 7px; font-size: 11px;">\n                        <span class="ui-button-text">Go to Mars</span>\n                    </button>\n                    <%\n                } else if (selection[i].layer.name === "Landing sites" && selection[i].feature.properties.name === "MSL Curiosity") {\n                    %>\n                    <button id="goToCuriosityBtn" style="margin-top: 7px; font-size: 11px;">\n                        <span class="ui-button-text">See it on Mars</span>\n                    </button>\n                    <%\n                } else if (selection[i].layer.name === "Planets" && selection[i].feature.properties.name === "Sun") {\n                    %>\n                    <button id="goToSunBtn" style="margin-top: 7px; font-size: 11px;">\n                        <span class="ui-button-text">Go to Sun</span>\n                    </button>\n                    <%\n                }\n            }\n            %>\n        </div>\n    </div>\n    <div id="scroll-arrow-down" style="display: none" class="scroll-arrow-down clickable"></div>\n</div>\n'}),r("text!templates/featureDescription.html",[],function(){return'<div class="detailedInfo">\n    <% if ( properties.thumbnail ) { %>\n    <div class="thumbnail"><img src="<%= properties.thumbnail %>"/></div>\n    <% }\n    else if (properties.quicklook) { %>\n    <div class="thumbnail"><img src="<%= properties.quicklook %>"/></div>\n    <% } %>\n    <div class="featureProperties">\n        <% if ( properties.abstract ) { %>\n        <%= properties[\'abstract\'] %>\n        <% } %>\n        <table class="propertiesTable" rules="rows">\n            <tbody>\n            <% print(descriptionTableTemplate( { properties: properties, descriptionTableTemplate:\n            descriptionTableTemplate, dictionary: dictionary }) ); %>\n            </tbody>\n        </table>\n    </div>\n\n    <% if (properties.quicklook || services ) {\n    %>\n    <div id="services">\n        <%\n        if ( properties.quicklook ) {\n        %>\n        <span class="featureService" title="Quicklook" id=\'quicklook\'\n              class="<%= (properties.quicklook && properties.style.fill ? \'selected\' : \'\' ) %>">\n        </span>\n        <% }\n        if ( services ) {\n        if (services.browse) {\n        if (services.browse.layer) {\n        if (services.browse.layer.type == "WMS") {\n        %>\n                    <span class="featureService <%= (hasServiceRunning ? \'selected\' : \'\' ) %>"\n                          title="Quicklook Wms" id=\'quicklookWms\' >\n\t\t\t\t\t</span>\n        <%\n        }\n        }\n        }\n        if ( services.healpix ) { %>\n        \t<span class="featureService"\n                  title="Healpix service" id=\'healpix\'\n                  class="<%= (services.healpix.layer.isVisible() ? \'selected\' : \'\' ) %>">\n\t\t\t</span>\n        <% }\n        if ( services.download && !isMobile) {\n        if ( services.download.mimetype == "image/fits" ) {\n        var fitsQuicklookOn = properties.style.fill && !properties.style.fillTextureUrl; %>\n            <span class="featureService"\n                  title="Fits quicklook" id=\'quicklookFits\'\n                  class="<%= (fitsQuicklookOn ? \'selected\' :\'\' ) %>">\n            </span>\n\t\t\t<span style="display: inline-block; position: relative;">\n\t\t\t\t<span class="featureService"\n                      title="Solar object service" id="solarObjects"\n                      class="<%= (services.solarObjects && services.solarObjects.layer.isVisible() ? \'selected\' : \'\' ) %>">\n\t\t\t\t</span>\n        \t\t<div style="display: none" id="solarObjectsSpinner"></div>\n        \t</span>\n            <span title="Image processing" id="dynamicImageView" class=\'dynamicAvailable\'/>\n        <%}%>\n\n        <a href="<%= services ? services.download.url : \'\' %>" target="_self"><span class="featureService" id="downloadImage" title="Download"/></a>\n\n        <% if ( mizarWidgetAPI.getContext().getComponentVisibility("sampContainer") ) { %>\n            <span class="featureService" title="Export image by SAMP" id="sendImage"></span>\n        <% } %>\n        <div style="display: none;" id="serviceStatus"></div>\n        <%}\n        }%>\n    </div>\n    <% } %>\n\n</div>\n'}),r("text!templates/descriptionTable.html",[],function(){return'<% for ( var key in properties )\n{\nif ( key != \'style\' && key != \'title\' && key != \'quicklook\' && key != \'thumbnail\' && key != \'abstract\' && key != \'style\' )\n{\nvar stringKey = key.toString(); %>\n<tr height="30%">\n    <% // Test if section\n    var title = dictionary[stringKey];\n    if (typeof (properties[key]) === "object" )\n    {\n    if ( key == \'crs\' )\n    {%>\n    <td id="<%=stringKey %>" title="<%= title%>" class="selectProperty"><em><%= stringKey %>:</em></td>\n    <td title="<%= properties[key].properties.name %>" class="selectValue"><%= properties[key].properties.name %></td>\n    <% } else { %>\n    <td id="<%=stringKey %>" title="<%= title%>" class="selectProperty" colspan="2">\n        <div id="arrow" class="arrow-right"></div>\n        <div class="section"><b><%= stringKey %></b></div>\n        <table class="propertiesTable" style="display: none; margin-left: 10px" rules="rows">\n            <tbody>\n            <% print( descriptionTableTemplate( { dictionary: dictionary, properties: properties[key],\n            descriptionTableTemplate: descriptionTableTemplate }) );\n            %>\n            </tbody>\n        </table>\n    </td>\n    <% }\n    }\n    else\n    {%>\n    <td id="<%=stringKey%>" title="<%= title%>" class="selectProperty"><em><%= stringKey %>:</em></td>\n    <%\n    var isUrl = ( typeof (properties[key]) === "string" && properties[key].substr(0,4) == \'http\' ) ? true : false;\n    if (isUrl) {%>\n    <td class="selectValue"><a href="<%= properties[key] %>"><%= properties[key] %></a></td>\n    <% } else { %>\n    <td class="selectValue" title="<%= properties[key] %>"><%= properties[key] %></td>\n    <% }\n    } %>\n</tr>\n<% }\n} %>'}),r("gui/FeaturePopupCore",["jquery","underscore-min","text!templates/featureList.html","text!templates/featureDescription.html","text!templates/descriptionTable.html"],function(e,t,i,r,n){var o,s,a,l,u,c="",h=null,d=null,p=t.template(i),f=t.template(r),g=t.template(n);function m(t,i){var r=t,n=i;r+=20,n-=100,e("#selectedFeatureDiv").css({position:"absolute",left:r+"px",top:n+"px"})}function v(){return 2*e("#"+o.getRenderContext().canvas.id).height()/5}function y(e,t){var i={};for(r in e)null==e[r]||"services"===r||"links"===r||"storage"===r||(i[r]=e[r]);if(t){var r,n={};n.title=i.title?i.title:"",n.style=i.style;for(var o=0;o<t.length;o++)i[r=t[o]]&&(n[r]=i[r]);for(r in n.others={},e)n[r]||(n.others[r]=i[r]);return n}return i}function b(t,i,r){e.ajax({type:"GET",url:t+i,dataType:"text",success:function(t){r[i]=t,e("#"+i).attr("title",t)},error:function(e){console.error(e)}})}function x(t,i){t.dictionary={},e.ajax({type:"GET",url:t.serviceUrl,dataType:"xml",success:function(r){var n=e(r).find('Url[rel="dicodesc"]'),o=e(n).attr("template");if(o){var s=o.indexOf("{");for(var a in-1!==s&&(o=o.substring(0,s)),i)b(o,a,t.dictionary)}},error:function(e){}})}function w(t,i){l.find(".featureProperties").getNiceScroll().hide(),l.fadeOut(300,function(){l.find(".featureProperties").getNiceScroll().remove(),function(e,t){e.hasOwnProperty("dictionary")||x(e,t.properties);var i=f({dictionary:e.dictionary,services:t.properties.services,properties:y(t.properties,e.displayProperties),descriptionTableTemplate:g,hasServiceRunning:e.hasServicesRunningOnRecord(t.id),mizarWidgetAPI:o,isMobile:u});l.html(i),l.find(".featureProperties").css("max-height",v()),s.find(".featureProperties").niceScroll({autohidemode:!1}).hide()}(t,i),e(this).fadeIn(300,function(){s.find(".featureProperties").getNiceScroll().resize(),s.find(".featureProperties").getNiceScroll().show()})})}return{init:function(t,i,r,n,c){o=t,h=r,d=n,c,u=c.isMobile,s=i,a=e("#leftDiv"),l=e("#rightDiv")},createFeatureList:function(t){c=p({selection:t}),a.html(c),"Planets"===t[0].layer.name&&"Mars"===t[0].feature.properties.name?e("#goToMarsBtn").button().once().click(function(){o.createMarsContext(),e("#selectedFeatureDiv").hide()}):"Landing sites"===t[0].layer.name&&"MSL Curiosity"===t[0].feature.properties.name?e("#goToCuriosityBtn").button().once().click(function(){o.createCuriosityContext(),e("#selectedFeatureDiv").hide()}):"Planets"===t[0].layer.name&&"Sun"===t[0].feature.properties.name&&e("#goToSunBtn").button().once().click(function(){o.createSunContext(),e("#selectedFeatureDiv").hide()})},createDictionary:x,computeDivPosition:m,computeHeight:v,buildProperties:y,showOrHideQuicklook:function(){var e=h.getSelectedData(),t=!1;"OpenSearch"===e.layer.type?(t=e.layer.isQuicklookDisplayed(),e.isFits=!1,e.isWms=!1,!0===t?(d.removeImage(e),e.layer.currentIdDisplayed!==e.feature.id&&d.addImage(e)):d.addImage(e)):(!0===(t=e.feature.properties.style.fill&&!e.feature.properties.style.fillTextureUrl)&&d.removeImage(e),e.isFits=!1,e.isWms=!1,!0===e.feature.properties.style.fill?d.removeImage(e):d.addImage(e))},showOrHideQuicklookWms:function(){var t=h.getSelectedData();"OpenSearch"===t.layer.type?t.layer.hasServicesRunningOnRecord(t.feature.id)?(e("#quicklookWms").removeClass("selected"),t.layer.unloadWMS(t)):(e("#quicklookWms").addClass("selected"),t.layer.loadWMS(t)):(!0===(t.feature.properties.style.fill&&!t.feature.properties.style.fillTextureUrl)&&d.removeImage(t),t.isFits=!1,t.isWms=!1,!0===t.feature.properties.style.fill?d.removeImage(t):d.addImage(t))},showOrHideQuicklookFits:function(){var e=h.getSelectedData();e.feature.properties.style.fill&&e.feature.properties.style.fillTextureUrl&&d.removeImage(e),e.isFits=!0,!0===e.feature.properties.style.fill?d.removeImage(e):d.addImage(e)},sendImageBySamp:function(){var t=h.getSelectedData(),i=o.getServiceByName(o.SERVICE.Samp).sendImage(t.feature.services.download.url);e("#serviceStatus").html(i).slideDown().delay(1500).slideUp()},showOrHideHEALPixService:function(t){var i=h.getSelectedData().feature.services.healpix.layer;e("#healpix").is(".selected")?(e("#healpix").removeClass("selected"),i.setVisible(!1)):(e("#healpix").addClass("selected"),i.setVisible(!0))},showOrHideDynamicImageService:function(){e(this).toggleClass("selected");var t=h.getSelectedData();o.getServiceByName(o.SERVICE.ImageProcessing).setData(t)},showFeatureInformation:w,selectFeatureOnTitle:function(){h.blurSelectedFeature(),e("#featureList div.selected").removeClass("selected");var t=e(this).index();h.focusFeatureByIndex(t,{isExclusive:!0});var i=h.getSelectedData();e("#featureList div:eq("+t+")").addClass("selected"),i&&w(i.layer,i.feature),o.getRenderContext().requestFrame()},hide:function(e){"none"!==s.css("display")?(s.find(".featureProperties").getNiceScroll().hide(),s.fadeOut(300,function(){s.find(".featureProperties").getNiceScroll().remove(),e&&e()})):e&&e()},show:function(t,i,r){m(t,i),s.fadeIn(500,function(){s.find(".featureProperties").getNiceScroll().resize(),r&&r()});var n=v()-60;e("#featureListDiv").css("max-height",n),a.find("#featureList").height()>n&&a.find(".scroll-arrow-up, .scroll-arrow-down").css("display","block")}}}),r("gui/IFrame",["jquery"],function(e){var t,i,r='<div id="externalIFrame" class="contentBox">            <div id="IFrameToolbar" class="ui-widget-header ui-widget-header ui-corner-all">              <button id="previous">Previous page</button>              <button id="next">Next page</button>            </div>            <div class="closeBtn">                <span class="defaultImg"></span>                <span style="opacity: 0" class="hoverImg"></span>            </div>            <iframe src="">Your browser does not support iframes.</iframe>        </div>';return{hide:function(){t&&t.animate({top:-1e3},800)},show:function(n){t||(t=e(r).appendTo("body"),i={pile:[],index:0,clicked:!1,clean:function(){this.pile.length=0,this.index=0,this.clicked=!1}},e("#previous").button({width:20,height:20,text:!1,icons:{primary:"ui-icon-circle-triangle-w"}}).click(function(e){e.preventDefault(),i.index>1&&(i.index--,i.clicked=!0,t.find("iframe")[0].contentWindow.history.back())}),e("#next").button({width:20,height:20,text:!1,icons:{secondary:"ui-icon-circle-triangle-e"}}).click(function(e){e.preventDefault(),i.index!=i.pile.length&&(i.index++,i.clicked=!0,t.find("iframe")[0].contentWindow.history.forward())}),t.find("iframe").on("load",function(){if(i.clicked)return i.clicked=!1,!1;i.pile.splice(i.index),i.pile.push(t.find("iframe")[0].attributes.src.nodeValue),i.index++})),i.clean(),historyClick=!1;var o=parseInt(e("#GlobWebCanvas").css("width")),s=parseInt(e("#GlobWebCanvas").css("height")),a=.8*o,l=.8*s,u=.1*s;t.find("iframe").css({width:a,height:l}).attr("src",n),t.animate({top:u},800)}}}),r("text!templates/cutOut.html",[],function(){return'<div class="cutOutService">\n    <div style="text-align: center;">\n        <button id="selectionTool">Select area</button>\n        <button id="clearSelection">Clear area</button>\n        <br/>\n        <button id="runJob">Cut</button>\n        <div style="display: none;" class="jobStatus"></div>\n    </div>\n    <hr/>\n    <em>Results</em>\n\n    <div class="cutoutResults">\n        <ul style="list-style-type: none;">\n        </ul>\n    </div>\n</div>'}),r("gui/CutOutView",["jquery","uws/UWSManager","service/Samp","uws/AnimatedButton","./dialog/ErrorDialog","underscore-min","text!templates/cutOut.html","text!templates/cutResultItem.html","jquery.ui"],function(e,t,i,r,n,o,s,a){var l=o.template(s),u=o.template(a),c=function(o,s,a){this.pickingManager=a,this.selectionTool=s;var u=l(),c=this;e("#"+o).html(""),this.$content=e(u).appendTo("#"+o).find("#selectionTool").button().click(function(){c.$content.slideUp(),c.pickingManager.deactivate(),c.selectionTool.toggle()}).end().find("#clearSelection").button().click(function(){c.selectionTool.clear()}).end(),this.runButton=new r(e("#"+o).find("#runJob")[0],{onclick:e.proxy(this.runJob,this)}),this.$content.on("click",".sampExport",function(t){i.isConnected()?i.sendImage(e(this).data("url")):n.open("You must be connected to SAMP Hub")}),this.$content.on("click",".deleteResult",function(i){var r=e(this).parent(),n=r.data("jobid");t.delete("cutout",n,{successCallback:function(){r.parent().find("li[data-jobid="+r.data("jobid")+"]").each(function(){e(this).fadeOut(function(){e(this).remove()})})},failCallback:function(t){console.error(t),r.parent().find("li[data-jobid="+r.data("jobid")+"]").each(function(){e(this).fadeOut(function(){e(this).remove()})})}})})};return c.prototype.runJob=function(){if(this.selectionTool.selectionFeature){this.runButton.startAnimation();var i={PHASE:"RUN",uri:this.url,ra:this.selectionTool.geoPickPoint[0],dec:this.selectionTool.geoPickPoint[1],radius:this.selectionTool.geoRadius},r=this;t.post("cutout",i,{successCallback:function(t,i){r.showMessage("Completed");for(var n=0;n<t.results.result.length;n++){var o=t.results.result[n],s=o["@id"],a=o["@xlink:href"];if(a.search("[?]")>0){var l=a.lastIndexOf("/")+1;a=a.substr(0,l)+encodeURIComponent(s)}var c,h=s.search("file_id=");c=h>=0?s.substr(h+8):s,r.runButton.stopAnimation();var d=u({result:o={name:c,url:a,jobId:i}});e(d).appendTo(r.$content.find(".cutoutResults").find("ul")).fadeIn(400)}},failCallback:function(e){r.runButton.stopAnimation(),r.showMessage(e)}})}else this.showMessage("Please, select area to cut")},c.prototype.showMessage=function(e){this.$content.find(".jobStatus").html(e).stop().slideDown(300).delay(2e3).slideUp()},c.prototype.setUrl=function(e){this.url=e},c}),r("gui/CutOutViewFactory",["jquery","./CutOutView"],function(e,t){var i,r,n,o=[];return{init:function(t,s){n=s,r=(i=t).getServiceByName(i.SERVICE.SelectionTool,{ctx:i.getContext(),onselect:function(){e(".cutOutService").slideDown(),n.activate(),r.toggle()}}),o=[]},addView:function(e){var i=new t(e,r,n);return o.push(i),i},removeView:function(e){var t=o.indexOf(e);o.splice(t,1)}}}),r("gui/ImageProcessing",["jquery","./CutOutViewFactory","./DynamicImageView","jquery.ui"],function(e,t,i){var r,n,o;return{init:function(s){s&&(o=s.mizar,r=s.unselect||null);var a=e('<div>                        <div class="imageProcessing" id="imageProcessing" title="Image processing">                            <h3>Histogram</h3>                            <div class="histogramContent">                                <p> Fits isn\'t loaded, thus histogram information isn\'t available</p>                                <div style="display: none;" id="histogramView"></div>                            </div>                            <h3>Cutout</h3>                            <div id="cutOutView"></div>                        </div>                    </div>').appendTo("body").dialog({title:"Image processing",autoOpen:!1,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},width:500,resizable:!1,minHeight:"auto",close:function(t,i){r&&r(),e(this).dialog("close")}}).find(".imageProcessing").accordion({autoHeight:!1,active:0,collapsible:!0,heightStyle:"content"}).end(),l=new i("histogramView",{id:"featureImageProcessing",mizar:o,changeShaderCallback:o.getMizarAPI().ServiceFactory.create(o.SERVICE.ImageProcessing).changeShaderCallback});n=t.addView("cutOutView"),o.getServiceByName(o.SERVICE.ImageProcessing).init(s,a,l,n),o.subscribeCtx("image:set",o.getServiceByName(o.SERVICE.ImageProcessing).setImage)}}}),function(e){"function"==typeof r&&r.amd?r("jquery.nicescroll.min",["jquery"],e):"object"==typeof exports?module.exports=e(t("jquery")):e(jQuery)}(function(e){"use strict";var t=!1,i=!1,r=0,n=2e3,o=0,s=e,a=document,l=window,u=s(l),c=[],h=l.requestAnimationFrame||l.webkitRequestAnimationFrame||l.mozRequestAnimationFrame||!1,d=l.cancelAnimationFrame||l.webkitCancelAnimationFrame||l.mozCancelAnimationFrame||!1;if(h)l.cancelAnimationFrame||(d=function(e){});else{var p=0;h=function(e,t){var i=(new Date).getTime(),r=Math.max(0,16-(i-p)),n=l.setTimeout(function(){e(i+r)},r);return p=i+r,n},d=function(e){l.clearTimeout(e)}}var f=l.MutationObserver||l.WebKitMutationObserver||!1,g=Date.now||function(){return(new Date).getTime()},m={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"6px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:40,mousescrollstep:27,touchbehavior:!1,emulatetouch:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var e=a.currentScript||function(){var e=a.getElementsByTagName("script");return!!e.length&&e[e.length-1]}(),t=e?e.src.split("?")[0]:"";return t.split("/").length>0?t.split("/").slice(0,-1).join("/")+"/":""}(),preventmultitouchscrolling:!0,disablemutationobserver:!1,enableobserver:!0,scrollbarid:!1},v=!1,y=function(){if(v)return v;var e=a.createElement("DIV"),t=e.style,i=navigator.userAgent,r=navigator.platform,n={};return n.haspointerlock="pointerLockElement"in a||"webkitPointerLockElement"in a||"mozPointerLockElement"in a,n.isopera="opera"in l,n.isopera12=n.isopera&&"getUserMedia"in navigator,n.isoperamini="[object OperaMini]"===Object.prototype.toString.call(l.operamini),n.isie="all"in a&&"attachEvent"in e&&!n.isopera,n.isieold=n.isie&&!("msInterpolationMode"in t),n.isie7=n.isie&&!n.isieold&&(!("documentMode"in a)||7===a.documentMode),n.isie8=n.isie&&"documentMode"in a&&8===a.documentMode,n.isie9=n.isie&&"performance"in l&&9===a.documentMode,n.isie10=n.isie&&"performance"in l&&10===a.documentMode,n.isie11="msRequestFullscreen"in e&&a.documentMode>=11,n.ismsedge="msCredentials"in l,n.ismozilla="MozAppearance"in t,n.iswebkit=!n.ismsedge&&"WebkitAppearance"in t,n.ischrome=n.iswebkit&&"chrome"in l,n.ischrome38=n.ischrome&&"touchAction"in t,n.ischrome22=!n.ischrome38&&n.ischrome&&n.haspointerlock,n.ischrome26=!n.ischrome38&&n.ischrome&&"transition"in t,n.cantouch="ontouchstart"in a.documentElement||"ontouchstart"in l,n.hasw3ctouch=!!l.PointerEvent&&(navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0),n.hasmstouch=!n.hasw3ctouch&&(l.MSPointerEvent||!1),n.ismac=/^mac$/i.test(r),n.isios=n.cantouch&&/iphone|ipad|ipod/i.test(r),n.isios4=n.isios&&!("seal"in Object),n.isios7=n.isios&&"webkitHidden"in a,n.isios8=n.isios&&"hidden"in a,n.isios10=n.isios&&l.Proxy,n.isandroid=/android/i.test(i),n.haseventlistener="addEventListener"in e,n.trstyle=!1,n.hastransform=!1,n.hastranslate3d=!1,n.transitionstyle=!1,n.hastransition=!1,n.transitionend=!1,n.trstyle="transform",n.hastransform="transform"in t||function(){for(var e=["msTransform","webkitTransform","MozTransform","OTransform"],i=0,r=e.length;i<r;i++)if(void 0!==t[e[i]]){n.trstyle=e[i];break}n.hastransform=!!n.trstyle}(),n.hastransform&&(t[n.trstyle]="translate3d(1px,2px,3px)",n.hastranslate3d=/translate3d/.test(t[n.trstyle])),n.transitionstyle="transition",n.prefixstyle="",n.transitionend="transitionend",n.hastransition="transition"in t||function(){n.transitionend=!1;for(var e=["webkitTransition","msTransition","MozTransition","OTransition","OTransition","KhtmlTransition"],i=["-webkit-","-ms-","-moz-","-o-","-o","-khtml-"],r=["webkitTransitionEnd","msTransitionEnd","transitionend","otransitionend","oTransitionEnd","KhtmlTransitionEnd"],o=0,s=e.length;o<s;o++)if(e[o]in t){n.transitionstyle=e[o],n.prefixstyle=i[o],n.transitionend=r[o];break}n.ischrome26&&(n.prefixstyle=i[1]),n.hastransition=n.transitionstyle}(),n.cursorgrabvalue=function(){var e=["grab","-webkit-grab","-moz-grab"];(n.ischrome&&!n.ischrome38||n.isie)&&(e=[]);for(var i=0,r=e.length;i<r;i++){var o=e[i];if(t.cursor=o,t.cursor==o)return o}return"url(https://cdnjs.cloudflare.com/ajax/libs/slider-pro/1.3.0/css/images/openhand.cur),n-resize"}(),n.hasmousecapture="setCapture"in e,n.hasMutationObserver=!1!==f,e=null,v=n,n},b=function(e,p){function v(){var e=C.doc.css(k.trstyle);return!(!e||"matrix"!=e.substr(0,6))&&e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/)}function b(e,t,i){var r=e.css(t),n=parseFloat(r);if(isNaN(n)){var o=3==(n=P[r]||0)?i?C.win.outerHeight()-C.win.innerHeight():C.win.outerWidth()-C.win.innerWidth():1;return C.isie8&&n&&(n+=1),o?n:0}return n}function w(e,t,i,r){C._bind(e,t,function(r){var n={original:r=r||l.event,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==t?(r.wheelDeltaX&&(n.deltaX=-.025*r.wheelDeltaX),r.wheelDeltaY&&(n.deltaY=-.025*r.wheelDeltaY),!n.deltaY&&!n.deltaX&&(n.deltaY=-.025*r.wheelDelta)):n.deltaY=r.detail,i.call(e,n)},r)}function T(e,t,i,r){C.scrollrunning||(C.newscrolly=C.getScrollTop(),C.newscrollx=C.getScrollLeft(),G=g());var n=g()-G;if(G=g(),n>350?U=1:U+=(2-U)/10,t=t*U|0,e=e*U|0){if(r)if(e<0){if(C.getScrollLeft()>=C.page.maxw)return!0}else if(C.getScrollLeft()<=0)return!0;var o=e>0?1:-1;B!==o&&(C.scrollmom&&C.scrollmom.stop(),C.newscrollx=C.getScrollLeft(),B=o),C.lastdeltax-=e}if(t){if(function(){var e=C.getScrollTop();if(t<0){if(e>=C.page.maxh)return!0}else if(e<=0)return!0}()){if(E.nativeparentscrolling&&i&&!C.ispage&&!C.zoomactive)return!0;var s=C.view.h>>1;C.newscrolly<-s?(C.newscrolly=-s,t=-1):C.newscrolly>C.page.maxh+s?(C.newscrolly=C.page.maxh+s,t=1):t=0}var a=t>0?1:-1;F!==a&&(C.scrollmom&&C.scrollmom.stop(),C.newscrolly=C.getScrollTop(),F=a),C.lastdeltay-=t}(t||e)&&C.synched("relativexy",function(){var e=C.lastdeltay+C.newscrolly;C.lastdeltay=0;var t=C.lastdeltax+C.newscrollx;C.lastdeltax=0,C.rail.drag||C.doScrollPos(t,e)})}function _(e,t,i){var r,n;return!(i||!z)||(0===e.deltaMode?(r=-e.deltaX*(E.mousescrollstep/54)|0,n=-e.deltaY*(E.mousescrollstep/54)|0):1===e.deltaMode&&(r=-e.deltaX*E.mousescrollstep*50/80|0,n=-e.deltaY*E.mousescrollstep*50/80|0),t&&E.oneaxismousemode&&0===r&&n&&(r=n,n=0,i&&(r<0?C.getScrollLeft()>=C.page.maxw:C.getScrollLeft()<=0)&&(n=r,r=0)),C.isrtlmode&&(r=-r),T(r,n,i,!0)?void(i&&(z=!0)):(z=!1,e.stopImmediatePropagation(),e.preventDefault()))}var C=this;this.version="3.7.6",this.name="nicescroll",this.me=p;var S=s("body"),E=this.opt={doc:S,win:!1};if(s.extend(E,m),E.snapbackspeed=80,e)for(var A in E)void 0!==e[A]&&(E[A]=e[A]);if(E.disablemutationobserver&&(f=!1),this.doc=E.doc,this.iddoc=this.doc&&this.doc[0]&&this.doc[0].id||"",this.ispage=/^BODY|HTML/.test(E.win?E.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==E.win,this.win=E.win||(this.ispage?u:this.doc),this.docscroll=this.ispage&&!this.haswrapper?u:this.win,this.body=S,this.viewport=!1,this.isfixed=!1,this.iframe=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=E.autohidemode,this.onmousedown=!1,this.onmouseup=!1,this.onmousemove=!1,this.onmousewheel=!1,this.onkeypress=!1,this.ongesturezoom=!1,this.onclick=!1,this.onscrollstart=!1,this.onscrollend=!1,this.onscrollcancel=!1,this.onzoomin=!1,this.onzoomout=!1,this.view=!1,this.page=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,"auto"==E.rtlmode){var I=this.win[0]==l?this.body:this.win,M=I.css("writing-mode")||I.css("-webkit-writing-mode")||I.css("-ms-writing-mode")||I.css("-moz-writing-mode");"horizontal-tb"==M||"lr-tb"==M||""===M?(this.isrtlmode="rtl"==I.css("direction"),this.isvertical=!1):(this.isrtlmode="vertical-rl"==M||"tb"==M||"tb-rl"==M||"rl-tb"==M,this.isvertical="vertical-rl"==M||"tb"==M||"tb-rl"==M)}else this.isrtlmode=!0===E.rtlmode,this.isvertical=!1;if(this.scrollrunning=!1,this.scrollmom=!1,this.observer=!1,this.observerremover=!1,this.observerbody=!1,!1!==E.scrollbarid)this.id=E.scrollbarid;else do{this.id="ascrail"+n++}while(a.getElementById(this.id));this.rail=!1,this.cursor=!1,this.cursorfreezed=!1,this.selectiondrag=!1,this.zoom=!1,this.zoomactive=!1,this.hasfocus=!1,this.hasmousefocus=!1,this.railslocked=!1,this.locked=!1,this.hidden=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=E.overflowx,this.overflowy=E.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltax=0,this.lastdeltay=0,this.detected=y();var k=s.extend({},this.detected);this.canhwscroll=k.hastransform&&E.hwacceleration,this.ishwscroll=this.canhwscroll&&C.haswrapper,this.isrtlmode?this.isvertical?this.hasreversehr=!(k.iswebkit||k.isie||k.isie11):this.hasreversehr=!(k.iswebkit||k.isie&&!k.isie10&&!k.isie11):this.hasreversehr=!1,this.istouchcapable=!1,(k.cantouch||!k.hasw3ctouch&&!k.hasmstouch)&&(!k.cantouch||k.isios||k.isandroid||!k.iswebkit&&!k.ismozilla)||(this.istouchcapable=!0),E.enablemouselockapi||(k.hasmousecapture=!1,k.haspointerlock=!1),this.debounced=function(e,t,i){C&&(C.delaylist[e]||(C.delaylist[e]={h:h(function(){C.delaylist[e].fn.call(C),C.delaylist[e]=!1},i)},t.call(C)),C.delaylist[e].fn=t)},this.synched=function(e,t){C.synclist[e]?C.synclist[e]=t:(C.synclist[e]=t,h(function(){C&&(C.synclist[e]&&C.synclist[e].call(C),C.synclist[e]=null)}))},this.unsynched=function(e){C.synclist[e]&&(C.synclist[e]=!1)},this.css=function(e,t){for(var i in t)C.saved.css.push([e,i,e.css(i)]),e.css(i,t[i])},this.scrollTop=function(e){return void 0===e?C.getScrollTop():C.setScrollTop(e)},this.scrollLeft=function(e){return void 0===e?C.getScrollLeft():C.setScrollLeft(e)};var D=function(e,t,i,r,n,o,s){this.st=e,this.ed=t,this.spd=i,this.p1=r||0,this.p2=n||1,this.p3=o||0,this.p4=s||1,this.ts=g(),this.df=t-e};if(D.prototype={B2:function(e){return 3*(1-e)*(1-e)*e},B3:function(e){return 3*(1-e)*e*e},B4:function(e){return e*e*e},getPos:function(){return(g()-this.ts)/this.spd},getNow:function(){var e=(g()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return e>=1?this.ed:this.st+this.df*t|0},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=g(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},k.hastranslate3d&&k.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){var t=v();if(t)return 16==t.length?-t[13]:-t[5];if(C.timerscroll&&C.timerscroll.bz)return C.timerscroll.bz.getNow()}return C.doc.translate.y},this.getScrollLeft=function(e){if(!e){var t=v();if(t)return 16==t.length?-t[12]:-t[4];if(C.timerscroll&&C.timerscroll.bh)return C.timerscroll.bh.getNow()}return C.doc.translate.x},this.notifyScrollEvent=function(e){var t=a.createEvent("UIEvents");t.initUIEvent("scroll",!1,!1,l,1),t.niceevent=!0,e.dispatchEvent(t)};var R=this.isrtlmode?1:-1;k.hastranslate3d&&E.enabletranslate3d?(this.setScrollTop=function(e,t){C.doc.translate.y=e,C.doc.translate.ty=-1*e+"px",C.doc.css(k.trstyle,"translate3d("+C.doc.translate.tx+","+C.doc.translate.ty+",0)"),t||C.notifyScrollEvent(C.win[0])},this.setScrollLeft=function(e,t){C.doc.translate.x=e,C.doc.translate.tx=e*R+"px",C.doc.css(k.trstyle,"translate3d("+C.doc.translate.tx+","+C.doc.translate.ty+",0)"),t||C.notifyScrollEvent(C.win[0])}):(this.setScrollTop=function(e,t){C.doc.translate.y=e,C.doc.translate.ty=-1*e+"px",C.doc.css(k.trstyle,"translate("+C.doc.translate.tx+","+C.doc.translate.ty+")"),t||C.notifyScrollEvent(C.win[0])},this.setScrollLeft=function(e,t){C.doc.translate.x=e,C.doc.translate.tx=e*R+"px",C.doc.css(k.trstyle,"translate("+C.doc.translate.tx+","+C.doc.translate.ty+")"),t||C.notifyScrollEvent(C.win[0])})}else this.getScrollTop=function(){return C.docscroll.scrollTop()},this.setScrollTop=function(e){C.docscroll.scrollTop(e)},this.getScrollLeft=function(){return C.hasreversehr?C.detected.ismozilla?C.page.maxw-Math.abs(C.docscroll.scrollLeft()):C.page.maxw-C.docscroll.scrollLeft():C.docscroll.scrollLeft()},this.setScrollLeft=function(e){return setTimeout(function(){if(C)return C.hasreversehr&&(e=C.detected.ismozilla?-(C.page.maxw-e):C.page.maxw-e),C.docscroll.scrollLeft(e)},1)};this.getTarget=function(e){return!!e&&(e.target?e.target:!!e.srcElement&&e.srcElement)},this.hasParent=function(e,t){if(!e)return!1;for(var i=e.target||e.srcElement||e||!1;i&&i.id!=t;)i=i.parentNode||!1;return!1!==i};var P={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:l.pageYOffset||a.documentElement.scrollTop,left:l.pageXOffset||a.documentElement.scrollLeft}},this.getOffset=function(){if(C.isfixed){var e=C.win.offset(),t=C.getDocumentScrollOffset();return e.top-=t.top,e.left-=t.left,e}var i=C.win.offset();if(!C.viewport)return i;var r=C.viewport.offset();return{top:i.top-r.top,left:i.left-r.left}},this.updateScrollBar=function(e){var t,i;if(C.ishwscroll)C.rail.css({height:C.win.innerHeight()-(E.railpadding.top+E.railpadding.bottom)}),C.railh&&C.railh.css({width:C.win.innerWidth()-(E.railpadding.left+E.railpadding.right)});else{var r=C.getOffset();if((t={top:r.top,left:r.left-(E.railpadding.left+E.railpadding.right)}).top+=b(C.win,"border-top-width",!0),t.left+=C.rail.align?C.win.outerWidth()-b(C.win,"border-right-width")-C.rail.width:b(C.win,"border-left-width"),(i=E.railoffset)&&(i.top&&(t.top+=i.top),i.left&&(t.left+=i.left)),C.railslocked||C.rail.css({top:t.top,left:t.left,height:(e?e.h:C.win.innerHeight())-(E.railpadding.top+E.railpadding.bottom)}),C.zoom&&C.zoom.css({top:t.top+1,left:1==C.rail.align?t.left-20:t.left+C.rail.width+4}),C.railh&&!C.railslocked){t={top:r.top,left:r.left},(i=E.railhoffset)&&(i.top&&(t.top+=i.top),i.left&&(t.left+=i.left));var n=C.railh.align?t.top+b(C.win,"border-top-width",!0)+C.win.innerHeight()-C.railh.height:t.top+b(C.win,"border-top-width",!0),o=t.left+b(C.win,"border-left-width");C.railh.css({top:n-(E.railpadding.top+E.railpadding.bottom),left:o,width:C.railh.width})}}},this.doRailClick=function(e,t,i){var r,n,o,s;C.railslocked||(C.cancelEvent(e),"pageY"in e||(e.pageX=e.clientX+a.documentElement.scrollLeft,e.pageY=e.clientY+a.documentElement.scrollTop),t?(r=i?C.doScrollLeft:C.doScrollTop,o=i?(e.pageX-C.railh.offset().left-C.cursorwidth/2)*C.scrollratio.x:(e.pageY-C.rail.offset().top-C.cursorheight/2)*C.scrollratio.y,C.unsynched("relativexy"),r(0|o)):(r=i?C.doScrollLeftBy:C.doScrollBy,o=i?C.scroll.x:C.scroll.y,s=i?e.pageX-C.railh.offset().left:e.pageY-C.rail.offset().top,n=i?C.view.w:C.view.h,r(o>=s?n:-n)))},C.newscrolly=C.newscrollx=0,C.hasanimationframe="requestAnimationFrame"in l,C.hascancelanimationframe="cancelAnimationFrame"in l,C.hasborderbox=!1,this.init=function(){if(C.saved.css=[],k.isoperamini)return!0;if(k.isandroid&&!("hidden"in a))return!0;E.emulatetouch=E.emulatetouch||E.touchbehavior,C.hasborderbox=l.getComputedStyle&&"border-box"===l.getComputedStyle(a.body)["box-sizing"];var e={"overflow-y":"hidden"};if((k.isie11||k.isie10)&&(e["-ms-overflow-style"]="none"),C.ishwscroll&&(this.doc.css(k.transitionstyle,k.prefixstyle+"transform 0ms ease-out"),k.transitionend&&C.bind(C.doc,k.transitionend,C.onScrollTransitionEnd,!1)),C.zindex="auto",C.ispage||"auto"!=E.zindex?C.zindex=E.zindex:C.zindex=function(){var e=C.win;if("zIndex"in e)return e.zIndex();for(;e.length>0;){if(9==e[0].nodeType)return!1;var t=e.css("zIndex");if(!isNaN(t)&&0!==t)return parseInt(t);e=e.parent()}return!1}()||"auto",!C.ispage&&"auto"!=C.zindex&&C.zindex>o&&(o=C.zindex),C.isie&&0===C.zindex&&"auto"==E.zindex&&(C.zindex="auto"),!C.ispage||!k.isieold){var n=C.docscroll;C.ispage&&(n=C.haswrapper?C.win:C.doc),C.css(n,e),C.ispage&&(k.isie11||k.isie)&&C.css(s("html"),e),!k.isios||C.ispage||C.haswrapper||C.css(S,{"-webkit-overflow-scrolling":"touch"});var c=s(a.createElement("div"));c.css({position:"relative",top:0,float:"right",width:E.cursorwidth,height:0,"background-color":E.cursorcolor,border:E.cursorborder,"background-clip":"padding-box","-webkit-border-radius":E.cursorborderradius,"-moz-border-radius":E.cursorborderradius,"border-radius":E.cursorborderradius}),c.addClass("nicescroll-cursors"),C.cursor=c;var h=s(a.createElement("div"));h.attr("id",C.id),h.addClass("nicescroll-rails nicescroll-rails-vr");var d,p,g=["left","right","top","bottom"];for(var m in g)p=g[m],(d=E.railpadding[p]||0)&&h.css("padding-"+p,d+"px");h.append(c),h.width=Math.max(parseFloat(E.cursorwidth),c.outerWidth()),h.css({width:h.width+"px",zIndex:C.zindex,background:E.background,cursor:"default"}),h.visibility=!0,h.scrollable=!0,h.align="left"==E.railalign?0:1,C.rail=h,C.rail.drag=!1;var v,y=!1;if(!E.boxzoom||C.ispage||k.isieold||(y=a.createElement("div"),C.bind(y,"click",C.doZoom),C.bind(y,"mouseenter",function(){C.zoom.css("opacity",E.cursoropacitymax)}),C.bind(y,"mouseleave",function(){C.zoom.css("opacity",E.cursoropacitymin)}),C.zoom=s(y),C.zoom.css({cursor:"pointer",zIndex:C.zindex,backgroundImage:"url("+E.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0 0"}),E.dblclickzoom&&C.bind(C.win,"dblclick",C.doZoom),k.cantouch&&E.gesturezoom&&(C.ongesturezoom=function(e){return e.scale>1.5&&C.doZoomIn(e),e.scale<.8&&C.doZoomOut(e),C.cancelEvent(e)},C.bind(C.win,"gestureend",C.ongesturezoom))),C.railh=!1,E.horizrailenabled&&(C.css(n,{overflowX:"hidden"}),(c=s(a.createElement("div"))).css({position:"absolute",top:0,height:E.cursorwidth,width:0,backgroundColor:E.cursorcolor,border:E.cursorborder,backgroundClip:"padding-box","-webkit-border-radius":E.cursorborderradius,"-moz-border-radius":E.cursorborderradius,"border-radius":E.cursorborderradius}),k.isieold&&c.css("overflow","hidden"),c.addClass("nicescroll-cursors"),C.cursorh=c,(v=s(a.createElement("div"))).attr("id",C.id+"-hr"),v.addClass("nicescroll-rails nicescroll-rails-hr"),v.height=Math.max(parseFloat(E.cursorwidth),c.outerHeight()),v.css({height:v.height+"px",zIndex:C.zindex,background:E.background}),v.append(c),v.visibility=!0,v.scrollable=!0,v.align="top"==E.railvalign?0:1,C.railh=v,C.railh.drag=!1),C.ispage)h.css({position:"fixed",top:0,height:"100%"}),h.css(h.align?{right:0}:{left:0}),C.body.append(h),C.railh&&(v.css({position:"fixed",left:0,width:"100%"}),v.css(v.align?{bottom:0}:{top:0}),C.body.append(v));else{if(C.ishwscroll){"static"==C.win.css("position")&&C.css(C.win,{position:"relative"});var b="HTML"==C.win[0].nodeName?C.body:C.win;s(b).scrollTop(0).scrollLeft(0),C.zoom&&(C.zoom.css({position:"absolute",top:1,right:0,"margin-right":h.width+4}),b.append(C.zoom)),h.css({position:"absolute",top:0}),h.css(h.align?{right:0}:{left:0}),b.append(h),v&&(v.css({position:"absolute",left:0,bottom:0}),v.css(v.align?{bottom:0}:{top:0}),b.append(v))}else{C.isfixed="fixed"==C.win.css("position");var w=C.isfixed?"fixed":"absolute";C.isfixed||(C.viewport=C.getViewport(C.win[0])),C.viewport&&(C.body=C.viewport,/fixed|absolute/.test(C.viewport.css("position"))||C.css(C.viewport,{position:"relative"})),h.css({position:w}),C.zoom&&C.zoom.css({position:w}),C.updateScrollBar(),C.body.append(h),C.zoom&&C.body.append(C.zoom),C.railh&&(v.css({position:w}),C.body.append(v))}k.isios&&C.css(C.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),E.disableoutline&&(k.isie&&C.win.attr("hideFocus","true"),k.iswebkit&&C.win.css("outline","none"))}if(!1===E.autohidemode?(C.autohidedom=!1,C.rail.css({opacity:E.cursoropacitymax}),C.railh&&C.railh.css({opacity:E.cursoropacitymax})):!0===E.autohidemode||"leave"===E.autohidemode?(C.autohidedom=s().add(C.rail),k.isie8&&(C.autohidedom=C.autohidedom.add(C.cursor)),C.railh&&(C.autohidedom=C.autohidedom.add(C.railh)),C.railh&&k.isie8&&(C.autohidedom=C.autohidedom.add(C.cursorh))):"scroll"==E.autohidemode?(C.autohidedom=s().add(C.rail),C.railh&&(C.autohidedom=C.autohidedom.add(C.railh))):"cursor"==E.autohidemode?(C.autohidedom=s().add(C.cursor),C.railh&&(C.autohidedom=C.autohidedom.add(C.cursorh))):"hidden"==E.autohidemode&&(C.autohidedom=!1,C.hide(),C.railslocked=!1),k.cantouch||C.istouchcapable||E.emulatetouch||k.hasmstouch){C.scrollmom=new x(C),C.ontouchstart=function(e){if(C.locked)return!1;if(e.pointerType&&("mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))return!1;if(C.hasmoving=!1,C.scrollmom.timer&&(C.triggerScrollEnd(),C.scrollmom.stop()),!C.railslocked){var t=C.getTarget(e);if(t&&/INPUT/i.test(t.nodeName)&&/range/i.test(t.type))return C.stopPropagation(e);var i="mousedown"===e.type;if(!("clientX"in e)&&"changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),C.forcescreen){var r=e;(e={original:e.original?e.original:e}).clientX=r.screenX,e.clientY=r.screenY}if(C.rail.drag={x:e.clientX,y:e.clientY,sx:C.scroll.x,sy:C.scroll.y,st:C.getScrollTop(),sl:C.getScrollLeft(),pt:2,dl:!1,tg:t},C.ispage||!E.directionlockdeadzone)C.rail.drag.dl="f";else{var n={w:u.width(),h:u.height()},o=C.getContentSize(),a=o.h-n.h,l=o.w-n.w;C.rail.scrollable&&!C.railh.scrollable?C.rail.drag.ck=a>0&&"v":!C.rail.scrollable&&C.railh.scrollable?C.rail.drag.ck=l>0&&"h":C.rail.drag.ck=!1}if(E.emulatetouch&&C.isiframe&&k.isie){var c=C.win.position();C.rail.drag.x+=c.left,C.rail.drag.y+=c.top}if(C.hasmoving=!1,C.lastmouseup=!1,C.scrollmom.reset(e.clientX,e.clientY),t&&i){if(!/INPUT|SELECT|BUTTON|TEXTAREA/i.test(t.nodeName))return k.hasmousecapture&&t.setCapture(),E.emulatetouch?(t.onclick&&!t._onclick&&(t._onclick=t.onclick,t.onclick=function(e){if(C.hasmoving)return!1;t._onclick.call(this,e)}),C.cancelEvent(e)):C.stopPropagation(e);/SUBMIT|CANCEL|BUTTON/i.test(s(t).attr("type"))&&(C.preventclick={tg:t,click:!1})}}},C.ontouchend=function(e){if(!C.rail.drag)return!0;if(2==C.rail.drag.pt){if(e.pointerType&&("mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))return!1;C.rail.drag=!1;var t="mouseup"===e.type;if(C.hasmoving&&(C.scrollmom.doMomentum(),C.lastmouseup=!0,C.hideCursor(),k.hasmousecapture&&a.releaseCapture(),t))return C.cancelEvent(e)}else if(1==C.rail.drag.pt)return C.onmouseup(e)};var T=E.emulatetouch&&C.isiframe&&!k.hasmousecapture,_=.3*E.directionlockdeadzone|0;C.ontouchmove=function(e,t){if(!C.rail.drag)return!0;if(e.targetTouches&&E.preventmultitouchscrolling&&e.targetTouches.length>1)return!0;if(e.pointerType&&("mouse"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE))return!0;if(2==C.rail.drag.pt){var i,r;if("changedTouches"in e&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),r=i=0,T&&!t){var n=C.win.position();r=-n.left,i=-n.top}var o=e.clientY+i,s=o-C.rail.drag.y,l=e.clientX+r,u=l-C.rail.drag.x,c=C.rail.drag.st-s;if(C.ishwscroll&&E.bouncescroll)c<0?c=Math.round(c/2):c>C.page.maxh&&(c=C.page.maxh+Math.round((c-C.page.maxh)/2));else if(c<0?(c=0,o=0):c>C.page.maxh&&(c=C.page.maxh,o=0),0===o&&!C.hasmoving)return C.ispage||(C.rail.drag=!1),!0;var h=C.getScrollLeft();if(C.railh&&C.railh.scrollable&&(h=C.isrtlmode?u-C.rail.drag.sl:C.rail.drag.sl-u,C.ishwscroll&&E.bouncescroll?h<0?h=Math.round(h/2):h>C.page.maxw&&(h=C.page.maxw+Math.round((h-C.page.maxw)/2)):(h<0&&(h=0,l=0),h>C.page.maxw&&(h=C.page.maxw,l=0))),!C.hasmoving){if(C.rail.drag.y===e.clientY&&C.rail.drag.x===e.clientX)return C.cancelEvent(e);var d=Math.abs(s),p=Math.abs(u),f=E.directionlockdeadzone;if(C.rail.drag.ck?"v"==C.rail.drag.ck?p>f&&d<=_?C.rail.drag=!1:d>f&&(C.rail.drag.dl="v"):"h"==C.rail.drag.ck&&(d>f&&p<=_?C.rail.drag=!1:p>f&&(C.rail.drag.dl="h")):d>f&&p>f?C.rail.drag.dl="f":d>f?C.rail.drag.dl=p>_?"f":"v":p>f&&(C.rail.drag.dl=d>_?"f":"h"),!C.rail.drag.dl)return C.cancelEvent(e);C.triggerScrollStart(e.clientX,e.clientY,0,0,0),C.hasmoving=!0}return C.preventclick&&!C.preventclick.click&&(C.preventclick.click=C.preventclick.tg.onclick||!1,C.preventclick.tg.onclick=C.onpreventclick),C.rail.drag.dl&&("v"==C.rail.drag.dl?h=C.rail.drag.sl:"h"==C.rail.drag.dl&&(c=C.rail.drag.st)),C.synched("touchmove",function(){C.rail.drag&&2==C.rail.drag.pt&&(C.prepareTransition&&C.resetTransition(),C.rail.scrollable&&C.setScrollTop(c),C.scrollmom.update(l,o),C.railh&&C.railh.scrollable?(C.setScrollLeft(h),C.showCursor(c,h)):C.showCursor(c),k.isie10&&a.selection.clear())}),C.cancelEvent(e)}return 1==C.rail.drag.pt?C.onmousemove(e):void 0},C.ontouchstartCursor=function(e,t){if(!C.rail.drag||3==C.rail.drag.pt){if(C.locked)return C.cancelEvent(e);C.cancelScroll(),C.rail.drag={x:e.touches[0].clientX,y:e.touches[0].clientY,sx:C.scroll.x,sy:C.scroll.y,pt:3,hr:!!t};var i=C.getTarget(e);return!C.ispage&&k.hasmousecapture&&i.setCapture(),C.isiframe&&!k.hasmousecapture&&(C.saved.csspointerevents=C.doc.css("pointer-events"),C.css(C.doc,{"pointer-events":"none"})),C.cancelEvent(e)}},C.ontouchendCursor=function(e){if(C.rail.drag){if(k.hasmousecapture&&a.releaseCapture(),C.isiframe&&!k.hasmousecapture&&C.doc.css("pointer-events",C.saved.csspointerevents),3!=C.rail.drag.pt)return;return C.rail.drag=!1,C.cancelEvent(e)}},C.ontouchmoveCursor=function(e){if(C.rail.drag){if(3!=C.rail.drag.pt)return;if(C.cursorfreezed=!0,C.rail.drag.hr){C.scroll.x=C.rail.drag.sx+(e.touches[0].clientX-C.rail.drag.x),C.scroll.x<0&&(C.scroll.x=0);var t=C.scrollvaluemaxw;C.scroll.x>t&&(C.scroll.x=t)}else{C.scroll.y=C.rail.drag.sy+(e.touches[0].clientY-C.rail.drag.y),C.scroll.y<0&&(C.scroll.y=0);var i=C.scrollvaluemax;C.scroll.y>i&&(C.scroll.y=i)}return C.synched("touchmove",function(){C.rail.drag&&3==C.rail.drag.pt&&(C.showCursor(),C.rail.drag.hr?C.doScrollLeft(Math.round(C.scroll.x*C.scrollratio.x),E.cursordragspeed):C.doScrollTop(Math.round(C.scroll.y*C.scrollratio.y),E.cursordragspeed))}),C.cancelEvent(e)}}}if(C.onmousedown=function(e,t){if(!C.rail.drag||1==C.rail.drag.pt){if(C.railslocked)return C.cancelEvent(e);C.cancelScroll(),C.rail.drag={x:e.clientX,y:e.clientY,sx:C.scroll.x,sy:C.scroll.y,pt:1,hr:t||!1};var i=C.getTarget(e);return k.hasmousecapture&&i.setCapture(),C.isiframe&&!k.hasmousecapture&&(C.saved.csspointerevents=C.doc.css("pointer-events"),C.css(C.doc,{"pointer-events":"none"})),C.hasmoving=!1,C.cancelEvent(e)}},C.onmouseup=function(e){if(C.rail.drag)return 1!=C.rail.drag.pt||(k.hasmousecapture&&a.releaseCapture(),C.isiframe&&!k.hasmousecapture&&C.doc.css("pointer-events",C.saved.csspointerevents),C.rail.drag=!1,C.cursorfreezed=!1,C.hasmoving&&C.triggerScrollEnd(),C.cancelEvent(e))},C.onmousemove=function(e){if(C.rail.drag){if(1!==C.rail.drag.pt)return;if(k.ischrome&&0===e.which)return C.onmouseup(e);if(C.cursorfreezed=!0,C.hasmoving||C.triggerScrollStart(e.clientX,e.clientY,0,0,0),C.hasmoving=!0,C.rail.drag.hr){C.scroll.x=C.rail.drag.sx+(e.clientX-C.rail.drag.x),C.scroll.x<0&&(C.scroll.x=0);var t=C.scrollvaluemaxw;C.scroll.x>t&&(C.scroll.x=t)}else{C.scroll.y=C.rail.drag.sy+(e.clientY-C.rail.drag.y),C.scroll.y<0&&(C.scroll.y=0);var i=C.scrollvaluemax;C.scroll.y>i&&(C.scroll.y=i)}return C.synched("mousemove",function(){C.cursorfreezed&&(C.showCursor(),C.rail.drag.hr?C.scrollLeft(Math.round(C.scroll.x*C.scrollratio.x)):C.scrollTop(Math.round(C.scroll.y*C.scrollratio.y)))}),C.cancelEvent(e)}C.checkarea=0},k.cantouch||E.emulatetouch)C.onpreventclick=function(e){if(C.preventclick)return C.preventclick.tg.onclick=C.preventclick.click,C.preventclick=!1,C.cancelEvent(e)},C.onclick=!k.isios&&function(e){return!C.lastmouseup||(C.lastmouseup=!1,C.cancelEvent(e))},E.grabcursorenabled&&k.cursorgrabvalue&&(C.css(C.ispage?C.doc:C.win,{cursor:k.cursorgrabvalue}),C.css(C.rail,{cursor:k.cursorgrabvalue}));else{var A=function(e){if(C.selectiondrag){if(e){var t=C.win.outerHeight(),i=e.pageY-C.selectiondrag.top;i>0&&i<t&&(i=0),i>=t&&(i-=t),C.selectiondrag.df=i}if(0!==C.selectiondrag.df){var r=-2*C.selectiondrag.df/6|0;C.doScrollBy(r),C.debounced("doselectionscroll",function(){A()},50)}}};C.hasTextSelected="getSelection"in a?function(){return a.getSelection().rangeCount>0}:"selection"in a?function(){return"None"!=a.selection.type}:function(){return!1},C.onselectionstart=function(e){C.ispage||(C.selectiondrag=C.win.offset())},C.onselectionend=function(e){C.selectiondrag=!1},C.onselectiondrag=function(e){C.selectiondrag&&C.hasTextSelected()&&C.debounced("selectionscroll",function(){A(e)},250)}}if(k.hasw3ctouch?(C.css(C.ispage?s("html"):C.win,{"touch-action":"none"}),C.css(C.rail,{"touch-action":"none"}),C.css(C.cursor,{"touch-action":"none"}),C.bind(C.win,"pointerdown",C.ontouchstart),C.bind(a,"pointerup",C.ontouchend),C.delegate(a,"pointermove",C.ontouchmove)):k.hasmstouch?(C.css(C.ispage?s("html"):C.win,{"-ms-touch-action":"none"}),C.css(C.rail,{"-ms-touch-action":"none"}),C.css(C.cursor,{"-ms-touch-action":"none"}),C.bind(C.win,"MSPointerDown",C.ontouchstart),C.bind(a,"MSPointerUp",C.ontouchend),C.delegate(a,"MSPointerMove",C.ontouchmove),C.bind(C.cursor,"MSGestureHold",function(e){e.preventDefault()}),C.bind(C.cursor,"contextmenu",function(e){e.preventDefault()})):k.cantouch&&(C.bind(C.win,"touchstart",C.ontouchstart,!1,!0),C.bind(a,"touchend",C.ontouchend,!1,!0),C.bind(a,"touchcancel",C.ontouchend,!1,!0),C.delegate(a,"touchmove",C.ontouchmove,!1,!0)),E.emulatetouch&&(C.bind(C.win,"mousedown",C.ontouchstart,!1,!0),C.bind(a,"mouseup",C.ontouchend,!1,!0),C.bind(a,"mousemove",C.ontouchmove,!1,!0)),(E.cursordragontouch||!k.cantouch&&!E.emulatetouch)&&(C.rail.css({cursor:"default"}),C.railh&&C.railh.css({cursor:"default"}),C.jqbind(C.rail,"mouseenter",function(){if(!C.ispage&&!C.win.is(":visible"))return!1;C.canshowonmouseevent&&C.showCursor(),C.rail.active=!0}),C.jqbind(C.rail,"mouseleave",function(){C.rail.active=!1,C.rail.drag||C.hideCursor()}),E.sensitiverail&&(C.bind(C.rail,"click",function(e){C.doRailClick(e,!1,!1)}),C.bind(C.rail,"dblclick",function(e){C.doRailClick(e,!0,!1)}),C.bind(C.cursor,"click",function(e){C.cancelEvent(e)}),C.bind(C.cursor,"dblclick",function(e){C.cancelEvent(e)})),C.railh&&(C.jqbind(C.railh,"mouseenter",function(){if(!C.ispage&&!C.win.is(":visible"))return!1;C.canshowonmouseevent&&C.showCursor(),C.rail.active=!0}),C.jqbind(C.railh,"mouseleave",function(){C.rail.active=!1,C.rail.drag||C.hideCursor()}),E.sensitiverail&&(C.bind(C.railh,"click",function(e){C.doRailClick(e,!1,!0)}),C.bind(C.railh,"dblclick",function(e){C.doRailClick(e,!0,!0)}),C.bind(C.cursorh,"click",function(e){C.cancelEvent(e)}),C.bind(C.cursorh,"dblclick",function(e){C.cancelEvent(e)})))),E.cursordragontouch&&(this.istouchcapable||k.cantouch)&&(C.bind(C.cursor,"touchstart",C.ontouchstartCursor),C.bind(C.cursor,"touchmove",C.ontouchmoveCursor),C.bind(C.cursor,"touchend",C.ontouchendCursor),C.cursorh&&C.bind(C.cursorh,"touchstart",function(e){C.ontouchstartCursor(e,!0)}),C.cursorh&&C.bind(C.cursorh,"touchmove",C.ontouchmoveCursor),C.cursorh&&C.bind(C.cursorh,"touchend",C.ontouchendCursor)),E.emulatetouch||k.isandroid||k.isios?(C.bind(k.hasmousecapture?C.win:a,"mouseup",C.ontouchend),C.onclick&&C.bind(a,"click",C.onclick),E.cursordragontouch?(C.bind(C.cursor,"mousedown",C.onmousedown),C.bind(C.cursor,"mouseup",C.onmouseup),C.cursorh&&C.bind(C.cursorh,"mousedown",function(e){C.onmousedown(e,!0)}),C.cursorh&&C.bind(C.cursorh,"mouseup",C.onmouseup)):(C.bind(C.rail,"mousedown",function(e){e.preventDefault()}),C.railh&&C.bind(C.railh,"mousedown",function(e){e.preventDefault()}))):(C.bind(k.hasmousecapture?C.win:a,"mouseup",C.onmouseup),C.bind(a,"mousemove",C.onmousemove),C.onclick&&C.bind(a,"click",C.onclick),C.bind(C.cursor,"mousedown",C.onmousedown),C.bind(C.cursor,"mouseup",C.onmouseup),C.railh&&(C.bind(C.cursorh,"mousedown",function(e){C.onmousedown(e,!0)}),C.bind(C.cursorh,"mouseup",C.onmouseup)),!C.ispage&&E.enablescrollonselection&&(C.bind(C.win[0],"mousedown",C.onselectionstart),C.bind(a,"mouseup",C.onselectionend),C.bind(C.cursor,"mouseup",C.onselectionend),C.cursorh&&C.bind(C.cursorh,"mouseup",C.onselectionend),C.bind(a,"mousemove",C.onselectiondrag)),C.zoom&&(C.jqbind(C.zoom,"mouseenter",function(){C.canshowonmouseevent&&C.showCursor(),C.rail.active=!0}),C.jqbind(C.zoom,"mouseleave",function(){C.rail.active=!1,C.rail.drag||C.hideCursor()}))),E.enablemousewheel&&(C.isiframe||C.mousewheel(k.isie&&C.ispage?a:C.win,C.onmousewheel),C.mousewheel(C.rail,C.onmousewheel),C.railh&&C.mousewheel(C.railh,C.onmousewheelhr)),C.ispage||k.cantouch||/HTML|^BODY/.test(C.win[0].nodeName)||(C.win.attr("tabindex")||C.win.attr({tabindex:++r}),C.bind(C.win,"focus",function(e){t=C.getTarget(e).id||C.getTarget(e)||!1,C.hasfocus=!0,C.canshowonmouseevent&&C.noticeCursor()}),C.bind(C.win,"blur",function(e){t=!1,C.hasfocus=!1}),C.bind(C.win,"mouseenter",function(e){i=C.getTarget(e).id||C.getTarget(e)||!1,C.hasmousefocus=!0,C.canshowonmouseevent&&C.noticeCursor()}),C.bind(C.win,"mouseleave",function(e){i=!1,C.hasmousefocus=!1,C.rail.drag||C.hideCursor()})),C.onkeypress=function(e){if(C.railslocked&&0===C.page.maxh)return!0;e=e||l.event;var r=C.getTarget(e);if(r&&/INPUT|TEXTAREA|SELECT|OPTION/.test(r.nodeName)&&(!r.getAttribute("type")&&!r.type||!/submit|button|cancel/i.tp))return!0;if(s(r).attr("contenteditable"))return!0;if(C.hasfocus||C.hasmousefocus&&!t||C.ispage&&!t&&!i){var n=e.keyCode;if(C.railslocked&&27!=n)return C.cancelEvent(e);var o=e.ctrlKey||!1,a=e.shiftKey||!1,u=!1;switch(n){case 38:case 63233:C.doScrollBy(72),u=!0;break;case 40:case 63235:C.doScrollBy(-72),u=!0;break;case 37:case 63232:C.railh&&(o?C.doScrollLeft(0):C.doScrollLeftBy(72),u=!0);break;case 39:case 63234:C.railh&&(o?C.doScrollLeft(C.page.maxw):C.doScrollLeftBy(-72),u=!0);break;case 33:case 63276:C.doScrollBy(C.view.h),u=!0;break;case 34:case 63277:C.doScrollBy(-C.view.h),u=!0;break;case 36:case 63273:C.railh&&o?C.doScrollPos(0,0):C.doScrollTo(0),u=!0;break;case 35:case 63275:C.railh&&o?C.doScrollPos(C.page.maxw,C.page.maxh):C.doScrollTo(C.page.maxh),u=!0;break;case 32:E.spacebarenabled&&(a?C.doScrollBy(C.view.h):C.doScrollBy(-C.view.h),u=!0);break;case 27:C.zoomactive&&(C.doZoom(),u=!0)}if(u)return C.cancelEvent(e)}},E.enablekeyboard&&C.bind(a,k.isopera&&!k.isopera12?"keypress":"keydown",C.onkeypress),C.bind(a,"keydown",function(e){e.ctrlKey&&(C.wheelprevented=!0)}),C.bind(a,"keyup",function(e){e.ctrlKey||(C.wheelprevented=!1)}),C.bind(l,"blur",function(e){C.wheelprevented=!1}),C.bind(l,"resize",C.onscreenresize),C.bind(l,"orientationchange",C.onscreenresize),C.bind(l,"load",C.lazyResize),k.ischrome&&!C.ispage&&!C.haswrapper){var I=C.win.attr("style"),M=parseFloat(C.win.css("width"))+1;C.win.css("width",M),C.synched("chromefix",function(){C.win.attr("style",I)})}if(C.onAttributeChange=function(e){C.lazyResize(C.isieold?250:30)},E.enableobserver&&(C.isie11||!1===f||(C.observerbody=new f(function(e){if(e.forEach(function(e){if("attributes"==e.type)return S.hasClass("modal-open")&&S.hasClass("modal-dialog")&&!s.contains(s(".modal-dialog")[0],C.doc[0])?C.hide():C.show()}),C.me.clientWidth!=C.page.width||C.me.clientHeight!=C.page.height)return C.lazyResize(30)}),C.observerbody.observe(a.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),!C.ispage&&!C.haswrapper)){var D=C.win[0];!1!==f?(C.observer=new f(function(e){e.forEach(C.onAttributeChange)}),C.observer.observe(D,{childList:!0,characterData:!1,attributes:!0,subtree:!1}),C.observerremover=new f(function(e){e.forEach(function(e){if(e.removedNodes.length>0)for(var t in e.removedNodes)if(C&&e.removedNodes[t]===D)return C.remove()})}),C.observerremover.observe(D.parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(C.bind(D,k.isie&&!k.isie9?"propertychange":"DOMAttrModified",C.onAttributeChange),k.isie9&&D.attachEvent("onpropertychange",C.onAttributeChange),C.bind(D,"DOMNodeRemoved",function(e){e.target===D&&C.remove()}))}!C.ispage&&E.boxzoom&&C.bind(l,"resize",C.resizeZoom),C.istextarea&&(C.bind(C.win,"keydown",C.lazyResize),C.bind(C.win,"mouseup",C.lazyResize)),C.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var R=function(){var t;C.iframexd=!1;try{(t="contentDocument"in this?this.contentDocument:this.contentWindow._doc).domain}catch(e){C.iframexd=!0,t=!1}if(C.iframexd)return"console"in l&&console.log("NiceScroll error: policy restriced iframe"),!0;if(C.forcescreen=!0,C.isiframe&&(C.iframe={doc:s(t),html:C.doc.contents().find("html")[0],body:C.doc.contents().find("body")[0]},C.getContentSize=function(){return{w:Math.max(C.iframe.html.scrollWidth,C.iframe.body.scrollWidth),h:Math.max(C.iframe.html.scrollHeight,C.iframe.body.scrollHeight)}},C.docscroll=s(C.iframe.body)),!k.isios&&E.iframeautoresize&&!C.isiframe){C.win.scrollTop(0),C.doc.height("");var i=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight);C.doc.height(i)}C.lazyResize(30),C.css(s(C.iframe.body),e),k.isios&&C.haswrapper&&C.css(s(t.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?C.bind(this.contentWindow,"scroll",C.onscroll):C.bind(t,"scroll",C.onscroll),E.enablemousewheel&&C.mousewheel(t,C.onmousewheel),E.enablekeyboard&&C.bind(t,k.isopera?"keypress":"keydown",C.onkeypress),k.cantouch?(C.bind(t,"touchstart",C.ontouchstart),C.bind(t,"touchmove",C.ontouchmove)):E.emulatetouch&&(C.bind(t,"mousedown",C.ontouchstart),C.bind(t,"mousemove",function(e){return C.ontouchmove(e,!0)}),E.grabcursorenabled&&k.cursorgrabvalue&&C.css(s(t.body),{cursor:k.cursorgrabvalue})),C.bind(t,"mouseup",C.ontouchend),C.zoom&&(E.dblclickzoom&&C.bind(t,"dblclick",C.doZoom),C.ongesturezoom&&C.bind(t,"gestureend",C.ongesturezoom))};this.doc[0].readyState&&"complete"===this.doc[0].readyState&&setTimeout(function(){R.call(C.doc[0],!1)},500),C.bind(this.doc,"load",R)}},this.showCursor=function(e,t){if(C.cursortimeout&&(clearTimeout(C.cursortimeout),C.cursortimeout=0),C.rail){if(C.autohidedom&&(C.autohidedom.stop().css({opacity:E.cursoropacitymax}),C.cursoractive=!0),C.rail.drag&&1==C.rail.drag.pt||(void 0!==e&&!1!==e&&(C.scroll.y=e/C.scrollratio.y|0),void 0!==t&&(C.scroll.x=t/C.scrollratio.x|0)),C.cursor.css({height:C.cursorheight,top:C.scroll.y}),C.cursorh){var i=C.hasreversehr?C.scrollvaluemaxw-C.scroll.x:C.scroll.x;C.cursorh.css({width:C.cursorwidth,left:!C.rail.align&&C.rail.visibility?i+C.rail.width:i}),C.cursoractive=!0}C.zoom&&C.zoom.stop().css({opacity:E.cursoropacitymax})}},this.hideCursor=function(e){C.cursortimeout||C.rail&&C.autohidedom&&(C.hasmousefocus&&"leave"===E.autohidemode||(C.cursortimeout=setTimeout(function(){C.rail.active&&C.showonmouseevent||(C.autohidedom.stop().animate({opacity:E.cursoropacitymin}),C.zoom&&C.zoom.stop().animate({opacity:E.cursoropacitymin}),C.cursoractive=!1),C.cursortimeout=0},e||E.hidecursordelay)))},this.noticeCursor=function(e,t,i){C.showCursor(t,i),C.rail.active||C.hideCursor(e)},this.getContentSize=C.ispage?function(){return{w:Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),h:Math.max(a.body.scrollHeight,a.documentElement.scrollHeight)}}:C.haswrapper?function(){return{w:C.doc[0].offsetWidth,h:C.doc[0].offsetHeight}}:function(){return{w:C.docscroll[0].scrollWidth,h:C.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!C||!C.win)return!1;var i=C.page.maxh,r=C.page.maxw,n=C.view.h,o=C.view.w;if(C.view={w:C.ispage?C.win.width():C.win[0].clientWidth,h:C.ispage?C.win.height():C.win[0].clientHeight},C.page=t||C.getContentSize(),C.page.maxh=Math.max(0,C.page.h-C.view.h),C.page.maxw=Math.max(0,C.page.w-C.view.w),C.page.maxh==i&&C.page.maxw==r&&C.view.w==o&&C.view.h==n){if(C.ispage)return C;var s=C.win.offset();if(C.lastposition){var a=C.lastposition;if(a.top==s.top&&a.left==s.left)return C}C.lastposition=s}return 0===C.page.maxh?(C.hideRail(),C.scrollvaluemax=0,C.scroll.y=0,C.scrollratio.y=0,C.cursorheight=0,C.setScrollTop(0),C.rail&&(C.rail.scrollable=!1)):(C.page.maxh-=E.railpadding.top+E.railpadding.bottom,C.rail.scrollable=!0),0===C.page.maxw?(C.hideRailHr(),C.scrollvaluemaxw=0,C.scroll.x=0,C.scrollratio.x=0,C.cursorwidth=0,C.setScrollLeft(0),C.railh&&(C.railh.scrollable=!1)):(C.page.maxw-=E.railpadding.left+E.railpadding.right,C.railh&&(C.railh.scrollable=E.horizrailenabled)),C.railslocked=C.locked||0===C.page.maxh&&0===C.page.maxw,C.railslocked?(C.ispage||C.updateScrollBar(C.view),!1):(C.hidden||(C.rail.visibility||C.showRail(),C.railh&&!C.railh.visibility&&C.showRailHr()),C.istextarea&&C.win.css("resize")&&"none"!=C.win.css("resize")&&(C.view.h-=20),C.cursorheight=Math.min(C.view.h,Math.round(C.view.h*(C.view.h/C.page.h))),C.cursorheight=E.cursorfixedheight?E.cursorfixedheight:Math.max(E.cursorminheight,C.cursorheight),C.cursorwidth=Math.min(C.view.w,Math.round(C.view.w*(C.view.w/C.page.w))),C.cursorwidth=E.cursorfixedheight?E.cursorfixedheight:Math.max(E.cursorminheight,C.cursorwidth),C.scrollvaluemax=C.view.h-C.cursorheight-(E.railpadding.top+E.railpadding.bottom),C.hasborderbox||(C.scrollvaluemax-=C.cursor[0].offsetHeight-C.cursor[0].clientHeight),C.railh&&(C.railh.width=C.page.maxh>0?C.view.w-C.rail.width:C.view.w,C.scrollvaluemaxw=C.railh.width-C.cursorwidth-(E.railpadding.left+E.railpadding.right)),C.ispage||C.updateScrollBar(C.view),C.scrollratio={x:C.page.maxw/C.scrollvaluemaxw,y:C.page.maxh/C.scrollvaluemax},C.getScrollTop()>C.page.maxh?C.doScrollTop(C.page.maxh):(C.scroll.y=C.getScrollTop()/C.scrollratio.y|0,C.scroll.x=C.getScrollLeft()/C.scrollratio.x|0,C.cursoractive&&C.noticeCursor()),C.scroll.y&&0===C.getScrollTop()&&C.doScrollTo(C.scroll.y*C.scrollratio.y|0),C)},this.resize=C.onResize;var L=0;this.onscreenresize=function(e){clearTimeout(L);var t=!C.ispage&&!C.haswrapper;t&&C.hideRails(),L=setTimeout(function(){C&&(t&&C.showRails(),C.resize()),L=0},120)},this.lazyResize=function(e){return clearTimeout(L),e=isNaN(e)?240:e,L=setTimeout(function(){C&&C.resize(),L=0},e),C},this.jqbind=function(e,t,i){C.events.push({e:e,n:t,f:i,q:!0}),s(e).on(t,i)},this.mousewheel=function(e,t,i){var r="jquery"in e?e[0]:e;if("onwheel"in a.createElement("div"))C._bind(r,"wheel",t,i||!1);else{var n=void 0!==a.onmousewheel?"mousewheel":"DOMMouseScroll";w(r,n,t,i||!1),"DOMMouseScroll"==n&&w(r,"MozMousePixelScroll",t,i||!1)}};var N=!1;if(k.haseventlistener){try{var O=Object.defineProperty({},"passive",{get:function(){N=!0}});l.addEventListener("test",null,O)}catch(e){}this.stopPropagation=function(e){return!!e&&((e=e.original?e.original:e).stopPropagation(),!1)},this.cancelEvent=function(e){return e.cancelable&&e.preventDefault(),e.stopImmediatePropagation(),e.preventManipulation&&e.preventManipulation(),!1}}else Event.prototype.preventDefault=function(){this.returnValue=!1},Event.prototype.stopPropagation=function(){this.cancelBubble=!0},l.constructor.prototype.addEventListener=a.constructor.prototype.addEventListener=Element.prototype.addEventListener=function(e,t,i){this.attachEvent("on"+e,t)},l.constructor.prototype.removeEventListener=a.constructor.prototype.removeEventListener=Element.prototype.removeEventListener=function(e,t,i){this.detachEvent("on"+e,t)},this.cancelEvent=function(e){return(e=e||l.event)&&(e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1),!1},this.stopPropagation=function(e){return(e=e||l.event)&&(e.cancelBubble=!0),!1};this.delegate=function(e,t,i,r,n){var o=c[t]||!1;o||(o={a:[],l:[],f:function(e){for(var t=o.l,i=!1,r=t.length-1;r>=0;r--)if(!1===(i=t[r].call(e.target,e)))return!1;return i}},C.bind(e,t,o.f,r,n),c[t]=o),C.ispage?(o.a=[C.id].concat(o.a),o.l=[i].concat(o.l)):(o.a.push(C.id),o.l.push(i))},this.undelegate=function(e,t,i,r,n){var o=c[t]||!1;if(o&&o.l)for(var s=0,a=o.l.length;s<a;s++)o.a[s]===C.id&&(o.a.splice(s),o.l.splice(s),0===o.a.length&&(C._unbind(e,t,o.l.f),c[t]=null))},this.bind=function(e,t,i,r,n){var o="jquery"in e?e[0]:e;C._bind(o,t,i,r||!1,n||!1)},this._bind=function(e,t,i,r,n){C.events.push({e:e,n:t,f:i,b:r,q:!1}),N&&n?e.addEventListener(t,i,{passive:!1,capture:r}):e.addEventListener(t,i,r||!1)},this._unbind=function(e,t,i,r){c[t]?C.undelegate(e,t,i,r):e.removeEventListener(t,i,r)},this.unbindAll=function(){for(var e=0;e<C.events.length;e++){var t=C.events[e];t.q?t.e.unbind(t.n,t.f):C._unbind(t.e,t.n,t.f,t.b)}},this.showRails=function(){return C.showRail().showRailHr()},this.showRail=function(){return 0===C.page.maxh||!C.ispage&&"none"==C.win.css("display")||(C.rail.visibility=!0,C.rail.css("display","block")),C},this.showRailHr=function(){return C.railh&&(0===C.page.maxw||!C.ispage&&"none"==C.win.css("display")||(C.railh.visibility=!0,C.railh.css("display","block"))),C},this.hideRails=function(){return C.hideRail().hideRailHr()},this.hideRail=function(){return C.rail.visibility=!1,C.rail.css("display","none"),C},this.hideRailHr=function(){return C.railh&&(C.railh.visibility=!1,C.railh.css("display","none")),C},this.show=function(){return C.hidden=!1,C.railslocked=!1,C.showRails()},this.hide=function(){return C.hidden=!0,C.railslocked=!0,C.hideRails()},this.toggle=function(){return C.hidden?C.show():C.hide()},this.remove=function(){for(var e in C.stop(),C.cursortimeout&&clearTimeout(C.cursortimeout),C.delaylist)C.delaylist[e]&&d(C.delaylist[e].h);C.doZoomOut(),C.unbindAll(),k.isie9&&C.win[0].detachEvent("onpropertychange",C.onAttributeChange),!1!==C.observer&&C.observer.disconnect(),!1!==C.observerremover&&C.observerremover.disconnect(),!1!==C.observerbody&&C.observerbody.disconnect(),C.events=null,C.cursor&&C.cursor.remove(),C.cursorh&&C.cursorh.remove(),C.rail&&C.rail.remove(),C.railh&&C.railh.remove(),C.zoom&&C.zoom.remove();for(var t=0;t<C.saved.css.length;t++){var i=C.saved.css[t];i[0].css(i[1],void 0===i[2]?"":i[2])}C.saved=!1,C.me.data("__nicescroll","");var r=s.nicescroll;for(var n in r.each(function(e){if(this&&this.id===C.id){delete r[e];for(var t=++e;t<r.length;t++,e++)r[e]=r[t];--r.length&&delete r[r.length]}}),C)C[n]=null,delete C[n];C=null},this.scrollstart=function(e){return this.onscrollstart=e,C},this.scrollend=function(e){return this.onscrollend=e,C},this.scrollcancel=function(e){return this.onscrollcancel=e,C},this.zoomin=function(e){return this.onzoomin=e,C},this.zoomout=function(e){return this.onzoomout=e,C},this.isScrollable=function(e){var t=e.target?e.target:e;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&t!==this.me[0]&&!/^BODY|HTML/.test(t.nodeName);){var i=s(t),r=i.css("overflowY")||i.css("overflowX")||i.css("overflow")||"";if(/scroll|auto/.test(r))return t.clientHeight!=t.scrollHeight;t=!!t.parentNode&&t.parentNode}return!1},this.getViewport=function(e){for(var t=!(!e||!e.parentNode)&&e.parentNode;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var i=s(t);if(/fixed|absolute/.test(i.css("position")))return i;var r=i.css("overflowY")||i.css("overflowX")||i.css("overflow")||"";if(/scroll|auto/.test(r)&&t.clientHeight!=t.scrollHeight)return i;if(i.getNiceScroll().length>0)return i;t=!!t.parentNode&&t.parentNode}return!1},this.triggerScrollStart=function(e,t,i,r,n){if(C.onscrollstart){var o={type:"scrollstart",current:{x:e,y:t},request:{x:i,y:r},end:{x:C.newscrollx,y:C.newscrolly},speed:n};C.onscrollstart.call(C,o)}},this.triggerScrollEnd=function(){if(C.onscrollend){var e=C.getScrollLeft(),t=C.getScrollTop(),i={type:"scrollend",current:{x:e,y:t},end:{x:e,y:t}};C.onscrollend.call(C,i)}};var F=0,B=0,G=0,U=1,z=!1;if(this.onmousewheel=function(e){if(C.wheelprevented||C.locked)return!1;if(C.railslocked)return C.debounced("checkunlock",C.resize,250),!1;if(C.rail.drag)return C.cancelEvent(e);if("auto"===E.oneaxismousemode&&0!==e.deltaX&&(E.oneaxismousemode=!1),E.oneaxismousemode&&0===e.deltaX&&!C.rail.scrollable)return!C.railh||!C.railh.scrollable||C.onmousewheelhr(e);var t=g(),i=!1;if(E.preservenativescrolling&&C.checkarea+600<t&&(C.nativescrollingarea=C.isScrollable(e),i=!0),C.checkarea=t,C.nativescrollingarea)return!0;var r=_(e,!1,i);return r&&(C.checkarea=0),r},this.onmousewheelhr=function(e){if(!C.wheelprevented){if(C.railslocked||!C.railh.scrollable)return!0;if(C.rail.drag)return C.cancelEvent(e);var t=g(),i=!1;return E.preservenativescrolling&&C.checkarea+600<t&&(C.nativescrollingarea=C.isScrollable(e),i=!0),C.checkarea=t,!!C.nativescrollingarea||(C.railslocked?C.cancelEvent(e):_(e,!0,i))}},this.stop=function(){return C.cancelScroll(),C.scrollmon&&C.scrollmon.stop(),C.cursorfreezed=!1,C.scroll.y=Math.round(C.getScrollTop()*(1/C.scrollratio.y)),C.noticeCursor(),C},this.getTransitionSpeed=function(e){return 80+e/72*E.scrollspeed|0},E.smoothscroll)if(C.ishwscroll&&k.hastransition&&E.usetransition&&E.smoothscroll){var V="";this.resetTransition=function(){V="",C.doc.css(k.prefixstyle+"transition-duration","0ms")},this.prepareTransition=function(e,t){var i=t?e:C.getTransitionSpeed(e),r=i+"ms";return V!==r&&(V=r,C.doc.css(k.prefixstyle+"transition-duration",r)),i},this.doScrollLeft=function(e,t){var i=C.scrollrunning?C.newscrolly:C.getScrollTop();C.doScrollPos(e,i,t)},this.doScrollTop=function(e,t){var i=C.scrollrunning?C.newscrollx:C.getScrollLeft();C.doScrollPos(i,e,t)},this.cursorupdate={running:!1,start:function(){var e=this;if(!e.running){e.running=!0;var t=function(){e.running&&h(t),C.showCursor(C.getScrollTop(),C.getScrollLeft()),C.notifyScrollEvent(C.win[0])};h(t)}},stop:function(){this.running=!1}},this.doScrollPos=function(e,t,i){var r=C.getScrollTop(),n=C.getScrollLeft();if(((C.newscrolly-r)*(t-r)<0||(C.newscrollx-n)*(e-n)<0)&&C.cancelScroll(),E.bouncescroll?(t<0?t=t/2|0:t>C.page.maxh&&(t=C.page.maxh+(t-C.page.maxh)/2|0),e<0?e=e/2|0:e>C.page.maxw&&(e=C.page.maxw+(e-C.page.maxw)/2|0)):(t<0?t=0:t>C.page.maxh&&(t=C.page.maxh),e<0?e=0:e>C.page.maxw&&(e=C.page.maxw)),C.scrollrunning&&e==C.newscrollx&&t==C.newscrolly)return!1;C.newscrolly=t,C.newscrollx=e;var o=C.getScrollTop(),s=C.getScrollLeft(),a={};a.x=e-s,a.y=t-o;var l=0|Math.sqrt(a.x*a.x+a.y*a.y),u=C.prepareTransition(l);C.scrollrunning||(C.scrollrunning=!0,C.triggerScrollStart(s,o,e,t,u),C.cursorupdate.start()),C.scrollendtrapped=!0,k.transitionend||(C.scrollendtrapped&&clearTimeout(C.scrollendtrapped),C.scrollendtrapped=setTimeout(C.onScrollTransitionEnd,u)),C.setScrollTop(C.newscrolly),C.setScrollLeft(C.newscrollx)},this.cancelScroll=function(){if(!C.scrollendtrapped)return!0;var e=C.getScrollTop(),t=C.getScrollLeft();return C.scrollrunning=!1,k.transitionend||clearTimeout(k.transitionend),C.scrollendtrapped=!1,C.resetTransition(),C.setScrollTop(e),C.railh&&C.setScrollLeft(t),C.timerscroll&&C.timerscroll.tm&&clearInterval(C.timerscroll.tm),C.timerscroll=!1,C.cursorfreezed=!1,C.cursorupdate.stop(),C.showCursor(e,t),C},this.onScrollTransitionEnd=function(){if(C.scrollendtrapped){var e=C.getScrollTop(),t=C.getScrollLeft();if(e<0?e=0:e>C.page.maxh&&(e=C.page.maxh),t<0?t=0:t>C.page.maxw&&(t=C.page.maxw),e!=C.newscrolly||t!=C.newscrollx)return C.doScrollPos(t,e,E.snapbackspeed);C.scrollrunning&&C.triggerScrollEnd(),C.scrollrunning=!1,C.scrollendtrapped=!1,C.resetTransition(),C.timerscroll=!1,C.setScrollTop(e),C.railh&&C.setScrollLeft(t),C.cursorupdate.stop(),C.noticeCursor(!1,e,t),C.cursorfreezed=!1}}}else this.doScrollLeft=function(e,t){var i=C.scrollrunning?C.newscrolly:C.getScrollTop();C.doScrollPos(e,i,t)},this.doScrollTop=function(e,t){var i=C.scrollrunning?C.newscrollx:C.getScrollLeft();C.doScrollPos(i,e,t)},this.doScrollPos=function(e,t,i){var r=C.getScrollTop(),n=C.getScrollLeft();((C.newscrolly-r)*(t-r)<0||(C.newscrollx-n)*(e-n)<0)&&C.cancelScroll();var o=!1;if(C.bouncescroll&&C.rail.visibility||(t<0?(t=0,o=!0):t>C.page.maxh&&(t=C.page.maxh,o=!0)),C.bouncescroll&&C.railh.visibility||(e<0?(e=0,o=!0):e>C.page.maxw&&(e=C.page.maxw,o=!0)),C.scrollrunning&&C.newscrolly===t&&C.newscrollx===e)return!0;C.newscrolly=t,C.newscrollx=e,C.dst={},C.dst.x=e-n,C.dst.y=t-r,C.dst.px=n,C.dst.py=r;var s=0|Math.sqrt(C.dst.x*C.dst.x+C.dst.y*C.dst.y),a=C.getTransitionSpeed(s);C.bzscroll={};var l=o?1:.58;C.bzscroll.x=new D(n,C.newscrollx,a,0,0,l,1),C.bzscroll.y=new D(r,C.newscrolly,a,0,0,l,1),g();var u=function(){if(C.scrollrunning){var e=C.bzscroll.y.getPos();C.setScrollLeft(C.bzscroll.x.getNow()),C.setScrollTop(C.bzscroll.y.getNow()),e<=1?C.timer=h(u):(C.scrollrunning=!1,C.timer=0,C.triggerScrollEnd())}};C.scrollrunning||(C.triggerScrollStart(n,r,e,t,a),C.scrollrunning=!0,C.timer=h(u))},this.cancelScroll=function(){return C.timer&&d(C.timer),C.timer=0,C.bzscroll=!1,C.scrollrunning=!1,C};else this.doScrollLeft=function(e,t){var i=C.getScrollTop();C.doScrollPos(e,i,t)},this.doScrollTop=function(e,t){var i=C.getScrollLeft();C.doScrollPos(i,e,t)},this.doScrollPos=function(e,t,i){var r=e>C.page.maxw?C.page.maxw:e;r<0&&(r=0);var n=t>C.page.maxh?C.page.maxh:t;n<0&&(n=0),C.synched("scroll",function(){C.setScrollTop(n),C.setScrollLeft(r)})},this.cancelScroll=function(){};this.doScrollBy=function(e,t){T(0,e)},this.doScrollLeftBy=function(e,t){T(e,0)},this.doScrollTo=function(e,t){var i=t?Math.round(e*C.scrollratio.y):e;i<0?i=0:i>C.page.maxh&&(i=C.page.maxh),C.cursorfreezed=!1,C.doScrollTop(e)},this.checkContentSize=function(){var e=C.getContentSize();e.h==C.page.h&&e.w==C.page.w||C.resize(!1,e)},C.onscroll=function(e){C.rail.drag||C.cursorfreezed||C.synched("scroll",function(){C.scroll.y=Math.round(C.getScrollTop()/C.scrollratio.y),C.railh&&(C.scroll.x=Math.round(C.getScrollLeft()/C.scrollratio.x)),C.noticeCursor()})},C.bind(C.docscroll,"scroll",C.onscroll),this.doZoomIn=function(e){if(!C.zoomactive){C.zoomactive=!0,C.zoomrestore={style:{}};var t=["position","top","left","zIndex","backgroundColor","marginTop","marginBottom","marginLeft","marginRight"],i=C.win[0].style;for(var r in t){var n=t[r];C.zoomrestore.style[n]=void 0!==i[n]?i[n]:""}C.zoomrestore.style.width=C.win.css("width"),C.zoomrestore.style.height=C.win.css("height"),C.zoomrestore.padding={w:C.win.outerWidth()-C.win.width(),h:C.win.outerHeight()-C.win.height()},k.isios4&&(C.zoomrestore.scrollTop=u.scrollTop(),u.scrollTop(0)),C.win.css({position:k.isios4?"absolute":"fixed",top:0,left:0,zIndex:o+100,margin:0});var s=C.win.css("backgroundColor");return(""===s||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(s))&&C.win.css("backgroundColor","#fff"),C.rail.css({zIndex:o+101}),C.zoom.css({zIndex:o+102}),C.zoom.css("backgroundPosition","0 -18px"),C.resizeZoom(),C.onzoomin&&C.onzoomin.call(C),C.cancelEvent(e)}},this.doZoomOut=function(e){if(C.zoomactive)return C.zoomactive=!1,C.win.css("margin",""),C.win.css(C.zoomrestore.style),k.isios4&&u.scrollTop(C.zoomrestore.scrollTop),C.rail.css({"z-index":C.zindex}),C.zoom.css({"z-index":C.zindex}),C.zoomrestore=!1,C.zoom.css("backgroundPosition","0 0"),C.onResize(),C.onzoomout&&C.onzoomout.call(C),C.cancelEvent(e)},this.doZoom=function(e){return C.zoomactive?C.doZoomOut(e):C.doZoomIn(e)},this.resizeZoom=function(){if(C.zoomactive){var e=C.getScrollTop();C.win.css({width:u.width()-C.zoomrestore.padding.w+"px",height:u.height()-C.zoomrestore.padding.h+"px"}),C.onResize(),C.setScrollTop(Math.min(C.page.maxh,e))}},this.init(),s.nicescroll.push(this)},x=function(e){var t=this;this.nc=e,this.lastx=0,this.lasty=0,this.speedx=0,this.speedy=0,this.lasttime=0,this.steptime=0,this.snapx=!1,this.snapy=!1,this.demulx=0,this.demuly=0,this.lastscrollx=-1,this.lastscrolly=-1,this.chkx=0,this.chky=0,this.timer=0,this.reset=function(e,i){t.stop(),t.steptime=0,t.lasttime=g(),t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=i,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,i){var r=g();t.steptime=r-t.lasttime,t.lasttime=r;var n=i-t.lasty,o=e-t.lastx,s=t.nc.getScrollTop()+n,a=t.nc.getScrollLeft()+o;t.snapx=a<0||a>t.nc.page.maxw,t.snapy=s<0||s>t.nc.page.maxh,t.speedx=o,t.speedy=n,t.lastx=e,t.lasty=i},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,i){var r=!1;i<0?(i=0,r=!0):i>t.nc.page.maxh&&(i=t.nc.page.maxh,r=!0),e<0?(e=0,r=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,r=!0),r?t.nc.doScrollPos(e,i,t.nc.opt.snapbackspeed):t.nc.triggerScrollEnd()},this.doMomentum=function(e){var i=g(),r=e?i+e:t.lasttime,n=t.nc.getScrollLeft(),o=t.nc.getScrollTop(),s=t.nc.page.maxh,a=t.nc.page.maxw;t.speedx=a>0?Math.min(60,t.speedx):0,t.speedy=s>0?Math.min(60,t.speedy):0;var l=r&&i-r<=60;(o<0||o>s||n<0||n>a)&&(l=!1);var u=!(!t.speedy||!l)&&t.speedy,c=!(!t.speedx||!l)&&t.speedx;if(u||c){var h=Math.max(16,t.steptime);if(h>50){var d=h/50;t.speedx*=d,t.speedy*=d,h=50}t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var p=t.lastscrollx,f=t.lastscrolly,m=function(){var e=g()-i>600?.04:.02;t.speedx&&(p=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=p,(p<0||p>a)&&(e=.1)),t.speedy&&(f=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=f,(f<0||f>s)&&(e=.1)),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft(),t.chkx=p,t.nc.setScrollLeft(p)),t.speedy&&(t.nc.getScrollTop(),t.chky=f,t.nc.setScrollTop(f)),t.timer||(t.nc.hideCursor(),t.doSnapy(p,f))}),t.demulxy<1?t.timer=setTimeout(m,h):(t.stop(),t.nc.hideCursor(),t.doSnapy(p,f))};m()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},w=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(e,t,i){var r=s.data(e,"__nicescroll")||!1;return r&&r.ishwscroll?r.getScrollTop():w.call(e)},set:function(e,t){var i=s.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollTop(parseInt(t)):w.call(e,t),this}},e.fn.scrollTop=function(e){if(void 0===e){var t=!!this[0]&&(s.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollTop():w.call(this)}return this.each(function(){var t=s.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollTop(parseInt(e)):w.call(s(this),e)})};var T=e.fn.scrollLeft;s.cssHooks.pageXOffset={get:function(e,t,i){var r=s.data(e,"__nicescroll")||!1;return r&&r.ishwscroll?r.getScrollLeft():T.call(e)},set:function(e,t){var i=s.data(e,"__nicescroll")||!1;return i&&i.ishwscroll?i.setScrollLeft(parseInt(t)):T.call(e,t),this}},e.fn.scrollLeft=function(e){if(void 0===e){var t=!!this[0]&&(s.data(this[0],"__nicescroll")||!1);return t&&t.ishwscroll?t.getScrollLeft():T.call(this)}return this.each(function(){var t=s.data(this,"__nicescroll")||!1;t&&t.ishwscroll?t.setScrollLeft(parseInt(e)):T.call(s(this),e)})};var _=function(e){var t=this;if(this.length=0,this.name="nicescrollarray",this.each=function(e){return s.each(t,e),t},this.push=function(e){t[t.length]=e,t.length++},this.eq=function(e){return t[e]},e)for(var i=0;i<e.length;i++){var r=s.data(e[i],"__nicescroll")||!1;r&&(this[this.length]=r,this.length++)}return this};!function(e,t,i){for(var r=0,n=t.length;r<n;r++)i(e,t[r])}(_.prototype,["show","hide","toggle","onResize","resize","remove","stop","doScrollPos"],function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(e){return void 0===e?new _(this):this[e]&&s.data(this[e],"__nicescroll")||!1},(e.expr.pseudos||e.expr[":"]).nicescroll=function(e){return void 0!==s.data(e,"__nicescroll")},s.fn.niceScroll=function(e,t){void 0!==t||"object"!=typeof e||"jquery"in e||(t=e,e=!1);var i=new _;return this.each(function(){var r=s(this),n=s.extend({},t);if(e){var o=s(e);n.doc=o.length>1?s(e,r):o,n.win=r}!("doc"in n)||"win"in n||(n.win=r);var a=r.data("__nicescroll")||!1;a||(n.doc=n.doc||r,a=new b(n,r),r.data("__nicescroll",a)),i.push(a)}),1===i.length?i[0]:i},l.NiceScroll={getjQuery:function(){return e}},s.nicescroll||(s.nicescroll=new _,s.nicescroll.options=m)}),r("gui/FeaturePopup",["jquery","./FeaturePopupCore","./IFrame","./ImageProcessing","service/Samp","underscore-min","text!templates/featureList.html","text!templates/featureDescription.html","text!templates/descriptionTable.html","jquery.nicescroll.min","jquery.ui"],function(e,t,i,r,n,o,s,a,l){var u,c,h;o.template(s),o.template(a),o.template(l);return{init:function(n,o,s,a){u=n,o,s,a,c=e('<div id="selectedFeatureDiv" class="contentBox ui-widget-content" style="display: none">\t\t\t\t<div id="leftDiv"></div>\t\t\t\t<div id="rightDiv"></div>\t\t\t\t<div class="closeBtn">\t\t\t\t\t<span class="defaultImg"></span>\t\t\t\t\t<span style="opacity: 0" class="hoverImg"></span>\t\t\t\t</div>\t\t\t\t<div class="arrow-left"></div>\t\t\t</div>').appendTo("body"),e("#leftDiv"),h=e("#rightDiv"),t.init(u,c,o,s,a),r.init({mizar:u,disable:function(){e("#dynamicImageView").removeClass("dynamicAvailable").addClass("dynamicNotAvailable")},unselect:function(){e("#dynamicImageView").removeClass("selected")}}),c.on("click","#quicklook",t.showOrHideQuicklook),c.on("click","#quicklookWms",t.showOrHideQuicklookWms),c.on("click","#quicklookFits",t.showOrHideQuicklookFits),c.on("click","#dynamicImageView",t.showOrHideDynamicImageService),c.on("click","#sendImage",t.sendImageBySamp),c.on("click","#healpix",t.showOrHideHEALPixService),c.on("mousedown","#scroll-arrow-down.clickable",function(){e("#selectedFeatureDiv #scroll-arrow-up").css("border-bottom-color","orange").addClass("clickable");var t=e("#featureList"),i=parseInt(e("#featureListDiv").css("max-height"))/2,r=parseInt(t.css("top"),10)-i,n=t.height(),o=parseInt(e("#featureListDiv").css("max-height"));r<=-(n-o)&&(r=-(n-o),e(this).css("border-top-color","gray").removeClass("clickable")),t.stop().animate({top:r+"px"},300)}).disableSelection(),c.on("mousedown","#scroll-arrow-up.clickable",function(){e("#selectedFeatureDiv #scroll-arrow-down").css("border-top-color","orange").addClass("clickable");var t=e("#featureList"),i=parseInt(e("#featureListDiv").css("max-height"))/2,r=parseInt(t.css("top"),10)+i;r>=0&&(r=0,e(this).css("border-bottom-color","gray").removeClass("clickable")),t.stop().animate({top:r+"px"},300)}).disableSelection(),c.on("click",".section",function(){c.find(".featureProperties").getNiceScroll().hide(),e(this).siblings("table").fadeToggle("slow","linear",function(){c.find(".featureProperties").getNiceScroll().show(),c.find(".featureProperties").getNiceScroll().resize()}),e(this).siblings("#arrow").is(".arrow-right")?e(this).siblings("#arrow").removeClass("arrow-right").addClass("arrow-bottom"):e(this).siblings("#arrow").removeClass("arrow-bottom").addClass("arrow-right")});c.on("click",".featureTitle",t.selectFeatureOnTitle),c.on("click",".propertiesTable a",function(e){e.preventDefault(),i.show(e.target.innerHTML)}),c.on("click",".featureProperties a",function(e){e.preventDefault(),i.show(e.target.href)}),h.css("max-width",e("#"+u.getRenderContext().canvas.id).width()/4),e(window).on("resize",function(){h.find(".featureProperties").css("max-height",t.computeHeight()),h.css("max-width",e("#"+u.getRenderContext().canvas.id).width()/4)})},hide:t.hide,show:t.show,createFeatureList:t.createFeatureList,showFeatureInformation:t.showFeatureInformation,createHelp:function(){h.html('<div id="pileStashHelp"> Some observations are overlapped. <br/> Click on the observation to see detailed informations about each observation. <br/> </div>')}}}),r("gui/ImageManager",["jquery","./ImageProcessing"],function(e,t){var i,r;return{init:function(e,t){(r=(i=e).getServiceByName(i.SERVICE.FitsVisu)).init(i.getMizarAPI(),t);i.getRenderContext().gl.getExtension("OES_texture_float")},hideImage:function(){r.hideImage()},showImage:function(e){r.showImage(e)},removeImage:function(e){r.removeImage(e)},addImage:function(e){r.addImage(e)},computeFits:function(){r.computeFits()},handleFits:function(e,i){var n=r.handleFits(e,i);t.setImage(n)}}}),r("gui/PickingManager",["jquery","underscore-min","./FeaturePopup","./ImageManager","./CutOutViewFactory"],function(e,t,i,r,n){var o,s,a,l,u,c,h;const d=25,p=3e3;function f(e){h&&e.type.search("touch")>=0&&(e.layerX=e.changedTouches[0].clientX,e.layerY=e.changedTouches[0].clientY),c=new Date,l=e.layerX,u=e.layerY,a.clearSelection()}function g(r){var n=new Date-c;if(h&&r.type.search("touch")>=0&&(r.layerX=r.changedTouches[0].clientX,r.layerY=r.changedTouches[0].clientY),n<500&&Math.abs(l-r.layerX)<5&&Math.abs(u-r.layerY)<5){var s=o.getContext().getLonLatFromPixel(r.layerX,r.layerY);a.clearSelection();var f=a.computePickSelection(s,{eventPos:[r.layerX,r.layerY]});if(!t.isEmpty(f)&&f.length>0){var g=o.getNavigation();i.hide(function(){g.inertia&&g.inertia.stop();var t=function(){var t=a.setSelection(f);a.focusSelection(t),i.createFeatureList(t),t.length>1?(i.createHelp(),a.stackSelectionIndex=-1):(a.focusFeatureByIndex(0,{isExclusive:!0}),e("#featureList div:eq(0)").addClass("selected"),i.showFeatureInformation(t[a.stackSelectionIndex].layer,t[a.stackSelectionIndex].feature));var r=e(o.getRenderContext().canvas).offset();i.show(r.left+o.getRenderContext().canvas.width/2,r.top+o.getRenderContext().canvas.height/2)};if(g.getType()===o.NAVIGATION.AstroNavigation){var r=g.getFov()[1],n=r>d?d:r;g.zoomTo(s,{fov:n,duration:p,callback:t})}else{g.getDistance();var l=s;if(!l)for(var u of f)if("Point"===u.feature.geometry.type&&(l=u.feature.geometry.coordinates))break;g.zoomTo(l,{duration:p,callback:t})}})}else i.hide();o.refresh()}}function m(){s.getRenderContext().canvas.addEventListener("mousedown",f),s.getRenderContext().canvas.addEventListener("mouseup",g),h&&(s.getRenderContext().canvas.addEventListener("touchstart",f),s.getRenderContext().canvas.addEventListener("touchend",g)),o.subscribeCtx(o.EVENT_MSG.NAVIGATION_STARTED,function(){a.clearSelection(),i.hide()})}return{init:function(e,t){s=(o=e).getContext(),this,h=t.isMobile,a=o.getServiceByName(o.SERVICE.PickingManager),m(),o.subscribeMizar(o.EVENT_MSG.MIZAR_MODE_TOGGLE,this.updateContext),o.subscribeCtx(o.EVENT_MSG.CRS_MODIFIED,this.updateContext),r.init(o,t),t.cutOut&&n.init(o,this),i.init(o,this,r,t)},updateContext:function(){s=o.getContext(),a.updateContext(s),m()},addPickableLayer:function(e){a.addPickableLayer(e)},removePickableLayer:function(e){a.removePickableLayer(e)},focusFeature:function(e,t){a.getSelection().push(e),this.focusFeatureByIndex(a.getSelection().length-1,t)},getSelectedData:function(){return a.getSelection()[a.stackSelectionIndex]},getSelection:function(){return a.getSelection()},blurSelectedFeature:function(){a.blurSelectedFeature()},focusFeatureByIndex:function(e,t){a.focusFeatureByIndex(e,t)},computePickSelection:function(e){a.computePickSelection(e)},blurSelection:function(){a.blurSelection()},activate:m,deactivate:function(){s.getRenderContext().canvas.removeEventListener("mousedown",f),s.getRenderContext().canvas.removeEventListener("mouseup",g),h&&(s.getRenderContext().canvas.removeEventListener("touchstart",f),s.getRenderContext().canvas.removeEventListener("touchend",g)),o.unsubscribeCtx(o.EVENT_MSG.NAVIGATION_STARTED,function(){a.clearSelection(),i.hide()})}}}),r("text!templates/backgroundLayers.html",[],function(){return'<div>\n    <h3>Background layer</h3>\n\n    <div id="backgroundLayers">\n        <fieldset>\n            <select style="display: none;" id="backgroundLayersSelect">\n            </select>\n        </fieldset>\n\n        <div style="display: none" id="backgroundSpinner"></div>\n        <br/>\n\n        <div id="backgroundOptions">\n            <input type="checkbox" id="fitsType"/><label for="fitsType">Fits</label>\n            <input type="checkbox" id="fitsView"/><label for="fitsView">Image processing</label>\n            <button class="layerServices">Available services</button>\n            <button class="exportLayer">Send viewport by SAMP</button>\n        </div>\n\n        <button class="backToSky">Back to sky</button>\n    </div>\n</div>\n'}),r("gui/BackgroundLayersView",["jquery","underscore-min","./DynamicImageView","./PickingManager","./LayerServiceView","service/Samp","./dialog/ErrorDialog","../utils/UtilsCore","text!templates/backgroundLayers.html","jquery.ui"],function(e,t,i,r,n,o,s,a,l){var u,c,h,d,p,f,g=0;function m(){if(f.isGroundContext())f.hasPlanetContext()?h.find(".backToSky").button().click(function(e){f.toggleToSky()}):h.find(".backToSky").hide(),h.find("#backgroundOptions").hide();else if(f.isPlanetContext())f.hasSkyContext()?h.find(".backToSky").button().click(function(e){f.toggleToSky()}):h.find(".backToSky").hide(),h.find("#backgroundOptions").hide();else{h.find(".backToSky").hide(),h.find(".layerServices").button({text:!1,icons:{primary:"ui-icon-wrench"}}).click(function(e){n.show(p)}),h.find(".exportLayer").button({text:!1,icons:{primary:"ui-icon-extlink"}}).click(function(e){if(o.isConnected())for(var t=u.baseImagery,i=0;i<u.tileManager.tilesToRender.length;i++){var r=u.tileManager.tilesToRender[i],n=t.getUrl(r);o.sendImage(n)}else s.open("You must be connected to SAMP Hub")}),function(t){h.find("#fitsType").button().click(function(){var i=e("#fitsType").is(":checked"),r=f.getServiceByName(f.SERVICE.FitsHips),n=f.getMizarAPI();r.init(n,{}),i?(e("#fitsType").removeAttr(":checked").button("refresh"),r.createFitsLayer(p),e("#fitsView").button("enable")):(e("#fitsType").attr(":checked",!0).button("refresh"),r.removeFitsLayer(p.ID),t.dialog("isOpen")&&(t.dialog("close"),e("#fitsView").removeAttr("checked").button("refresh")),e("#fitsView").button("disable")),e("#loading").show()})}(function(){var t=e('<div id="backgroundDiv"></div>').appendTo("body").dialog({title:"Image processing",autoOpen:!1,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},width:400,resizable:!1,minHeight:"auto",close:function(t,i){e("#fitsView").removeAttr("checked").button("refresh"),e(this).dialog("close")}});return d=new i("backgroundDiv",{id:"backgroundFitsView",mizar:f}),f.subscribeCtx("baseLayersReady",function(e){"fits"===e.format&&d.setImage(e.levelZeroImage)}),h.find("#fitsView").button({text:!1,icons:{primary:"ui-icon-image"}}).click(function(e){t.dialog("isOpen")?t.dialog("close"):t.dialog("open")}),t}())}}function v(e){if(h.find("#backgroundOptions").is(":visible")){a.isHipsFitsLayer(e)?"fits"!==e.format&&h.find("#fitsType").removeAttr("disabled").removeAttr("checked").button("refresh"):(h.find("#fitsType").attr("disabled","disabled").button("refresh"),h.find("#fitsView").button("disable"));var t=h.find(".layerServices");e.services?t.removeAttr("disabled").button("refresh"):t.attr("disabled","disabled").button("refresh")}}function y(e){h.find("#backgroundSpinner").fadeIn("fast")}function b(e){h.find("#backgroundSpinner").fadeOut("fast")}return{init:function(e){f=e.mizar,u=f.getContext().globe,c=e.configuration.element,this.updateUI(),f.subscribeCtx(f.EVENT_MSG.LAYER_START_BACKGROUND_LOAD,y),f.subscribeCtx(f.EVENT_MSG.LAYER_END_BACKGROUND_LOAD,b),f.subscribeCtx(f.EVENT_MSG.LAYER_BACKGROUND_CHANGED,this.selectLayer)},remove:function(){f.unsubscribeCtx(f.EVENT_MSG.LAYER_START_BACKGROUND_LOAD,y),f.unsubscribeCtx(f.EVENT_MSG.LAYER_END_BACKGROUND_LOAD,b),f.unsubscribeCtx(f.EVENT_MSG.LAYER_BACKGROUND_CHANGED,this.selectLayer),e("#backgroundDiv").dialog("destroy").remove(),h.remove(),g=0},addView:function(t){if("WCSElevation"===t.type||"WMSElevation"===t.type);else{var i=e("<option "+(t.isVisible()?"selected":"")+">"+t.name+"</option>").appendTo(h.find("#backgroundLayersSelect")).data("layer",t);t.icon?i.addClass("backgroundLayer_"+g).attr("data-style","background-image: url("+t.icon+")"):i.addClass("backgroundLayer_"+g).attr("data-class","unknown"),t.isVisible()&&(p=t,v(t)),h.find("#backgroundLayersSelect").iconselectmenu("refresh"),g++}},selectLayer:function(i){h.children().removeAttr("selected");var r=t.find(h.children(),function(e){return e.text===i.name});e(r).attr("selected","selected"),p=i,t.isEmpty(d)||(d.changeShaderCallback=function(e){i.customShader.fragmentCode="raw"===e?i.rawFragShader:i.colormapFragShader}),v(i)},updateUI:function(){h=e(l).prependTo(e(c)),e.widget("custom.iconselectmenu",e.ui.selectmenu,{_renderItem:function(t,i){var r=e("<li>",{text:i.label});return i.disabled&&r.addClass("ui-state-disabled"),e("<span>",{style:i.element.attr("data-style"),class:"ui-icon "+i.element.attr("data-class")}).appendTo(r),r.appendTo(t)}}),m(),h.find("#backgroundLayersSelect").iconselectmenu({select:function(t,i){var r=i.item.index,n=e(this).children().eq(r).data("layer");n!==f.getContext().globe.baseImagery&&f.setBackgroundLayer(n.name)}}).iconselectmenu("menuWidget").addClass("ui-menu-icons customicons")},getDiv:function(){return d}}}),r("gui/AdditionalLayersCore",["jquery","underscore-min","./dialog/ErrorDialog","../utils/UtilsCore"],function(e,t,i,r){var n,o;return{init:function(e){o=(n=e).getContext().globe},generatePointLegend:function(e,t,i){var r=t.getContext("2d"),n=new Image;n.crossOrigin="",n.onload=function(){r.drawImage(n,5,0,10,10);for(var i=r.getImageData(0,0,t.width,t.height),o=0,s=i.data.length;o<s;o+=4)i.data[o]=255*e.style.fillColor[0],i.data[o+1]=255*e.style.fillColor[1],i.data[o+2]=255*e.style.fillColor[2];r.putImageData(i,0,0)},n.src=i},generateLineLegend:function(e,t){var i=t.getContext("2d");i.beginPath(),i.moveTo(2,t.height-2),i.lineTo(t.width/2-2,2),i.lineTo(t.width/2+2,t.height-2),i.lineTo(t.width-2,2),i.lineWidth=1,i.strokeStyle=n.getMizarAPI().UtilityFactory.create(n.UTILITY.FeatureStyle).fromColorToString(e.style.fillColor),i.stroke()},buildVisibleTilesUrl:function(e){for(var t=3,i="",r=0;r<o.tileManager.visibleTiles.length;r++){var n=o.tileManager.visibleTiles[r];t<n.order&&(t=n.order),i+=n.pixelIndex,r<o.tileManager.visibleTiles.length-1&&(i+=",")}return e.serviceUrl+"/search?order="+t+"&healpix="+i+"&coordSystem=EQUATORIAL"},createHTMLFromTemplate:function(e,t,i,r){return e({layer:t,shortName:i,isMobile:r})},setSublayersVisibility:function(e,t){var i;if(t)for(i=0;i<e.subLayers.length;i++)o.addLayer(e.subLayers[i]);else for(i=0;i<e.subLayers.length;i++)o.removeLayer(e.subLayers[i])},zoomTo:function(e){var t=0,i=0,o=0;if(e.features.length>0){for(var s=0;s<e.features.length;s++){var a=r.computeGeometryBarycenter(e.features[s].geometry);t+=a[0],i+=a[1],o++}n.getNavigation().zoomTo([t/o,i/o])}}}}),r("text!templates/additionalLayers.html",[],function(){return'<div style="display: none;" class="category">\n    <h3>Other</h3>\n\n    <div id="otherLayers"></div>\n</div>\n\n<div style="display: none;" class="category">\n    <h3>Coordinate systems</h3>\n\n    <div id="coordinateSystems">\n        <em>Default coordinate system:</em>\n        <select id="defaultCoordSystem">\n            <option value="Equatorial">Equatorial</option>\n            <option value="Galactic">Galactic</option>\n        </select>\n\n        <div id="coordinateGrids">\n        </div>\n    </div>\n</div>'}),r("text!templates/additionalLayer.html",[],function(){return'<div class="ui-widget addLayer" id="addLayer_<%= shortName %>">\n\n\t<span id="visible_<%= shortName %>"\n          class="<% if (layer.isVisible()) print(\'ui-state-active\'); else print(\'ui-state-default\'); %> ui-corner-all ui-button">\n\t\t<span class="ui-icon <% if (layer.isVisible()) print(\'ui-icon-check\'); else print(\'ui-icon-empty\'); %>"></span>\n\t</span>\n\n    <canvas width="20" height="10" class="legend"></canvas>\n\n    <label title="<%= layer.description %>" for="addLayerInput_<%= shortName %>"><%= layer.name %></label>\n\n    <span style="display: none;" class="spinner"></span>\n\n    <div style="display: none;" class="layerTools" class="ui-widget-header ui-corner-all">\n        <%\n        if( layer.deletable )\n        {\n        %>\n\n        <button class="deleteLayer">Delete</button>\n        <%\n        }\n        %>\n\n\n        <% if ( layer.type == "GeoJSON" )\n        {\n        %>\n\n        <button class="zoomTo">zoomTo</button>\n        <%\n        }\n\n        if ( layer.services )\n        {\n        %>\n        <button class="layerServices">Available services</button>\n        <%\n        }\n        if ( layer.type == "OpenSearch" ) \n        {\n        %>\n        <button class="exportLayer">Export visible tiles by SAMP</button>\n        <a href="" download="">\n            <button class="downloadAsVO">Download visible tiles as VOTable</button>\n        </a>\n        <%\n        }\n        %>\n\n        <% if ( layer.type == "Hips" && layer.fitsSupported == true && !isMobile )\n        {\n        %>\n        <input type="checkbox" class="isFits" id="isFits_<%= shortName %>"/><label\n            for="isFits_<%= shortName %>">Fits</label>\n        <input type="checkbox" class="addFitsView" id="addFitsView_<%= shortName %>" disabled="disabled"/><label\n            for="addFitsView_<%= shortName %>"></label>\n        <%\n        }\n        if ( layer.type == "OpenSearch" )\n        {\n        %>\n        <div id="os_navigation_<%= shortName %>">\n            &nbsp;&nbsp;&nbsp;<label class="labelPage_<%= layer.getShortName() %>">Page 1</label>&nbsp;&nbsp;&nbsp;<button class="osNext">Next</button><br/>\n        </div>\n        <div class="QLWMS_<%= shortName %>" style="display:none">\n            <button class="removeWMS">Remove quicklook WMS layers</button>\n        </div>\n        <%\n        }\n        %>\n\n        <div id="opacity_<%= shortName %>">\n            <div>\n                <label for="percentInput_<%= shortName %>">Opacity: </label>\n                <input class="percentInput" type="text" id="percentInput_<%= shortName %>"/>\n            </div>\n            <div class="slider" id="slider_<%= shortName %>"></div>\n        </div>\n\n        \x3c!--<div id="seaLevel_<%= shortName %>">--\x3e\n            \x3c!--<div>--\x3e\n                \x3c!--<label for="seaLevelInput_<%= shortName %>">Sea level: </label>--\x3e\n                \x3c!--<input class="percentInput" type="text" id="seaLevelInput_<%= shortName %>"/>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--<div class="slider" id="seaLevelSlider_<%= shortName %>"></div>--\x3e\n        \x3c!--</div>--\x3e\n        <div id="time_<%= shortName %>">\n            <div>\n                <label for="timeInput_<%= shortName %>">Time: </label>\n                <input class="dateInput" type="text" id="timeInput_<%= shortName %>"/>\n            </div>\n            <div class="sliderTime" id="timeSlider_<%= shortName %>"></div>\n        </div>\n    </div>\n\n</div>\n'}),r("gui/AdditionalLayersView",["jquery","moment","./AdditionalLayersCore","./PickingManager","./DynamicImageView","./LayerServiceView","service/Samp","./dialog/ErrorDialog","../utils/UtilsCore","underscore-min","text!templates/additionalLayers.html","text!templates/additionalLayer.html","jquery.nicescroll.min","jquery.ui"],function(e,t,i,r,n,o,s,a,l,u,c,h){var d,p,f,g,m={Other:"otherLayers","Coordinate systems":"coordinateSystems"},v=!1,y=u.template(h);function b(t){e(g).find("#"+t).getNiceScroll().resize()}function x(i,r){if(void 0!==r){var n=r.getShortName();!function(t,i,r){t.find("#slider_"+i).slider({value:100*r.getOpacity(),min:20,max:100,step:20,slide:function(t,n){if(e("#percentInput_"+i).val(n.value+"%"),r.setOpacity(n.value/100),r.subLayers)for(var o=0;o<r.subLayers.length;o++)r.subLayers[o].setOpacity(n.value/100)}}).slider("option","disabled",!r.isVisible()),e("#percentInput_"+i).val(e("#slider_"+i).slider("value")+"%")}(i,n,r),function(i,r,n){var o,s,a,l,u,c=n.getDimensions().time,h=!1;if(c){var p=d.getMizarAPI().TimeUtility;if(u=c.value.split(","),p.isSampling(u[0])){var f=u[0].split("/");o=t.utc(f[0]),s=t.utc(f[1]),l=p.timeResolution(f[2]),a=Math.floor(s.diff(o,l.unit)/parseInt(l.step)),h=!0}else o=t.utc(u[0]),a=u.length-1,h=!1}i.find("#timeSlider_"+r).slider({value:0,min:0,max:a,step:1,slide:function(i,s){var a;if(h){var c=t.utc(o);c.add(parseInt(s.value)*l.step,l.unit),a=c.toISOString()}else a=u[parseInt(s.value)];e("#timeInput_"+r).val(a),n.setParameter("time",a)}}).slider("option","disabled",!n.isVisible()),c?(e("#timeInput_"+r).val(o.toISOString()),e("#time_"+r).css("visibility","show"),n.setParameter("time",o.toISOString())):e("#time_"+r).css("visibility","hidden")}(i,n,r)}}function w(t){if(void 0!==t){var r=t.isVisible();if(!0===r){for(var n=d.mizarWidgetGui.activatedContext.layers,o=-1,s=null,a=0;a<n.length&&o<0;a++)n[a].ID===t.ID&&(o=a,s=n[a]);if(o>=1){for(var l=o-1;l>=0;l--)n[l+1]=n[l];n[0]=s}}var u=t.getShortName();t.subLayers&&i.setSublayersVisibility(t,r);var c=e("#addLayer_"+u).find(".layerTools");e("#addLayer_"+u).find(".slider").slider(r?"enable":"disable"),e("#addLayer_"+u).find(".sliderTime").slider(r?"enable":"disable"),r?(e(".layerTools").slideUp(),c.slideDown(),e("#visible_"+u).addClass("ui-state-active").removeClass("ui-state-default").find("span").addClass("ui-icon-check").removeClass("ui-icon-empty")):(c.slideUp(),e("#visible_"+u).removeClass("ui-state-active").addClass("ui-state-default").find("span").removeClass("ui-icon-check").addClass("ui-icon-empty")),p.refresh()}}function T(t,r){if(!(void 0===t||t.getType()===d.LAYER.Vector&&t.isDraw())){var n=i.createHTMLFromTemplate(y,t,t.getShortName(),v),o=e(n).appendTo("#"+r).data("layer",t);!function(e,t){var r=e.find(".legend"),n=r[0];l.isOpenSearchLayer(t)||l.isMocLayer(t)||l.isVectorLayer(t)||l.isGeoJsonLayer(t)||l.isHipsCatLayer(t)?t.dataType===d.GEOMETRY.Point?i.generatePointLegend(t,n,t.style.iconUrl):t.dataType===d.GEOMETRY.LineString?i.generateLineLegend(t,n):r.css("display","none"):r.css("display","none")}(o,t),x(o,t),function(t,i,r){if(void 0!==i){var n=i.getShortName(),o=t.find(".layerTools");t.children("label").click(function(){o.slideToggle(b.bind(this,r))}),i.isVisible()&&o.slideDown(),"Atmosphere"===n&&(d.getContext()._atmosphereLayer=i),t.find("#visible_"+n).click(function(){var t=!e(this).hasClass("ui-state-active");i.setVisible(t)})}}(o,t,r),function(e){e.find(".deleteLayer").button({text:!1,icons:{primary:"ui-icon-trash"}}).end().find(".zoomTo").button({text:!1,icons:{primary:"ui-icon-zoomin"}}).end().find(".exportLayer").button({text:!1,icons:{primary:"ui-icon-extlink"}}).end().find(".downloadAsVO").button({text:!1,icons:{primary:"ui-icon-arrowthickstop-1-s"}}).end().find(".removeWMS").button({text:!1,icons:{primary:"ui-icon-newwin"}}).end().find(".isFits").button().end().find(".addFitsView").button({text:!1,icons:{primary:"ui-icon-image"}}).end().find(".layerServices").button({text:!1,icons:{primary:"ui-icon-wrench"}}).end().find(".osNext").button({text:!0,icons:{primary:"ui-icon-triangle-1-e"}})}(o),l.isHipsFitsLayer(t)}}function _(){e(this).parent().parent().fadeOut(300,function(){e(this).remove()});var t=e(this).closest(".addLayer").data("layer");d.removeLayer(t.ID),b("otherLayers")}function C(){var t=e(this).closest(".addLayer").data("layer");null!==t&&t.nextPage()}function S(){var t=e(this).closest(".addLayer").data("layer");o.show(t)}function E(){if(s.isConnected()){var t=e(this).closest(".addLayer").data("layer"),r=i.buildVisibleTilesUrl(t);s.sendVOTable(t,r)}else a.open("You must be connected to SAMP Hub")}function A(){e(this).closest(".addLayer").data("layer").unloadAllWMS()}function I(){var t=e(this).closest(".addLayer").data("layer"),r=i.buildVisibleTilesUrl(t);r+="&media=votable";var n=t.globe.coordinateSystem.getWorldFrom3D(f.center3d),o=l.formatCoordinates(n);e(this).parent().attr("href",r).attr("download",t.name+"_"+o[0]+"_"+o[1])}function M(){var t=e(this).closest(".addLayer").data("layer");i.zoomTo(t)}function k(){var t=e(this).is(":checked"),i=e(this).closest(".addLayer").data("layer");i.format=t?"fits":"jpg",t||e(this).nextAll(".addFitsView").button("disable");var r=i.ID;p.removeLayer(i),p.addLayer(i),e("#addLayer_"+r).attr("id","addLayer_"+i.ID)}function D(t){void 0!==t&&e("#addLayer_"+t.getShortName()).find(".spinner").stop(!0,!0).fadeIn("fast")}function R(t){void 0!==t&&e("#addLayer_"+t.getShortName()).find(".spinner").fadeOut(500)}return{init:function(t){d=t.mizar,p=d.getContext().globe,f=d.getNavigation(),v=t.configuration.isMobile,t.configuration,i.init(d),g=t.configuration.element,e(g).append(c),e("#defaultCoordSystem").selectmenu({select:function(){var t=e(this).children("option:selected").val();d.setCrs({geoideName:t})},width:100}),d.subscribeCtx(d.EVENT_MSG.LAYER_START_LOAD,D),d.subscribeCtx(d.EVENT_MSG.LAYER_END_LOAD,R),e(g).on("click",".category .deleteLayer",_).on("click",".category .layerServices",S).on("click",".category .exportLayer",E).on("click",".category .downloadAsVO",I).on("click",".removeWMS",A).on("click",".category .zoomTo",M).on("click",".category .isFits",k).on("click",".category .osNext",C)},remove:function(){var t=this;e(g).find(".addLayer").each(function(){t.removeView(e(this).data("layer"))}),e(g).find(".category").remove(),d.unsubscribeCtx(d.EVENT_MSG.LAYER_START_LOAD,D),d.unsubscribeCtx(d.EVENT_MSG.LAYER_END_LOAD,R),e(g).off("click",".category .deleteLayer",_).off("click",".category .layerServices",S).off("click",".category .exportLayer",E).off("click",".category .downloadAsVO",I).off("click",".featureService .removeWMS",A).off("click",".category .zoomTo",M).off("click",".category .isFits",k).off("click",".category .osNext",C);for(var i=d.getLayers(),r=0;r<i.length;r++){var n=i[r];n.div&&e("#addFitsViewDialog_"+n.div.id).dialog("destroy").remove()}m={Other:"otherLayers","Coordinate systems":"coordinateSystems"}},addView:function(t){if(""!==t.linkedTo||"WCSElevation"===t.type||"WMSElevation"===t.type||"Moc"===t.type);else{var i,r=t.category;r||(r="Other"),m[r]?(i=m[r],0===e("#"+i+" .addLayer").length&&e("#"+i).closest(".category").show()):(i=l.formatId(r),e('<div class="category"><h3>'+r+'</h3>\t\t\t<div id="'+i+'"></div></div>').insertBefore(e("#otherLayers").parent()),m[r]=i,e(g).accordion("refresh"),function(t){e("#"+t).niceScroll({autohidemode:!1}),e(g).on("accordionbeforeactivate",function(){e("#"+t).niceScroll().hide()}),e(g).on("accordionactivate",function(){e("#"+t).niceScroll().show(),b(t)})}(i)),T(t,i),t.subscribe(d.EVENT_MSG.LAYER_VISIBILITY_CHANGED,w)}},removeView:function(t){if(void 0!==t){var i=e(g).find("#addLayer_"+t.getShortName());1===i.parent().children().length?i.closest(".category").remove():i.remove(),t.div&&(e("#addFitsView_"+t.div.id).dialog("destroy").remove(),t.div=null),t.unsubscribe(d.EVENT_MSG.LAYER_VISIBILITY_CHANGED,w)}},hideView:function(t){e("#addLayer_"+t.getShortName()).hide()},showView:function(t){e("#addLayer_"+t.getShortName()).show()}}}),r("gui/LayerManagerView",["jquery","underscore-min","../utils/UtilsCore","./dialog/ErrorDialog","./LayerServiceView","./BackgroundLayersView","./AdditionalLayersView","./ImageProcessing","jquery.ui"],function(e,t,i,r,n,o,s,a){var l,u,c,h;function d(t){t.stopPropagation(),t.preventDefault(),e.event.props.push("dataTransfer"),function(t){e.each(t,function(t,r){var n=r.name,o=new FileReader;e("#loading").show(),"image/fits"===r.type?(o.onloadend=function(t){var i=this.result,r=l.getServiceByName(l.SERVICE.FitsVisu).parseFits(i),o=l.createLayerFromFits(n,r),s={layer:o,feature:o.features[0],isFits:!0},u=r.getHDU().data;l.publish("image:added",s);var c=l.getServiceByName(l.SERVICE.FitsVisu).handleFits(u,s);a.setImage(c),e("#loading").hide()},o.readAsArrayBuffer(r)):(o.onloadend=function(t){var r;this.result.search("<?xml")>0?i.convertVotable2JsonFromXML(this.result,function(t){l.addLayerByDragNDrop(n,t);e("#loading").hide()}):(r=e.parseJSON(this.result),l.addLayerByDragNDrop(n,r),e("#loading").hide())},o.readAsText(r))})}(t.dataTransfer.files)}function p(e){e.stopPropagation(),e.preventDefault()}function f(e){e.stopPropagation(),e.preventDefault()}return{init:function(t,i){l=t,c=(u=i).element,e('<input type="button" id="lmInvoker" />').appendTo(c),h=e('<div id="accordion" style="display: none;"></div>').appendTo(c),u.element=h,o.init({mizar:l,configuration:u}),s.init({mizar:l,configuration:u}),l.subscribeCtx(l.EVENT_MSG.LAYER_BACKGROUND_ADDED,o.addView),l.subscribeCtx(l.EVENT_MSG.LAYER_ADDED,s.addView),l.subscribeMizar(l.EVENT_MSG.MIZAR_MODE_TOGGLE,this.toggleMode),l.subscribeCtx(l.EVENT_MSG.LAYER_UPDATE_STATS_ATTRIBUTES,this.updateStatsAttributes),l.subscribeCtx(l.EVENT_MSG.LAYER_TOGGLE_WMS,this.toggleWMS),e.event.props.push("dataTransfer"),h.accordion({header:"> div > h3",autoHeight:!1,active:0,collapsible:!0,heightStyle:"content"}).show().accordion("refresh"),n.init(l,u),e("canvas").on("dragover",p),e("canvas").on("dragenter",f),e("canvas").on("drop",d),e("#lmInvoker").click(function(){parseFloat(e(this).siblings("#accordion").css("left"))<0?(e(this).animate({left:"-10px"},300).addClass("selected"),e(this).siblings("#accordion").animate({left:"15px"},300)):(e(this).animate({left:"0px"},300).removeClass("selected"),e(this).siblings("#accordion").animate({left:"-255px"},300))}),u.isMobile||e("#lmInvoker").trigger("click"),u.votable2geojson&&u.votable2geojson.baseUrl},updateStatsAttributes:function(t){void 0!==t.page&&(e(".labelPage_"+t.shortName)[0].innerText="Page "+t.page)},toggleWMS:function(t){void 0!==t.layer_name&&void 0!==t.visible&&(e(".QLWMS_"+t.layer_name)[0].style=!0===t.visible?"display:inline":"display:none")},refresh:function(){h.find("#backgroundLayersSelect").iconselectmenu("refresh")},remove:function(){s.remove(),o.remove(),n.remove(),e(c).empty(),l.unsubscribeCtx(l.EVENT_MSG.LAYER_BACKGROUND_ADDED,o.addView),l.unsubscribeCtx(l.EVENT_MSG.LAYER_ADDED,s.addView),l.unsubscribeMizar(l.EVENT_MSG.MIZAR_MODE_TOGGLE,this.toggleMode),e("canvas").off("dragover",p),e("canvas").off("dragenter",f),e("canvas").off("drop",d)},toggleMode:function(e){o.remove(),s.remove(),o.init({mizar:l,configuration:u}),s.init({mizar:l,configuration:u}),function(e){l.getMizarWidgetGui().setUpdatedActivatedContext(e);for(var t=e.getLayers(),i=0;i<t.length;i++){var r=t[i];r.isBackground()?o.addView(r):s.addView(r)}}(e),l.subscribeCtx(l.EVENT_MSG.LAYER_BACKGROUND_ADDED,o.addView),l.subscribeCtx(l.EVENT_MSG.LAYER_ADDED,s.addView),h.accordion("option","active",0).accordion("refresh")},isInitialized:function(){return!!l}}}),r("text!templates/nameResolverResult.html",[],function(){return'<% if (properties.type == "layer") { %>\n    <% if (first) { %>\n    <div class="firstNameResolverResult"><hr/><span>Layers</span><hr/></div>\n    <% }%>\n    <div class="layerResolverResult" mizar_feature_index="<%= index %>">\n        <div class="nameResolverResult">\n            <em>Type:</em> <%= properties.layerType %><br/>\n            <em>Name:</em> <%= properties.name %><br/>\n            <% if(properties.description) { %>\n                <span title="<%= properties.description %>"><em>Description:</em><% var String=require(\'string\');  print (String(properties.description).truncate(50).s) %></span><br/>\n            <% } %>\n        </div>\n        <button class="show_or_hide"><span>Show</span></button>\n    </div>\n<% } %>\n<% if (properties.type != "layer") {%>\n    <% if (first) { %>\n    <div class="firstNameResolverResult"><hr/><span>Objects</span><hr/></div>\n    <% }%>\n    <div class="nameResolverResult coordinatesResolverResult" mizar_feature_index="<%= index %>">\n        <% if (properties.type) { %>\n            <em>Type:</em> <%= properties.type %><br/>\n        <% } %>\n        <em>Name: </em><%= properties.name %><br/>\n        <em><% (type == "Sky") ? print("RA: ") : print("Longitude: ") %></em><%= lon %><br/>\n        <em><% (type == "Sky") ? print("Dec: ") : print("Latitude: ") %></em><%= lat %><br/>\n        <div class="credits"><%= properties.credits %></div>\n    </div>\n<% } %>\n'}),function(e){"use strict";"object"==typeof exports?e(t("jquery")):"function"==typeof r&&r.amd?r("jquery.once",["jquery"],e):e(jQuery)}(function(e){"use strict";var t=function(e){if("string"!=typeof(e=e||"once"))throw new TypeError("The jQuery Once id parameter must be a string");return e};e.fn.once=function(i){var r="jquery-once-"+t(i);return this.filter(function(){return!0!==e(this).data(r)}).data(r,!0)},e.fn.removeOnce=function(e){return this.findOnce(e).removeData("jquery-once-"+t(e))},e.fn.findOnce=function(i){var r="jquery-once-"+t(i);return this.filter(function(){return!0===e(this).data(r)})}}),function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof r&&r.amd)r("string",e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.S=e()}}(function(){return function e(i,r,n){function o(a,l){if(!r[a]){if(!i[a]){var u="function"==typeof t&&t;if(!l&&u)return u(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var c=r[a]={exports:{}};i[a][0].call(c.exports,function(e){var t=i[a][1][e];return o(t||e)},c,c.exports,e,i,r,n)}return r[a].exports}for(var s="function"==typeof t&&t,a=0;a<n.length;a++)o(n[a]);return o}({1:[function(e,t,i){t.exports=function(e,t){for(var i=0,r=e.indexOf(t);r>=0;)i+=1,r=e.indexOf(t,r+1);return i}},{}],2:[function(e,t,i){t.exports=function(e,t,i,r){void 0===i&&(i=-1);var n=e.split(t),o=n.slice(0,i),s=n.slice(i);return n=0===s.length?o:o.concat(s.join(t)),void 0===r?n:r<0?n.slice(r):n.slice(0,r)}},{}],3:[function(e,t,i){t.exports=function(e,t,i,r){void 0===i&&(i=-1);void 0===r&&(r=0);for(var n=[e],o=e.length-1;o>=0;o--)0===n[0].slice(o).indexOf(t)&&(n.length<=i||-1===i)&&(n.splice(1,0,n[0].slice(o+t.length)),n[0]=n[0].slice(0,o));return r>=0?n.slice(-r):n.slice(0,-r)}},{}],4:[function(e,t,i){(function(){"use strict";var i={},r={"Á":"A","Ă":"A","Ắ":"A","Ặ":"A","Ằ":"A","Ẳ":"A","Ẵ":"A","Ǎ":"A","Â":"A","Ấ":"A","Ậ":"A","Ầ":"A","Ẩ":"A","Ẫ":"A","Ä":"A","Ǟ":"A","Ȧ":"A","Ǡ":"A","Ạ":"A","Ȁ":"A","À":"A","Ả":"A","Ȃ":"A","Ā":"A","Ą":"A","Å":"A","Ǻ":"A","Ḁ":"A","Ⱥ":"A","Ã":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ḃ":"B","Ḅ":"B","Ɓ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ć":"C","Č":"C","Ç":"C","Ḉ":"C","Ĉ":"C","Ċ":"C","Ƈ":"C","Ȼ":"C","Ď":"D","Ḑ":"D","Ḓ":"D","Ḋ":"D","Ḍ":"D","Ɗ":"D","Ḏ":"D","ǲ":"D","ǅ":"D","Đ":"D","Ƌ":"D","Ǳ":"DZ","Ǆ":"DZ","É":"E","Ĕ":"E","Ě":"E","Ȩ":"E","Ḝ":"E","Ê":"E","Ế":"E","Ệ":"E","Ề":"E","Ể":"E","Ễ":"E","Ḙ":"E","Ë":"E","Ė":"E","Ẹ":"E","Ȅ":"E","È":"E","Ẻ":"E","Ȇ":"E","Ē":"E","Ḗ":"E","Ḕ":"E","Ę":"E","Ɇ":"E","Ẽ":"E","Ḛ":"E","Ꝫ":"ET","Ḟ":"F","Ƒ":"F","Ǵ":"G","Ğ":"G","Ǧ":"G","Ģ":"G","Ĝ":"G","Ġ":"G","Ɠ":"G","Ḡ":"G","Ǥ":"G","Ḫ":"H","Ȟ":"H","Ḩ":"H","Ĥ":"H","Ⱨ":"H","Ḧ":"H","Ḣ":"H","Ḥ":"H","Ħ":"H","Í":"I","Ĭ":"I","Ǐ":"I","Î":"I","Ï":"I","Ḯ":"I","İ":"I","Ị":"I","Ȉ":"I","Ì":"I","Ỉ":"I","Ȋ":"I","Ī":"I","Į":"I","Ɨ":"I","Ĩ":"I","Ḭ":"I","Ꝺ":"D","Ꝼ":"F","Ᵹ":"G","Ꞃ":"R","Ꞅ":"S","Ꞇ":"T","Ꝭ":"IS","Ĵ":"J","Ɉ":"J","Ḱ":"K","Ǩ":"K","Ķ":"K","Ⱪ":"K","Ꝃ":"K","Ḳ":"K","Ƙ":"K","Ḵ":"K","Ꝁ":"K","Ꝅ":"K","Ĺ":"L","Ƚ":"L","Ľ":"L","Ļ":"L","Ḽ":"L","Ḷ":"L","Ḹ":"L","Ⱡ":"L","Ꝉ":"L","Ḻ":"L","Ŀ":"L","Ɫ":"L","ǈ":"L","Ł":"L","Ǉ":"LJ","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ń":"N","Ň":"N","Ņ":"N","Ṋ":"N","Ṅ":"N","Ṇ":"N","Ǹ":"N","Ɲ":"N","Ṉ":"N","Ƞ":"N","ǋ":"N","Ñ":"N","Ǌ":"NJ","Ó":"O","Ŏ":"O","Ǒ":"O","Ô":"O","Ố":"O","Ộ":"O","Ồ":"O","Ổ":"O","Ỗ":"O","Ö":"O","Ȫ":"O","Ȯ":"O","Ȱ":"O","Ọ":"O","Ő":"O","Ȍ":"O","Ò":"O","Ỏ":"O","Ơ":"O","Ớ":"O","Ợ":"O","Ờ":"O","Ở":"O","Ỡ":"O","Ȏ":"O","Ꝋ":"O","Ꝍ":"O","Ō":"O","Ṓ":"O","Ṑ":"O","Ɵ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Õ":"O","Ṍ":"O","Ṏ":"O","Ȭ":"O","Ƣ":"OI","Ꝏ":"OO","Ɛ":"E","Ɔ":"O","Ȣ":"OU","Ṕ":"P","Ṗ":"P","Ꝓ":"P","Ƥ":"P","Ꝕ":"P","Ᵽ":"P","Ꝑ":"P","Ꝙ":"Q","Ꝗ":"Q","Ŕ":"R","Ř":"R","Ŗ":"R","Ṙ":"R","Ṛ":"R","Ṝ":"R","Ȑ":"R","Ȓ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꜿ":"C","Ǝ":"E","Ś":"S","Ṥ":"S","Š":"S","Ṧ":"S","Ş":"S","Ŝ":"S","Ș":"S","Ṡ":"S","Ṣ":"S","Ṩ":"S","ẞ":"SS","Ť":"T","Ţ":"T","Ṱ":"T","Ț":"T","Ⱦ":"T","Ṫ":"T","Ṭ":"T","Ƭ":"T","Ṯ":"T","Ʈ":"T","Ŧ":"T","Ɐ":"A","Ꞁ":"L","Ɯ":"M","Ʌ":"V","Ꜩ":"TZ","Ú":"U","Ŭ":"U","Ǔ":"U","Û":"U","Ṷ":"U","Ü":"U","Ǘ":"U","Ǚ":"U","Ǜ":"U","Ǖ":"U","Ṳ":"U","Ụ":"U","Ű":"U","Ȕ":"U","Ù":"U","Ủ":"U","Ư":"U","Ứ":"U","Ự":"U","Ừ":"U","Ử":"U","Ữ":"U","Ȗ":"U","Ū":"U","Ṻ":"U","Ų":"U","Ů":"U","Ũ":"U","Ṹ":"U","Ṵ":"U","Ꝟ":"V","Ṿ":"V","Ʋ":"V","Ṽ":"V","Ꝡ":"VY","Ẃ":"W","Ŵ":"W","Ẅ":"W","Ẇ":"W","Ẉ":"W","Ẁ":"W","Ⱳ":"W","Ẍ":"X","Ẋ":"X","Ý":"Y","Ŷ":"Y","Ÿ":"Y","Ẏ":"Y","Ỵ":"Y","Ỳ":"Y","Ƴ":"Y","Ỷ":"Y","Ỿ":"Y","Ȳ":"Y","Ɏ":"Y","Ỹ":"Y","Ź":"Z","Ž":"Z","Ẑ":"Z","Ⱬ":"Z","Ż":"Z","Ẓ":"Z","Ȥ":"Z","Ẕ":"Z","Ƶ":"Z","Ĳ":"IJ","Œ":"OE","ᴀ":"A","ᴁ":"AE","ʙ":"B","ᴃ":"B","ᴄ":"C","ᴅ":"D","ᴇ":"E","ꜰ":"F","ɢ":"G","ʛ":"G","ʜ":"H","ɪ":"I","ʁ":"R","ᴊ":"J","ᴋ":"K","ʟ":"L","ᴌ":"L","ᴍ":"M","ɴ":"N","ᴏ":"O","ɶ":"OE","ᴐ":"O","ᴕ":"OU","ᴘ":"P","ʀ":"R","ᴎ":"N","ᴙ":"R","ꜱ":"S","ᴛ":"T","ⱻ":"E","ᴚ":"R","ᴜ":"U","ᴠ":"V","ᴡ":"W","ʏ":"Y","ᴢ":"Z","á":"a","ă":"a","ắ":"a","ặ":"a","ằ":"a","ẳ":"a","ẵ":"a","ǎ":"a","â":"a","ấ":"a","ậ":"a","ầ":"a","ẩ":"a","ẫ":"a","ä":"a","ǟ":"a","ȧ":"a","ǡ":"a","ạ":"a","ȁ":"a","à":"a","ả":"a","ȃ":"a","ā":"a","ą":"a","ᶏ":"a","ẚ":"a","å":"a","ǻ":"a","ḁ":"a","ⱥ":"a","ã":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ḃ":"b","ḅ":"b","ɓ":"b","ḇ":"b","ᵬ":"b","ᶀ":"b","ƀ":"b","ƃ":"b","ɵ":"o","ć":"c","č":"c","ç":"c","ḉ":"c","ĉ":"c","ɕ":"c","ċ":"c","ƈ":"c","ȼ":"c","ď":"d","ḑ":"d","ḓ":"d","ȡ":"d","ḋ":"d","ḍ":"d","ɗ":"d","ᶑ":"d","ḏ":"d","ᵭ":"d","ᶁ":"d","đ":"d","ɖ":"d","ƌ":"d","ı":"i","ȷ":"j","ɟ":"j","ʄ":"j","ǳ":"dz","ǆ":"dz","é":"e","ĕ":"e","ě":"e","ȩ":"e","ḝ":"e","ê":"e","ế":"e","ệ":"e","ề":"e","ể":"e","ễ":"e","ḙ":"e","ë":"e","ė":"e","ẹ":"e","ȅ":"e","è":"e","ẻ":"e","ȇ":"e","ē":"e","ḗ":"e","ḕ":"e","ⱸ":"e","ę":"e","ᶒ":"e","ɇ":"e","ẽ":"e","ḛ":"e","ꝫ":"et","ḟ":"f","ƒ":"f","ᵮ":"f","ᶂ":"f","ǵ":"g","ğ":"g","ǧ":"g","ģ":"g","ĝ":"g","ġ":"g","ɠ":"g","ḡ":"g","ᶃ":"g","ǥ":"g","ḫ":"h","ȟ":"h","ḩ":"h","ĥ":"h","ⱨ":"h","ḧ":"h","ḣ":"h","ḥ":"h","ɦ":"h","ẖ":"h","ħ":"h","ƕ":"hv","í":"i","ĭ":"i","ǐ":"i","î":"i","ï":"i","ḯ":"i","ị":"i","ȉ":"i","ì":"i","ỉ":"i","ȋ":"i","ī":"i","į":"i","ᶖ":"i","ɨ":"i","ĩ":"i","ḭ":"i","ꝺ":"d","ꝼ":"f","ᵹ":"g","ꞃ":"r","ꞅ":"s","ꞇ":"t","ꝭ":"is","ǰ":"j","ĵ":"j","ʝ":"j","ɉ":"j","ḱ":"k","ǩ":"k","ķ":"k","ⱪ":"k","ꝃ":"k","ḳ":"k","ƙ":"k","ḵ":"k","ᶄ":"k","ꝁ":"k","ꝅ":"k","ĺ":"l","ƚ":"l","ɬ":"l","ľ":"l","ļ":"l","ḽ":"l","ȴ":"l","ḷ":"l","ḹ":"l","ⱡ":"l","ꝉ":"l","ḻ":"l","ŀ":"l","ɫ":"l","ᶅ":"l","ɭ":"l","ł":"l","ǉ":"lj","ſ":"s","ẜ":"s","ẛ":"s","ẝ":"s","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ᵯ":"m","ᶆ":"m","ń":"n","ň":"n","ņ":"n","ṋ":"n","ȵ":"n","ṅ":"n","ṇ":"n","ǹ":"n","ɲ":"n","ṉ":"n","ƞ":"n","ᵰ":"n","ᶇ":"n","ɳ":"n","ñ":"n","ǌ":"nj","ó":"o","ŏ":"o","ǒ":"o","ô":"o","ố":"o","ộ":"o","ồ":"o","ổ":"o","ỗ":"o","ö":"o","ȫ":"o","ȯ":"o","ȱ":"o","ọ":"o","ő":"o","ȍ":"o","ò":"o","ỏ":"o","ơ":"o","ớ":"o","ợ":"o","ờ":"o","ở":"o","ỡ":"o","ȏ":"o","ꝋ":"o","ꝍ":"o","ⱺ":"o","ō":"o","ṓ":"o","ṑ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","õ":"o","ṍ":"o","ṏ":"o","ȭ":"o","ƣ":"oi","ꝏ":"oo","ɛ":"e","ᶓ":"e","ɔ":"o","ᶗ":"o","ȣ":"ou","ṕ":"p","ṗ":"p","ꝓ":"p","ƥ":"p","ᵱ":"p","ᶈ":"p","ꝕ":"p","ᵽ":"p","ꝑ":"p","ꝙ":"q","ʠ":"q","ɋ":"q","ꝗ":"q","ŕ":"r","ř":"r","ŗ":"r","ṙ":"r","ṛ":"r","ṝ":"r","ȑ":"r","ɾ":"r","ᵳ":"r","ȓ":"r","ṟ":"r","ɼ":"r","ᵲ":"r","ᶉ":"r","ɍ":"r","ɽ":"r","ↄ":"c","ꜿ":"c","ɘ":"e","ɿ":"r","ś":"s","ṥ":"s","š":"s","ṧ":"s","ş":"s","ŝ":"s","ș":"s","ṡ":"s","ṣ":"s","ṩ":"s","ʂ":"s","ᵴ":"s","ᶊ":"s","ȿ":"s","ɡ":"g","ß":"ss","ᴑ":"o","ᴓ":"o","ᴝ":"u","ť":"t","ţ":"t","ṱ":"t","ț":"t","ȶ":"t","ẗ":"t","ⱦ":"t","ṫ":"t","ṭ":"t","ƭ":"t","ṯ":"t","ᵵ":"t","ƫ":"t","ʈ":"t","ŧ":"t","ᵺ":"th","ɐ":"a","ᴂ":"ae","ǝ":"e","ᵷ":"g","ɥ":"h","ʮ":"h","ʯ":"h","ᴉ":"i","ʞ":"k","ꞁ":"l","ɯ":"m","ɰ":"m","ᴔ":"oe","ɹ":"r","ɻ":"r","ɺ":"r","ⱹ":"r","ʇ":"t","ʌ":"v","ʍ":"w","ʎ":"y","ꜩ":"tz","ú":"u","ŭ":"u","ǔ":"u","û":"u","ṷ":"u","ü":"u","ǘ":"u","ǚ":"u","ǜ":"u","ǖ":"u","ṳ":"u","ụ":"u","ű":"u","ȕ":"u","ù":"u","ủ":"u","ư":"u","ứ":"u","ự":"u","ừ":"u","ử":"u","ữ":"u","ȗ":"u","ū":"u","ṻ":"u","ų":"u","ᶙ":"u","ů":"u","ũ":"u","ṹ":"u","ṵ":"u","ᵫ":"ue","ꝸ":"um","ⱴ":"v","ꝟ":"v","ṿ":"v","ʋ":"v","ᶌ":"v","ⱱ":"v","ṽ":"v","ꝡ":"vy","ẃ":"w","ŵ":"w","ẅ":"w","ẇ":"w","ẉ":"w","ẁ":"w","ⱳ":"w","ẘ":"w","ẍ":"x","ẋ":"x","ᶍ":"x","ý":"y","ŷ":"y","ÿ":"y","ẏ":"y","ỵ":"y","ỳ":"y","ƴ":"y","ỷ":"y","ỿ":"y","ȳ":"y","ẙ":"y","ɏ":"y","ỹ":"y","ź":"z","ž":"z","ẑ":"z","ʑ":"z","ⱬ":"z","ż":"z","ẓ":"z","ȥ":"z","ẕ":"z","ᵶ":"z","ᶎ":"z","ʐ":"z","ƶ":"z","ɀ":"z","ﬀ":"ff","ﬃ":"ffi","ﬄ":"ffl","ﬁ":"fi","ﬂ":"fl","ĳ":"ij","œ":"oe","ﬆ":"st","ₐ":"a","ₑ":"e","ᵢ":"i","ⱼ":"j","ₒ":"o","ᵣ":"r","ᵤ":"u","ᵥ":"v","ₓ":"x"};function n(e,t){e.s=null!=t?"string"==typeof t?t:t.toString():t,e.orig=t,null!=t?e.__defineGetter__?e.__defineGetter__("length",function(){return e.s.length}):e.length=t.length:e.length=-1}function o(e){n(this,e)}var s=String.prototype,a=o.prototype={between:function(e,t){var i=this.s,r=i.indexOf(e),n=i.indexOf(t,r+e.length);return-1==n&&null!=t?new this.constructor(""):-1==n&&null==t?new this.constructor(i.substring(r+e.length)):new this.constructor(i.slice(r+e.length,n))},camelize:function(){var e=this.trim().s.replace(/(\-|_|\s)+(.)?/g,function(e,t,i){return i?i.toUpperCase():""});return new this.constructor(e)},capitalize:function(){return new this.constructor(this.s.substr(0,1).toUpperCase()+this.s.substring(1).toLowerCase())},charAt:function(e){return this.s.charAt(e)},chompLeft:function(e){var t=this.s;return 0===t.indexOf(e)?(t=t.slice(e.length),new this.constructor(t)):this},chompRight:function(e){if(this.endsWith(e)){var t=this.s;return t=t.slice(0,t.length-e.length),new this.constructor(t)}return this},collapseWhitespace:function(){var e=this.s.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"");return new this.constructor(e)},contains:function(e){return this.s.indexOf(e)>=0},count:function(t){return e("./_count")(this.s,t)},dasherize:function(){var e=this.trim().s.replace(/[_\s]+/g,"-").replace(/([A-Z])/g,"-$1").replace(/-+/g,"-").toLowerCase();return new this.constructor(e)},equalsIgnoreCase:function(e){return this.s.toLowerCase()==e.toLowerCase()},latinise:function(){var e=this.replace(/[^A-Za-z0-9\[\] ]/g,function(e){return r[e]||e});return new this.constructor(e)},decodeHtmlEntities:function(){var e=this.s;return e=e.replace(/&#(\d+);?/g,function(e,t){return String.fromCharCode(t)}).replace(/&#[xX]([A-Fa-f0-9]+);?/g,function(e,t){return String.fromCharCode(parseInt(t,16))}).replace(/&([^;\W]+;?)/g,function(e,t){var r=t.replace(/;$/,""),n=i[t]||t.match(/;$/)&&i[r];return"number"==typeof n?String.fromCharCode(n):"string"==typeof n?n:e}),new this.constructor(e)},endsWith:function(){for(var e=Array.prototype.slice.call(arguments,0),t=0;t<e.length;++t){var i=this.s.length-e[t].length;if(i>=0&&this.s.indexOf(e[t],i)===i)return!0}return!1},escapeHTML:function(){return new this.constructor(this.s.replace(/[&<>"']/g,function(e){return"&"+g[e]+";"}))},ensureLeft:function(e){var t=this.s;return 0===t.indexOf(e)?this:new this.constructor(e+t)},ensureRight:function(e){var t=this.s;return this.endsWith(e)?this:new this.constructor(t+e)},humanize:function(){if(null===this.s||void 0===this.s)return new this.constructor("");var e=this.underscore().replace(/_id$/,"").replace(/_/g," ").trim().capitalize();return new this.constructor(e)},isAlpha:function(){return!/[^a-z\xDF-\xFF]|^$/.test(this.s.toLowerCase())},isAlphaNumeric:function(){return!/[^0-9a-z\xDF-\xFF]/.test(this.s.toLowerCase())},isEmpty:function(){return null===this.s||void 0===this.s||/^[\s\xa0]*$/.test(this.s)},isLower:function(){return this.isAlpha()&&this.s.toLowerCase()===this.s},isNumeric:function(){return!/[^0-9]/.test(this.s)},isUpper:function(){return this.isAlpha()&&this.s.toUpperCase()===this.s},left:function(e){if(e>=0){var t=this.s.substr(0,e);return new this.constructor(t)}return this.right(-e)},lines:function(){return this.replaceAll("\r\n","\n").s.split("\n")},pad:function(e,t){if(null==t&&(t=" "),this.s.length>=e)return new this.constructor(this.s);e-=this.s.length;var i=Array(Math.ceil(e/2)+1).join(t),r=Array(Math.floor(e/2)+1).join(t);return new this.constructor(i+this.s+r)},padLeft:function(e,t){return null==t&&(t=" "),this.s.length>=e?new this.constructor(this.s):new this.constructor(Array(e-this.s.length+1).join(t)+this.s)},padRight:function(e,t){return null==t&&(t=" "),this.s.length>=e?new this.constructor(this.s):new this.constructor(this.s+Array(e-this.s.length+1).join(t))},parseCSV:function(e,t,i,r){e=e||",",i=i||"\\",void 0===t&&(t='"');var n=0,o=[],s=[],a=this.s.length,l=!1,u=!1,c=this,h=function(e){return c.s.charAt(e)};if(void 0!==r)var d=[];for(t||(l=!0);n<a;){var p=h(n);switch(p){case i:if(l&&(i!==t||h(n+1)===t)){n+=1,o.push(h(n));break}if(i!==t)break;case t:l=!l;break;case e:u&&(l=!1,u=!1),l&&t?o.push(p):(s.push(o.join("")),o.length=0);break;case r:u?(l=!1,u=!1,s.push(o.join("")),d.push(s),s=[],o.length=0):l?o.push(p):d&&(s.push(o.join("")),d.push(s),s=[],o.length=0);break;case" ":l&&o.push(p);break;default:l?o.push(p):p!==t&&(o.push(p),l=!0,u=!0)}n+=1}return s.push(o.join("")),d?(d.push(s),d):s},replaceAll:function(e,t){var i=this.s.split(e).join(t);return new this.constructor(i)},splitLeft:function(t,i,r){return e("./_splitLeft")(this.s,t,i,r)},splitRight:function(t,i,r){return e("./_splitRight")(this.s,t,i,r)},strip:function(){for(var e=this.s,t=0,i=arguments.length;t<i;t++)e=e.split(arguments[t]).join("");return new this.constructor(e)},stripLeft:function(e){var t,i,r=f(this.s);return void 0===e?i=/^\s+/g:(t=p(e),i=new RegExp("^["+t+"]+","g")),new this.constructor(r.replace(i,""))},stripRight:function(e){var t,i,r=f(this.s);return void 0===e?i=/\s+$/g:(t=p(e),i=new RegExp("["+t+"]+$","g")),new this.constructor(r.replace(i,""))},right:function(e){if(e>=0){var t=this.s.substr(this.s.length-e,e);return new this.constructor(t)}return this.left(-e)},setValue:function(e){return n(this,e),this},slugify:function(){var e=new o(new o(this.s).latinise().s.replace(/[^\w\s-]/g,"").toLowerCase()).dasherize().s;return"-"===e.charAt(0)&&(e=e.substr(1)),new this.constructor(e)},startsWith:function(){for(var e=Array.prototype.slice.call(arguments,0),t=0;t<e.length;++t)if(0===this.s.lastIndexOf(e[t],0))return!0;return!1},stripPunctuation:function(){return new this.constructor(this.s.replace(/[^\w\s]|_/g,"").replace(/\s+/g," "))},stripTags:function(){var e=this.s;return function(e,t){var i,r=[];for(i=0;i<e.length;i++)r.push(e[i]),t&&t.call(e,e[i],i)}(arguments.length>0?arguments:[""],function(t){e=e.replace(RegExp("</?"+t+"[^<>]*>","gi"),"")}),new this.constructor(e)},template:function(e,t,i){var r=this.s,n=(t=t||h.TMPL_OPEN,i=i||h.TMPL_CLOSE,t.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$")),o=i.replace(/[-[\]()*\s]/g,"\\$&").replace(/\$/g,"\\$"),s=new RegExp(n+"(.+?)"+o,"g");return(r.match(s)||[]).forEach(function(n){var o=n.substring(t.length,n.length-i.length).trim(),s=void 0===e[o]?"":e[o];r=r.replace(n,s)}),new this.constructor(r)},times:function(e){return new this.constructor(new Array(e+1).join(this.s))},titleCase:function(){var e=this.s;return e&&(e=e.replace(/(^[a-z]| [a-z]|-[a-z]|_[a-z])/g,function(e){return e.toUpperCase()})),new this.constructor(e)},toBoolean:function(){if("string"==typeof this.orig){var e=this.s.toLowerCase();return"true"===e||"yes"===e||"on"===e||"1"===e}return!0===this.orig||1===this.orig},toFloat:function(e){var t=parseFloat(this.s);return e?parseFloat(t.toFixed(e)):t},toInt:function(){return/^\s*-?0x/i.test(this.s)?parseInt(this.s,16):parseInt(this.s,10)},trim:function(){var e;return e=void 0===s.trim?this.s.replace(/(^\s*|\s*$)/g,""):this.s.trim(),new this.constructor(e)},trimLeft:function(){var e;return e=s.trimLeft?this.s.trimLeft():this.s.replace(/(^\s*)/g,""),new this.constructor(e)},trimRight:function(){var e;return e=s.trimRight?this.s.trimRight():this.s.replace(/\s+$/,""),new this.constructor(e)},truncate:function(e,t){var i=this.s;if(e=~~e,t=t||"...",i.length<=e)return new this.constructor(i);var r=i.slice(0,e+1).replace(/.(?=\W*\w*$)/g,function(e){return e.toUpperCase()!==e.toLowerCase()?"A":" "});return((r=r.slice(r.length-2).match(/\w\w/)?r.replace(/\s*\S+$/,""):new o(r.slice(0,r.length-1)).trimRight().s)+t).length>i.length?new o(i):new o(i.slice(0,r.length)+t)},toCSV:function(){var e=",",t='"',i="\\",r=!0,n=!1,s=[];if("object"==typeof arguments[0]?(e=arguments[0].delimiter||e,e=arguments[0].separator||e,t=arguments[0].qualifier||t,r=!!arguments[0].encloseNumbers,i=arguments[0].escape||i,n=!!arguments[0].keys):"string"==typeof arguments[0]&&(e=arguments[0]),"string"==typeof arguments[1]&&(t=arguments[1]),null===arguments[1]&&(t=null),this.orig instanceof Array)s=this.orig;else for(var a in this.orig)this.orig.hasOwnProperty(a)&&(n?s.push(a):s.push(this.orig[a]));for(var l,u=i+t,c=[],h=0;h<s.length;++h){var d=null!==(l=t)&&""!==l;if("number"==typeof s[h]&&(d&=r),d&&c.push(t),null!==s[h]&&void 0!==s[h]){var p=new o(s[h]).replaceAll(t,u).s;c.push(p)}else c.push("");d&&c.push(t),e&&c.push(e)}return c.length=c.length-1,new this.constructor(c.join(""))},toString:function(){return this.s},underscore:function(){var e=this.trim().s.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/([A-Z\d]+)([A-Z][a-z])/g,"$1_$2").replace(/[-\s]+/g,"_").toLowerCase();return new this.constructor(e)},unescapeHTML:function(){return new this.constructor(this.s.replace(/\&([^;]+);/g,function(e,t){var i;return t in d?d[t]:(i=t.match(/^#x([\da-fA-F]+)$/))?String.fromCharCode(parseInt(i[1],16)):(i=t.match(/^#(\d+)$/))?String.fromCharCode(~~i[1]):e}))},valueOf:function(){return this.s.valueOf()},wrapHTML:function(e,t){var i=this.s,r=null==e?"span":e,n="";if("object"==typeof t)for(var o in t)n+=" "+o+'="'+new this.constructor(t[o]).escapeHTML()+'"';return i="".concat("<",r,n,">",this,"</",r,">"),new this.constructor(i)}},l=[];var u=function(){for(var e=function(){var e=[];if(Object.getOwnPropertyNames)return(e=Object.getOwnPropertyNames(s)).splice(e.indexOf("valueOf"),1),e.splice(e.indexOf("toString"),1),e;var t={};for(var i in String.prototype)t[i]=i;for(var i in Object.prototype)delete t[i];for(var i in t)e.push(i);return e}(),t={},i=0;i<e.length;++i){var r=e[i];if("to"!==r&&"toEnd"!==r){var n=s[r];try{var o=typeof n.apply("teststring");t[r]=o}catch(e){}}}return t}();for(var c in u)!function(e){var t=s[e];"function"==typeof t&&(a[e]||("string"===u[e]?a[e]=function(){return new this.constructor(t.apply(this,arguments))}:a[e]=t))}(c);function h(e){return new o(e)}a.repeat=a.times,a.include=a.contains,a.toInteger=a.toInt,a.toBool=a.toBoolean,a.decodeHTMLEntities=a.decodeHtmlEntities,a.constructor=o,h.extendPrototype=function(){for(var e in a)!function(e){var t=a[e];s.hasOwnProperty(e)||(l.push(e),s[e]=function(){return String.prototype.s=this,t.apply(this,arguments)})}(e)},h.restorePrototype=function(){for(var e=0;e<l.length;++e)delete String.prototype[l[e]];l.length=0},h.VERSION="3.3.3",h.TMPL_OPEN="{{",h.TMPL_CLOSE="}}",h.ENTITIES=i,void 0!==t&&void 0!==t.exports?t.exports=h:window.S=h;var d={lt:"<",gt:">",quot:'"',apos:"'",amp:"&"};function p(e){var t,i,r=[],n=/^[A-Za-z0-9]+$/;for(e=f(e),i=0;i<e.length;++i)t=e.charAt(i),n.test(t)?r.push(t):"\\000"===t?r.push("\\000"):r.push("\\"+t);return r.join("")}function f(e){return null==e?"":""+e}var g={};for(var m in d)g[d[m]]=m;i={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,"OElig;":338,"oelig;":339,"Scaron;":352,"scaron;":353,"Yuml;":376,"fnof;":402,"circ;":710,"tilde;":732,"Alpha;":913,"Beta;":914,"Gamma;":915,"Delta;":916,"Epsilon;":917,"Zeta;":918,"Eta;":919,"Theta;":920,"Iota;":921,"Kappa;":922,"Lambda;":923,"Mu;":924,"Nu;":925,"Xi;":926,"Omicron;":927,"Pi;":928,"Rho;":929,"Sigma;":931,"Tau;":932,"Upsilon;":933,"Phi;":934,"Chi;":935,"Psi;":936,"Omega;":937,"alpha;":945,"beta;":946,"gamma;":947,"delta;":948,"epsilon;":949,"zeta;":950,"eta;":951,"theta;":952,"iota;":953,"kappa;":954,"lambda;":955,"mu;":956,"nu;":957,"xi;":958,"omicron;":959,"pi;":960,"rho;":961,"sigmaf;":962,"sigma;":963,"tau;":964,"upsilon;":965,"phi;":966,"chi;":967,"psi;":968,"omega;":969,"thetasym;":977,"upsih;":978,"piv;":982,"ensp;":8194,"emsp;":8195,"thinsp;":8201,"zwnj;":8204,"zwj;":8205,"lrm;":8206,"rlm;":8207,"ndash;":8211,"mdash;":8212,"lsquo;":8216,"rsquo;":8217,"sbquo;":8218,"ldquo;":8220,"rdquo;":8221,"bdquo;":8222,"dagger;":8224,"Dagger;":8225,"bull;":8226,"hellip;":8230,"permil;":8240,"prime;":8242,"Prime;":8243,"lsaquo;":8249,"rsaquo;":8250,"oline;":8254,"frasl;":8260,"euro;":8364,"image;":8465,"weierp;":8472,"real;":8476,"trade;":8482,"alefsym;":8501,"larr;":8592,"uarr;":8593,"rarr;":8594,"darr;":8595,"harr;":8596,"crarr;":8629,"lArr;":8656,"uArr;":8657,"rArr;":8658,"dArr;":8659,"hArr;":8660,"forall;":8704,"part;":8706,"exist;":8707,"empty;":8709,"nabla;":8711,"isin;":8712,"notin;":8713,"ni;":8715,"prod;":8719,"sum;":8721,"minus;":8722,"lowast;":8727,"radic;":8730,"prop;":8733,"infin;":8734,"ang;":8736,"and;":8743,"or;":8744,"cap;":8745,"cup;":8746,"int;":8747,"there4;":8756,"sim;":8764,"cong;":8773,"asymp;":8776,"ne;":8800,"equiv;":8801,"le;":8804,"ge;":8805,"sub;":8834,"sup;":8835,"nsub;":8836,"sube;":8838,"supe;":8839,"oplus;":8853,"otimes;":8855,"perp;":8869,"sdot;":8901,"lceil;":8968,"rceil;":8969,"lfloor;":8970,"rfloor;":8971,"lang;":9001,"rang;":9002,"loz;":9674,"spades;":9824,"clubs;":9827,"hearts;":9829,"diams;":9830}}).call(this)},{"./_count":1,"./_splitLeft":2,"./_splitRight":3}]},{},[4])(4)}),r("gui/NameResolverView",["jquery","underscore-min","../utils/UtilsCore","text!templates/nameResolverResult.html","jquery.ui","jquery.once","string"],function(e,t,i,r){var n,o,s,a,l,u,c,h,d=t.template(r),p=300;function f(){var t=o.attr("value");o.val()===t&&o.val(""),e(this).animate({color:"#000"},p).parent().animate({backgroundColor:"#fff"},p,function(){""!==o.val()&&o.val()!==t&&s.fadeIn(p)}).addClass("focus")}function g(t){var i=o.attr("value");e(this).animate({color:"#b4bdc4"},p,function(){""===o.val()&&o.val(i)}).parent().animate({backgroundColor:"#e8edf1"},p).removeClass("focus")}function m(){""===o.val()?s.fadeOut(p):s.fadeIn(p)}function v(e){if(e){l=e;for(var t="",i=!1,r=!0,o=!0,c=0;c<l.features.length;c++)if("layer"==l.features[c].properties.type)i=!0,t+=d({first:r,properties:l.features[c].properties,lon:0,lat:0,type:u.getCrs().getType(),index:c}),r=!1;else{var h=u.getCrs().formatCoordinates([l.features[c].geometry.coordinates[0],l.features[c].geometry.coordinates[1]]);t+=d({first:o,properties:l.features[c].properties,lon:h[0],lat:h[1],type:u.getCrs().getType(),index:c}),o=!1}a.html(t).fadeIn(p),i||a.find("div:nth-child(2)").addClass("selected")}n.find("#searchSpinner").fadeOut(p),s.fadeIn(p)}function y(){a.html("<div class='errorNameResolver'>Bad input or object not found</div>").fadeIn(0),n.find("#searchSpinner").fadeOut(p).end(),s.fadeIn(p)}function b(){a.html("<div class='errorNameResolver'>Bad input parameters (coordinates out of extent)</div>").fadeIn(0),n.find("#searchSpinner").fadeOut(p).end(),s.fadeIn(p)}function x(e){e.preventDefault(),o.blur();var t=o.val();t!=o.attr("value")&&""!=t?(n.find("#searchSpinner").fadeIn(p).end().find("#searchClear").fadeOut(p),a.fadeOut(p),c.goTo(t,v,y,b)):a.html("Enter object name").fadeIn(p)}function w(t){e("#resolverSearchResult").find(".selected").removeClass("selected"),e(this).addClass("selected");var i=e(this).attr("mizar_feature_index"),r=l.features[i];c.zoomTo(r.geometry.coordinates[0],r.geometry.coordinates[1],null,r.geometry.crs.properties.name)}function T(){e("#resolverSearchResult").fadeOut(p)}function _(){var t=o.attr("value");o.val()!==t&&o.val(t),s.fadeOut(p),e("#searchInput").animate({color:"#b4bdc4"},p).parent().animate({backgroundColor:"#e8edf1"},p).removeClass("focus")}function C(t){var i=e("#navigationDiv"),r=i.scrollTop(),n=t.originalEvent.deltaY;i.scrollTop(r+n)}function S(t){var i=e(this).parent();if(!i.hasClass("selected")){e("#resolverSearchResult").find(".selected").removeClass("selected"),e("#resolverSearchResult").find("button").removeAttr("style"),i.addClass("selected");var r=e(i).attr("mizar_feature_index"),n=l.features[r].properties.name,o=u.getLayerByName(n),s=(o.isVisible(),e(i).find(".show_or_hide"));A(o,s),s.button().once().click(function(e){E(o),A(o,s)})}}function E(t){if("background"==t.category)e("#backgroundLayersSelect").val(t.name).iconselectmenu("refresh");else{var i=t.isVisible();t.setVisible(!i)}}function A(t,i){var r=t.isVisible();"background"==t.category?r?i.hide():(i.show(),e("span",i).text("Show")):e("span",i).text(r?"Hide":"Show")}return{init:function(t){c=(u=t).getServiceByName(u.SERVICE.NameResolver),h=this,n?console.error("Name resolver view is already initialized"):(u.subscribeMizar(u.EVENT_MSG.MIZAR_MODE_TOGGLE,this.onModeToggle),n=e('<form id="searchForm">\t\t\t\t<fieldset>\t\t\t\t\t<div class="searchInputDiv">\t\t\t\t\t\t<input title="Enter an object name (e.g. m31) or coordinate (e.g 23h45m30.5s -45&#186;30\'30&rdquo;)" type="text" name="searchInput" id="searchInput" value="Object name or coordinates" />\t\t\t\t\t</div>\t\t\t\t\t<input type="submit" id="searchSubmit" value="" />\t\t\t\t\t<div style="display: none" id="searchSpinner"></div>\t\t\t\t\t<input type="button" id="searchClear" value="" style="display: none;"/>\t\t\t\t</fieldset>\t\t\t</form>\t\t\t<div style="display: none" id="resolverSearchResult"></div>').appendTo("#searchDiv"),o=n.find("#searchInput"),s=n.find("#searchClear"),a=n.siblings("#resolverSearchResult"),o.on("focus",f).on("blur",g).keyup(m),e("#searchDiv").find("#searchForm").submit(x),e("canvas").on("click",T),e("#navigationDiv").on("mousewheel","",C),e("#searchDiv").find("#resolverSearchResult").on("click",".nameResolverResult.coordinatesResolverResult",w),e("#searchDiv").find("#resolverSearchResult").on("click",".layerResolverResult .nameResolverResult",S),n.find("#searchClear").on("click",_))},remove:function(){n&&(o.off("focus",f).off("blur",g).unbind("keyup",m),e("canvas").off("click",T),a.off("click",".nameResolverResult.coordinatesResolverResult",w),a.off("click",".nameResolverResult.layerResolverResult",S),n.find("#searchClear").off("click",_),n.remove(),n=null,u.unsubscribeMizar(u.EVENT_MSG.MIZAR_MODE_TOGGLE,this.onModeToggle),u=null)},onModeToggle:function(e){n.show(),h.setContext(e)},setContext:function(e){c.setContext(e),_(),a.css("display","none")},toggleButtonVisibility:A,toggleLayer:E,isInitialized:function(){return!!u}}}),r("gui/ReverseNameResolverView",["jquery","underscore-min","../utils/UtilsCore","./IFrame","./dialog/ErrorDialog","text!templates/featureDescription.html","text!templates/descriptionTable.html","jquery.ui"],function(e,t,i,r,n,o,s){var a,l,u,c,h,d,p=[],f=!1,g=t.template(o),m=t.template(s);function v(e){u=new Date,e.type.search("touch")>=0&&(e.clientX=e.changedTouches[0].clientX,e.clientY=e.changedTouches[0].clientY),c=e.clientX,h=e.clientY}function y(t){var i=new Date-u;t.type.search("touch")>=0&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),i>500&&Math.abs(c-t.clientX)<5&&Math.abs(h-t.clientY)<5&&(p=a.getContext().getLonLatFromPixel(t.clientX,t.clientY),function(t){var i=window.innerHeight-t.clientY-30;e("#reverseSearchField").css("max-height",i),e("#reverseSearchResult").css("max-height",i),e("#reverseSearchResult").css("display","none");var r=a.getCrs().formatCoordinates([p[0],p[1]]);a.getCrs().getGeoideName()===a.CRS.Equatorial?e("#coordinatesInfo").html("<em>Right ascension:</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+r[0]+"<br/><em>Declination :</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+r[1]):a.getCrs().getGeoideName()==a.CRS.Galactic?e("#coordinatesInfo").html("<em>Longitude:</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+r[0]+"<br/><em>Latitude:</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+r[1]):e("#coordinatesInfo").html("<em>Longitude:</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+p[0]+"<br/><em>Latitude:</em><br/>&nbsp;&nbsp;&nbsp;&nbsp;"+p[1]);if(a.options.gui.debug&&a.getTileManager().tiling.findInsideTile){var n=a.getTileManager().getVisibleTile(p[0],p[1]);e("#reverseSearchField #healpixInfo").html("<em>Healpix index/order: </em>&nbsp;&nbsp;&nbsp;&nbsp;"+n.pixelIndex+"/"+n.order)}e("#reverseSearchField").css("display","block"),d.css({position:"absolute",left:t.clientX+"px",top:t.clientY+"px"}).fadeIn(100)}(t))}function b(t){var i=t.features[0],r=g({dictionary:{},services:i.services,properties:i.properties,descriptionTableTemplate:m});r='<div class="title">'+(i.properties.title?i.properties.title:i.properties.identifier)+'</div><div class="credit">Found in CDS database</div>'+r,e("#reverseSearchResult").html(r).find("#sendViewport").button(),e("#reverseSearchField").fadeOut(300,function(){e("#reverseSearchResult").fadeIn(300)}),e('#reverseSearchField input[type="submit"]').removeAttr("disabled")}function x(t){if(t)switch(t.status){case 503:n.open("Please wait at least 6 seconds between each request to reverse name resolver");break;case 500:n.open("Internal server error");break;case 404:n.open("Object not found");break;case 400:n.open("Bad input")}e('#reverseSearchField input[type="submit"]').removeAttr("disabled")}function w(e){e.preventDefault(),r.show(e.target.innerHTML)}function T(e){d&&d.hasOwnProperty("css")&&"none"!=d.css("display")&&d.fadeOut(300)}return{init:function(t){l=this,d?console.error("Reverse name resolver is already initialized"):(f=(a=t).getMizarWidgetGui().isMobile,(d=e('<div id="reverseNameResolver" class="contentBox ui-widget-content" style="display: none;">                <div id="reverseSearchField">                    <input type="submit" value="Find Object Name" />                    <div id="coordinatesInfo"></div>                    <div id="healpixInfo"></div>                </div>                <div id="reverseSearchResult"></div>                <div class="closeBtn">                    <span class="defaultImg"></span>                    <span style="opacity: 0" class="hoverImg"></span>                </div>            </div>').appendTo("body")).find("input[type=submit]").button().click(function(t){t.preventDefault(),e('#reverseSearchField input[type="submit"]').attr("disabled","disabled"),a.getServiceByName(a.SERVICE.ReverseNameResolver).sendRequest(p,{success:b,error:x})}),d.on("click",".propertiesTable a",w),a.subscribeMizar(a.EVENT_MSG.MIZAR_MODE_TOGGLE,l.updateContext),this.updateContext())},updateContext:function(){a.getContext().getContextConfiguration().reverseNameResolver&&a.getContext().getContextConfiguration().reverseNameResolver.baseUrl?(a.getContext()&&l.deactivate(),l.activate(),a.getServiceByName(a.SERVICE.ReverseNameResolver).setContext(a.getContext())):l.deactivate()},activate:function(){a.getRenderContext().canvas.addEventListener("mousedown",v),a.getRenderContext().canvas.addEventListener("mouseup",y),f&&(a.getRenderContext().canvas.addEventListener("touchstart",v),a.getRenderContext().canvas.addEventListener("touchend",y)),a.subscribeCtx(a.EVENT_MSG.NAVIGATION_MODIFIED,T)},deactivate:function(){a.getRenderContext().canvas.removeEventListener("mousedown",v),a.getRenderContext().canvas.removeEventListener("mouseup",y),f&&(a.getRenderContext().canvas.removeEventListener("touchstart",v),a.getRenderContext().canvas.removeEventListener("touchend",y)),a.unsubscribeCtx(a.EVENT_MSG.NAVIGATION_MODIFIED,T)},unregisterEvents:function(){this.deactivate(),d.off("click",".propertiesTable a",w),a.unsubscribeMizar(a.EVENT_MSG.MIZAR_MODE_TOGGLE,l.updateContext)},remove:function(){d&&(this.unregisterEvents(),d.remove(),d=null,a=null)},isInitialized:function(){return!!a}}}),r("gui/MollweideViewer",["jquery"],function(e){return function(t){this.mizarBaseUrl=t.mizarBaseUrl;var i=t.mizar,r=i.getServiceByName(i.SERVICE.MollweideViewer),n=e.extend({},t);n.mizar=i.getMizarAPI(),r.init(n);var o=!1,s=document.getElementById("mollweideCanvas");function a(e){return[e.offsetX?e.offsetX:e.layerX-e.target.offsetLeft,e.offsetY?e.offsetY:e.layerY-e.target.offsetTop]}i.subscribeCtx(i.EVENT_MSG.CRS_MODIFIED,r.updateGalaxyProjection),r.updateGalaxyProjection(i.getContext()),s.addEventListener("mousedown",function(e){var t=a(e);return r.updateNavigation(t),o=!0,!0}),s.addEventListener("mousemove",function(e){if(o){var t=a(e);r.updateNavigation(t)}}),s.addEventListener("mouseup",function(){o=!1}),e("#slideArrow").click(function(){parseFloat(e(this).parent().css("left"))<0?(e("#mollweideContent").css({boxShadow:"0px 0px 8px 1px rgba(255, 158, 82, 0.92)"}),e(this).css("background-position","0px 0px"),e(this).parent().animate({left:"0px"},300),i.subscribeCtx(i.EVENT_MSG.NAVIGATION_MODIFIED,r.updateMollweideFov),r.updateMollweideFov(r.getImageObj())):(e("#mollweideContent").css({boxShadow:"none"}),e(this).css("background-position","0px -20px"),e(this).parent().animate({left:"-266px"},300),i.unsubscribeCtx(i.EVENT_MSG.NAVIGATION_MODIFIED,r.updateMollweideFov))}),s.addEventListener("dragstart",function(e){return e.preventDefault(),!1})}}),r("gui/SimpleProgressBar",["jquery"],function(e){var t=function(t){var i=t.id;this.percentOutput=!!t.hasOwnProperty("percentOutput")&&t.percentOutput,this.$element=e('<div style="display: none;" class="progress"><div></div></div>').appendTo("#"+i).fadeIn()};return t.prototype.onprogress=function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100),i=t*this.$element.width()/100;this.$element.find("div").css("width",i),this.percentOut&&this.$element.find("div").html(t+"%&nbsp;"),t>=99&&this.$element.delay(1e3).fadeOut("slow")}else this.$element.fadeOut()},t}),r("text!templates/imageViewer.html",[],function(){return'<div id="imageViewerContent">\n    <span id="imageViewInvoker"></span>\n\n    <div id="loadedImages">\n        <h3>Images</h3>\n\n        <div>\n            <p style="color: white; text-align: center;">No image was loaded</p>\n\n            <div class="imageLayers">\n            </div>\n        </div>\n    </div>\n</div>'}),r("text!templates/imageViewerLayerItem.html",[],function(){return'<div class="layer" id="imageLayer_<%= id %>" style="display: none;">\n    <input class="layerVisibility" id="layerVisibility_<%= id %>" type="checkbox" checked/>\n    <label for="layerVisibility_<%= id %>"></label>\n    <label class="layerName" title=<%= name %>><%= name %></label>\n    <ul>\n    </ul>\n</div>'}),r("text!templates/imageViewerImageItem.html",[],function(){return'<li class="image" id="imageView_<%= id %>" style="display: none;">\n    <input type="checkbox" name="imageView" id="<%= id %>" checked/>\n    <label style="width: 15px; height: 15px;" for="<%= id %>"></label>\n    <label class="imageName" title="<%= name %>"><%= name %></label>\n\n    <div style="display: none;" class="options">\n        <button class="zoomTo">Zoom to..</button>\n        <button class="<% if (!isFits) print(\'fitsUnavailable\') %> imageProcessing" id="imageProcessing_<%= id %>">Image\n            processing\n        </button>\n        <button class="sampExport">Send image by SAMP</button>\n        <button class="metadata">Show metadata</button>\n        <button class="delete">Delete</button>\n    </div>\n</li>'}),r("gui/ImageViewer",["require","jquery","underscore-min","../utils/UtilsCore","./PickingManager","./ImageManager","./ImageProcessing","./SimpleProgressBar","service/Samp","./dialog/ErrorDialog","text!templates/imageViewer.html","text!templates/imageViewerLayerItem.html","text!templates/imageViewerImageItem.html","jquery.ui"],function(e,t,i,r,n,o,s,a,l,u,c,h,d){var p,f,g,m=[],v=[],y=i.template(h),b=i.template(d);function x(e){g.find('.imageLayers div[id="imageLayer_'+e.id+'"]').find("#layerVisibility_"+e.id).button("option",{icons:{primary:e.isVisible()?"ui-icon-check":""}}).button("refresh"),e.isVisible()?function(e){g.find('.imageLayers div[id="imageLayer_'+e.id+'"] ul').find("button, input").each(function(){t(this).hasClass("fitsUnavailable")||t(this).removeAttr("disabled").button("refresh")})}(e):function(e){g.find('.imageLayers div[id="imageLayer_'+e.id+'"] ul').find("button, input").each(function(){t(this).attr("disabled","disabled").button("refresh")})}(e)}function w(){g.find("#loadedImages").css({boxShadow:"0px 0px 8px 1px rgba(255, 158, 82, 0.92)"}),g.find("#imageViewInvoker").css("background-position","0px -20px").parent().animate({right:"0px"},300)}return{init:function(e){(p=e).subscribeCtx(p.EVENT_MSG.IMAGE_ADDED,this.addView),p.subscribeCtx(p.EVENT_MSG.IMAGE_REMOVED,this.removeView),p.subscribeCtx(p.EVENT_MSG.IMAGE_DOWNLOADED,this.addProgressBar),p.subscribeCtx(p.EVENT_MSG.LAYER_REMOVED,this.removeLayer),f=p.getNavigation(),(g=t(c).appendTo("#imageViewerDiv")).find("#imageViewInvoker").click(function(){parseFloat(t(this).parent().css("right"))<0?w():(g.find("#loadedImages").css({boxShadow:"none"}),g.find("#imageViewInvoker").css("background-position","0px 0px").parent().animate({right:"-254px"},300))}),g.find("#loadedImages").accordion({heightStyle:"content",active:0,collapsible:!0}).show()},remove:function(){for(var e=0;e<layer.length;e++)layer.unsubscribeCtx(p.EVENT_MSG.LAYER_VISIBILITY_CHANGED,x);p.unsubscribeCtx(p.EVENT_MSG.IMAGE_ADDED,this.addView),p.unsubscribeCtx(p.EVENT_MSG.IMAGE_REMOVED,this.removeView),p.unsubscribeCtx(p.EVENT_MSG.IMAGE_DOWNLOADED,this.addProgressBar),p.unsubscribeCtx(p.EVENT_MSG.LAYER_REMOVED,this.removeLayer),g.remove(),f=null},addProgressBar:function(e){var t="imageView_"+r.formatId(e.feature.properties.identifier)+"_fits",i=new a({id:t});e.xhr.onprogress=i.onprogress.bind(i)},addView:function(i){var a;console.log("addView",i),w();var c=i.layer;a=m.indexOf(i.layer)<0?function(e){var i=y({id:e.id,name:e.name}),r=t(i).appendTo(g.find(".imageLayers"));r.find("label.layerName").click(function(){t("#imageLayer_"+e.id+" > ul").slideToggle()});var n=r.find("#layerVisibility_"+e.id);return n.button({text:!1,icons:{primary:"ui-icon-check"}}).click(function(){var t=!("ui-icon-check"===n.button("option","icons").primary);e.setVisible(t)}),0===m.length?g.find("#loadedImages p").fadeOut(function(){r.fadeIn()}):r.fadeIn(),m.push(e),p.subscribeCtx(p.EVENT_MSG.LAYER_VISIBILITY_CHANGED,x),r}(i.layer):g.find('.imageLayers div[id="imageLayer_'+c.id+'"]');var h=i.feature,d=r.formatId(i.feature.properties.identifier);i.isFits&&(d+="_fits");var T,_,C=i.feature.properties.identifier;if(0===a.find('ul li[id="'+d+'"]').length){var S=b({id:d,name:C,isFits:i.isFits});return(T=t(S).appendTo(a.find("ul")).find(".zoomTo").button({text:!1,icons:{primary:"ui-icon-zoomin"}}).click(function(){var e=r.computeGeometryBarycenter(h.geometry);f.zoomTo([e[0],e[1]],.1,2e3,function(){n.focusFeature(i,{isExclusive:!0})})}).end().find("input").button({text:!1,icons:{primary:"ui-icon-check"}}).click(function(){t(this).button("option",{icons:{primary:t(this)[0].checked?"ui-icon-check":""}}),t(this).is(":checked")?o.showImage(i):o.hideImage(i),p.getRenderContext().requestFrame()}).end().find(".delete").button({text:!1,icons:{primary:"ui-icon-trash"}}).click(function(){o.removeImage(i,i.isFits),i.isFits&&s.removeData(i),p.getRenderContext().requestFrame()}).end().find(".imageProcessing").button({text:!1,icons:{primary:"ui-icon-image"}}).click(function(){s.setData(i)}).end().find(".metadata").button({text:!1,icons:{primary:"ui-icon-info"}}).click(function(){if(_)_.dialog("isOpen")&&_.dialog("close");else{var r=e("FeaturePopup").generateFeatureMetadata(i.layer,i.feature);(_=t("<div>"+r+"</div>").dialog({autoOpen:!0,show:{effect:"fade",duration:300},hide:{effect:"fade",duration:300},title:"Metadata",width:350,resizable:!1,zIndex:12,stack:!1,close:function(){t(this).find(".featureProperties").getNiceScroll().remove(),t(this).dialog("destroy").remove(),_=null},drag:function(){t(this).find(".featureProperties").getNiceScroll().resize()}})).find(".featureProperties").niceScroll({autohidemode:!1})}}).end().find(".sampExport").button({text:!1,icons:{primary:"ui-icon-extlink"}}).click(function(){l.isConnected()?l.sendImage(h.services.download.url):u.open("You must be connected to SAMP Hub")}).end().fadeIn()).find("label.imageName").click(function(){t(this).siblings(".options").slideToggle()}),i.isFits||T.find(".imageProcessing").button("disable"),v.push(i),T}},removeView:function(e){var i="imageView_"+r.formatId(e.feature.properties.identifier);e.isFits&&(i+="_fits"),g.find("#loadedImages").find('li.image[id="'+i+'"]').fadeOut(function(){if(0===t(this).siblings().length){g.find('.imageLayers div[id="imageLayer_'+e.layer.id+'"]').fadeOut(300,function(){t(this).remove(),0===m.length&&g.find("#loadedImages p").fadeIn()});var i=m.indexOf(e.layer);m.splice(i,1)}t(this).remove()});var n=v.indexOf(e);v.splice(n,1),e.layer.unsubscribeCtx(p.EVENT_MSG.LAYER_VISIBILITY_CHANGED,x)},removeLayer:function(e){g.find('.imageLayers div[id="imageLayer_'+e.id+'"]').find("ul li").each(function(){t(this).find(".delete").trigger("click")})},getFeatures:function(){return v},isInitialized:function(){return!!p}}}),r("gui/MeasureToolSky",["jquery","underscore-min","jquery.ui"],function(e,t){var i,r,n=function(t){if(i=t.mizar,t.mode===i.CONTEXT.Sky){var n=e.extend({},t);n.mizar=i.getMizarAPI(),i.getServiceByName(i.SERVICE.MeasureToolSky).init(n),i.subscribeMizar(i.EVENT_MSG.MIZAR_MODE_TOGGLE,function(){i.getServiceByName(i.SERVICE.MeasureToolSky).activated&&r.toggle()}),i.subscribeCtx(i.EVENT_MSG.CRS_MODIFIED,function(){i.getServiceByName(i.SERVICE.MeasureToolSky).activated&&r.toggle()}),this.renderContext=i.getRenderContext(),(r=this).renderContext.canvas.addEventListener("mousedown",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseDown,this)),r.renderContext.canvas.addEventListener("mouseup",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseUp,this)),r.renderContext.canvas.addEventListener("mousemove",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseMove,this)),t.isMobile&&(r.renderContext.canvas.addEventListener("touchend",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseUp,this)),r.renderContext.canvas.addEventListener("touchmove",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseMove,this)),r.renderContext.canvas.addEventListener("touchstart",e.proxy(i.getServiceByName(i.SERVICE.MeasureToolSky)._handleMouseDown,this))),e("#measureSkyInvoker").on("click",function(){r.toggle()}).hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)})}};return n.prototype.toggle=function(){i.getServiceByName(i.SERVICE.MeasureToolSky).activated=!i.getServiceByName(i.SERVICE.MeasureToolSky).activated,i.getServiceByName(i.SERVICE.MeasureToolSky).activated?e(r.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)"):(e(r.renderContext.canvas).css("cursor","default"),i.getServiceByName(i.SERVICE.MeasureToolSky).clear()),e("#measureSkyInvoker").toggleClass("selected")},n.prototype.remove=function(){i.getServiceByName(i.SERVICE.MeasureToolSky).remove(),i.unsubscribeMizar(i.EVENT_MSG.MIZAR_MODE_TOGGLE,function(){i.getServiceByName(i.SERVICE.MeasureToolSky).activated&&r.toggle()}),i.unsubscribeCtx(i.EVENT_MSG.CRS_MODIFIED,function(){i.getServiceByName(i.SERVICE.MeasureToolSky).activated&&r.toggle()})},n}),r("gui/MeasureToolPlanet",["jquery","jquery.ui"],function(e){var t,i,r=function(r){if(t=r.mizar,r.mode===t.CONTEXT.Planet){var n=e.extend({},r);n.mizar=t.getMizarAPI(),t.getServiceByName(t.SERVICE.MeasureToolPlanet).init(n),this.renderContext=t.getRenderContext(),i=this,t.subscribeCtx(t.EVENT_MSG.CRS_MODIFIED,function(){t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated&&i.toggle()}),t.subscribeMizar(t.EVENT_MSG.MIZAR_MODE_TOGGLE,function(){t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated&&i.toggle()});var o=function(r){if(t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated){t.getServiceByName(t.SERVICE.MeasureToolPlanet)._handleMouseUp(r);var n=t.getMizarAPI().getBaseElevation();null!=n&&n.isRequested()&&e.proxy(i.displayButtonElevation(r),i)}};e("a#elevationTrackingBtn").text("Calculate elevation"),e("#elevationTrackingBtn").button().click(e.proxy(i.displayPopupElevation,this)),i.renderContext.canvas.addEventListener("contextmenu",function(){return!1}),i.renderContext.canvas.addEventListener("mousedown",e.proxy(t.getServiceByName(t.SERVICE.MeasureToolPlanet)._handleMouseDown,this)),i.renderContext.canvas.addEventListener("mouseup",e.proxy(o,this)),i.renderContext.canvas.addEventListener("mousemove",e.proxy(t.getServiceByName(t.SERVICE.MeasureToolPlanet)._handleMouseMove,this)),r.isMobile&&(i.renderContext.canvas.addEventListener("touchend",e.proxy(o,this)),i.renderContext.canvas.addEventListener("touchmove",e.proxy(t.getServiceByName(t.SERVICE.MeasureToolPlanet)._handleMouseMove,this)),i.renderContext.canvas.addEventListener("touchstart",e.proxy(t.getServiceByName(t.SERVICE.MeasureToolPlanet)._handleMouseDown,this))),e("#measurePlanetInvoker").on("click",function(){i.toggle()}).hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)})}};return r.prototype.updateContext=function(e){t.getServiceByName(t.SERVICE.MeasureToolPlanet).updateContext(e.getMizarAPI())},r.prototype.toggle=function(){if(t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated=!t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated,t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated)e(i.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)");else{e(i.renderContext.canvas).css("cursor","default"),e("#elevationTrackingBtn").hide();try{e("#popupElevation").dialog("close")}catch(e){}t.getServiceByName(t.SERVICE.MeasureToolPlanet).clear()}e("#measurePlanetInvoker").toggleClass("selected")},r.prototype.remove=function(){t.getServiceByName(t.SERVICE.MeasureToolPlanet).remove(),t.unsubscribeCtx(t.EVENT_MSG.CRS_MODIFIED,function(){t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated&&i.toggle()}),t.unsubscribeMizar(t.EVENT_MSG.MIZAR_MODE_TOGGLE,function(){t.getServiceByName(t.SERVICE.MeasureToolPlanet).activated&&i.toggle()})},r.prototype.displayButtonElevation=function(t){e("#elevationTrackingBtn").button().show().position({my:"left+3 bottom-3",of:t,collision:"fit"})},r.prototype.displayPopupElevation=function(i){var r=t.getServiceByName(t.SERVICE.MeasureToolPlanet).calculateIntermediateElevationPoint({},t.getServiceByName(t.SERVICE.MeasureToolPlanet).geoPickPoint,t.getServiceByName(t.SERVICE.MeasureToolPlanet).secondGeoPickPoint);t.getServiceByName(t.SERVICE.MeasureToolPlanet).storeDistanceAndElevation(r[0],r[0]);for(var n=0;n<r.length;n++)t.getServiceByName(t.SERVICE.MeasureToolPlanet).storeDistanceAndElevation(r[0],r[n]);e("#popupElevation").dialog({width:500,height:400,position:{my:"right top",at:"right top",of:window}}),e.plot("#popupElevation",[{data:t.getServiceByName(t.SERVICE.MeasureToolPlanet).elevations,label:"elevation (m)"}],{series:{color:"#F68D12",lines:{show:!0},points:{show:!0}},grid:{hoverable:!0},tooltip:{show:!0,content:"Distance: %x | Elevation: %y",cssClass:"flotTip",shifts:{x:-25,y:-60}},xaxis:{axisLabel:"Distance (km)",axisLabelUseCanvas:!1,axisLabelFontSizePixels:20},yaxis:{axisLabel:"Elevation (m)",axisLabelUseCanvas:!1,axisLabelFontSizePixels:20},zoom:{interactive:!0},pan:{interactive:!0}})},r}),r("gui/DistanceNavigationView",["jquery"],function(e){var t=null,i=null,r=function(e){var t,i;return e>=1e4?(t=(t=e/1e3).toFixed(1),i="Km"):(t=(t=e).toFixed(0),i="m"),t+" "+i},n=function(e){var t;t=e?r(e):"waiting ...",document.getElementById(i).innerHTML=t};return{init:function(o,s,a){a,i=s,t=o,e('<input type="submit" id="distanceButtom" value="" /><div id="distTracker"></div>').appendTo("#distanceDiv");var l=t.getContext(),u=l.getNavigation().getDistance();document.getElementById(i).innerHTML=r(u),l.subscribe(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,n)},isInitialized:function(){return!!t},update:function(e){this.unregisterEvents(),(t=e).getContext().subscribe(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,n)},unregisterEvents:function(){t&&t.getContext().unsubscribe(t.EVENT_MSG.NAVIGATION_CHANGED_DISTANCE,n)},remove:function(){this.unregisterEvents(),i=null,null,t=null}}}),r("gui/SwitchTo2D",["jquery","jquery.ui"],function(e){var t=function(t){this.mizarWidgetAPI=t.mizar;var i=this;e("#switch2DButton").on("click",function(){i.toggle2DSwitch()}).hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)})};return t.prototype.toggle2DSwitch=function(){this.mizarWidgetAPI.toggleDimension(),e("#switch2DButton").toggleClass("selected")},t}),r("gui/ExportTool",["jquery","underscore-min","./PickingManager"],function(e,t,i){var r,n,o,s,a,l,u=t.template('<div class="addLayer_<%=layerName%>" style="padding:2px;" name="<%=layerName%>"><input id="<%=layer.layerId%>" type="checkbox" class="ui-checkbox"/> <label title="<%=layerDescription%>" ><%=layer.name%></label></div>'),c=function(t){a=t.mizar,n=a.getNavigation(),r=this,(l=a.getServiceByName(a.SERVICE.ExportTool)).init(a.getMizarAPI(),t),this.activated=!1,this.renderContext=a.getRenderContext(),this.coordinateSystem=a.getCrs(),e("#exportInvoker").on("click",function(){r.toggle()}).hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)})};return c.prototype.toggle=function(){this.activated=!this.activated,this.activated?this.activate():this.deactivate(),e("#exportInvoker").toggleClass("selected")},c.prototype.activate=function(){e(this.renderContext.canvas).css("cursor","url(css/images/selectionCursor.png)"),e("#GlobWebCanvas").css("cursor","crosshair"),a.getContext().hideComponents(["exportContainer"]),e("#rightTopPopup").append('<p class="zoneToExport">Draw a zone to export</p>'),e("#rightTopPopup").dialog({draggable:!1,resizable:!1,width:280,maxHeight:400,dialogClass:"popupService noTitlePopup",position:{my:"right top",at:"right top",of:window}}),i.deactivate(),n.stop(),o=a.getServiceByName(a.SERVICE.SelectionTool,{ctx:a.getContext(),activated:!0,onselect:function(t){e(".cutOutService").slideDown(),s=l.filterServicesAvailableOnLayers(),r.displayAvailableServices(),r.coordinates=t,e(r.renderContext.canvas).css("cursor","default"),e("#GlobWebCanvas").css("cursor","default"),e("#exportToolBtn").on("click",r.coordinates,l.exportSelection),i.activate(),n.start(),o.toggle()}})},c.prototype.deactivate=function(){e(this.renderContext.canvas).css("cursor","default"),e("#GlobWebCanvas").css("cursor","default"),a.getContext().showComponents(),e("#rightTopPopup").empty().dialog("close"),i.activate(),n.start(),o.clear()},c.prototype.displayAvailableServices=function(){e("#rightTopPopup").empty(),e("#rightTopPopup").append("<p>Select from available layers to export images/data : </p>"),t.each(s,function(t){var i=u({layerName:t.layerId,layerDescription:t.description,layer:t});e("#rightTopPopup").append(i),e("."+t.layerId).data("layer",t)}),e("#rightTopPopup").append('<button id="exportToolBtn" class="ui-button ui-widget ui-state-default ui-corner-all">Export Selection</button>')},c}),r("service/ShareCore",["jquery","gui/dialog/ErrorDialog"],function(e,t){var i,r,n;return{init:function(e){i=e.mizar,r=i.getNavigation(),e.configuration.hasOwnProperty("shortener")&&(n=e.configuration.shortener.baseUrl)},generateURL:function(){var o=window.document.documentURI,s=o.search(/[&|?]sharedParameters=/);-1!==s&&(o=o.substr(0,s));var a=o.indexOf("?conf=");-1!==a?"undefined"!==o&&""!==o?o+="&":(o=o.substr(0,a),o+="?"):o+="?";var l=[];i.getCrs().getWorldFrom3D(r.center3d,l);for(var u=i.getLayers(i.CONTEXT.Sky),c={},h=0;h<u.length;h++)c[u[h].name]=u[h].isVisible();var d={initTarget:l,fov:r.renderContext.fov,visibility:c,up:r.up};return n?e.ajax({type:"POST",url:n,async:!1,data:{context:JSON.stringify(d)},success:function(e){o+="sharedParameters="+e},error:function(e){t.open("Shortener service: "+e.statusText),console.error(e)}}):o+="sharedParameters="+JSON.stringify(d),o}}}),r("service/Share",["jquery","service/ShareCore"],function(e,t){return{init:function(i){t.init(i),e("#share").on("click",function(){var i=t.generateURL();e("#shareInput").val(i),e(this).fadeOut(300,function(){e(this).next().fadeIn(),e("#shareInput").select()})}),e("#shareClear").on("click",function(){e(this).parent().fadeOut(300,function(){e("#share").fadeIn()})}),e("#share").hover(function(){e(this).animate({left:"-10px"},100)},function(){e(this).animate({left:"-20px"},100)})}}}),function(e){e.color={},e.color.make=function(t,i,r,n){var o={};return o.r=t||0,o.g=i||0,o.b=r||0,o.a=null!=n?n:1,o.add=function(e,t){for(var i=0;i<e.length;++i)o[e.charAt(i)]+=t;return o.normalize()},o.scale=function(e,t){for(var i=0;i<e.length;++i)o[e.charAt(i)]*=t;return o.normalize()},o.toString=function(){return o.a>=1?"rgb("+[o.r,o.g,o.b].join(",")+")":"rgba("+[o.r,o.g,o.b,o.a].join(",")+")"},o.normalize=function(){function e(e,t,i){return t<e?e:t>i?i:t}return o.r=e(0,parseInt(o.r),255),o.g=e(0,parseInt(o.g),255),o.b=e(0,parseInt(o.b),255),o.a=e(0,o.a,1),o},o.clone=function(){return e.color.make(o.r,o.b,o.g,o.a)},o.normalize()},e.color.extract=function(t,i){var r;do{if(""!=(r=t.css(i).toLowerCase())&&"transparent"!=r)break;t=t.parent()}while(t.length&&!e.nodeName(t.get(0),"body"));return"rgba(0, 0, 0, 0)"==r&&(r="transparent"),e.color.parse(r)},e.color.parse=function(i){var r,n=e.color.make;if(r=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(i))return n(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10));if(r=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))return n(parseInt(r[1],10),parseInt(r[2],10),parseInt(r[3],10),parseFloat(r[4]));if(r=/rgb\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*\)/.exec(i))return n(2.55*parseFloat(r[1]),2.55*parseFloat(r[2]),2.55*parseFloat(r[3]));if(r=/rgba\(\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\%\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(i))return n(2.55*parseFloat(r[1]),2.55*parseFloat(r[2]),2.55*parseFloat(r[3]),parseFloat(r[4]));if(r=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(i))return n(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16));if(r=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(i))return n(parseInt(r[1]+r[1],16),parseInt(r[2]+r[2],16),parseInt(r[3]+r[3],16));var o=e.trim(i).toLowerCase();return"transparent"==o?n(255,255,255,0):n((r=t[o]||[0,0,0])[0],r[1],r[2])};var t={aqua:[0,255,255],azure:[240,255,255],beige:[245,245,220],black:[0,0,0],blue:[0,0,255],brown:[165,42,42],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgrey:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkviolet:[148,0,211],fuchsia:[255,0,255],gold:[255,215,0],green:[0,128,0],indigo:[75,0,130],khaki:[240,230,140],lightblue:[173,216,230],lightcyan:[224,255,255],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightyellow:[255,255,224],lime:[0,255,0],magenta:[255,0,255],maroon:[128,0,0],navy:[0,0,128],olive:[128,128,0],orange:[255,165,0],pink:[255,192,203],purple:[128,0,128],violet:[128,0,128],red:[255,0,0],silver:[192,192,192],white:[255,255,255],yellow:[255,255,0]}}(jQuery),function(e){var t=Object.prototype.hasOwnProperty;function i(t,i){var r=i.children("."+t)[0];if(null==r&&((r=document.createElement("canvas")).className=t,e(r).css({direction:"ltr",position:"absolute",left:0,top:0}).appendTo(i),!r.getContext)){if(!window.G_vmlCanvasManager)throw new Error("Canvas is not available. If you're using IE with a fall-back such as Excanvas, then there's either a mistake in your conditional include, or the page has no DOCTYPE and is rendering in Quirks Mode.");r=window.G_vmlCanvasManager.initElement(r)}this.element=r;var n=this.context=r.getContext("2d"),o=window.devicePixelRatio||1,s=n.webkitBackingStorePixelRatio||n.mozBackingStorePixelRatio||n.msBackingStorePixelRatio||n.oBackingStorePixelRatio||n.backingStorePixelRatio||1;this.pixelRatio=o/s,this.resize(i.width(),i.height()),this.textContainer=null,this.text={},this._textCache={}}function r(t,r,n,o){var s=[],a={colors:["#edc240","#afd8f8","#cb4b4b","#4da74d","#9440ed"],legend:{show:!0,noColumns:1,labelFormatter:null,labelBoxBorderColor:"#ccc",container:null,position:"ne",margin:5,backgroundColor:null,backgroundOpacity:.85,sorted:null},xaxis:{show:null,position:"bottom",mode:null,font:null,color:null,tickColor:null,transform:null,inverseTransform:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,reserveSpace:null,tickLength:null,alignTicksWithAxis:null,tickDecimals:null,tickSize:null,minTickSize:null},yaxis:{autoscaleMargin:.02,position:"left"},xaxes:[],yaxes:[],series:{points:{show:!1,radius:3,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle"},lines:{lineWidth:2,fill:!1,fillColor:null,steps:!1},bars:{show:!1,lineWidth:2,barWidth:1,fill:!0,fillColor:null,align:"left",horizontal:!1,zero:!0},shadowSize:3,highlightColor:null},grid:{show:!0,aboveData:!1,color:"#545454",backgroundColor:null,borderColor:null,tickColor:null,margin:0,labelMargin:5,axisMargin:8,borderWidth:2,minBorderMargin:null,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:2,clickable:!1,hoverable:!1,autoHighlight:!0,mouseActiveRadius:10},interaction:{redrawOverlayInterval:1e3/60},hooks:{}},l=null,u=null,c=null,h=null,d=null,p=[],f=[],g={left:0,right:0,top:0,bottom:0},m=0,v=0,y={processOptions:[],processRawData:[],processDatapoints:[],processOffset:[],drawBackground:[],drawSeries:[],draw:[],bindEvents:[],drawOverlay:[],shutdown:[]},b=this;function x(e,t){t=[b].concat(t);for(var i=0;i<e.length;++i)e[i].apply(this,t)}function w(t){s=function(t){for(var i=[],r=0;r<t.length;++r){var n=e.extend(!0,{},a.series);null!=t[r].data?(n.data=t[r].data,delete t[r].data,e.extend(!0,n,t[r]),t[r].data=n.data):n.data=t[r],i.push(n)}return i}(t),function(){var t,i=s.length,r=-1;for(t=0;t<s.length;++t){var n=s[t].color;null!=n&&(i--,"number"==typeof n&&n>r&&(r=n))}i<=r&&(i=r+1);var o,l=[],u=a.colors,c=u.length,h=0;for(t=0;t<i;t++)o=e.color.parse(u[t%c]||"#666"),t%c==0&&t&&(h=h>=0?h<.5?-h-.2:0:-h),l[t]=o.scale("rgb",1+h);var d,g=0;for(t=0;t<s.length;++t){if(null==(d=s[t]).color?(d.color=l[g].toString(),++g):"number"==typeof d.color&&(d.color=l[d.color].toString()),null==d.lines.show){var m,v=!0;for(m in d)if(d[m]&&d[m].show){v=!1;break}v&&(d.lines.show=!0)}null==d.lines.zero&&(d.lines.zero=!!d.lines.fill),d.xaxis=S(p,T(d,"x")),d.yaxis=S(f,T(d,"y"))}}(),function(){var t,i,r,n,o,a,l,u,c,h,d,p,f=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,m=Number.MAX_VALUE;function v(e,t,i){t<e.datamin&&t!=-m&&(e.datamin=t),i>e.datamax&&i!=m&&(e.datamax=i)}for(e.each(_(),function(e,t){t.datamin=f,t.datamax=g,t.used=!1}),t=0;t<s.length;++t)(o=s[t]).datapoints={points:[]},x(y.processRawData,[o,o.data,o.datapoints]);for(t=0;t<s.length;++t){if(o=s[t],d=o.data,!(p=o.datapoints.format)){if((p=[]).push({x:!0,number:!0,required:!0}),p.push({y:!0,number:!0,required:!0}),o.bars.show||o.lines.show&&o.lines.fill){var b=!!(o.bars.show&&o.bars.zero||o.lines.show&&o.lines.zero);p.push({y:!0,number:!0,required:!1,defaultValue:0,autoscale:b}),o.bars.horizontal&&(delete p[p.length-1].y,p[p.length-1].x=!0)}o.datapoints.format=p}if(null==o.datapoints.pointsize){o.datapoints.pointsize=p.length,l=o.datapoints.pointsize,a=o.datapoints.points;var w=o.lines.show&&o.lines.steps;for(o.xaxis.used=o.yaxis.used=!0,i=r=0;i<d.length;++i,r+=l){var T=null==(h=d[i]);if(!T)for(n=0;n<l;++n)u=h[n],(c=p[n])&&(c.number&&null!=u&&(u=+u,isNaN(u)?u=null:u==1/0?u=m:u==-1/0&&(u=-m)),null==u&&(c.required&&(T=!0),null!=c.defaultValue&&(u=c.defaultValue))),a[r+n]=u;if(T)for(n=0;n<l;++n)null!=(u=a[r+n])&&!1!==(c=p[n]).autoscale&&(c.x&&v(o.xaxis,u,u),c.y&&v(o.yaxis,u,u)),a[r+n]=null;else if(w&&r>0&&null!=a[r-l]&&a[r-l]!=a[r]&&a[r-l+1]!=a[r+1]){for(n=0;n<l;++n)a[r+l+n]=a[r+n];a[r+1]=a[r-l+1],r+=l}}}}for(t=0;t<s.length;++t)o=s[t],x(y.processDatapoints,[o,o.datapoints]);for(t=0;t<s.length;++t){o=s[t],a=o.datapoints.points,l=o.datapoints.pointsize,p=o.datapoints.format;var C=f,S=f,E=g,A=g;for(i=0;i<a.length;i+=l)if(null!=a[i])for(n=0;n<l;++n)u=a[i+n],(c=p[n])&&!1!==c.autoscale&&u!=m&&u!=-m&&(c.x&&(u<C&&(C=u),u>E&&(E=u)),c.y&&(u<S&&(S=u),u>A&&(A=u)));if(o.bars.show){var I;switch(o.bars.align){case"left":I=0;break;case"right":I=-o.bars.barWidth;break;default:I=-o.bars.barWidth/2}o.bars.horizontal?(S+=I,A+=I+o.bars.barWidth):(C+=I,E+=I+o.bars.barWidth)}v(o.xaxis,C,E),v(o.yaxis,S,A)}e.each(_(),function(e,t){t.datamin==f&&(t.datamin=null),t.datamax==g&&(t.datamax=null)})}()}function T(e,t){var i=e[t+"axis"];return"object"==typeof i&&(i=i.n),"number"!=typeof i&&(i=1),i}function _(){return e.grep(p.concat(f),function(e){return e})}function C(e){var t,i,r={};for(t=0;t<p.length;++t)(i=p[t])&&i.used&&(r["x"+i.n]=i.c2p(e.left));for(t=0;t<f.length;++t)(i=f[t])&&i.used&&(r["y"+i.n]=i.c2p(e.top));return void 0!==r.x1&&(r.x=r.x1),void 0!==r.y1&&(r.y=r.y1),r}function S(t,i){return t[i-1]||(t[i-1]={n:i,direction:t==p?"x":"y",options:e.extend(!0,{},t==p?a.xaxis:a.yaxis)}),t[i-1]}function E(){O&&clearTimeout(O),c.unbind("mousemove",F),c.unbind("mouseleave",B),c.unbind("click",G),x(y.shutdown,[c])}function A(t){var i=t.labelWidth,r=t.labelHeight,n=t.options.position,o="x"===t.direction,s=t.options.tickLength,u=a.grid.axisMargin,c=a.grid.labelMargin,h=!0,d=!0,m=!0,v=!1;e.each(o?p:f,function(e,i){i&&(i.show||i.reserveSpace)&&(i===t?v=!0:i.options.position===n&&(v?d=!1:h=!1),v||(m=!1))}),d&&(u=0),null==s&&(s=m?"full":5),isNaN(+s)||(c+=+s),o?(r+=c,"bottom"==n?(g.bottom+=r+u,t.box={top:l.height-g.bottom,height:r}):(t.box={top:g.top+u,height:r},g.top+=r+u)):(i+=c,"left"==n?(t.box={left:g.left+u,width:i},g.left+=i+u):(g.right+=i+u,t.box={left:l.width-g.right,width:i})),t.position=n,t.tickLength=s,t.box.padding=c,t.innermost=h}function I(){var i,r=_(),n=a.grid.show;for(var o in g){var u=a.grid.margin||0;g[o]="number"==typeof u?u:u[o]||0}for(var o in x(y.processOffset,[g]),g)"object"==typeof a.grid.borderWidth?g[o]+=n?a.grid.borderWidth[o]:0:g[o]+=n?a.grid.borderWidth:0;if(e.each(r,function(e,t){var i=t.options;t.show=null==i.show?t.used:i.show,t.reserveSpace=null==i.reserveSpace?t.show:i.reserveSpace,function(e){var t=e.options,i=+(null!=t.min?t.min:e.datamin),r=+(null!=t.max?t.max:e.datamax),n=r-i;if(0==n){var o=0==r?1:.01;null==t.min&&(i-=o),null!=t.max&&null==t.min||(r+=o)}else{var s=t.autoscaleMargin;null!=s&&(null==t.min&&(i-=n*s)<0&&null!=e.datamin&&e.datamin>=0&&(i=0),null==t.max&&(r+=n*s)>0&&null!=e.datamax&&e.datamax<=0&&(r=0))}e.min=i,e.max=r}(t)}),n){var c=e.grep(r,function(e){return e.show||e.reserveSpace});for(e.each(c,function(t,i){!function(t){var i,r=t.options;i="number"==typeof r.ticks&&r.ticks>0?r.ticks:.3*Math.sqrt("x"==t.direction?l.width:l.height);var n=(t.max-t.min)/i,o=-Math.floor(Math.log(n)/Math.LN10),s=r.tickDecimals;null!=s&&o>s&&(o=s);var a,u=Math.pow(10,-o),c=n/u;c<1.5?a=1:c<3?(a=2,c>2.25&&(null==s||o+1<=s)&&(a=2.5,++o)):a=c<7.5?5:10;a*=u,null!=r.minTickSize&&a<r.minTickSize&&(a=r.minTickSize);if(t.delta=n,t.tickDecimals=Math.max(0,null!=s?s:o),t.tickSize=r.tickSize||a,"time"==r.mode&&!t.tickGenerator)throw new Error("Time mode requires the flot.time plugin.");t.tickGenerator||(t.tickGenerator=function(e){var t,i,r,n=[],o=(i=e.min,(r=e.tickSize)*Math.floor(i/r)),s=0,a=Number.NaN;do{t=a,a=o+s*e.tickSize,n.push(a),++s}while(a<e.max&&a!=t);return n},t.tickFormatter=function(e,t){var i=t.tickDecimals?Math.pow(10,t.tickDecimals):1,r=""+Math.round(e*i)/i;if(null!=t.tickDecimals){var n=r.indexOf("."),o=-1==n?0:r.length-n-1;if(o<t.tickDecimals)return(o?r:r+".")+(""+i).substr(1,t.tickDecimals-o)}return r});e.isFunction(r.tickFormatter)&&(t.tickFormatter=function(e,t){return""+r.tickFormatter(e,t)});if(null!=r.alignTicksWithAxis){var h=("x"==t.direction?p:f)[r.alignTicksWithAxis-1];if(h&&h.used&&h!=t){var d=t.tickGenerator(t);if(d.length>0&&(null==r.min&&(t.min=Math.min(t.min,d[0])),null==r.max&&d.length>1&&(t.max=Math.max(t.max,d[d.length-1]))),t.tickGenerator=function(e){var t,i,r=[];for(i=0;i<h.ticks.length;++i)t=(h.ticks[i].v-h.min)/(h.max-h.min),t=e.min+t*(e.max-e.min),r.push(t);return r},!t.mode&&null==r.tickDecimals){var g=Math.max(0,1-Math.floor(Math.log(t.delta)/Math.LN10)),m=t.tickGenerator(t);m.length>1&&/\..*0$/.test((m[1]-m[0]).toFixed(g))||(t.tickDecimals=g)}}}}(i),function(t){var i,r,n=t.options.ticks,o=[];null==n||"number"==typeof n&&n>0?o=t.tickGenerator(t):n&&(o=e.isFunction(n)?n(t):n);for(t.ticks=[],i=0;i<o.length;++i){var s=null,a=o[i];"object"==typeof a?(r=+a[0],a.length>1&&(s=a[1])):r=+a,null==s&&(s=t.tickFormatter(r,t)),isNaN(r)||t.ticks.push({v:r,label:s})}}(i),function(e,t){e.options.autoscaleMargin&&t.length>0&&(null==e.options.min&&(e.min=Math.min(e.min,t[0].v)),null==e.options.max&&t.length>1&&(e.max=Math.max(e.max,t[t.length-1].v)))}(i,i.ticks),function(e){for(var t=e.options,i=e.ticks||[],r=t.labelWidth||0,n=t.labelHeight||0,o=r||("x"==e.direction?Math.floor(l.width/(i.length||1)):null),s=e.direction+"Axis "+e.direction+e.n+"Axis",a="flot-"+e.direction+"-axis flot-"+e.direction+e.n+"-axis "+s,u=t.font||"flot-tick-label tickLabel",c=0;c<i.length;++c){var h=i[c];if(h.label){var d=l.getTextInfo(a,h.label,u,null,o);r=Math.max(r,d.width),n=Math.max(n,d.height)}}e.labelWidth=t.labelWidth||r,e.labelHeight=t.labelHeight||n}(i)}),i=c.length-1;i>=0;--i)A(c[i]);!function(){var t,i=a.grid.minBorderMargin;if(null==i)for(i=0,t=0;t<s.length;++t)i=Math.max(i,2*(s[t].points.radius+s[t].points.lineWidth/2));var r={left:i,right:i,top:i,bottom:i};e.each(_(),function(e,t){t.reserveSpace&&t.ticks&&t.ticks.length&&("x"===t.direction?(r.left=Math.max(r.left,t.labelWidth/2),r.right=Math.max(r.right,t.labelWidth/2)):(r.bottom=Math.max(r.bottom,t.labelHeight/2),r.top=Math.max(r.top,t.labelHeight/2)))}),g.left=Math.ceil(Math.max(r.left,g.left)),g.right=Math.ceil(Math.max(r.right,g.right)),g.top=Math.ceil(Math.max(r.top,g.top)),g.bottom=Math.ceil(Math.max(r.bottom,g.bottom))}(),e.each(c,function(e,t){!function(e){"x"==e.direction?(e.box.left=g.left-e.labelWidth/2,e.box.width=l.width-g.left-g.right+e.labelWidth):(e.box.top=g.top-e.labelHeight/2,e.box.height=l.height-g.bottom-g.top+e.labelHeight)}(t)})}m=l.width-g.left-g.right,v=l.height-g.bottom-g.top,e.each(r,function(e,t){!function(e){function t(e){return e}var i,r,n=e.options.transform||t,o=e.options.inverseTransform;"x"==e.direction?(i=e.scale=m/Math.abs(n(e.max)-n(e.min)),r=Math.min(n(e.max),n(e.min))):(i=-(i=e.scale=v/Math.abs(n(e.max)-n(e.min))),r=Math.max(n(e.max),n(e.min))),e.p2c=n==t?function(e){return(e-r)*i}:function(e){return(n(e)-r)*i},e.c2p=o?function(e){return o(r+e/i)}:function(e){return r+e/i}}(t)}),n&&e.each(_(),function(e,t){var i,r,n,o,s,a=t.box,u=t.direction+"Axis "+t.direction+t.n+"Axis",c="flot-"+t.direction+"-axis flot-"+t.direction+t.n+"-axis "+u,h=t.options.font||"flot-tick-label tickLabel";if(l.removeText(c),t.show&&0!=t.ticks.length)for(var d=0;d<t.ticks.length;++d)!(i=t.ticks[d]).label||i.v<t.min||i.v>t.max||("x"==t.direction?(o="center",r=g.left+t.p2c(i.v),"bottom"==t.position?n=a.top+a.padding:(n=a.top+a.height-a.padding,s="bottom")):(s="middle",n=g.top+t.p2c(i.v),"left"==t.position?(r=a.left+a.width-a.padding,o="right"):r=a.left+a.padding),l.addText(c,r,n,i.label,h,null,null,o,s))}),function(){null!=a.legend.container?e(a.legend.container).html(""):t.find(".legend").remove();if(!a.legend.show)return;for(var i,r,n=[],o=[],l=!1,u=a.legend.labelFormatter,c=0;c<s.length;++c)(i=s[c]).label&&(r=u?u(i.label,i):i.label)&&o.push({label:r,color:i.color});if(a.legend.sorted)if(e.isFunction(a.legend.sorted))o.sort(a.legend.sorted);else if("reverse"==a.legend.sorted)o.reverse();else{var h="descending"!=a.legend.sorted;o.sort(function(e,t){return e.label==t.label?0:e.label<t.label!=h?1:-1})}for(var c=0;c<o.length;++c){var d=o[c];c%a.legend.noColumns==0&&(l&&n.push("</tr>"),n.push("<tr>"),l=!0),n.push('<td class="legendColorBox"><div style="border:1px solid '+a.legend.labelBoxBorderColor+';padding:1px"><div style="width:4px;height:0;border:5px solid '+d.color+';overflow:hidden"></div></div></td><td class="legendLabel">'+d.label+"</td>")}l&&n.push("</tr>");if(0==n.length)return;var p='<table style="font-size:smaller;color:'+a.grid.color+'">'+n.join("")+"</table>";if(null!=a.legend.container)e(a.legend.container).html(p);else{var f="",m=a.legend.position,v=a.legend.margin;null==v[0]&&(v=[v,v]),"n"==m.charAt(0)?f+="top:"+(v[1]+g.top)+"px;":"s"==m.charAt(0)&&(f+="bottom:"+(v[1]+g.bottom)+"px;"),"e"==m.charAt(1)?f+="right:"+(v[0]+g.right)+"px;":"w"==m.charAt(1)&&(f+="left:"+(v[0]+g.left)+"px;");var y=e('<div class="legend">'+p.replace('style="','style="position:absolute;'+f+";")+"</div>").appendTo(t);if(0!=a.legend.backgroundOpacity){var b=a.legend.backgroundColor;null==b&&((b=(b=a.grid.backgroundColor)&&"string"==typeof b?e.color.parse(b):e.color.extract(y,"background-color")).a=1,b=b.toString());var x=y.children();e('<div style="position:absolute;width:'+x.width()+"px;height:"+x.height()+"px;"+f+"background-color:"+b+';"> </div>').prependTo(y).css("opacity",a.legend.backgroundOpacity)}}}()}function M(){l.clear(),x(y.drawBackground,[h]);var e=a.grid;e.show&&e.backgroundColor&&(h.save(),h.translate(g.left,g.top),h.fillStyle=X(a.grid.backgroundColor,v,0,"rgba(255, 255, 255, 0)"),h.fillRect(0,0,m,v),h.restore()),e.show&&!e.aboveData&&D();for(var t=0;t<s.length;++t)x(y.drawSeries,[h,s[t]]),R(s[t]);x(y.draw,[h]),e.show&&e.aboveData&&D(),l.render(),z()}function k(e,t){for(var i,r,n,o,s=_(),a=0;a<s.length;++a)if((i=s[a]).direction==t&&(e[o=t+i.n+"axis"]||1!=i.n||(o=t+"axis"),e[o])){r=e[o].from,n=e[o].to;break}if(e[o]||(i="x"==t?p[0]:f[0],r=e[t+"1"],n=e[t+"2"]),null!=r&&null!=n&&r>n){var l=r;r=n,n=l}return{from:r,to:n,axis:i}}function D(){var t,i,r,n;h.save(),h.translate(g.left,g.top);var o=a.grid.markings;if(o)for(e.isFunction(o)&&((i=b.getAxes()).xmin=i.xaxis.min,i.xmax=i.xaxis.max,i.ymin=i.yaxis.min,i.ymax=i.yaxis.max,o=o(i)),t=0;t<o.length;++t){var s=o[t],l=k(s,"x"),u=k(s,"y");if(null==l.from&&(l.from=l.axis.min),null==l.to&&(l.to=l.axis.max),null==u.from&&(u.from=u.axis.min),null==u.to&&(u.to=u.axis.max),!(l.to<l.axis.min||l.from>l.axis.max||u.to<u.axis.min||u.from>u.axis.max)){l.from=Math.max(l.from,l.axis.min),l.to=Math.min(l.to,l.axis.max),u.from=Math.max(u.from,u.axis.min),u.to=Math.min(u.to,u.axis.max);var c=l.from===l.to,d=u.from===u.to;if(!c||!d)if(l.from=Math.floor(l.axis.p2c(l.from)),l.to=Math.floor(l.axis.p2c(l.to)),u.from=Math.floor(u.axis.p2c(u.from)),u.to=Math.floor(u.axis.p2c(u.to)),c||d){var p=s.lineWidth||a.grid.markingsLineWidth,f=p%2?.5:0;h.beginPath(),h.strokeStyle=s.color||a.grid.markingsColor,h.lineWidth=p,c?(h.moveTo(l.to+f,u.from),h.lineTo(l.to+f,u.to)):(h.moveTo(l.from,u.to+f),h.lineTo(l.to,u.to+f)),h.stroke()}else h.fillStyle=s.color||a.grid.markingsColor,h.fillRect(l.from,u.to,l.to-l.from,u.from-u.to)}}i=_(),r=a.grid.borderWidth;for(var y=0;y<i.length;++y){var x,w,T,C,S=i[y],E=S.box,A=S.tickLength;if(S.show&&0!=S.ticks.length){for(h.lineWidth=1,"x"==S.direction?(x=0,w="full"==A?"top"==S.position?0:v:E.top-g.top+("top"==S.position?E.height:0)):(w=0,x="full"==A?"left"==S.position?0:m:E.left-g.left+("left"==S.position?E.width:0)),S.innermost||(h.strokeStyle=S.options.color,h.beginPath(),T=C=0,"x"==S.direction?T=m+1:C=v+1,1==h.lineWidth&&("x"==S.direction?w=Math.floor(w)+.5:x=Math.floor(x)+.5),h.moveTo(x,w),h.lineTo(x+T,w+C),h.stroke()),h.strokeStyle=S.options.tickColor,h.beginPath(),t=0;t<S.ticks.length;++t){var I=S.ticks[t].v;T=C=0,isNaN(I)||I<S.min||I>S.max||"full"==A&&("object"==typeof r&&r[S.position]>0||r>0)&&(I==S.min||I==S.max)||("x"==S.direction?(x=S.p2c(I),C="full"==A?-v:A,"top"==S.position&&(C=-C)):(w=S.p2c(I),T="full"==A?-m:A,"left"==S.position&&(T=-T)),1==h.lineWidth&&("x"==S.direction?x=Math.floor(x)+.5:w=Math.floor(w)+.5),h.moveTo(x,w),h.lineTo(x+T,w+C))}h.stroke()}}r&&(n=a.grid.borderColor,"object"==typeof r||"object"==typeof n?("object"!=typeof r&&(r={top:r,right:r,bottom:r,left:r}),"object"!=typeof n&&(n={top:n,right:n,bottom:n,left:n}),r.top>0&&(h.strokeStyle=n.top,h.lineWidth=r.top,h.beginPath(),h.moveTo(0-r.left,0-r.top/2),h.lineTo(m,0-r.top/2),h.stroke()),r.right>0&&(h.strokeStyle=n.right,h.lineWidth=r.right,h.beginPath(),h.moveTo(m+r.right/2,0-r.top),h.lineTo(m+r.right/2,v),h.stroke()),r.bottom>0&&(h.strokeStyle=n.bottom,h.lineWidth=r.bottom,h.beginPath(),h.moveTo(m+r.right,v+r.bottom/2),h.lineTo(0,v+r.bottom/2),h.stroke()),r.left>0&&(h.strokeStyle=n.left,h.lineWidth=r.left,h.beginPath(),h.moveTo(0-r.left/2,v+r.bottom),h.lineTo(0-r.left/2,0),h.stroke())):(h.lineWidth=r,h.strokeStyle=a.grid.borderColor,h.strokeRect(-r/2,-r/2,m+r,v+r))),h.restore()}function R(e){e.lines.show&&function(e){function t(e,t,i,r,n){var o=e.points,s=e.pointsize,a=null,l=null;h.beginPath();for(var u=s;u<o.length;u+=s){var c=o[u-s],d=o[u-s+1],p=o[u],f=o[u+1];if(null!=c&&null!=p){if(d<=f&&d<n.min){if(f<n.min)continue;c=(n.min-d)/(f-d)*(p-c)+c,d=n.min}else if(f<=d&&f<n.min){if(d<n.min)continue;p=(n.min-d)/(f-d)*(p-c)+c,f=n.min}if(d>=f&&d>n.max){if(f>n.max)continue;c=(n.max-d)/(f-d)*(p-c)+c,d=n.max}else if(f>=d&&f>n.max){if(d>n.max)continue;p=(n.max-d)/(f-d)*(p-c)+c,f=n.max}if(c<=p&&c<r.min){if(p<r.min)continue;d=(r.min-c)/(p-c)*(f-d)+d,c=r.min}else if(p<=c&&p<r.min){if(c<r.min)continue;f=(r.min-c)/(p-c)*(f-d)+d,p=r.min}if(c>=p&&c>r.max){if(p>r.max)continue;d=(r.max-c)/(p-c)*(f-d)+d,c=r.max}else if(p>=c&&p>r.max){if(c>r.max)continue;f=(r.max-c)/(p-c)*(f-d)+d,p=r.max}c==a&&d==l||h.moveTo(r.p2c(c)+t,n.p2c(d)+i),a=p,l=f,h.lineTo(r.p2c(p)+t,n.p2c(f)+i)}}h.stroke()}h.save(),h.translate(g.left,g.top),h.lineJoin="round";var i=e.lines.lineWidth,r=e.shadowSize;if(i>0&&r>0){h.lineWidth=r,h.strokeStyle="rgba(0,0,0,0.1)";var n=Math.PI/18;t(e.datapoints,Math.sin(n)*(i/2+r/2),Math.cos(n)*(i/2+r/2),e.xaxis,e.yaxis),h.lineWidth=r/2,t(e.datapoints,Math.sin(n)*(i/2+r/4),Math.cos(n)*(i/2+r/4),e.xaxis,e.yaxis)}h.lineWidth=i,h.strokeStyle=e.color;var o=L(e.lines,e.color,0,v);o&&(h.fillStyle=o,function(e,t,i){var r=e.points,n=e.pointsize,o=Math.min(Math.max(0,i.min),i.max),s=0,a=!1,l=1,u=0,c=0;for(;!(n>0&&s>r.length+n);){var d=r[(s+=n)-n],p=r[s-n+l],f=r[s],g=r[s+l];if(a){if(n>0&&null!=d&&null==f){c=s,n=-n,l=2;continue}if(n<0&&s==u+n){h.fill(),a=!1,l=1,s=u=c+(n=-n);continue}}if(null!=d&&null!=f){if(d<=f&&d<t.min){if(f<t.min)continue;p=(t.min-d)/(f-d)*(g-p)+p,d=t.min}else if(f<=d&&f<t.min){if(d<t.min)continue;g=(t.min-d)/(f-d)*(g-p)+p,f=t.min}if(d>=f&&d>t.max){if(f>t.max)continue;p=(t.max-d)/(f-d)*(g-p)+p,d=t.max}else if(f>=d&&f>t.max){if(d>t.max)continue;g=(t.max-d)/(f-d)*(g-p)+p,f=t.max}if(a||(h.beginPath(),h.moveTo(t.p2c(d),i.p2c(o)),a=!0),p>=i.max&&g>=i.max)h.lineTo(t.p2c(d),i.p2c(i.max)),h.lineTo(t.p2c(f),i.p2c(i.max));else if(p<=i.min&&g<=i.min)h.lineTo(t.p2c(d),i.p2c(i.min)),h.lineTo(t.p2c(f),i.p2c(i.min));else{var m=d,v=f;p<=g&&p<i.min&&g>=i.min?(d=(i.min-p)/(g-p)*(f-d)+d,p=i.min):g<=p&&g<i.min&&p>=i.min&&(f=(i.min-p)/(g-p)*(f-d)+d,g=i.min),p>=g&&p>i.max&&g<=i.max?(d=(i.max-p)/(g-p)*(f-d)+d,p=i.max):g>=p&&g>i.max&&p<=i.max&&(f=(i.max-p)/(g-p)*(f-d)+d,g=i.max),d!=m&&h.lineTo(t.p2c(m),i.p2c(p)),h.lineTo(t.p2c(d),i.p2c(p)),h.lineTo(t.p2c(f),i.p2c(g)),f!=v&&(h.lineTo(t.p2c(f),i.p2c(g)),h.lineTo(t.p2c(v),i.p2c(g)))}}}}(e.datapoints,e.xaxis,e.yaxis));i>0&&t(e.datapoints,0,0,e.xaxis,e.yaxis);h.restore()}(e),e.bars.show&&function(e){var t;switch(h.save(),h.translate(g.left,g.top),h.lineWidth=e.bars.lineWidth,h.strokeStyle=e.color,e.bars.align){case"left":t=0;break;case"right":t=-e.bars.barWidth;break;default:t=-e.bars.barWidth/2}var i=e.bars.fill?function(t,i){return L(e.bars,e.color,t,i)}:null;(function(t,i,r,n,o,s){for(var a=t.points,l=t.pointsize,u=0;u<a.length;u+=l)null!=a[u]&&P(a[u],a[u+1],a[u+2],i,r,n,o,s,h,e.bars.horizontal,e.bars.lineWidth)})(e.datapoints,t,t+e.bars.barWidth,i,e.xaxis,e.yaxis),h.restore()}(e),e.points.show&&function(e){function t(e,t,i,r,n,o,s,a){for(var l=e.points,u=e.pointsize,c=0;c<l.length;c+=u){var d=l[c],p=l[c+1];null==d||d<o.min||d>o.max||p<s.min||p>s.max||(h.beginPath(),d=o.p2c(d),p=s.p2c(p)+r,"circle"==a?h.arc(d,p,t,0,n?Math.PI:2*Math.PI,!1):a(h,d,p,t,n),h.closePath(),i&&(h.fillStyle=i,h.fill()),h.stroke())}}h.save(),h.translate(g.left,g.top);var i=e.points.lineWidth,r=e.shadowSize,n=e.points.radius,o=e.points.symbol;0==i&&(i=1e-4);if(i>0&&r>0){var s=r/2;h.lineWidth=s,h.strokeStyle="rgba(0,0,0,0.1)",t(e.datapoints,n,null,s+s/2,!0,e.xaxis,e.yaxis,o),h.strokeStyle="rgba(0,0,0,0.2)",t(e.datapoints,n,null,s/2,!0,e.xaxis,e.yaxis,o)}h.lineWidth=i,h.strokeStyle=e.color,t(e.datapoints,n,L(e.points,e.color),0,!1,e.xaxis,e.yaxis,o),h.restore()}(e)}function P(e,t,i,r,n,o,s,a,l,u,c){var h,d,p,f,g,m,v,y,b;u?(y=m=v=!0,g=!1,f=t+r,p=t+n,(d=e)<(h=i)&&(b=d,d=h,h=b,g=!0,m=!1)):(g=m=v=!0,y=!1,h=e+r,d=e+n,(f=t)<(p=i)&&(b=f,f=p,p=b,y=!0,v=!1)),d<s.min||h>s.max||f<a.min||p>a.max||(h<s.min&&(h=s.min,g=!1),d>s.max&&(d=s.max,m=!1),p<a.min&&(p=a.min,y=!1),f>a.max&&(f=a.max,v=!1),h=s.p2c(h),p=a.p2c(p),d=s.p2c(d),f=a.p2c(f),o&&(l.fillStyle=o(p,f),l.fillRect(h,f,d-h,p-f)),c>0&&(g||m||v||y)&&(l.beginPath(),l.moveTo(h,p),g?l.lineTo(h,f):l.moveTo(h,f),v?l.lineTo(d,f):l.moveTo(d,f),m?l.lineTo(d,p):l.moveTo(d,p),y?l.lineTo(h,p):l.moveTo(h,p),l.stroke()))}function L(t,i,r,n){var o=t.fill;if(!o)return null;if(t.fillColor)return X(t.fillColor,r,n,i);var s=e.color.parse(i);return s.a="number"==typeof o?o:.4,s.normalize(),s.toString()}b.setData=w,b.setupGrid=I,b.draw=M,b.getPlaceholder=function(){return t},b.getCanvas=function(){return l.element},b.getPlotOffset=function(){return g},b.width=function(){return m},b.height=function(){return v},b.offset=function(){var e=c.offset();return e.left+=g.left,e.top+=g.top,e},b.getData=function(){return s},b.getAxes=function(){var t={};return e.each(p.concat(f),function(e,i){i&&(t[i.direction+(1!=i.n?i.n:"")+"axis"]=i)}),t},b.getXAxes=function(){return p},b.getYAxes=function(){return f},b.c2p=C,b.p2c=function(e){var t,i,r,n={};for(t=0;t<p.length;++t)if((i=p[t])&&i.used&&(r="x"+i.n,null==e[r]&&1==i.n&&(r="x"),null!=e[r])){n.left=i.p2c(e[r]);break}for(t=0;t<f.length;++t)if((i=f[t])&&i.used&&(r="y"+i.n,null==e[r]&&1==i.n&&(r="y"),null!=e[r])){n.top=i.p2c(e[r]);break}return n},b.getOptions=function(){return a},b.highlight=j,b.unhighlight=W,b.triggerRedrawOverlay=z,b.pointOffset=function(e){return{left:parseInt(p[T(e,"x")-1].p2c(+e.x)+g.left,10),top:parseInt(f[T(e,"y")-1].p2c(+e.y)+g.top,10)}},b.shutdown=E,b.destroy=function(){E(),t.removeData("plot").empty(),s=[],a=null,l=null,u=null,c=null,h=null,d=null,p=[],f=[],y=null,N=[],b=null},b.resize=function(){var e=t.width(),i=t.height();l.resize(e,i),u.resize(e,i)},b.hooks=y,function(){for(var t={Canvas:i},r=0;r<o.length;++r){var n=o[r];n.init(b,t),n.options&&e.extend(!0,a,n.options)}}(),function(i){e.extend(!0,a,i),i&&i.colors&&(a.colors=i.colors);null==a.xaxis.color&&(a.xaxis.color=e.color.parse(a.grid.color).scale("a",.22).toString());null==a.yaxis.color&&(a.yaxis.color=e.color.parse(a.grid.color).scale("a",.22).toString());null==a.xaxis.tickColor&&(a.xaxis.tickColor=a.grid.tickColor||a.xaxis.color);null==a.yaxis.tickColor&&(a.yaxis.tickColor=a.grid.tickColor||a.yaxis.color);null==a.grid.borderColor&&(a.grid.borderColor=a.grid.color);null==a.grid.tickColor&&(a.grid.tickColor=e.color.parse(a.grid.color).scale("a",.22).toString());var r,n,o,s=t.css("font-size"),l=s?+s.replace("px",""):13,u={style:t.css("font-style"),size:Math.round(.8*l),variant:t.css("font-variant"),weight:t.css("font-weight"),family:t.css("font-family")};for(o=a.xaxes.length||1,r=0;r<o;++r)(n=a.xaxes[r])&&!n.tickColor&&(n.tickColor=n.color),n=e.extend(!0,{},a.xaxis,n),a.xaxes[r]=n,n.font&&(n.font=e.extend({},u,n.font),n.font.color||(n.font.color=n.color),n.font.lineHeight||(n.font.lineHeight=Math.round(1.15*n.font.size)));for(o=a.yaxes.length||1,r=0;r<o;++r)(n=a.yaxes[r])&&!n.tickColor&&(n.tickColor=n.color),n=e.extend(!0,{},a.yaxis,n),a.yaxes[r]=n,n.font&&(n.font=e.extend({},u,n.font),n.font.color||(n.font.color=n.color),n.font.lineHeight||(n.font.lineHeight=Math.round(1.15*n.font.size)));a.xaxis.noTicks&&null==a.xaxis.ticks&&(a.xaxis.ticks=a.xaxis.noTicks);a.yaxis.noTicks&&null==a.yaxis.ticks&&(a.yaxis.ticks=a.yaxis.noTicks);a.x2axis&&(a.xaxes[1]=e.extend(!0,{},a.xaxis,a.x2axis),a.xaxes[1].position="top",null==a.x2axis.min&&(a.xaxes[1].min=null),null==a.x2axis.max&&(a.xaxes[1].max=null));a.y2axis&&(a.yaxes[1]=e.extend(!0,{},a.yaxis,a.y2axis),a.yaxes[1].position="right",null==a.y2axis.min&&(a.yaxes[1].min=null),null==a.y2axis.max&&(a.yaxes[1].max=null));a.grid.coloredAreas&&(a.grid.markings=a.grid.coloredAreas);a.grid.coloredAreasColor&&(a.grid.markingsColor=a.grid.coloredAreasColor);a.lines&&e.extend(!0,a.series.lines,a.lines);a.points&&e.extend(!0,a.series.points,a.points);a.bars&&e.extend(!0,a.series.bars,a.bars);null!=a.shadowSize&&(a.series.shadowSize=a.shadowSize);null!=a.highlightColor&&(a.series.highlightColor=a.highlightColor);for(r=0;r<a.xaxes.length;++r)S(p,r+1).options=a.xaxes[r];for(r=0;r<a.yaxes.length;++r)S(f,r+1).options=a.yaxes[r];for(var c in y)a.hooks[c]&&a.hooks[c].length&&(y[c]=y[c].concat(a.hooks[c]));x(y.processOptions,[a])}(n),function(){t.css("padding",0).children().filter(function(){return!e(this).hasClass("flot-overlay")&&!e(this).hasClass("flot-base")}).remove(),"static"==t.css("position")&&t.css("position","relative");l=new i("flot-base",t),u=new i("flot-overlay",t),h=l.context,d=u.context,c=e(u.element).unbind();var r=t.data("plot");r&&(r.shutdown(),u.clear());t.data("plot",b)}(),w(r),I(),M(),function(){a.grid.hoverable&&(c.mousemove(F),c.bind("mouseleave",B));a.grid.clickable&&c.click(G);x(y.bindEvents,[c])}();var N=[],O=null;function F(e){a.grid.hoverable&&U("plothover",e,function(e){return 0!=e.hoverable})}function B(e){a.grid.hoverable&&U("plothover",e,function(e){return!1})}function G(e){U("plotclick",e,function(e){return 0!=e.clickable})}function U(e,i,r){var n=c.offset(),o=i.pageX-n.left-g.left,l=i.pageY-n.top-g.top,u=C({left:o,top:l});u.pageX=i.pageX,u.pageY=i.pageY;var h=function(e,t,i){var r,n,o,l=a.grid.mouseActiveRadius,u=l*l+1,c=null;for(r=s.length-1;r>=0;--r)if(i(s[r])){var h=s[r],d=h.xaxis,p=h.yaxis,f=h.datapoints.points,g=d.c2p(e),m=p.c2p(t),v=l/d.scale,y=l/p.scale;if(o=h.datapoints.pointsize,d.options.inverseTransform&&(v=Number.MAX_VALUE),p.options.inverseTransform&&(y=Number.MAX_VALUE),h.lines.show||h.points.show)for(n=0;n<f.length;n+=o){var b=f[n],x=f[n+1];if(null!=b&&!(b-g>v||b-g<-v||x-m>y||x-m<-y)){var w=Math.abs(d.p2c(b)-e),T=Math.abs(p.p2c(x)-t),_=w*w+T*T;_<u&&(u=_,c=[r,n/o])}}if(h.bars.show&&!c){var C,S;switch(h.bars.align){case"left":C=0;break;case"right":C=-h.bars.barWidth;break;default:C=-h.bars.barWidth/2}for(S=C+h.bars.barWidth,n=0;n<f.length;n+=o){b=f[n],x=f[n+1];var E=f[n+2];null!=b&&(s[r].bars.horizontal?g<=Math.max(E,b)&&g>=Math.min(E,b)&&m>=x+C&&m<=x+S:g>=b+C&&g<=b+S&&m>=Math.min(E,x)&&m<=Math.max(E,x))&&(c=[r,n/o])}}}return c?(r=c[0],n=c[1],o=s[r].datapoints.pointsize,{datapoint:s[r].datapoints.points.slice(n*o,(n+1)*o),dataIndex:n,series:s[r],seriesIndex:r}):null}(o,l,r);if(h&&(h.pageX=parseInt(h.series.xaxis.p2c(h.datapoint[0])+n.left+g.left,10),h.pageY=parseInt(h.series.yaxis.p2c(h.datapoint[1])+n.top+g.top,10)),a.grid.autoHighlight){for(var d=0;d<N.length;++d){var p=N[d];p.auto!=e||h&&p.series==h.series&&p.point[0]==h.datapoint[0]&&p.point[1]==h.datapoint[1]||W(p.series,p.point)}h&&j(h.series,h.datapoint,e)}t.trigger(e,[u,h])}function z(){var e=a.interaction.redrawOverlayInterval;-1!=e?O||(O=setTimeout(V,e)):V()}function V(){var e,t;for(O=null,d.save(),u.clear(),d.translate(g.left,g.top),e=0;e<N.length;++e)(t=N[e]).series.bars.show?q(t.series,t.point):H(t.series,t.point);d.restore(),x(y.drawOverlay,[d])}function j(e,t,i){if("number"==typeof e&&(e=s[e]),"number"==typeof t){var r=e.datapoints.pointsize;t=e.datapoints.points.slice(r*t,r*(t+1))}var n=Y(e,t);-1==n?(N.push({series:e,point:t,auto:i}),z()):i||(N[n].auto=!1)}function W(e,t){if(null==e&&null==t)return N=[],void z();if("number"==typeof e&&(e=s[e]),"number"==typeof t){var i=e.datapoints.pointsize;t=e.datapoints.points.slice(i*t,i*(t+1))}var r=Y(e,t);-1!=r&&(N.splice(r,1),z())}function Y(e,t){for(var i=0;i<N.length;++i){var r=N[i];if(r.series==e&&r.point[0]==t[0]&&r.point[1]==t[1])return i}return-1}function H(t,i){var r=i[0],n=i[1],o=t.xaxis,s=t.yaxis,a="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString();if(!(r<o.min||r>o.max||n<s.min||n>s.max)){var l=t.points.radius+t.points.lineWidth/2;d.lineWidth=l,d.strokeStyle=a;var u=1.5*l;r=o.p2c(r),n=s.p2c(n),d.beginPath(),"circle"==t.points.symbol?d.arc(r,n,u,0,2*Math.PI,!1):t.points.symbol(d,r,n,u,!1),d.closePath(),d.stroke()}}function q(t,i){var r,n="string"==typeof t.highlightColor?t.highlightColor:e.color.parse(t.color).scale("a",.5).toString(),o=n;switch(t.bars.align){case"left":r=0;break;case"right":r=-t.bars.barWidth;break;default:r=-t.bars.barWidth/2}d.lineWidth=t.bars.lineWidth,d.strokeStyle=n,P(i[0],i[1],i[2]||0,r,r+t.bars.barWidth,function(){return o},t.xaxis,t.yaxis,d,t.bars.horizontal,t.bars.lineWidth)}function X(t,i,r,n){if("string"==typeof t)return t;for(var o=h.createLinearGradient(0,r,0,i),s=0,a=t.colors.length;s<a;++s){var l=t.colors[s];if("string"!=typeof l){var u=e.color.parse(n);null!=l.brightness&&(u=u.scale("rgb",l.brightness)),null!=l.opacity&&(u.a*=l.opacity),l=u.toString()}o.addColorStop(s/(a-1),l)}return o}}e.fn.detach||(e.fn.detach=function(){return this.each(function(){this.parentNode&&this.parentNode.removeChild(this)})}),i.prototype.resize=function(e,t){if(e<=0||t<=0)throw new Error("Invalid dimensions for plot, width = "+e+", height = "+t);var i=this.element,r=this.context,n=this.pixelRatio;this.width!=e&&(i.width=e*n,i.style.width=e+"px",this.width=e),this.height!=t&&(i.height=t*n,i.style.height=t+"px",this.height=t),r.restore(),r.save(),r.scale(n,n)},i.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)},i.prototype.render=function(){var e=this._textCache;for(var i in e)if(t.call(e,i)){var r=this.getTextLayer(i),n=e[i];for(var o in r.hide(),n)if(t.call(n,o)){var s=n[o];for(var a in s)if(t.call(s,a)){for(var l,u=s[a].positions,c=0;l=u[c];c++)l.active?l.rendered||(r.append(l.element),l.rendered=!0):(u.splice(c--,1),l.rendered&&l.element.detach());0==u.length&&delete s[a]}}r.show()}},i.prototype.getTextLayer=function(t){var i=this.text[t];return null==i&&(null==this.textContainer&&(this.textContainer=e("<div class='flot-text'></div>").css({position:"absolute",top:0,left:0,bottom:0,right:0,"font-size":"smaller",color:"#545454"}).insertAfter(this.element)),i=this.text[t]=e("<div></div>").addClass(t).css({position:"absolute",top:0,left:0,bottom:0,right:0}).appendTo(this.textContainer)),i},i.prototype.getTextInfo=function(t,i,r,n,o){var s,a,l,u;if(i=""+i,s="object"==typeof r?r.style+" "+r.variant+" "+r.weight+" "+r.size+"px/"+r.lineHeight+"px "+r.family:r,null==(a=this._textCache[t])&&(a=this._textCache[t]={}),null==(l=a[s])&&(l=a[s]={}),null==(u=l[i])){var c=e("<div></div>").html(i).css({position:"absolute","max-width":o,top:-9999}).appendTo(this.getTextLayer(t));"object"==typeof r?c.css({font:s,color:r.color}):"string"==typeof r&&c.addClass(r),u=l[i]={width:c.outerWidth(!0),height:c.outerHeight(!0),element:c,positions:[]},c.detach()}return u},i.prototype.addText=function(e,t,i,r,n,o,s,a,l){var u=this.getTextInfo(e,r,n,o,s),c=u.positions;"center"==a?t-=u.width/2:"right"==a&&(t-=u.width),"middle"==l?i-=u.height/2:"bottom"==l&&(i-=u.height);for(var h,d=0;h=c[d];d++)if(h.x==t&&h.y==i)return void(h.active=!0);h={active:!0,rendered:!1,element:c.length?u.element.clone():u.element,x:t,y:i},c.push(h),h.element.css({top:Math.round(i),left:Math.round(t),"text-align":a})},i.prototype.removeText=function(e,i,r,n,o,s){if(null==n){var a=this._textCache[e];if(null!=a)for(var l in a)if(t.call(a,l)){var u=a[l];for(var c in u)if(t.call(u,c))for(var h=u[c].positions,d=0;p=h[d];d++)p.active=!1}}else{var p;for(h=this.getTextInfo(e,n,o,s).positions,d=0;p=h[d];d++)p.x==i&&p.y==r&&(p.active=!1)}},e.plot=function(t,i,n){return new r(e(t),i,n,e.plot.plugins)},e.plot.version="0.8.3",e.plot.plugins=[],e.fn.plot=function(t,i){return this.each(function(){e.plot(this,t,i)})}}(jQuery),r("flot",["jquery"],function(e){return function(){return e.$.plot}}(this)),function(e){var t={tooltip:{show:!1,cssClass:"flotTip",content:"%s | X: %x | Y: %y",xDateFormat:null,yDateFormat:null,monthNames:null,dayNames:null,shifts:{x:10,y:20},defaultTheme:!0,lines:!1,onHover:function(e,t){},$compat:!1}};t.tooltipOpts=t.tooltip;var i=function(e){this.tipPosition={x:0,y:0},this.init(e)};i.prototype.init=function(t){function i(e){var i={};i.x=e.pageX,i.y=e.pageY,t.setTooltipPosition(i)}function r(i,r,o){var s=function(e,t,i,r){return Math.sqrt((i-e)*(i-e)+(r-t)*(r-t))};if(o)t.showTooltip(o,r);else if(n.plotOptions.series.lines.show&&!0===n.tooltipOptions.lines){var a=n.plotOptions.grid.mouseActiveRadius,l={distance:a+1};e.each(t.getData(),function(e,i){for(var n=0,o=-1,a=1;a<i.data.length;a++)i.data[a-1][0]<=r.x&&i.data[a][0]>=r.x&&(n=a-1,o=a);if(-1!==o){var u={x:i.data[n][0],y:i.data[n][1]},c={x:i.data[o][0],y:i.data[o][1]},h=function(e,t,i,r,n,o,a){if(!a||(a=function(e,t,i,r,n,o){if(void 0!==i)return{x:i,y:t};if(void 0!==r)return{x:e,y:r};var s,a=-1/((o-r)/(n-i));return{x:s=(n*(e*a-t+r)+i*(e*-a+t-o))/(a*(n-i)+r-o),y:a*s-a*e+t}}(e,t,i,r,n,o)).x>=Math.min(i,n)&&a.x<=Math.max(i,n)&&a.y>=Math.min(r,o)&&a.y<=Math.max(r,o)){var l=r-o,u=n-i,c=i*o-r*n;return Math.abs(l*e+u*t+c)/Math.sqrt(l*l+u*u)}var h=s(e,t,i,r),d=s(e,t,n,o);return h>d?d:h}(i.xaxis.p2c(r.x),i.yaxis.p2c(r.y),i.xaxis.p2c(u.x),i.yaxis.p2c(u.y),i.xaxis.p2c(c.x),i.yaxis.p2c(c.y),!1);if(h<l.distance){var d=s(u.x,u.y,r.x,r.y)<s(r.x,r.y,c.x,c.y)?n:o,p=(i.datapoints.pointsize,[r.x,u.y+(c.y-u.y)*((r.x-u.x)/(c.x-u.x))]);l={distance:h,item:{datapoint:p,dataIndex:d,series:i,seriesIndex:e}}}}else t.hideTooltip()}),l.distance<a+1?t.showTooltip(l.item,r):t.hideTooltip()}else t.hideTooltip()}var n=this,o=e.plot.plugins.length;if(this.plotPlugins=[],o)for(var s=0;o>s;s++)this.plotPlugins.push(e.plot.plugins[s].name);t.hooks.bindEvents.push(function(t,o){n.plotOptions=t.getOptions(),"boolean"==typeof n.plotOptions.tooltip&&(n.plotOptions.tooltipOpts.show=n.plotOptions.tooltip,n.plotOptions.tooltip=n.plotOptions.tooltipOpts,delete n.plotOptions.tooltipOpts),!1!==n.plotOptions.tooltip.show&&void 0!==n.plotOptions.tooltip.show&&(n.tooltipOptions=n.plotOptions.tooltip,n.tooltipOptions.$compat?(n.wfunc="width",n.hfunc="height"):(n.wfunc="innerWidth",n.hfunc="innerHeight"),n.getDomElement(),e(t.getPlaceholder()).bind("plothover",r),e(o).bind("mousemove",i))}),t.hooks.shutdown.push(function(t,n){e(t.getPlaceholder()).unbind("plothover",r),e(n).unbind("mousemove",i)}),t.setTooltipPosition=function(t){var i=n.getDomElement(),r=i.outerWidth()+n.tooltipOptions.shifts.x,o=i.outerHeight()+n.tooltipOptions.shifts.y;t.x-e(window).scrollLeft()>e(window)[n.wfunc]()-r&&(t.x-=r),t.y-e(window).scrollTop()>e(window)[n.hfunc]()-o&&(t.y-=o),n.tipPosition.x=t.x,n.tipPosition.y=t.y},t.showTooltip=function(e,i){var r=n.getDomElement(),o=n.stringFormat(n.tooltipOptions.content,e);""!==o&&(r.html(o),t.setTooltipPosition({x:i.pageX,y:i.pageY}),r.css({left:n.tipPosition.x+n.tooltipOptions.shifts.x,top:n.tipPosition.y+n.tooltipOptions.shifts.y}).show(),"function"==typeof n.tooltipOptions.onHover&&n.tooltipOptions.onHover(e,r))},t.hideTooltip=function(){n.getDomElement().hide().html("")}},i.prototype.getDomElement=function(){var t=e("."+this.tooltipOptions.cssClass);return 0===t.length&&((t=e("<div />").addClass(this.tooltipOptions.cssClass)).appendTo("body").hide().css({position:"absolute"}),this.tooltipOptions.defaultTheme&&t.css({background:"#fff","z-index":"1040",padding:"0.4em 0.6em","border-radius":"0.5em","font-size":"0.8em",border:"1px solid #111",display:"none","white-space":"nowrap"})),t},i.prototype.stringFormat=function(e,t){var i,r,n,o,s=/%s/,a=/%c/,l=/%lx/,u=/%ly/,c=/%x\.{0,1}(\d{0,})/,h=/%y\.{0,1}(\d{0,})/;if(void 0!==t.series.threshold?(i=t.datapoint[0],r=t.datapoint[1],n=t.datapoint[2]):void 0!==t.series.lines&&t.series.lines.steps?(i=t.series.datapoints.points[2*t.dataIndex],r=t.series.datapoints.points[2*t.dataIndex+1],n=""):(i=t.series.data[t.dataIndex][0],r=t.series.data[t.dataIndex][1],n=t.series.data[t.dataIndex][2]),null===t.series.label&&t.series.originSeries&&(t.series.label=t.series.originSeries.label),"function"==typeof e&&(e=e(t.series.label,i,r,t)),"boolean"==typeof e&&!e)return"";if(void 0!==t.series.percent?o=t.series.percent:void 0!==t.series.percents&&(o=t.series.percents[t.dataIndex]),"number"==typeof o&&(e=this.adjustValPrecision(/%p\.{0,1}(\d{0,})/,e,o)),e=void 0!==t.series.label?e.replace(s,t.series.label):e.replace(s,""),e=void 0!==t.series.color?e.replace(a,t.series.color):e.replace(a,""),e=this.hasAxisLabel("xaxis",t)?e.replace(l,t.series.xaxis.options.axisLabel):e.replace(l,""),e=this.hasAxisLabel("yaxis",t)?e.replace(u,t.series.yaxis.options.axisLabel):e.replace(u,""),this.isTimeMode("xaxis",t)&&this.isXDateFormat(t)&&(e=e.replace(c,this.timestampToDate(i,this.tooltipOptions.xDateFormat,t.series.xaxis.options))),this.isTimeMode("yaxis",t)&&this.isYDateFormat(t)&&(e=e.replace(h,this.timestampToDate(r,this.tooltipOptions.yDateFormat,t.series.yaxis.options))),"number"==typeof i&&(e=this.adjustValPrecision(c,e,i)),"number"==typeof r&&(e=this.adjustValPrecision(h,e,r)),void 0!==t.series.xaxis.ticks){var d;d=this.hasRotatedXAxisTicks(t)?"rotatedTicks":"ticks";var p=t.dataIndex+t.seriesIndex;for(var f in t.series.xaxis[d])if(t.series.xaxis[d].hasOwnProperty(p)&&!this.isTimeMode("xaxis",t)){(this.isCategoriesMode("xaxis",t)?t.series.xaxis[d][p].label:t.series.xaxis[d][p].v)===i&&(e=e.replace(c,t.series.xaxis[d][p].label))}}if(void 0!==t.series.yaxis.ticks)for(var f in t.series.yaxis.ticks)if(t.series.yaxis.ticks.hasOwnProperty(f)){(this.isCategoriesMode("yaxis",t)?t.series.yaxis.ticks[f].label:t.series.yaxis.ticks[f].v)===r&&(e=e.replace(h,t.series.yaxis.ticks[f].label))}return void 0!==t.series.xaxis.tickFormatter&&(e=e.replace("%x",t.series.xaxis.tickFormatter(i,t.series.xaxis).replace(/\$/g,"$$"))),void 0!==t.series.yaxis.tickFormatter&&(e=e.replace("%y",t.series.yaxis.tickFormatter(r,t.series.yaxis).replace(/\$/g,"$$"))),n&&(e=e.replace("%ct",n)),e},i.prototype.isTimeMode=function(e,t){return void 0!==t.series[e].options.mode&&"time"===t.series[e].options.mode},i.prototype.isXDateFormat=function(e){return void 0!==this.tooltipOptions.xDateFormat&&null!==this.tooltipOptions.xDateFormat},i.prototype.isYDateFormat=function(e){return void 0!==this.tooltipOptions.yDateFormat&&null!==this.tooltipOptions.yDateFormat},i.prototype.isCategoriesMode=function(e,t){return void 0!==t.series[e].options.mode&&"categories"===t.series[e].options.mode},i.prototype.timestampToDate=function(t,i,r){var n=e.plot.dateGenerator(t,r);return e.plot.formatDate(n,i,this.tooltipOptions.monthNames,this.tooltipOptions.dayNames)},i.prototype.adjustValPrecision=function(e,t,i){var r;return null!==t.match(e)&&""!==RegExp.$1&&(r=RegExp.$1,i=i.toFixed(r),t=t.replace(e,i)),t},i.prototype.hasAxisLabel=function(t,i){return-1!==e.inArray(this.plotPlugins,"axisLabels")&&void 0!==i.series[t].options.axisLabel&&i.series[t].options.axisLabel.length>0},i.prototype.hasRotatedXAxisTicks=function(t){return-1!==e.inArray(this.plotPlugins,"tickRotor")&&void 0!==t.series.xaxis.rotatedTicks};e.plot.plugins.push({init:function(e){new i(e)},options:t,name:"tooltip",version:"0.8.5"})}(jQuery),r("flot.tooltip",["flot"],function(){}),function(e){e.plot.plugins.push({init:function(t){var i=!1;t.hooks.draw.push(function(t,r){i?(e.each(t.getAxes(),function(i,r){var n=r.options||t.getOptions()[i];if(n&&n.axisLabel)if(n.axisLabelUseCanvas){var o=t.getCanvas().getContext("2d");o.save(),o.font=n.axisLabelFontSizePixels+"px "+n.axisLabelFontFamily;var s,a,l=o.measureText(n.axisLabel).width,u=n.axisLabelFontSizePixels;"x"==i.charAt(0)?(s=t.getPlotOffset().left+t.width()/2-l/2,a=t.getCanvas().height):(s=.72*u,a=t.getPlotOffset().top+t.height()/2-l/2),o.translate(s,a),o.rotate("x"==i.charAt(0)?0:-Math.PI/2),o.fillText(n.axisLabel,0,0),o.restore()}else{t.getPlaceholder().find("#"+i+"Label").remove();var c=e('<div id="'+i+'Label" " class="axisLabels" style="position:absolute;">'+n.axisLabel+"</div>");"x"==i.charAt(0)?(c.css("left",t.getPlotOffset().left+t.width()/2-c.outerWidth()/2+"px"),c.css("bottom","0px")):(c.css("top",t.getPlotOffset().top+t.height()/2-c.outerHeight()/2+"px"),c.css("left","0px")),t.getPlaceholder().append(c)}}),i=!1):(e.each(t.getAxes(),function(i,r){var n=r.options||t.getOptions()[i];if(n&&n.axisLabel){var o,s;if(0!=n.axisLabelUseCanvas&&(n.axisLabelUseCanvas=!0),n.axisLabelUseCanvas)n.axisLabelFontSizePixels||(n.axisLabelFontSizePixels=14),n.axisLabelFontFamily||(n.axisLabelFontFamily="sans-serif"),o=n.axisLabelFontSizePixels,s=n.axisLabelFontSizePixels;else{var a=e('<div class="axisLabels" style="position:absolute;">'+n.axisLabel+"</div>");t.getPlaceholder().append(a),o=a.outerWidth(!0),s=a.outerHeight(!0),a.remove()}"x"==i.charAt(0)?r.labelHeight+=s:r.labelWidth+=o,n.labelHeight=r.labelHeight,n.labelWidth=r.labelWidth}}),i=!0,t.setupGrid(),t.draw())})},options:{},name:"axisLabels",version:"1.0"})}(jQuery),r("flot.axislabels",["flot"],function(){}),r("MizarWidgetGui",["jquery","underscore-min","./gui/LayerManagerView","./gui/BackgroundLayersView","./gui/NameResolverView","./gui/ReverseNameResolverView","./gui/PickingManager","./gui/FeaturePopup","./gui/IFrame","./gui/MollweideViewer","./gui/ImageViewer","./gui/MeasureToolSky","./gui/MeasureToolPlanet","./gui/DistanceNavigationView","./gui/SwitchTo2D","./gui/ExportTool","service/Share","service/Samp","./utils/UtilsCore","jquery.ui","flot","flot.tooltip","flot.axislabels"],function(e,t,i,r,n,o,s,a,l,u,c,h,d,p,f,g,m,v,y){var b,x,w,T=function(e,i){if(i.options.gui){x=e,this.mode=t.find(i.options.ctx,function(e){return e.name===i.options.defaultCtx}),b=i.options,w=i.mizarWidgetAPI,this.isMobile=i.options.gui.isMobile,this.activatedContext=w.getContext();var r=this;w.subscribeCtx("layer:fitsSupported",function(e){r.addFitsEvent(e)}),s.init(w,i),m.init({mizar:w,configuration:i.options}),v.init(w,w.getServiceByName(w.SERVICE.Samp),i.options),this.addMouseEvents()}};return T.prototype.addMouseEvents=function(){var t=e("body");t.on("mouseenter","span.defaultImg",function(){e(this).stop().animate({opacity:"0"},100),e(this).siblings(".hoverImg").stop().animate({opacity:"1"},100)}),t.on("mouseleave","span.defaultImg",function(){e(this).stop().animate({opacity:"1"},100),e(this).siblings(".hoverImg").stop().animate({opacity:"0"},100)}),t.on("click",".closeBtn",function(){switch(e(this).parent().attr("id")){case"externalIFrame":l.hide();break;case"selectedFeatureDiv":a.hide();break;default:e(this).parent().fadeOut(300)}})},T.prototype.addFitsEvent=function(t){t.fitsSupported&&(t.onready=function(t){if("fits"===t.format&&t.levelZeroImage)if(t.div){var i=y.formatId(t.name);e("#addFitsView_"+i).button("enable"),t.div.setImage(t.levelZeroImage)}else{e("#fitsView").button("enable"),r.getDiv().setImage(t.levelZeroImage)}})},T.prototype.setAngleDistanceSkyGui=function(e){e&&!this.measureToolSky&&(this.measureToolSky=new h({mizar:w,isMobile:this.isMobile,mode:w.CONTEXT.Sky})),this.activatedContext.setComponentVisibility("measureSkyContainer",e)},T.prototype.setAngleDistancePlanetGui=function(e){e&&(this.measureToolPlanet?this.measureToolPlanet.updateContext(w):this.measureToolPlanet=new d({mizar:w,isMobile:this.isMobile,mode:w.CONTEXT.Planet})),this.activatedContext.setComponentVisibility("measurePlanetContainer",e)},T.prototype.setSwitchTo2D=function(e){e&&!this.switchTo2D&&(this.switchTo2D=new f({mizar:w})),this.activatedContext.setComponentVisibility("switch2DContainer",e)},T.prototype.setSampGui=function(e){this.activatedContext.setComponentVisibility("sampContainer",e)},T.prototype.setShortenerUrlGui=function(e){this.activatedContext.setComponentVisibility("shareContainer",e)},T.prototype.setMollweideMapGui=function(e){e&&!this.mollweideViewer&&(this.mollweideViewer=new u({mizar:w,mizarBaseUrl:b.global.mizarBaseUrl})),this.activatedContext.setComponentVisibility("2dMapContainer",e)},T.prototype.setReverseNameResolverGui=function(e){e&&(o.isInitialized()||o.init(w))},T.prototype.setDistanceGui=function(e){e?p.isInitialized()?p.update(w):p.init(w,"distTracker"):p.unregisterEvents(),this.activatedContext.setComponentVisibility("distanceDiv",e)},T.prototype.setNameResolverGui=function(e){e&&(n.isInitialized()||n.init(w)),this.activatedContext.setComponentVisibility("searchDiv",e)},T.prototype.setCategoryGui=function(t){t&&(i.isInitialized()||i.init(w,e.extend({element:e(x).find("#categoryDiv")},b))),this.activatedContext.setComponentVisibility("categoryDiv",t)},T.prototype.setImageViewerGui=function(e){b.isMobile||(e&&(c.isInitialized()||c.init(w)),this.activatedContext.setComponentVisibility("imageViewerDiv",e))},T.prototype.setExportGui=function(e){e&&(this.exportTool||(this.exportTool=new g({mizar:w}))),this.activatedContext.setComponentVisibility("exportContainer",e)},T.prototype.getMizarWidgetAPI=function(){return w},T.prototype.setUpdatedActivatedContext=function(e){this.activatedContext=e},T}),r("text!templates/mizarCore.html",[],function(){return'<div id="webGLNotAvailable">\n    If you see this message, WebGL is not supported in your browser.<br/>\n    Please install a recent version of <a href="http://www.mozilla.com">Firefox</a> or <a\n        href="http://www.google.com/chrome">Google Chrome</a>.<br/>\n    If you already have a recent version of Firefox or Google Chrome, your graphics driver are too old, please update\n    it.<br/>\n    On Google Chrome, you can check why it is not working by entering "about:gpu" in the url bar.\n</div>\n\n<div id="webGLContextLost">\n    Hmmm......can\'t get the background layer<br/>\n    Please check your network or your configuration.\n</div>\n\n<div id="splash">\n    <h1>Welcome to Mizar</h1>\n    <div id="loadingSplash"></div>\n    <div id="splash-logo"></div>\n</div>\n<div id="loading"></div>\n\n<div class="canvas">\n\n    \x3c!-- Side bar will contain available layers --\x3e\n    <div id="categoryDiv">\n    </div>\n\n    <div class="" id="rightTopPopup"></div>\n\n    <div class="" id="popupElevation">\n    </div>\n\n    <a href="#" id="elevationTrackingBtn" style="position:absolute; display:none;" class="elevationTrackingPopup"></a>\n\n    <div class="noSelect" id="distanceDiv"></div>\n    <div class="noSelect" id="navigationDiv">\n        <div id="searchDiv">\n        </div>\n\n        <div id="compassDiv">\n        </div>\n\n        <div id="timeTravelDiv"></div>\n        <div id="textTimeTravelDiv"></div>\n\n        <div id="legendDiv" class="row">\n        </div>\n\n        <div id="imageViewerDiv">\n        </div>\n\n    </div>\n\n\n    \x3c!-- Left-Bottom-section --\x3e\n    <div class="noSelect" id="leftBottomDiv">\n        \x3c!-- Div for relative position 164 = define height of mollweideContent--\x3e\n        <div id="2dMapContainer" style="display: none; position: relative; height: 164px; margin-bottom: 5px;">\n            <div id="mollweideDiv">\n\t\t\t\t<span id="mollweideContent">\n\t\t\t\t\t<canvas id="mollweideCanvas" class="noSelect" width="232px" height="116px"></canvas>\n\t\t\t\t\t<div id="fov" class="ui-widget">Fov : 45 x 45</div>\n\t\t\t\t</span>\n\n                <span id="slideArrow"></span>\n            </div>\n        </div>\n        <div id="shareContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="share"/>\n\n            <div id="shareResult" style="pointer-events : auto;">\n                <input type="text" id="shareInput"/>\n                <input type="button" id="shareClear"/>\n            </div>\n        </div>\n        <div id="sampContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="sampInvoker"/>\n        </div>\n        <div id="measureSkyContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="measureSkyInvoker"/>\n        </div>\n        <div id="measurePlanetContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="measurePlanetInvoker"/>\n        </div>\n        <div id="switch2DContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="switch2DButton"/>\n        </div>\n        <div id="exportContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="exportInvoker"/>\n        </div>\n        <div id="searchContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="searchInvoker"/>\n        </div>\n        <div id="warningContainer" style="display: none;" class="leftBottomButton">\n            <input type="button" id="warningButton"/>\n        </div>\n        <div style="display: none;" id="fps" class="statBox ui-widget">FPS : 0</div>\n    </div>\n\n    <div id="attributions">\n        <div class="noSelect" id="skyAttributions"></div>\n        <div class="noSelect" id="globeAttributions"></div>\n    </div>\n    <div id="resultNavigation"></div>\n    <div id="tracker">\n        <div id="posTrackerInfo" class="noSelect"></div>\n        <div id="posTracker" class="noSelect"></div>\n        <div id="elevTracker" class="noSelect"></div>\n    </div>\n\n    <canvas class="noSelect" id="GlobWebCanvas" style="border: none; margin: 0; padding: 0;">\n    </canvas>\n\n</div>\n'}),r("MizarWidgetAPI",["jquery","underscore-min","./utils/UtilsCore","MizarWidgetGui","./uws/UWSManager","gw/Mizar","gw/Gui/dialog/ErrorDialog","text!templates/mizarCore.html"],function(e,t,i,r,n,o,s,a){var l,u,c,h=function(t){return e.ajax({type:"GET",url:t,cache:!1,async:!1}).responseText},d=function(e,t){return e+(e.indexOf("?")>=0?"&":"?")+"uuid="+t},p=function(e){l.navigation.initTarget=e.initTarget,l.navigation.initFov=e.fov,l.navigation.up=e.up,l.layerVisibility=e.visibility};function f(e,t){if(e.getMode()===e.CONTEXT.Sky)e.setAngleDistancePlanetGui(!1),e.setAngleDistanceSkyGui(!0),e.setSwitchTo2D(!1),e.setSampGui(!0),e.setShortenerUrlGui(!1),e.setMollweideMapGui(!0),e.setReverseNameResolverGui(!0),e.setNameResolverGui(!0),e.setCategoryGui(!0),e.setImageViewerGui(!0),e.setExportGui(!0),e.setDistanceGui(!1);else if(e.getMode()===e.CONTEXT.Planet)e.setAngleDistanceSkyGui(!1),e.setAngleDistancePlanetGui(!0),e.setSwitchTo2D(!0),e.setSampGui(!1),e.setShortenerUrlGui(!1),e.setMollweideMapGui(!1),e.setReverseNameResolverGui(!1),e.setNameResolverGui(!0),e.setCategoryGui(!0),e.setImageViewerGui(!0),e.setExportGui(!1),e.setDistanceGui(!0);else{if(e.getMode()!==e.CONTEXT.Ground)throw"Unable to find mizar.mode="+mizar.mode;e.setAngleDistanceSkyGui(!1),e.setAngleDistancePlanetGui(!1),e.setSwitchTo2D(!1),e.setSampGui(!1),e.setShortenerUrlGui(!1),e.setMollweideMapGui(!1),e.setReverseNameResolverGui(!1),e.setNameResolverGui(!1),e.setCategoryGui(!0),e.setImageViewerGui(!0),e.setExportGui(!1),e.setDistanceGui(!1)}}var g=function(){var e=u.ProviderFactory.create(o.PROVIDER.Crater);u.registerNoStandardDataProvider("crater",e.loadFiles);var t=u.ProviderFactory.create(o.PROVIDER.Trajectory);u.registerNoStandardDataProvider("trajectory",t.loadFiles)};function m(){e(c.div).find("#loading").hide(),e(c.div).find("#splash").hide()}var v=function(h,d,v){this.div="#"+h;var y,b,x,w,T,_,C,S=(y=document.getElementsByTagName("script"),(b=t.find(y,function(e){return-1!==e.src.indexOf("MizarWidget.min")}))?b.src.split("/").slice(0,-1).join("/")+"/":(b=t.find(y,function(e){return-1!==e.src.indexOf("MizarWidgetAPI")})).src.split("/").slice(0,-1).join("/")+"/../");d.global.mizarBaseUrl=S,d.ctx=this._loadConfigFiles(S,d.ctx),function(e){var t;for(ctx in e)t=e[ctx].context.init.coordinateSystem.geoideName,e[ctx].mode=o.CRS_TO_CONTEXT[t]}(d.ctx),c=this,this.options=(x=d,w="ontouchstart"in window||void 0!==window.DocumentTouch&&window.DocumentTouch&&document instanceof DocumentTouch,T=x.global.sitoolsBaseUrl?x.global.sitoolsBaseUrl:"http://demonstrator.telespazio.com/sitools",_=x.global.proxyUrl?x.global.proxyUrl:null,C=null!=x.global.proxyUse&&x.global.proxyUse,l={},e.extend(l,x),l.global.sitoolsBaseUrl=T,l.global.proxyUrl=_,l.global.proxyUse=C,l.global.isMobile=w,l);var E=t.template(a,{});e(this.div).append(E),function(t){var i=window.document.documentURI,r=i.indexOf("sharedParameters=");if(-1!==r){var n=r+"sharedParameters=".length,o=i.substr(n);if(t.shortener)e.ajax({type:"GET",url:t.shortener.baseUrl+"/"+o,async:!1,success:function(e){p(e)},error:function(e){console.error(e)}});else{console.log("Shortener plugin isn't defined, try to extract as a string");var s=JSON.parse(decodeURI(o));p(s)}}}(l),u=new o({canvas:e(this.div).find("#GlobWebCanvas")[0],configuration:{mizarBaseUrl:this.options.global.mizarBaseUrl,debug:this.options.gui.debug,isMobile:this.options.gui.isMobile,positionTracker:this.options.gui.positionTracker,elevationTracker:this.options.gui.elevationTracker,registry:this.options.gui.registry,proxyUse:this.options.global.proxyUse,proxyUrl:this.options.global.proxyUrl}});var A,I,M,k=t.find(this.options.ctx,function(e){return e.name===d.defaultCtx});if(void 0===k)throw"Unable to find the default context";this.mode=k.mode,k.context.init.isMobile=this.options.gui.isMobile,u.createContext(this.mode,k.context.init),this.mizarWidgetGui=new r(this.div,{mizarWidgetAPI:this,options:this.options}),f(this,this.mode),this.subscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m),this.subscribeMizar(o.EVENT_MSG.MIZAR_MODE_TOGGLE,m),A=u.ProviderFactory.create(o.PROVIDER.Planet),I=u.ProviderFactory.create(o.PROVIDER.Star),M=u.ProviderFactory.create(o.PROVIDER.Constellation),u.registerNoStandardDataProvider("planets",A.loadFiles),u.registerNoStandardDataProvider("constellation",M.loadFiles),u.registerNoStandardDataProvider("star",I.loadFiles),g(),this.options.gui.stats.visible&&(u.createStats({element:e("#fps"),verbose:!!this.options.gui.stats.verbose&&this.options.gui.stats.verbose}),e("#fps").show()),u.getServiceByName(o.SERVICE.NameResolver).init(u),u.getServiceByName(o.SERVICE.ReverseNameResolver).init(u),n.init(l),i.init(this,l),u.getServiceByName(o.SERVICE.MocBase).init(this,l),document.addEventListener("keydown",function(t){!0===t.ctrlKey&&32===t.keyCode&&e(".canvas > canvas").siblings(":not(canvas)").each(function(){e(this).fadeToggle()})}),s.setIcon("#warningButton"),e("#warningButton").on("click",function(){!0===s.isActive()?s.hide():s.view()})};return v.prototype.init=function(){for(var i=this.options,r=t.find(this.options.ctx,function(e){return e.name===i.defaultCtx}),n=0;n<r.context.layers.length;n++){var s=r.context.layers[n];u.addLayer(s,function(e){u.getLayerByID(e).type===o.LAYER.WCSElevation&&u.setBaseElevationByID(e)},function(t){console.error(t),t.layerDescription.background&&(e(c.div).find("#loading").hide(),e(c.div).find("#splash").hide(),e(c.div).find("canvas").hide(),e(c.div).find("#navigationDiv").hide(),e(c.div).find("#webGLContextLost").show())})}},v.prototype._loadConfigFiles=function(e,t){for(var i,r,n,o,s=[],a=(i=(new Date).getTime(),i+=parseInt(100*Math.random()).toString()),l=0;l<t.length;l++){var u,c=t[l];u=c.context.toLowerCase().startsWith("http")?c.context:e+"/conf/"+c.context,u=d(u,a);var p=h(u);c.context=JSON.parse((r=p,void 0,void 0,n=new RegExp("/\\*(.|[\r\n])*?\\*/","g"),o=new RegExp("[^:]//.*[\r\n]","g"),r=(r=r.replace(o,"")).replace(n,""))),s.push(c)}return s},v.prototype.getMizarWidgetGui=function(){return this.mizarWidgetGui},v.prototype.getContext=function(){return u.getActivatedContext()},v.prototype.getRenderContext=function(){return u.getRenderContext()},v.prototype.getScene=function(){return u.getActivatedContext()._getGlobe()},v.prototype.getNavigation=function(){return u.getActivatedContext().getNavigation()},v.prototype.getCrs=function(){return u.getCrs()},v.prototype.setCrs=function(e){u.setCrs(e)},v.prototype.subscribeMizar=function(e,t){u.subscribe(e,t)},v.prototype.unsubscribeMizar=function(e,t){u.unsubscribe(e,t)},v.prototype.publishMizar=function(e,t){u.publish(e,t)},v.prototype.subscribeCtx=function(e,t){u.getActivatedContext().subscribe(e,t)},v.prototype.unsubscribeCtx=function(e,t){u.getActivatedContext().unsubscribe(e,t)},v.prototype.publishCtx=function(e,t){u.getActivatedContext().publish(e,t)},v.prototype.refresh=function(){u.getActivatedContext().refresh()},v.prototype.getTileManager=function(){return u.getActivatedContext().getTileManager()},v.prototype.addLayer=function(e){return e.coordinateSystem&&(e.coordinateSystem={geoideName:e.coordinateSystem}),u.addLayer(e)},v.prototype.getServiceByName=function(e,t){return u.getServiceByName(e,t)},v.prototype.SERVICE=o.SERVICE,v.prototype.LAYER=o.LAYER,v.prototype.CONTEXT=o.CONTEXT,v.prototype.CRS=o.CRS,v.prototype.GEOMETRY=o.GEOMETRY,v.prototype.UTILITY=o.UTILITY,v.prototype.NAVIGATION=o.NAVIGATION,v.prototype.LAYER=o.LAYER,v.prototype.EVENT_MSG=o.EVENT_MSG,v.prototype.setAngleDistanceSkyGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setAngleDistanceSkyGui(e)},v.prototype.setAngleDistancePlanetGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setAngleDistancePlanetGui(e)},v.prototype.setSwitchTo2D=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setSwitchTo2D(e)},v.prototype.setSampGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setSampGui(e)},v.prototype.setShortenerUrlGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setShortenerUrlGui(e)},v.prototype.setMollweideMapGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setMollweideMapGui(e)},v.prototype.setReverseNameResolverGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setReverseNameResolverGui(e)},v.prototype.setDistanceGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setDistanceGui(e)},v.prototype.setNameResolverGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setNameResolverGui(e)},v.prototype.setCategoryGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setCategoryGui(e)},v.prototype.setImageViewerGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setImageViewerGui(e)},v.prototype.setExportGui=function(e){this.mizarWidgetGui&&this.mizarWidgetGui.setExportGui(e)},v.prototype.getMode=function(){return u.getActivatedContext().getMode()},v.prototype.toggleDimension=function(e){u.toggleDimension(),this.setAngleDistancePlanetGui(!0),this.setSwitchTo2D(!0)},v.prototype.isSkyContext=function(){return this.getMode()===o.CONTEXT.Sky},v.prototype.isPlanetContext=function(){return this.getMode()===o.CONTEXT.Planet},v.prototype.isGroundContext=function(){return this.getMode()===o.CONTEXT.Ground},v.prototype.createMarsContext=function(){this.unsubscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m),e(this.div).find("#loading").show();this.options;var i=t.find(this.options.ctx,function(e){return"mars"===e.name});if(void 0===i)throw"Unable to get the Mars context";i.context.init.isMobile=this.options.gui.isMobile,u.createContext(o.CONTEXT.Planet,i.context.init);var r=this;u.toggleToContext(u.getPlanetContext(),{mustBeHidden:!0,callback:function(){f(r,r.getMode()),r.subscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m)}}),g();for(var n=0;n<i.context.layers.length;n++){var s=i.context.layers[n];u.addLayer(s,function(e){u.getLayerByID(e).getType()===o.LAYER.WCSElevation&&u.setBaseElevationByID(e)})}r.mizarWidgetGui.setUpdatedActivatedContext(r.getContext())},v.prototype.createCuriosityContext=function(){this.unsubscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m),e(this.div).find("#loading").show();this.options;var i=t.find(this.options.ctx,function(e){return"curiosity"===e.name});i.context.init.isMobile=this.options.gui.isMobile,u.createContext(o.CONTEXT.Ground,i.context.init);var r=this;u.toggleToContext(u.getGroundContext(),{mustBeHidden:!0,callback:function(){f(r,r.getMode()),r.subscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m)}});for(var n=0;n<i.context.layers.length;n++){var s=i.context.layers[n];u.addLayer(s,function(e){u.getLayerByID(e).getType()===o.LAYER.WCSElevation&&u.setBaseElevationByID(e)})}r.mizarWidgetGui.setUpdatedActivatedContext(r.getContext())},v.prototype.createSunContext=function(){this.unsubscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m),e(this.div).find("#loading").show();this.options;var i=t.find(this.options.ctx,function(e){return"sun"===e.name});i.context.init.isMobile=this.options.gui.isMobile,u.createContext(o.CONTEXT.Planet,i.context.init);var r=this;u.toggleToContext(u.getPlanetContext(),{mustBeHidden:!0,callback:function(){f(r,r.getMode()),r.subscribeCtx(o.EVENT_MSG.BASE_LAYERS_READY,m)}});for(var n=0;n<i.context.layers.length;n++){var s=i.context.layers[n];u.addLayer(s,function(e){u.getLayerByID(e).getType()===o.LAYER.WCSElevation&&u.setBaseElevationByID(e)})}r.mizarWidgetGui.setUpdatedActivatedContext(r.getContext())},v.prototype.toggleToSky=function(){var t;e(this.div).find("#loading").show(),u.getMode()===o.CONTEXT.Planet?t=u.getSkyContext():u.getMode()===o.CONTEXT.Ground&&(t=u.getPlanetContext()),u.toggleToContext(t,{mustBeDestroyed:!0}),c.mizarWidgetGui.setUpdatedActivatedContext(c.getContext())},v.prototype.getMizarAPI=function(){return u},v.prototype.addLayerByDragNDrop=function(e,t){u.addLayer({name:e,type:o.LAYER.GeoJSON,pickable:!0,deletable:!0,visible:!0},function(e){u.getLayerByID(e).addFeatureCollection(t)})},v.prototype.getLayers=function(){return u.getLayers()},v.prototype.removeLayer=function(e){return u.removeLayer(e)},v.prototype.getLayerByName=function(e){return u.getLayerByName(e)},v.prototype.getLayerByID=function(e){return u.getLayerByID(e)},v.prototype.setBackgroundLayer=function(e){return u.setBackgroundLayer(e)},v.prototype.hasSkyContext=function(){return null!=u.getSkyContext()},v.prototype.hasPlanetContext=function(){return null!=u.getPlanetContext()},v.prototype.createLayerFromFits=function(e,t){},v}),r("MizarWidget",["./MizarWidgetAPI"],function(e){var t=function(t,i){this.mizarWidgetAPI=new e(t,i)};return t.prototype.getMizarWidgetAPI=function(){return this.mizarWidgetAPI},window.MizarWidget=t,t}),r("jquery",function(){return e}),t("MizarWidget")});